<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DistributionChart ãƒ†ã‚¹ãƒˆ</title>

    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="styles/base.css?v=20251115">
    <link rel="stylesheet" href="styles/results.css?v=20251115">

    <!-- Lucideã‚¢ã‚¤ã‚³ãƒ³ -->
    <script src="https://unpkg.com/lucide@0.263.0/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="container" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
        <h1 class="text-3xl font-bold text-white mb-6">DistributionChart ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ</h1>

        <!-- ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬è¡¨ç¤ºï¼ˆèª¬æ˜ã‚ã‚Šãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ãªã—ï¼‰ -->
        <section class="glass-card">
            <h2 class="heading-md">
                <i data-lucide="bar-chart-3" class="text-blue-300"></i>
                <span>ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬è¡¨ç¤º</span>
            </h2>
            <div id="test-basic"></div>
        </section>

        <!-- ãƒ†ã‚¹ãƒˆ2: ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³è¡¨ç¤º -->
        <section class="glass-card">
            <div class="section-header-row">
                <h2 class="heading-md">
                    <i data-lucide="help-circle" class="text-blue-300"></i>
                    <span>ãƒ†ã‚¹ãƒˆ2: ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³è¡¨ç¤º</span>
                </h2>
                <div id="help-button-container" class="section-header-help"></div>
            </div>
            <div id="test-with-help"></div>
        </section>

        <!-- ãƒ†ã‚¹ãƒˆ3: ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤ºï¼ˆæ”¹å–„ä¸­ï¼‰ -->
        <section class="glass-card">
            <h2 class="heading-md">
                <i data-lucide="trending-up" class="text-green-300"></i>
                <span>ãƒ†ã‚¹ãƒˆ3: æ”¹å–„ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º</span>
            </h2>
            <div id="test-trend-improving"></div>
        </section>

        <!-- ãƒ†ã‚¹ãƒˆ4: ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤ºï¼ˆæ‚ªåŒ–ï¼‰ -->
        <section class="glass-card">
            <h2 class="heading-md">
                <i data-lucide="trending-down" class="text-orange-300"></i>
                <span>ãƒ†ã‚¹ãƒˆ4: æ‚ªåŒ–ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º</span>
            </h2>
            <div id="test-trend-declining"></div>
        </section>

        <!-- ãƒ†ã‚¹ãƒˆ5: ãƒ‡ãƒ¼ã‚¿ãªã— -->
        <section class="glass-card">
            <h2 class="heading-md">
                <i data-lucide="inbox" class="text-white-60"></i>
                <span>ãƒ†ã‚¹ãƒˆ5: ãƒ‡ãƒ¼ã‚¿ãªã—</span>
            </h2>
            <div id="test-no-data"></div>
        </section>

        <!-- ãƒ†ã‚¹ãƒˆ6: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã— -->
        <section class="glass-card">
            <h2 class="heading-md">
                <i data-lucide="zap-off" class="text-white-60"></i>
                <span>ãƒ†ã‚¹ãƒˆ6: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—</span>
            </h2>
            <div id="test-no-animation"></div>
        </section>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="js/lucide-init.js"></script>
    <script src="js/evaluation-calculator.js"></script>
    <script src="js/components/DistributionChart.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTestSessionData(sessionCount = 10) {
            const sessions = [];
            const now = Date.now();

            for (let i = 0; i < sessionCount; i++) {
                const pitchErrors = [];
                const sessionDate = now - (sessionCount - i) * 24 * 60 * 60 * 1000; // 1æ—¥ãšã¤éå»ã«

                // 8éŸ³ã®ã‚¨ãƒ©ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                for (let j = 0; j < 8; j++) {
                    const errorInCents = (Math.random() - 0.5) * 100; // -50 ~ +50cents
                    pitchErrors.push({ errorInCents });
                }

                sessions.push({
                    lessonId: `lesson_${sessionDate}_random_up_asc`,
                    startTime: sessionDate,
                    pitchErrors
                });
            }

            return sessions;
        }

        // æ”¹å–„å‚¾å‘ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateImprovingData() {
            const sessions = [];
            const now = Date.now();

            for (let i = 0; i < 20; i++) {
                const pitchErrors = [];
                const sessionDate = now - (20 - i) * 24 * 60 * 60 * 1000;

                // éå»1é€±é–“ï¼ˆæœ€æ–°7ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã¯ç²¾åº¦ãŒå‘ä¸Š
                const isRecent = i >= 13;
                const errorRange = isRecent ? 30 : 50; // æœ€è¿‘ã®æ–¹ãŒèª¤å·®ãŒå°ã•ã„

                for (let j = 0; j < 8; j++) {
                    const errorInCents = (Math.random() - 0.5) * errorRange;
                    pitchErrors.push({ errorInCents });
                }

                sessions.push({
                    lessonId: `lesson_${sessionDate}_random_up_asc`,
                    startTime: sessionDate,
                    pitchErrors
                });
            }

            return sessions;
        }

        // æ‚ªåŒ–å‚¾å‘ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateDecliningData() {
            const sessions = [];
            const now = Date.now();

            for (let i = 0; i < 20; i++) {
                const pitchErrors = [];
                const sessionDate = now - (20 - i) * 24 * 60 * 60 * 1000;

                // éå»1é€±é–“ï¼ˆæœ€æ–°7ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã¯ç²¾åº¦ãŒæ‚ªåŒ–
                const isRecent = i >= 13;
                const errorRange = isRecent ? 70 : 40; // æœ€è¿‘ã®æ–¹ãŒèª¤å·®ãŒå¤§ãã„

                for (let j = 0; j < 8; j++) {
                    const errorInCents = (Math.random() - 0.5) * errorRange;
                    pitchErrors.push({ errorInCents });
                }

                sessions.push({
                    lessonId: `lesson_${sessionDate}_random_up_asc`,
                    startTime: sessionDate,
                    pitchErrors
                });
            }

            return sessions;
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª DistributionChart ãƒ†ã‚¹ãƒˆé–‹å§‹');

            // ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬è¡¨ç¤º
            const basicData = generateTestSessionData(10);
            window.DistributionChart.render({
                containerId: 'test-basic',
                sessionData: basicData,
                showTrend: false,
                animate: true,
                showDescription: true
            });

            // ãƒ†ã‚¹ãƒˆ2: ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³è¡¨ç¤º
            // è¦‹å‡ºã—è¡Œã«ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥
            const helpButtonContainer = document.getElementById('help-button-container');
            helpButtonContainer.innerHTML = window.DistributionChart.getHelpButton('test-with-help');

            window.DistributionChart.render({
                containerId: 'test-with-help',
                sessionData: basicData,
                showTrend: false,
                animate: true,
                showDescription: true,
                showHelpButton: true  // ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼ç”Ÿæˆãƒ•ãƒ©ã‚°
            });

            // ãƒ†ã‚¹ãƒˆ3: æ”¹å–„ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º
            const improvingData = generateImprovingData();
            window.DistributionChart.render({
                containerId: 'test-trend-improving',
                sessionData: improvingData,
                showTrend: true,
                trendPeriod: 'week',
                animate: true,
                showDescription: true
            });

            // ãƒ†ã‚¹ãƒˆ4: æ‚ªåŒ–ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º
            const decliningData = generateDecliningData();
            window.DistributionChart.render({
                containerId: 'test-trend-declining',
                sessionData: decliningData,
                showTrend: true,
                trendPeriod: 'week',
                animate: true,
                showDescription: true
            });

            // ãƒ†ã‚¹ãƒˆ5: ãƒ‡ãƒ¼ã‚¿ãªã—
            window.DistributionChart.render({
                containerId: 'test-no-data',
                sessionData: [],
                showTrend: false,
                animate: true,
                showDescription: true
            });

            // ãƒ†ã‚¹ãƒˆ6: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—
            window.DistributionChart.render({
                containerId: 'test-no-animation',
                sessionData: basicData,
                showTrend: false,
                animate: false,
                showDescription: false
            });

            console.log('âœ… DistributionChart ãƒ†ã‚¹ãƒˆå®Œäº†');
        });
    </script>
</body>
</html>
