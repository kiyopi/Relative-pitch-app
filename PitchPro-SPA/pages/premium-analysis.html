<!-- プレミアム分析ページ（SPA用テンプレート） -->
<!-- このファイルはrouter.jsによって#app-rootに動的読み込みされます -->

<div class="page-container">
    <!-- ページヘッダー（横並び・コンパクト） -->
    <header class="page-header">
        <div class="page-header-content">
            <div class="page-header-icon-wrapper">
                <div class="page-header-icon gradient-catalog-purple">
                    <i data-lucide="bar-chart-3" class="text-white" data-stroke-width="2" style="width: 36px; height: 36px;"></i>
                </div>
            </div>
            <div class="page-header-text">
                <h1 class="page-title">詳細分析</h1>
                <p class="page-subtitle">あなたの音感を科学的に分析します</p>
            </div>
        </div>
    </header>

    <!-- タブナビゲーション -->
    <div class="tab-navigation">
        <button class="tab-button active" data-tab="tab-accuracy">
            <i data-lucide="music"></i>
            <span>音程精度</span>
        </button>
        <button class="tab-button" data-tab="tab-patterns">
            <i data-lucide="alert-triangle"></i>
            <span>エラー分析</span>
        </button>
        <button class="tab-button" data-tab="tab-practice">
            <i data-lucide="target"></i>
            <span>練習プラン</span>
        </button>
        <button class="tab-button" data-tab="tab-growth">
            <i data-lucide="trending-up"></i>
            <span>成長記録</span>
        </button>
    </div>

    <!-- Tab 1: 音程精度分析 -->
    <section id="tab-accuracy" class="tab-content active">
        <!-- 平均音程精度 -->
        <div class="glass-card">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="music" class="text-blue-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">平均音程精度</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                すべての測定データの平均誤差です。<br>
                ±20¢以内が「Excellent」、±35¢以内が「Good」の目安です。
            </p>
            <div style="text-align: center; padding: 2rem 0;">
                <div id="average-accuracy" style="color: #10b981; font-size: 3rem; font-weight: 700; margin-bottom: 0.5rem;">
                    ±--¢
                </div>
                <p style="color: #cbd5e1; font-size: 1rem; margin: 0;">
                    全<span id="total-data-points">--</span>音のデータから算出
                </p>
            </div>

            <!-- モード別平均精度 -->
            <div id="mode-accuracy-summary" class="mode-accuracy-summary">
                <!-- ランダム基音 -->
                <div class="mode-accuracy-card">
                    <div class="mode-accuracy-card-title">
                        <i data-lucide="shuffle" style="width: 16px; height: 16px;"></i>
                        <span>ランダム基音</span>
                    </div>
                    <div id="random-accuracy-value" class="mode-accuracy-card-value text-purple-300">--</div>
                    <div class="mode-accuracy-details">
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">上行</span>
                            <span id="random-asc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">下行</span>
                            <span id="random-desc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                    </div>
                </div>

                <!-- 連続チャレンジ -->
                <div class="mode-accuracy-card">
                    <div class="mode-accuracy-card-title">
                        <i data-lucide="repeat" style="width: 16px; height: 16px;"></i>
                        <span>連続チャレンジ</span>
                    </div>
                    <div id="continuous-accuracy-value" class="mode-accuracy-card-value text-blue-300">--</div>
                    <div class="mode-accuracy-details">
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">上行</span>
                            <span id="continuous-asc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">下行</span>
                            <span id="continuous-desc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                    </div>
                </div>

                <!-- 12音階 -->
                <div class="mode-accuracy-card">
                    <div class="mode-accuracy-card-title">
                        <i data-lucide="music-2" style="width: 16px; height: 16px;"></i>
                        <span>12音階</span>
                    </div>
                    <div id="12tone-accuracy-value" class="mode-accuracy-card-value text-green-300">--</div>
                    <div class="mode-accuracy-details">
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">上行</span>
                            <span id="12tone-asc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                        <div class="mode-accuracy-detail-row">
                            <span class="mode-accuracy-detail-label">下行</span>
                            <span id="12tone-desc-value" class="mode-accuracy-detail-value">--</span>
                        </div>
                        <div class="mode-accuracy-12tone-extra">
                            <div class="mode-accuracy-detail-row">
                                <span class="mode-accuracy-detail-label">上昇</span>
                                <span id="12tone-chromatic-asc-value" class="mode-accuracy-detail-value">--</span>
                            </div>
                            <div class="mode-accuracy-detail-row">
                                <span class="mode-accuracy-detail-label">下降</span>
                                <span id="12tone-chromatic-desc-value" class="mode-accuracy-detail-value">--</span>
                            </div>
                            <div class="mode-accuracy-detail-row">
                                <span class="mode-accuracy-detail-label">両方向</span>
                                <span id="12tone-chromatic-both-value" class="mode-accuracy-detail-value">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 音程間隔別精度 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="bar-chart-3" class="text-yellow-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">音程間隔別精度</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                2度〜8度の各音程間隔ごとの平均誤差を表示します。<br>
                苦手な音程を特定し、重点的に練習しましょう。
            </p>

            <div id="interval-accuracy-list" style="display: flex; flex-direction: column; gap: 1rem;">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- 上行・下行比較（Phase 4で有効化） -->
        <div id="ascending-descending-section" class="glass-card" style="margin-top: 1.5rem; display: none;">
            <div class="flex items-center gap-3" style="margin-bottom: 1.5rem;">
                <i data-lucide="arrow-up-down" class="text-purple-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">上行・下行音程比較</h3>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="background: rgba(255, 255, 255, 0.08); padding: 1.5rem; border-radius: 12px; text-align: center;">
                    <h4 style="color: white; font-weight: 600; margin-bottom: 0.75rem; font-size: 1.125rem;">上行音程</h4>
                    <div id="ascending-accuracy" style="color: #10b981; font-weight: 700; font-size: 2rem; margin-bottom: 0.5rem;">±--¢</div>
                    <p style="color: #cbd5e1; font-size: 0.875rem; margin: 0;">音程を上がる時の精度</p>
                </div>
                <div style="background: rgba(255, 255, 255, 0.08); padding: 1.5rem; border-radius: 12px; text-align: center;">
                    <h4 style="color: white; font-weight: 600; margin-bottom: 0.75rem; font-size: 1.125rem;">下行音程</h4>
                    <div id="descending-accuracy" style="color: #f59e0b; font-weight: 700; font-size: 2rem; margin-bottom: 0.5rem;">±--¢</div>
                    <p style="color: #cbd5e1; font-size: 0.875rem; margin: 0;">音程を下がる時の精度</p>
                </div>
            </div>
        </div>

        <!-- 音域ブロック分析 -->
        <div class="glass-card brain-processing-section" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="layers" class="text-cyan-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">音域ブロック分析</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                12音をAブロック（C〜F#）とBブロック（G〜B）に分け、それぞれの精度を比較します。<br>
                両ブロックの誤差を均等に改善することで、相対音感のバランスが向上します。
            </p>

            <!-- Aブロック vs Bブロック 比較 -->
            <div class="brain-processing-comparison">
                <!-- Aブロック -->
                <div class="brain-group-card">
                    <div class="brain-group-title">
                        <i data-lucide="circle" class="text-blue-300" style="width: 18px; height: 18px;"></i>
                        <span>Aブロック</span>
                    </div>
                    <div class="brain-group-notes">C C# D D# E F F#</div>
                    <div class="brain-group-avg">
                        <p class="brain-group-avg-label">平均誤差</p>
                        <div id="left-brain-avg" class="brain-group-avg-value" style="color: #10b981;">±--¢</div>
                    </div>
                    <div class="progress-bar" style="margin-bottom: 0.75rem;">
                        <div id="left-brain-progress" class="progress-fill gradient-catalog-blue" style="width: 0%;"></div>
                    </div>
                    <p id="left-brain-count" class="brain-group-count">測定回数: --</p>
                </div>

                <!-- Bブロック -->
                <div class="brain-group-card">
                    <div class="brain-group-title">
                        <i data-lucide="zap" class="text-purple-300" style="width: 18px; height: 18px;"></i>
                        <span>Bブロック</span>
                    </div>
                    <div class="brain-group-notes">G G# A B♭ B</div>
                    <div class="brain-group-avg">
                        <p class="brain-group-avg-label">平均誤差</p>
                        <div id="both-brain-avg" class="brain-group-avg-value" style="color: #f59e0b;">±--¢</div>
                    </div>
                    <div class="progress-bar" style="margin-bottom: 0.75rem;">
                        <div id="both-brain-progress" class="progress-fill gradient-catalog-purple" style="width: 0%;"></div>
                    </div>
                    <p id="both-brain-count" class="brain-group-count">測定回数: --</p>
                </div>
            </div>

            <!-- ブロック間の誤差 -->
            <div class="brain-difficulty-section">
                <div class="brain-difficulty-title">
                    <i data-lucide="bar-chart-3" class="text-orange-300" style="width: 18px; height: 18px;"></i>
                    <span>ブロック間の誤差</span>
                </div>
                <div id="brain-difficulty-value" class="brain-difficulty-value" style="color: #f59e0b;">--</div>
                <p id="brain-difficulty-analysis" class="brain-difficulty-analysis"></p>
            </div>

            <!-- Bブロックの詳細分析 -->
            <div class="brain-notes-detail-section">
                <div class="brain-notes-detail-title">
                    <i data-lucide="music" class="text-green-300" style="width: 18px; height: 18px;"></i>
                    <span>Bブロックの詳細分析</span>
                </div>
                <div id="brain-notes-detail-list" class="brain-notes-detail-list">
                    <!-- 動的に生成される -->
                </div>
            </div>
        </div>

    </section>

    <!-- Tab 2: エラーパターン分析 -->
    <section id="tab-patterns" class="tab-content">
        <!-- シャープ・フラット傾向 -->
        <div class="glass-card">
            <h3 class="heading-md">
                <i data-lucide="alert-triangle" class="text-orange-300"></i>
                <span>シャープ・フラット傾向</span>
            </h3>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                音程を高め（シャープ）に取るか、低め（フラット）に取るかの全体的な傾向です。<br>
                50%に近いほどバランスが取れています。
            </p>

            <div class="chart-container">
                <div class="chart-wrapper">
                    <!-- 円グラフ風の表示（CSSベース） -->
                    <div id="sharp-flat-chart" class="chart-circle" data-sharp-percent="50"></div>
                    <div class="chart-center">
                        <div id="sharp-percentage" class="chart-percentage">--</div>
                        <div class="chart-label">シャープ傾向</div>
                    </div>
                </div>

                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color sharp"></div>
                        <span class="legend-text">シャープ（高め）</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color flat"></div>
                        <span class="legend-text">フラット（低め）</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 音程拡大・縮小パターン -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <h3 class="heading-md">
                <i data-lucide="maximize-2" class="text-green-300"></i>
                <span>音程拡大・縮小パターン</span>
            </h3>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                各音程を一貫して広く取る（拡大）か狭く取る（縮小）かの傾向を分析します。<br>
                ±0.1半音（±10セント）以内は「正確」と判定されます。
            </p>

            <div id="interval-expansion-list" class="expansion-list">
                <!-- 動的に生成される -->
            </div>
        </div>
    </section>

    <!-- Tab 3: 練習プラン -->
    <section id="tab-practice" class="tab-content">
        <div class="glass-card" style="margin-bottom: 1.5rem;">
            <p class="text-white-60 text-sm" style="margin: 0;">
                あなたのデータを分析し、最も効果的な練習項目を優先順位付けしました。<br>
                上から順に取り組むことで、効率的に音感を向上させることができます。
            </p>
        </div>
        <div id="practice-plan-container">
            <!-- 動的に生成される -->
        </div>
    </section>

    <!-- Tab 4: 成長記録 -->
    <section id="tab-growth" class="tab-content">
        <!-- 月間成長比較 -->
        <div class="glass-card">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="calendar" class="text-blue-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">月間成長比較</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                1ヶ月前と現在の平均誤差を比較します。<br>
                継続的な練習の効果を確認しましょう。
            </p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div style="text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">1ヶ月前</div>
                    <div id="old-average" style="color: #f59e0b; font-size: 1.5rem; font-weight: 600;">±--¢</div>
                </div>
                <div style="text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">現在</div>
                    <div id="recent-average" style="color: #10b981; font-size: 1.5rem; font-weight: 600;">±--¢</div>
                </div>
            </div>

            <div id="monthly-improvement" style="text-align: center; margin-top: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                <span style="color: #10b981; font-weight: 600; font-size: 1.125rem;">改善: --¢</span>
            </div>
        </div>

        <!-- 音程間隔別成長グラフ -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="bar-chart-2" class="text-blue-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">音程間隔別成長グラフ</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                各音程間隔の1ヶ月前（オレンジ）と現在（緑）の誤差を比較します。<br>
                棒が短いほど精度が高いことを示します。
            </p>

            <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 12px;">
                <canvas id="interval-growth-chart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- 最も改善した音程 TOP 3 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="trending-up" class="text-green-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">最も改善した音程 TOP 3</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                1ヶ月間で最も誤差が減少した音程です。練習の成果が出ています！
            </p>

            <div id="top3-improved" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- 停滞音程 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="trending-down" class="text-orange-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">改善が停滞した音程 TOP 3</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                改善が進んでいない音程です。重点的に練習することをお勧めします。
            </p>

            <div id="top3-stagnant" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- 時系列パフォーマンス分析 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="activity" class="text-purple-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">時系列パフォーマンス分析</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                時間帯やセッション回数による精度の変化を分析します。<br>
                最も調子の良い練習条件を見つけましょう。
            </p>

            <div id="time-series-analysis" style="display: flex; flex-direction: column; gap: 1rem;">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- 親モード別分析 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="folder" class="text-purple-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">親モード別分析</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                ランダム基音・連続チャレンジ・12音階の各モードでの精度を比較します。<br>
                モードをタップすると詳細が展開されます。
            </p>

            <!-- 親モードアコーディオンカード -->
            <div id="mode-analysis-accordion">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- モード別分析 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="layers" class="text-cyan-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">モード別分析</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                上行・下行などの方向別の詳細な精度を表示します。<br>
                得意・苦手な方向を把握しましょう。
            </p>

            <!-- クイックジャンプナビゲーション -->
            <div id="mode-quick-nav" style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <!-- 動的に生成される -->
            </div>

            <!-- モード別熟練度コンテンツ -->
            <div id="mode-mastery-content">
                <!-- 動的に生成される -->
            </div>
        </div>

        <!-- モード別詳細統計 -->
        <div class="glass-card" style="margin-top: 1.5rem;">
            <div class="flex items-center gap-3" style="margin-bottom: 0.5rem;">
                <i data-lucide="bar-chart-2" class="text-green-300" style="width: 24px; height: 24px;"></i>
                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin: 0;">モード別詳細統計</h3>
            </div>
            <p class="text-white-60 text-sm" style="margin-bottom: 1rem;">
                レッスン数・平均精度・最高グレードなどの詳細な統計データです。
            </p>

            <!-- クイックジャンプナビゲーション -->
            <div id="mode-stats-quick-nav" style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <!-- 動的に生成される -->
            </div>

            <!-- モード別詳細統計コンテンツ -->
            <div id="mode-stats-content">
                <!-- 動的に生成される -->
            </div>
        </div>
    </section>
</div>

<!-- JavaScript読み込み -->
<script src="pages/js/premium-analysis-calculator.js"></script>
<script src="pages/js/premium-analysis-controller.js"></script>
