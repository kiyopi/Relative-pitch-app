<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - ç·åˆè©•ä¾¡</title>
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/results.css"><!-- çµæœè¡¨ç¤ºå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé–‹ç™ºåŠ¹ç‡å„ªå…ˆãƒ»å°†æ¥åˆ†é›¢äºˆå®šï¼‰ -->
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆindex.html ã§ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ï¼‰ -->

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- JavaScript ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆdata-manager.js ã¨ evaluation-calculator.js ã¯ index.html ã§ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ï¼‰ -->
</head>
<body>
    <div class="container">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="page-header">
                <div class="page-header-content">
                    <div class="page-header-icon-wrapper">
                        <div class="page-header-icon gradient-catalog-purple">
                            <i data-lucide="bar-chart-2" class="text-white" data-stroke-width="2" style="width: 36px; height: 36px;"></i>
                        </div>
                    </div>
                    <div class="page-header-text">
                        <h1 class="page-title">ç·åˆè©•ä¾¡</h1>
                        <p class="page-subtitle text-green-200">8ã‚»ãƒƒã‚·ãƒ§ãƒ³ (64éŸ³) ã®ç·åˆè©•ä¾¡</p>
                    </div>
                </div>
            </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <main class="wide-main">
                
                <!-- ç·åˆè©•ä¾¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="rank-section glass-card share-card">
                    <div class="rank-mode">
                        <h3 class="mode-title" id="main-mode-title">ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰</h3>
                    </div>
                    <div class="rank-content-row">
                        <!-- ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ -->
                        <div class="rank-icon">
                            <div class="rank-circle rank-md rank-circle-b" style="position: relative;">
                                <i data-lucide="circle-star" class="text-white" style="width: 64px; height: 64px;"></i>
                                <!-- ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ -->
                                <button class="help-icon-btn" style="color: white;">
                                    <i data-lucide="help-circle" style="width: 20px !important; height: 20px !important; min-width: 20px !important; min-height: 20px !important; max-width: 20px !important; max-height: 20px !important; font-size: 20px !important;"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- çµ±è¨ˆæƒ…å ± -->
                        <div class="rank-stats-row">
                            <div class="rank-stat-item">
                                <div class="stat-value-rank grade-value" id="dynamic-grade">B</div>
                                <div class="stat-label-rank">ç·åˆã‚°ãƒ¬ãƒ¼ãƒ‰</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank stat-value-avg-error avg-error">Â±18.2Â¢</div>
                                <div class="stat-label-rank">å¹³å‡èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank excellence-rate" id="excellence-rate">50%</div>
                                <div class="stat-label-rank">å„ªç§€ç‡ï¼ˆÂ±20Â¢ä»¥å†…ï¼‰</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank stat-value-session-count session-count">8</div>
                                <div class="stat-label-rank">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</div>
                            </div>
                        </div>
                        
                        <!-- ãƒ©ãƒ³ã‚¯å–å¾—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                        <div class="rank-achievement-message text-center">
                            <p id="share-message" class="text-body text-white-90">
                                Bç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ã‚°ãƒƒãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼
                            </p>
                        </div>
                    </div>
                    
                    <div class="rank-divider"></div>
                    
                    <!-- ã‚·ã‚§ã‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="rank-share-section">
                        <h3 class="heading-md">
                            <i data-lucide="share-2" class="text-blue-400"></i>
                            <span>ã¿ã‚“ãªã«æˆæœã‚’ã‚·ã‚§ã‚¢ã—ã‚ˆã†ï¼</span>
                        </h3>
                        <div class="share-buttons">
                            <a href="#" class="share-btn twitter" onclick="shareToTwitter(event)" title="Xã§ã‚·ã‚§ã‚¢">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                                </svg>
                            </a>
                            <a href="#" class="share-btn line" onclick="shareToLine(event)" title="LINEã§é€ã‚‹">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.348 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path>
                                </svg>
                            </a>
                            <a href="#" class="share-btn facebook" onclick="shareToFacebook(event)" title="Facebookã§ã‚·ã‚§ã‚¢">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                                </svg>
                            </a>
                            <button class="share-btn copy" onclick="copyShareText(event)" title="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- è©•ä¾¡åˆ†å¸ƒ -->
                <section class="glass-card">
                    <h4 class="heading-md">
                        <i data-lucide="bar-chart-3" class="text-blue-300"></i>
                        <span>è©•ä¾¡åˆ†å¸ƒ</span>
                    </h4>
                    
                    <!-- è©•ä¾¡åˆ†å¸ƒãƒãƒ¼ -->
                    <div class="flex flex-col gap-3">
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                </section>

                <!-- èª¤å·®æ¨ç§»ã‚°ãƒ©ãƒ• -->
                <section class="glass-card">
                    <h2 class="heading-md">
                        <i data-lucide="trending-up" style="width: 24px; height: 24px;"></i>
                        <span>èª¤å·®æ¨ç§»</span>
                    </h2>
                    <div class="chart-container">
                        <canvas id="error-trend-chart"></canvas>
                    </div>
                </section>

                <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚°ãƒªãƒƒãƒ‰ -->
                <section class="glass-card">
                    <h2 class="heading-md">
                        <i data-lucide="grid" style="width: 24px; height: 24px;"></i>
                        <span>ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§</span>
                    </h2>
                    <div id="session-grid-container">
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                </section>

                <!-- è©³ç´°åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="glass-card">
                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="section-header mb-4">
                        <div class="flex items-center justify-between w-full">
                            <button id="prev-session-btn" class="glass-card-sm">
                                <i data-lucide="chevron-left" class="text-white icon-md"></i>
                            </button>
                            <div class="text-center flex-1 px-2">
                                <h3 class="text-sub-title detail-analysis-title">
                                    <span>è©³ç´°åˆ†æ</span>
                                    <span class="dash-separator"> - </span>
                                    <span>ã‚»ãƒƒã‚·ãƒ§ãƒ³1</span>
                                </h3>
                            </div>
                            <button id="next-session-btn" class="glass-card-sm">
                                <i data-lucide="chevron-right" class="text-white icon-md"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="detail-analysis-container">
                        <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦è¡¨ç¤º -->
                        <div class="score-section">
                            <!-- PCç‰ˆ3åˆ—ã‚°ãƒªãƒƒãƒ‰ -->
                            <div class="rank-display-grid">
                                <!-- åŸºéŸ³è¡¨ç¤ºï¼ˆå·¦ï¼‰ -->
                                <div class="rank-grid-left">
                                    <div class="score-base-note text-white">C4</div>
                                    <p class="text-body-green mb-0">åŸºéŸ³</p>
                                </div>
                                
                                <!-- ãƒˆãƒ­ãƒ•ã‚£ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä¸­å¤®ï¼‰ -->
                                <div class="rank-grid-center">
                                    <div class="accuracy-badge accuracy-badge-excellent accuracy-badge-container">
                                        <i data-lucide="trophy" class="text-yellow-300 accuracy-icon"></i>
                                        <!-- ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ -->
                                        <button class="help-icon-btn help-icon-btn-positioned">
                                            <i data-lucide="help-circle" style="width: 20px !important; height: 20px !important; min-width: 20px !important; min-height: 20px !important; max-width: 20px !important; max-height: 20px !important; font-size: 20px !important;"></i>
                                        </button>
                                    </div>
                                    <p class="text-sub-title mt-4 mb-0">ç´ æ™´ã‚‰ã—ã„ç²¾åº¦ï¼</p>
                                </div>
                                
                                <!-- å¹³å‡èª¤å·®ï¼ˆå³ï¼‰ -->
                                <div class="rank-grid-right">
                                    <div class="score-average text-white">Â±12.1Â¢</div>
                                    <p class="text-body-green mb-0">å¹³å‡èª¤å·®</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- éŸ³åˆ¥è©³ç´°çµæœ -->
                        <div class="space-y-2" id="detail-note-results">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </div>
                        
                        <!-- è¿½åŠ ã®åˆ†ææƒ…å ±ï¼ˆæœªå®šï¼‰ -->
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                </section>

                <!-- æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— -->
                <section class="glass-card">
                    <h2 class="heading-md">
                        <i data-lucide="compass" style="width: 24px; height: 24px;"></i>
                        <span>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</span>
                    </h2>
                    <div class="next-steps-grid">
                        <!-- UIã‚«ã‚¿ãƒ­ã‚°æº–æ‹ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
                    </div>
                </section>

                <!-- ç„¡æ–™ç‰ˆ vs ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆæ¯”è¼ƒ -->
                <section class="glass-card mb-8">
                    <h2 class="heading-md">
                        <i data-lucide="scale" style="width: 24px; height: 24px;"></i>
                        <span>ç„¡æ–™ç‰ˆ vs ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆ</span>
                    </h2>
                    
                    <!-- æ©Ÿèƒ½æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ« -->
                    <div class="comparison-table">
                        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="comparison-header-row">
                            <div class="comparison-cell comparison-feature-header">
                                <h4>æ©Ÿèƒ½</h4>
                            </div>
                            <div class="comparison-cell comparison-plan-header">
                                <div class="plan-header">
                                    <i data-lucide="user" class="icon-sm"></i>
                                    <h4>ç„¡æ–™ç‰ˆ</h4>
                                </div>
                            </div>
                            <div class="comparison-cell comparison-plan-header">
                                <div class="plan-header">
                                    <i data-lucide="crown" class="icon-sm"></i>
                                    <h4>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆ</h4>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆæœªå®šï¼‰ -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆâ€»æœªå®šï¼‰</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <span class="text-gray-400 text-sm">åŸºæœ¬è¡¨ç¤º</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <span class="text-white text-sm">AIåˆ†æä»˜ã</span>
                            </div>
                        </div>
                        
                        <!-- 12éŸ³éšãƒã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>12éŸ³éšãƒã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- å¼±ç‚¹ç‰¹å®šãƒ»æ”¹å–„ææ¡ˆ -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>å¼±ç‚¹ç‰¹å®šãƒ»æ”¹å–„ææ¡ˆ</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
                        <div class="comparison-row comparison-row-last">
                            <div class="comparison-cell comparison-feature">
                                <span>ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="check-circle" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆCTA -->
                    <div class="text-center">
                        <button class="btn btn-primary">
                            <i data-lucide="star" class="icon-xs"></i>
                            7æ—¥é–“ç„¡æ–™ã§ãŠè©¦ã—
                        </button>
                        <p class="text-caption mt-2">æœˆé¡480å†† â€¢ ã„ã¤ã§ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½</p>
                    </div>
                </section>

                <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <section class="action-buttons mb-6">
                    <button class="btn btn-primary" id="btn-new-training">
                        <i data-lucide="play" class="text-blue-300"></i>
                        <span>æ–°ã—ã„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹</span>
                    </button>
                    <button class="btn btn-outline" onclick="window.location.hash='home'">
                        <i data-lucide="home" class="text-white"></i>
                        <span>ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</span>
                    </button>
                </section>
        </main>

        <!-- Footer -->
        <footer class="footer-base">
            <p class="footer-copyright">Â© 2024 8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª</p>
            <p class="footer-tagline">éŸ³æ¥½ã®æ–°ã—ã„æ‰‰ã‚’é–‹ã“ã†</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        /**
         * ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–ï¼ˆå³åº§ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ï¼‰
         */
        window.initResultsOverview = async function() {
            console.log('ğŸ“Š ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸åˆæœŸåŒ–é–‹å§‹');

            // DataManagerã‹ã‚‰å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const allSessionData = loadAllSessionData();

            if (!allSessionData || allSessionData.length === 0) {
                console.warn('âš ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
                showDummyOverview();
                return;
            }

            // ã€ä¿®æ­£ã€‘URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¢ãƒ¼ãƒ‰ã‚’å–å¾—
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash.split('?')[1] || '');
            const currentMode = params.get('mode') || 'random';
            console.log(`ğŸ” [DEBUG] ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: ${currentMode}`);
            console.log(`ğŸ” [DEBUG] URL hash: ${window.location.hash}`);

            // ã€ãƒ‡ãƒãƒƒã‚°ã€‘å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¢ãƒ¼ãƒ‰åˆ†å¸ƒã‚’è¡¨ç¤º
            const modeDistribution = {};
            allSessionData.forEach(s => {
                modeDistribution[s.mode] = (modeDistribution[s.mode] || 0) + 1;
            });
            console.log('ğŸ“Š [DEBUG] ãƒ¢ãƒ¼ãƒ‰åˆ¥ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°:', modeDistribution);

            // ã€ä¿®æ­£ã€‘ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const sessionData = allSessionData.filter(s => s.mode === currentMode);
            console.log(`âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—: ${currentMode}ãƒ¢ãƒ¼ãƒ‰=${sessionData.length}ã‚»ãƒƒã‚·ãƒ§ãƒ³ (å…¨ä½“=${allSessionData.length}ã‚»ãƒƒã‚·ãƒ§ãƒ³)`);

            // ã€é‡è¦ã€‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            // showSessionDetailé–¢æ•°ã§å‚ç…§ã™ã‚‹ãŸã‚
            window.filteredSessionData = sessionData;
            window.currentMode = currentMode;

            // ã€ãƒ‡ãƒãƒƒã‚°ã€‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            if (sessionData.length > 0) {
                const sessionIds = sessionData.map(s => `#${s.sessionId}(${s.mode})`).join(', ');
                console.log(`ğŸ” [DEBUG] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${sessionIds}`);
            }

            if (sessionData.length === 0) {
                console.warn(`âš ï¸ ${currentMode}ãƒ¢ãƒ¼ãƒ‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`);
                showDummyOverview();
                return;
            }

            // å‹•çš„ã‚°ãƒ¬ãƒ¼ãƒ‰è¨ˆç®—
            const evaluation = window.EvaluationCalculator.calculateDynamicGrade(sessionData);
            console.log('âœ… è©•ä¾¡çµæœ:', evaluation);

            // UIæ›´æ–°
            updateOverviewUI(evaluation, sessionData);

            // Chart.jsåˆæœŸåŒ–
            if (typeof Chart !== 'undefined') {
                initializeCharts(sessionData);
            }

            // Lucideã‚¢ã‚¤ã‚³ãƒ³å†åˆæœŸåŒ–ï¼ˆçµ±åˆåˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼‰
            if (typeof window.initializeLucideIcons === 'function') {
                window.initializeLucideIcons({ immediate: true });
            }

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            const prevBtn = document.getElementById('prev-session-btn');
            const nextBtn = document.getElementById('next-session-btn');

            if (prevBtn) {
                prevBtn.addEventListener('click', window.navigateToPrevSession);
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', window.navigateToNextSession);
            }

            // åˆå›è¡¨ç¤ºæ™‚ã¯æœ€åˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            if (sessionData && sessionData.length > 0) {
                window.showSessionDetail(0);
            }
        }

        /**
         * å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
         */
        function loadAllSessionData() {
            try {
                const data = DataManager.getFromStorage('sessionData') || [];
                console.log('ğŸ“Š èª­ã¿è¾¼ã‚“ã ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿:', data);
                return data;
            } catch (error) {
                console.error('âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                return [];
            }
        }

        /**
         * ç·åˆè©•ä¾¡UIã‚’æ›´æ–°
         */
        function updateOverviewUI(evaluation, sessionData) {
            console.log('ğŸ¨ UIæ›´æ–°é–‹å§‹:', evaluation);

            // ãƒ¢ãƒ¼ãƒ‰åæ›´æ–°
            const modeTitleEl = document.getElementById('main-mode-title');
            if (modeTitleEl) {
                modeTitleEl.textContent = evaluation.modeInfo.name;
            }

            // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            const subtitleEl = document.querySelector('.page-subtitle');
            if (subtitleEl) {
                const totalNotes = evaluation.metrics.raw.totalNotes;
                subtitleEl.textContent = `${sessionData.length}ã‚»ãƒƒã‚·ãƒ§ãƒ³ (${totalNotes}éŸ³) ã®ç·åˆè©•ä¾¡`;
            }

            // ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°
            updateGradeIcon(evaluation.grade);

            // çµ±è¨ˆæƒ…å ±æ›´æ–°
            updateStatistics(evaluation, sessionData);

            // é”æˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
            const messageEl = document.getElementById('share-message');
            if (messageEl) {
                let message = evaluation.displayInfo.achievements;

                // ã‚°ãƒ¬ãƒ¼ãƒ‰æœªé”æˆã®å ´åˆã€è©³ç´°æƒ…å ±ã‚’è¿½åŠ 
                if (!evaluation.gradeResult.achievedBy.avgError || !evaluation.gradeResult.achievedBy.excellence) {
                    const grade = evaluation.grade;
                    const threshold = evaluation.gradeResult.thresholds;
                    const actual = evaluation.metrics.adjusted;

                    message = `${grade}ç´šåŸºæº–æœªé”æˆ\n`;

                    // å¹³å‡èª¤å·®ã®é”æˆçŠ¶æ³
                    if (!evaluation.gradeResult.achievedBy.avgError) {
                        const diff = (actual.avgError - threshold.avgError).toFixed(1);
                        message += `å¹³å‡èª¤å·®: ${actual.avgError.toFixed(1)}Â¢ï¼ˆç›®æ¨™${threshold.avgError}Â¢ä»¥ä¸‹ã€ã‚ã¨${diff}Â¢æ”¹å–„å¿…è¦ï¼‰\n`;
                    } else {
                        message += `å¹³å‡èª¤å·®: ${actual.avgError.toFixed(1)}Â¢ï¼ˆç›®æ¨™${threshold.avgError}Â¢ä»¥ä¸‹ âœ“ï¼‰\n`;
                    }

                    // å„ªç§€ç‡ã®é”æˆçŠ¶æ³
                    if (!evaluation.gradeResult.achievedBy.excellence) {
                        const diff = ((threshold.excellence - actual.excellenceRate) * 100).toFixed(1);
                        message += `å„ªç§€ç‡: ${(actual.excellenceRate * 100).toFixed(1)}%ï¼ˆç›®æ¨™${(threshold.excellence * 100).toFixed(0)}%ä»¥ä¸Šã€ã‚ã¨${diff}%æ”¹å–„å¿…è¦ï¼‰`;
                    } else {
                        message += `å„ªç§€ç‡: ${(actual.excellenceRate * 100).toFixed(1)}%ï¼ˆç›®æ¨™${(threshold.excellence * 100).toFixed(0)}%ä»¥ä¸Š âœ“ï¼‰`;
                    }
                }

                messageEl.textContent = message;
            }

            // è©•ä¾¡åˆ†å¸ƒè¡¨ç¤º
            displayOverallDistribution(sessionData);

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
            displaySessionGrid(sessionData);
        }

        /**
         * ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
         */
        function updateGradeIcon(grade) {
            const iconContainer = document.querySelector('.rank-icon .rank-circle');
            if (!iconContainer) return;

            // ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²è¨­å®š
            const gradeConfig = {
                'S': { icon: 'crown', class: 'rank-circle-s', color: 'gold' },
                'A': { icon: 'award', class: 'rank-circle-a', color: 'silver' },
                'B': { icon: 'star', class: 'rank-circle-b', color: 'orange' },
                'C': { icon: 'smile', class: 'rank-circle-c', color: 'green' },
                'D': { icon: 'meh', class: 'rank-circle-d', color: 'blue' },
                'E': { icon: 'frown', class: 'rank-circle-e', color: 'red' }
            };

            const config = gradeConfig[grade] || gradeConfig['B'];

            // ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            iconContainer.className = `rank-circle rank-md ${config.class}`;

            // ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°
            iconContainer.innerHTML = `
                <i data-lucide="${config.icon}" class="text-white" style="width: 64px; height: 64px;"></i>
                <button class="help-icon-btn" style="color: white;">
                    <i data-lucide="help-circle" style="width: 20px !important; height: 20px !important;"></i>
                </button>
            `;
        }

        /**
         * çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
         */
        function updateStatistics(evaluation, sessionData) {
            // ã‚°ãƒ¬ãƒ¼ãƒ‰
            const gradeEl = document.getElementById('dynamic-grade');
            if (gradeEl) {
                gradeEl.textContent = evaluation.grade;
            }

            // å¹³å‡èª¤å·®
            const avgErrorEl = document.querySelector('.avg-error');
            if (avgErrorEl) {
                const avgError = evaluation.metrics.adjusted.avgError;
                avgErrorEl.textContent = `Â±${avgError.toFixed(1)}Â¢`;
            }

            // å„ªç§€ç‡
            const excellenceRateEl = document.getElementById('excellence-rate');
            if (excellenceRateEl) {
                const excellenceRate = evaluation.metrics.adjusted.excellenceRate;
                excellenceRateEl.textContent = `${(excellenceRate * 100).toFixed(1)}%`;
            }

            // æœ€å¤§èª¤å·®è¨ˆç®—
            let maxError = 0;
            sessionData.forEach(session => {
                if (session.pitchErrors) {
                    session.pitchErrors.forEach(error => {
                        const absError = Math.abs(error.errorInCents);
                        if (absError > maxError) {
                            maxError = absError;
                        }
                    });
                }
            });

            const maxErrorEl = document.querySelector('.max-error');
            if (maxErrorEl) {
                maxErrorEl.textContent = `Â±${maxError.toFixed(1)}Â¢`;
            }

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°
            const sessionCountEl = document.querySelector('.session-count');
            if (sessionCountEl) {
                sessionCountEl.textContent = sessionData.length;
            }
        }

        /**
         * ç·åˆè©•ä¾¡åˆ†å¸ƒã‚’è¡¨ç¤º
         */
        function displayOverallDistribution(sessionData) {
            const distribution = {
                excellent: 0,
                good: 0,
                pass: 0,
                practice: 0
            };

            let total = 0;

            sessionData.forEach(session => {
                if (!session.pitchErrors) return;

                session.pitchErrors.forEach(error => {
                    const absError = Math.abs(error.errorInCents);
                    total++;

                    if (absError <= 15) distribution.excellent++;
                    else if (absError <= 25) distribution.good++;
                    else if (absError <= 40) distribution.pass++;
                    else distribution.practice++;
                });
            });

            const container = document.querySelector('.glass-card .flex.flex-col.gap-3');
            if (!container) return;

            container.innerHTML = `
                <!-- Excellent -->
                <div class="flex items-center gap-3">
                    <i data-lucide="trophy" class="text-yellow-300" style="width: 20px; height: 20px; flex-shrink: 0;"></i>
                    <div class="progress-bar flex">
                        <div class="progress-fill-custom color-eval-gold" style="width: ${(distribution.excellent / total * 100).toFixed(1)}%;"></div>
                    </div>
                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">${distribution.excellent}</span>
                </div>

                <!-- Good -->
                <div class="flex items-center gap-3">
                    <i data-lucide="star" class="text-green-300" style="width: 20px; height: 20px; flex-shrink: 0;"></i>
                    <div class="progress-bar flex">
                        <div class="progress-fill-custom color-eval-good" style="width: ${(distribution.good / total * 100).toFixed(1)}%;"></div>
                    </div>
                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">${distribution.good}</span>
                </div>

                <!-- Pass -->
                <div class="flex items-center gap-3">
                    <i data-lucide="thumbs-up" class="text-blue-300" style="width: 20px; height: 20px; flex-shrink: 0;"></i>
                    <div class="progress-bar flex">
                        <div class="progress-fill-custom color-eval-pass" style="width: ${(distribution.pass / total * 100).toFixed(1)}%;"></div>
                    </div>
                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">${distribution.pass}</span>
                </div>

                <!-- Practice -->
                <div class="flex items-center gap-3">
                    <i data-lucide="alert-triangle" class="text-red-300" style="width: 20px; height: 20px; flex-shrink: 0;"></i>
                    <div class="progress-bar flex">
                        <div class="progress-fill-custom color-eval-practice" style="width: ${(distribution.practice / total * 100).toFixed(1)}%;"></div>
                    </div>
                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">${distribution.practice}</span>
                </div>
            `;

            // Lucideã‚¢ã‚¤ã‚³ãƒ³å†åˆæœŸåŒ–ï¼ˆçµ±åˆåˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼‰
            if (typeof window.initializeLucideIcons === 'function') {
                window.initializeLucideIcons({ immediate: true });
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚°ãƒªãƒƒãƒ‰ã‚’è¡¨ç¤ºï¼ˆUIã‚«ã‚¿ãƒ­ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³æº–æ‹ ï¼‰
         */
        function displaySessionGrid(sessionData) {
            const container = document.getElementById('session-grid-container');
            if (!container) return;

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã«å¿œã˜ãŸã‚°ãƒªãƒƒãƒ‰ã‚¯ãƒ©ã‚¹ã‚’æ±ºå®š
            const sessionCount = sessionData.length;
            let gridClass = 'sessions-grid-8';
            if (sessionCount === 12) gridClass = 'sessions-grid-12';
            else if (sessionCount === 24) gridClass = 'sessions-grid-24';

            const sessionBoxes = sessionData.map((session, index) => {
                const avgError = session.pitchErrors
                    ? session.pitchErrors.reduce((sum, e) => sum + Math.abs(e.errorInCents), 0) / session.pitchErrors.length
                    : 0;

                // è©•ä¾¡ã‚¯ãƒ©ã‚¹ã¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ±ºå®šï¼ˆUIã‚«ã‚¿ãƒ­ã‚°æº–æ‹ ï¼‰
                let badgeClass, iconName, iconColor;
                if (avgError <= 15) {
                    badgeClass = 'session-excellent';
                    iconName = 'trophy';
                    iconColor = 'text-yellow-300';
                } else if (avgError <= 25) {
                    badgeClass = 'session-good';
                    iconName = 'star';
                    iconColor = 'text-green-300';
                } else if (avgError <= 40) {
                    badgeClass = 'session-pass';
                    iconName = 'thumbs-up';
                    iconColor = 'text-blue-300';
                } else {
                    badgeClass = 'session-practice';
                    iconName = 'alert-triangle';
                    iconColor = 'text-red-300';
                }

                return `
                    <div class="session-box ${badgeClass}"
                         data-session-index="${index}"
                         onclick="window.showSessionDetail(${index})">
                        <div class="session-number">${index + 1}</div>
                        <div class="session-icon">
                            <i data-lucide="${iconName}" class="${iconColor}"></i>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="${gridClass}">
                    ${sessionBoxes}
                </div>
            `;

            // Lucideã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆæœŸåŒ–
            if (typeof window.initializeLucideIcons === 'function') {
                window.initializeLucideIcons({ immediate: true });
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã‚’è¡¨ç¤ºï¼ˆUIã‚«ã‚¿ãƒ­ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³æº–æ‹ ï¼‰
         */
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å®šç¾©ï¼ˆSPAå†å®Ÿè¡Œæ™‚ã®é‡è¤‡ã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
        if (typeof window.currentSessionIndex === 'undefined') {
            window.currentSessionIndex = 0;
        }

        window.showSessionDetail = function(sessionIndex) {
            // ã€ä¿®æ­£ã€‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
            const sessionData = window.filteredSessionData || [];

            console.log('ğŸ“Š [showSessionDetail] å–å¾—ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿:', sessionData);
            console.log('ğŸ“Š [showSessionDetail] ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°:', sessionData.length);
            console.log('ğŸ“Š [showSessionDetail] è¦æ±‚ã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:', sessionIndex);
            console.log('ğŸ“Š [showSessionDetail] ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:', window.currentMode);

            if (!sessionData || sessionData.length === 0) {
                console.warn('âš ï¸ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            if (!sessionData[sessionIndex]) {
                console.warn(`âš ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³${sessionIndex + 1}ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                return;
            }

            window.currentSessionIndex = sessionIndex;
            const session = sessionData[sessionIndex];

            console.log('ğŸ“Š [showSessionDetail] é¸æŠã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³:', session);
            console.log('ğŸ” [DEBUG] ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰:', session.mode);

            // 1. .selectedã‚¯ãƒ©ã‚¹ã‚’æ›´æ–°
            document.querySelectorAll('.session-box').forEach((box, idx) => {
                if (idx === sessionIndex) {
                    box.classList.add('selected');
                } else {
                    box.classList.remove('selected');
                }
            });

            // 2. å¹³å‡èª¤å·®ã‚’è¨ˆç®—
            const avgError = session.pitchErrors
                ? session.pitchErrors.reduce((sum, e) => sum + Math.abs(e.errorInCents), 0) / session.pitchErrors.length
                : 0;

            // 3. ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            const titleSpan = document.querySelector('.detail-analysis-title span:last-child');
            if (titleSpan) titleSpan.textContent = `ã‚»ãƒƒã‚·ãƒ§ãƒ³${sessionIndex + 1}`;

            // 4. åŸºéŸ³ã‚’æ›´æ–°
            const baseNoteEl = document.querySelector('.score-base-note');
            if (baseNoteEl) baseNoteEl.textContent = session.baseNote || 'C4';

            // 5. ç²¾åº¦ãƒãƒƒã‚¸ã‚’æ›´æ–°
            const badge = document.querySelector('.accuracy-badge');
            const message = document.querySelector('.rank-grid-center p');
            if (badge && message) {
                badge.className = 'accuracy-badge accuracy-badge-container';

                let iconName, iconColor, messageText, badgeClass;
                if (avgError <= 15) {
                    badgeClass = 'accuracy-badge-excellent';
                    iconName = 'trophy';
                    iconColor = 'text-yellow-300';
                    messageText = 'ç´ æ™´ã‚‰ã—ã„ç²¾åº¦ï¼';
                } else if (avgError <= 25) {
                    badgeClass = 'accuracy-badge-good';
                    iconName = 'star';
                    iconColor = 'text-green-300';
                    messageText = 'è‰¯å¥½ãªç²¾åº¦ï¼';
                } else if (avgError <= 40) {
                    badgeClass = 'accuracy-badge-pass';
                    iconName = 'thumbs-up';
                    iconColor = 'text-blue-300';
                    messageText = 'åˆæ ¼ãƒ©ã‚¤ãƒ³é”æˆï¼';
                } else {
                    badgeClass = 'accuracy-badge-practice';
                    iconName = 'alert-triangle';
                    iconColor = 'text-red-300';
                    messageText = 'ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼';
                }

                badge.classList.add(badgeClass);
                badge.innerHTML = `
                    <i data-lucide="${iconName}" class="${iconColor} accuracy-icon"></i>
                    <button class="help-icon-btn help-icon-btn-positioned">
                        <i data-lucide="help-circle" style="width: 20px !important; height: 20px !important; min-width: 20px !important; min-height: 20px !important; max-width: 20px !important; max-height: 20px !important; font-size: 20px !important;"></i>
                    </button>
                `;
                message.textContent = messageText;
            }

            // 6. å¹³å‡èª¤å·®ã‚’æ›´æ–°
            const avgErrorEl = document.querySelector('.score-average');
            if (avgErrorEl) avgErrorEl.textContent = `Â±${avgError.toFixed(1)}Â¢`;

            // 7. éŸ³åˆ¥è©³ç´°çµæœã‚’è¡¨ç¤º
            const container = document.getElementById('detail-note-results');
            if (container && session.pitchErrors) {
                const noteNames = ['ãƒ‰', 'ãƒ¬', 'ãƒŸ', 'ãƒ•ã‚¡', 'ã‚½', 'ãƒ©', 'ã‚·', 'ãƒ‰'];
                container.innerHTML = '';

                session.pitchErrors.forEach((error, index) => {
                    const absError = Math.abs(error.errorInCents);
                    let evalIcon, evalColor;

                    if (absError <= 15) {
                        evalIcon = 'trophy';
                        evalColor = 'text-yellow-300';
                    } else if (absError <= 25) {
                        evalIcon = 'star';
                        evalColor = 'text-green-300';
                    } else if (absError <= 40) {
                        evalIcon = 'thumbs-up';
                        evalColor = 'text-blue-300';
                    } else {
                        evalIcon = 'alert-triangle';
                        evalColor = 'text-red-300';
                    }

                    const deviationClass = error.errorInCents >= 0 ? 'text-pitch-deviation-plus' : 'text-pitch-deviation-minus';

                    const noteElement = document.createElement('div');
                    noteElement.className = 'note-result-item';
                    noteElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div>
                                    <div class="text-sub-title">${noteNames[index]}</div>
                                </div>
                                <div>
                                    <div class="text-body">ç›®æ¨™ ${error.expectedFrequency.toFixed(0)}Hz</div>
                                    <div class="text-body">å®ŸéŸ³ ${error.detectedFrequency.toFixed(0)}Hz</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="${deviationClass}">${error.errorInCents >= 0 ? '+' : ''}${error.errorInCents.toFixed(1)}Â¢</div>
                                <div class="flex items-center justify-center">
                                    <i data-lucide="${evalIcon}" class="${evalColor}" style="width: 28px; height: 28px;"></i>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(noteElement);
                });
            }

            // 8. Lucideã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            if (typeof window.initializeLucideIcons === 'function') {
                window.initializeLucideIcons({ immediate: true });
            }

            // 9. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            updateNavigationButtons();
        }

        /**
         * å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ç§»å‹•
         */
        window.navigateToPrevSession = function() {
            if (window.currentSessionIndex > 0) {
                window.showSessionDetail(window.currentSessionIndex - 1);
            }
        }

        /**
         * æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ç§»å‹•
         */
        window.navigateToNextSession = function() {
            // ã€ä¿®æ­£ã€‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            const sessionData = window.filteredSessionData || [];

            if (window.currentSessionIndex < sessionData.length - 1) {
                window.showSessionDetail(window.currentSessionIndex + 1);
            }
        }

        /**
         * ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
         */
        function updateNavigationButtons() {
            // ã€ä¿®æ­£ã€‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            const sessionData = window.filteredSessionData || [];

            if (!sessionData || sessionData.length === 0) return;

            const prevBtn = document.getElementById('prev-session-btn');
            const nextBtn = document.getElementById('next-session-btn');

            if (prevBtn) {
                prevBtn.disabled = window.currentSessionIndex === 0;
                prevBtn.style.opacity = window.currentSessionIndex === 0 ? '0.5' : '1';
                prevBtn.style.cursor = window.currentSessionIndex === 0 ? 'not-allowed' : 'pointer';
            }

            if (nextBtn) {
                nextBtn.disabled = window.currentSessionIndex >= sessionData.length - 1;
                nextBtn.style.opacity = window.currentSessionIndex >= sessionData.length - 1 ? '0.5' : '1';
                nextBtn.style.cursor = window.currentSessionIndex >= sessionData.length - 1 ? 'not-allowed' : 'pointer';
            }
        }

        /**
         * Chart.jsåˆæœŸåŒ–
         */
        // Chartã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¿å­˜ï¼ˆSPAå†å®Ÿè¡Œæ™‚ã«ç ´æ£„ã™ã‚‹ãŸã‚ï¼‰
        if (typeof window.resultsOverviewChart === 'undefined') {
            window.resultsOverviewChart = null;
        }

        function initializeCharts(sessionData) {
            const canvas = document.getElementById('error-trend-chart');
            if (!canvas) return;

            // æ—¢å­˜ã®Chartã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Œã°ç ´æ£„
            if (window.resultsOverviewChart) {
                window.resultsOverviewChart.destroy();
                window.resultsOverviewChart = null;
            }

            const ctx = canvas.getContext('2d');

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥å¹³å‡èª¤å·®ãƒ‡ãƒ¼ã‚¿
            const labels = sessionData.map((_, i) => `S${i + 1}`);
            const data = sessionData.map(session => {
                if (!session.pitchErrors || session.pitchErrors.length === 0) return 0;
                const sum = session.pitchErrors.reduce((s, e) => s + Math.abs(e.errorInCents), 0);
                return (sum / session.pitchErrors.length).toFixed(1);
            });

            window.resultsOverviewChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¹³å‡èª¤å·® (ã‚»ãƒ³ãƒˆ)',
                        data: data,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        /**
         * ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
         */
        function showDummyOverview() {
            console.log('ğŸ“Š ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ç·åˆè©•ä¾¡ã‚’è¡¨ç¤º');

            const dummySessions = Array.from({ length: 8 }, (_, i) => ({
                sessionId: i + 1,
                baseNote: ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'][i],
                pitchErrors: Array.from({ length: 8 }, (_, j) => ({
                    step: j,
                    errorInCents: (Math.random() - 0.5) * 30
                }))
            }));

            const evaluation = window.EvaluationCalculator.calculateDynamicGrade(dummySessions);
            updateOverviewUI(evaluation, dummySessions);

            if (typeof Chart !== 'undefined') {
                initializeCharts(dummySessions);
            }
        }
        
        // ã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function getShareText() {
            const grade = document.querySelector('#dynamic-grade')?.textContent || 'B';
            const error = document.querySelector('.avg-error')?.textContent || 'Â±18.2Â¢';
            const sessions = document.querySelector('.session-count')?.textContent || '8';
            
            return `ğŸµ 8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã€${grade}ç´šã€‘ç²å¾—ï¼\nå¹³å‡èª¤å·®: ${error}\n${sessions}ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œèµ°ï¼`;
        }
        
        window.shareToTwitter = function(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }
        
        window.shareToLine = function(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText() + '\n' + window.location.href);
            window.open(`https://social-plugins.line.me/lineit/share?text=${text}`, '_blank');
        }
        
        window.shareToFacebook = function(event) {
            event.preventDefault();
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        window.copyShareText = function(event) {
            event.preventDefault();
            const text = getShareText() + '\n' + window.location.href;

            navigator.clipboard.writeText(text).then(() => {
                const btn = event.currentTarget;
                btn.classList.add('copied');
                setTimeout(() => btn.classList.remove('copied'), 2000);
            });
        }

        // DOMContentLoadedæ™‚ã®åˆæœŸåŒ–ï¼ˆç›´æ¥ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹æ™‚ç”¨ï¼‰
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“Š [DOMContentLoaded] results-overviewåˆæœŸåŒ–');

            // Lucideã‚¢ã‚¤ã‚³ãƒ³åˆæœŸåŒ–ï¼ˆçµ±åˆåˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼‰
            if (typeof window.initializeLucideIcons === 'function') {
                window.initializeLucideIcons({ immediate: true });
            }

            // ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸åˆæœŸåŒ–ï¼ˆDOMContentLoadedçµŒç”±ï¼‰
            await window.initResultsOverview();
        });

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ãŒå®šç¾©ã•ã‚ŒãŸã“ã¨ã‚’é€šçŸ¥
        console.log('âœ… [results-overview] window.initResultsOverview defined');
    </script>
</body>
</html>