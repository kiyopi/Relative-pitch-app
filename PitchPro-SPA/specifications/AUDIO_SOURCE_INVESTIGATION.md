# 調査報告: 音源ファイルの生成過程と根本原因について

## 発見事項
サーバー上のスクリプト `audio/piano/generate_samples.py` を解析した結果、現在の音源ファイル（`C3.mp3`）は、**`C4.mp3` を元にプログラムでピッチシフト加工して生成されたもの** であることが判明しました。

```python
# generate_samples.py の処理内容
# C4.mp3 -> (1オクターブ下げ) -> C3.mp3
# C4.mp3 -> (2オクターブ下げ) -> C2.mp3
# C4.mp3 -> (1オクターブ上げ) -> C5.mp3
```

## 問題点
1.  **二重加工による劣化:**
    現在のアプリは `C3.mp3` を基準にしていますが、これは既に `C4` から加工されたファイルです。
    例えば `C4` の音を出す場合、「`C4` → (加工) → `C3` → (アプリで再加工) → `C4`」という二重の変換が行われており、音質劣化やノイズの原因になります。

2.  **根本原因は `C4.mp3`:**
    全ての音源の親である `C4.mp3` に「冒頭の無音」や「クリックノイズ」が含まれている場合、そこから生成された `C2`, `C3`, `C5` 全てにそのノイズが引き継がれます（しかもピッチシフトによりノイズが伸びたり変質したりします）。
    「マルチサンプル化しても直らなかった」という過去の経緯とも合致します（全ての元が同じ `C4.mp3` だからです）。

## 提案する解決策

### 手順1: `C4.mp3` の確認と修正（最重要）
**`audio/piano/C4.mp3`** が全ての元凶である可能性が高いです。
このファイルを波形編集ソフト（Audacity等）で開き、以下の点を確認・修正してください。
*   **冒頭の無音:** 完全に削除する（0秒から波形が始まるように）。
*   **ゼロクロス:** 波形の開始点が振幅0の位置から始まるようにフェードイン処理をする。

### 手順2: アプリ側の基準音変更
`C4.mp3` が修正されたら、アプリ（`reference-tones.js`）の基準音を `C3` から **`C4`** に変更することを推奨します。
これにより、オリジナルの音質をそのまま活かせる範囲が広がります。

---

まずは **`C4.mp3` の確認** をお願いできますでしょうか？
もしよろしければ、私が `reference-tones.js` を書き換えて、一時的に `C4.mp3` を直接読み込むように変更し、音が変わるかテストすることも可能です。
