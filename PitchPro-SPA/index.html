
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ– -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - ãƒ›ãƒ¼ãƒ </title>
    <link rel="stylesheet" href="styles/base.css?v=20251115002">
    <link rel="stylesheet" href="styles/results.css?v=20251115001">
    <link rel="stylesheet" href="styles/training.css?v=20251030001">
    <link rel="stylesheet" href="styles/voice-range.css?v=20251030001">
    <link rel="stylesheet" href="styles/premium-analysis.css?v=20251111001">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons - unpkg CDN (å®‰å®šç‰ˆãƒ»ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š) -->
    <script src="https://unpkg.com/lucide@0.263.0/dist/umd/lucide.js"></script>

    <!-- Chart.jsï¼ˆç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- JavaScript ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="js/utils/music-theory.js?v=20251110001"></script>
    <script src="js/components/loading-component.js?v=20251109012"></script>
    <!-- ã€v1.0.0è¿½åŠ ã€‘èª²é‡‘ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆDataManagerä¾å­˜å‰æï¼‰ -->
    <script src="js/subscription-manager.js?v=20251114001"></script>
    <script src="js/data-manager.js?v=20251114001"></script>
    <script src="js/navigation-manager.js?v=20251029012"></script>
    <script src="js/evaluation-calculator.js?v=20251029012"></script>
    <!-- ã€v2.0.1æ›´æ–°ã€‘ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆLucideã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°çµ±ä¸€ï¼‰ -->
    <script src="js/mode-controller.js?v=20251114004"></script>
    <!-- ã€v1.0.0è¿½åŠ ã€‘sessionDataï¼ˆlocalStorageï¼‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="js/session-data-manager.js?v=20251113001"></script>
    <!-- ã€v1.0.0è¿½åŠ ã€‘ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆModeController, SessionDataManagerä¾å­˜ï¼‰ -->
    <script src="js/session-manager.js?v=20251113001"></script>
    <script src="js/controllers/session-data-recorder.js?v=20251029012"></script>
    <script src="pages/js/result-session-controller.js?v=20251030002"></script>
    <!-- results-overview-controller.js ã¯ results-overview.html å†…ã§èª­ã¿è¾¼ã¿ -->
    <script src="pages/js/premium-analysis-calculator.js?v=20251110001"></script>
    <script src="pages/js/premium-analysis-controller.js?v=20251110001"></script>
    <script src="js/core/pitchpro-v1.3.4.umd.js?v=20251110006"></script>
    <script src="js/core/pitchpro-config.js?v=20251110006"></script>
    <script src="js/core/device-detector.js?v=20251109001"></script>

    <!-- éŸ³åŸŸãƒ†ã‚¹ãƒˆæ­£è¦ç‰ˆï¼ˆSPAå¯¾å¿œãƒ»æ¡ä»¶ä»˜ãåˆæœŸåŒ–ï¼‰ -->
    <script src="pages/js/voice-range-test.js?v=1762761450"></script>
    <!-- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ–¹å¼ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å¼·åˆ¶ç„¡åŠ¹åŒ– -->
    <script>
        const script = document.createElement('script');
        script.src = `pages/js/preparation-pitchpro-cycle.js?t=${Date.now()}`;
        document.head.appendChild(script);
    </script>

    <!-- Tone.js Library (Required for PitchShifter) -->
    <script type="importmap">
    {
        "imports": {
            "tone": "https://cdn.jsdelivr.net/npm/tone@15.1.22/+esm"
        }
    }
    </script>

    <!-- PitchShifter Library -->
    <script type="module">
        import { PitchShifter } from './js/core/reference-tones.js?v=2.9.0&t=1761735209&nocache=1';
        import * as Tone from 'tone';

        window.PitchShifter = PitchShifter;
        window.Tone = Tone;

        console.log('âœ… PitchShifter loaded globally (v2.9.0 - Optimized Envelope)');
        console.log('ğŸ“¦ [CACHE BUSTER] Timestamp: 1761735209');
        console.log('âš™ï¸ [ENVELOPE] attack: 0.02s, sustain: 1.0s, release: 1.5s (2.52s total), curve: linear');
        console.log('âœ… Tone.js v15.1.22 (stable latest) loaded globally');
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="app-header">
                <div class="header-brand">
                    <div class="header-icon-wrapper">
                        <div class="header-icon">
                            <i data-lucide="music" class="icon-lg text-white"></i>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
                        <p class="text-purple-200">ã‚ãªãŸã®éŸ³æ„Ÿã‚’ç§‘å­¦çš„ã«å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†</p>
                    </div>
                </div>
                <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <button class="menu-toggle" id="menu-toggle">
                    <i data-lucide="menu" class="icon-md"></i>
                </button>
                
                <!-- PCç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <nav class="header-nav" id="header-nav">
                    <button class="nav-button" onclick="location.hash='records'" title="ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’è¦‹ã‚‹">
                        <i data-lucide="history" class="icon-md"></i>
                        <span class="nav-text">è¨˜éŒ²</span>
                    </button>
                    <button class="nav-button" onclick="location.hash='premium-analysis'" title="è©³ç´°åˆ†æ">
                        <i data-lucide="bar-chart-3" class="icon-md"></i>
                        <span class="nav-text">è©³ç´°åˆ†æ</span>
                    </button>
                    <button class="nav-button" onclick="location.hash='settings'" title="è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†">
                        <i data-lucide="settings" class="icon-md"></i>
                        <span class="nav-text">è¨­å®š</span>
                    </button>
                    <button class="nav-button">
                        <i data-lucide="share" class="icon-md"></i>
                        <span class="nav-text">å…±æœ‰</span>
                    </button>
                </nav>
        </header>

        <!-- Main Content Container for SPA -->
        <main id="app-root" class="wide-main">
            <!-- å‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ -->
        </main>
        
        <!-- Footer -->
        <footer class="footer-base">
            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ä»¥å¤–ã§è¡¨ç¤ºï¼‰ -->
            <div class="footer-nav" id="footer-nav" style="display: none;">
                <button class="btn btn-outline" onclick="handleFooterHomeButtonClick()">
                    <i data-lucide="home"></i>
                    <span>ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</span>
                </button>
            </div>

            <p class="footer-copyright">Â© 2024 8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª</p>
            <p class="footer-tagline">éŸ³æ¥½ã®æ–°ã—ã„æ‰‰ã‚’é–‹ã“ã†</p>
        </footer>
    </div>

    <!-- Lucideã‚¢ã‚¤ã‚³ãƒ³çµ±åˆåˆæœŸåŒ–ãƒ»æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ  v2.0.0 -->
    <script src="js/lucide-init.js?v=20251114001"></script>

    <!-- SPA Router -->
    <script src="js/router.js?v=20251110002"></script>

    <!-- Home Page Direction Tabs -->
    <script src="js/home-direction-tabs.js?v=20251113011"></script>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menu-toggle');
            const headerNav = document.getElementById('header-nav');
            
            menuToggle.addEventListener('click', function() {
                headerNav.classList.toggle('active');
                // ã‚¢ã‚¤ã‚³ãƒ³åˆ‡ã‚Šæ›¿ãˆ
                const icon = menuToggle.querySelector('i');
                if (icon) {
                    if (headerNav.classList.contains('active')) {
                        icon.setAttribute('data-lucide', 'x');
                    } else {
                        icon.setAttribute('data-lucide', 'menu');
                    }
                    // çµ±åˆåˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼ˆå³åº§å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ï¼‰
                    if (typeof window.initializeLucideIcons === 'function') {
                        window.initializeLucideIcons({ immediate: true });
                    }
                }
            });
            
            // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.addEventListener('click', function(event) {
                if (!menuToggle.contains(event.target) && !headerNav.contains(event.target)) {
                    headerNav.classList.remove('active');
                    const icon = menuToggle.querySelector('i');
                    if (icon) {
                        icon.setAttribute('data-lucide', 'menu');
                        // çµ±åˆåˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼ˆå³åº§å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ï¼‰
                        if (typeof window.initializeLucideIcons === 'function') {
                            window.initializeLucideIcons({ immediate: true });
                        }
                    }
                }
            });
        });

        /**
         * ãƒ•ãƒƒã‚¿ãƒ¼ã€Œãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
         * æº–å‚™ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã§ã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
         */
        function handleFooterHomeButtonClick() {
            const currentPage = window.router ? window.router.currentPage : '';

            // æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã§ã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            if (currentPage === 'preparation' || currentPage === 'training') {
                const message = currentPage === 'preparation'
                    ? 'éŸ³åŸŸãƒ†ã‚¹ãƒˆã‚’ä¸­æ–­ã—ã¦ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ'
                    : 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã§ã™ã€‚\nãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹ã¨é€²è¡Œä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã¾ã™ã€‚\næœ¬å½“ã«ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ';

                if (confirm(message)) {
                    // ã€ä¿®æ­£v4.0.4ã€‘ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­æ–­æ™‚ã¯æœªå®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                    if (currentPage === 'training') {
                        cleanupIncompleteLesson();
                    }

                    // NavigationManagerã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ã«é·ç§»
                    if (window.NavigationManager) {
                        NavigationManager.navigate('home');
                    } else {
                        window.location.hash = 'home';
                    }
                }
            } else {
                // ãã®ä»–ã®ãƒšãƒ¼ã‚¸ã¯ç¢ºèªãªã—ã§é·ç§»
                if (window.NavigationManager) {
                    NavigationManager.navigate('home');
                } else {
                    window.location.hash = 'home';
                }
            }
        }

        /**
         * æœªå®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
         * ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­æ–­æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
         */
        function cleanupIncompleteLesson() {
            try {
                const currentLessonId = sessionStorage.getItem('currentLessonId');
                if (!currentLessonId) {
                    console.log('â„¹ï¸ currentLessonIdãªã— - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸è¦');
                    return;
                }

                // localStorage ã‹ã‚‰ç¾åœ¨ã®lessonIdã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                // ã€v2.0.0ã€‘SessionDataManagerã‚’ä½¿ç”¨ã—ã¦çµ±ä¸€ç®¡ç†
                const deletedCount = window.SessionDataManager
                    ? window.SessionDataManager.clearSessionsByLessonId(currentLessonId)
                    : 0;

                if (!window.SessionDataManager) {
                    console.error('âŒ SessionDataManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                // sessionStorageã‚’ã‚¯ãƒªã‚¢
                SessionManager.clearSessionStorage();

                console.log('âœ… æœªå®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
            } catch (error) {
                console.error('âŒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
    </script>
</body>
</html>