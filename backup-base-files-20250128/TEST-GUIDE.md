# 📋 Preparation分割テスト - 実行ガイド

## 🎯 このテストの目的
preparation.htmlを2つのファイルに分割して、PitchPro二重初期化問題を解決するためのテストです。

## 🚀 テスト実行手順（3ステップ）

### ステップ1: テストページを開く
1. Finderで以下のファイルを探す：
   ```
   /Users/isao/Documents/Relative-pitch-app/Bolt/v2/pages/preparation-split-test/index.html
   ```

2. `index.html`をダブルクリックしてブラウザで開く
   - または右クリック → 「このアプリケーションで開く」→ Chrome/Safari

### ステップ2: Step1テスト（マイク許可）
1. テストページで「Step1テスト開始」ボタンをクリック

2. 新しいページで以下を確認：
   - ✅ 「マイクを許可（テスト）」ボタンが表示される
   - ✅ テスト項目が表示される

3. 「マイクを許可（テスト）」ボタンをクリック

4. 以下が順番に起こることを確認：
   - ✅ ボタンクリック検出（緑のチェックマーク）
   - ✅ マイク許可ダイアログが表示される
   - ✅ 「許可」をクリック
   - ✅ ストリーム取得成功（ボタンが緑色に変わる）

### ステップ3: Step2テスト（データ受け渡し）
1. ブラウザの戻るボタンでindexページに戻る

2. 「Step2テスト開始」ボタンをクリック

3. 新しいページで以下を確認：
   - ✅ 「Step1からの遷移成功！」と表示される
   - ✅ データ表示エリアに `micPermissionGranted: true` が表示される

## ✅ 成功の判定基準

### Step1テスト成功の条件
- ボタンクリックでマイク許可ダイアログが出る
- ダイアログで「許可」後にボタンが緑色になる
- コンソール（下の黒い画面）にエラーが出ない

### Step2テスト成功の条件
- 「Step1からの遷移成功！」メッセージが表示される
- データ表示に `micPermissionGranted: true` が表示される

## 🔧 トラブルシューティング

### Q1: テストページが開かない
**解決法：**
1. ファイルを右クリック → 「このアプリケーションで開く」→ Chrome
2. または Chrome/Safariを開いて、ファイルをドラッグ&ドロップ

### Q2: マイク許可ダイアログが出ない
**解決法：**
1. ブラウザの設定でマイクアクセスが許可されているか確認
2. 別のブラウザ（Chrome/Safari）で試す
3. HTTPSではなくfile://でも動作するはず

### Q3: Step2で「Step1未完了」と表示される
**解決法：**
1. Step1テストを最後まで完了させる（ボタンが緑色になるまで）
2. Step2テストページをリロード
3. または index.html の「Step1完了状態でテスト」ボタンを使用

### Q4: エラーが表示される
**解決法：**
1. ページをリロード（F5 または Cmd+R）
2. index.html の「localStorage クリア」ボタンをクリック
3. 最初からやり直す

## 📞 サポート
- 問題が解決しない場合は、ブラウザのコンソール（F12 → Console）のエラーメッセージを確認
- 「localStorage クリア」ボタンでリセット可能