<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ éŸ³åŸŸãƒ†ã‚¹ãƒˆå°‚ç”¨ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</title>
    
    <!-- preparation.htmlæº–æ‹ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="Bolt/v2/styles/base.css">
    <link rel="stylesheet" href="Bolt/v2/styles/results.css">
    <link rel="stylesheet" href="Bolt/v2/styles/training.css">
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-status {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .control-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .voice-range-display {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .results-display {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .result-item {
            margin: 10px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .result-value {
            color: #10b981;
            font-size: 24px;
        }
        
        /* range-iconæ¸¬å®šæ™‚ã®pulseã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆtraining.cssã§å®šç¾©æ¸ˆã¿ï¼‰*/
    </style>
</head>
<body>
    <div class="container">
        <!-- preparation.htmlé¢¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="page-header">
            <div class="page-header-content">
                <div class="page-header-icon-wrapper">
                    <div class="page-header-icon gradient-catalog-blue">
                        <i data-lucide="mic" class="text-white" data-stroke-width="2" style="width: 36px; height: 36px;"></i>
                    </div>
                </div>
                <div class="page-header-text">
                    <h1 class="page-title">ğŸ¯ éŸ³åŸŸãƒ†ã‚¹ãƒˆå°‚ç”¨ãƒšãƒ¼ã‚¸</h1>
                    <p class="page-subtitle text-green-200">é«˜ç²¾åº¦éŸ³åŸŸæ¸¬å®šãƒ»HarmonicCorrectionæœ€é©åŒ–ç‰ˆ</p>
                </div>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="narrow-main">
            <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆpreparation.htmlé¢¨ï¼‰ -->
            <div class="mb-4">
                <div class="flex items-center justify-between gap-4">
                    <!-- Step 1: åˆæœŸåŒ– -->
                    <div class="flex-1 text-center">
                        <div class="step-indicator" id="step-1">
                            <i data-lucide="settings" style="width: 24px; height: 24px;"></i>
                        </div>
                        <p class="text-xs text-white-60 mt-2">åˆæœŸåŒ–</p>
                    </div>
                    
                    <!-- æ¥ç¶šç·š -->
                    <div class="step-connector" id="connector-1"></div>
                    
                    <!-- Step 2: éŸ³åŸŸãƒ†ã‚¹ãƒˆ -->
                    <div class="flex-1 text-center">
                        <div class="step-indicator" id="step-2">
                            <i data-lucide="music" style="width: 24px; height: 24px;"></i>
                        </div>
                        <p class="text-xs text-white-60 mt-2">éŸ³åŸŸãƒ†ã‚¹ãƒˆ</p>
                    </div>
                    
                    <!-- æ¥ç¶šç·š -->
                    <div class="step-connector" id="connector-2"></div>
                    
                    <!-- Step 3: çµæœåˆ†æ -->
                    <div class="flex-1 text-center">
                        <div class="step-indicator" id="step-3">
                            <i data-lucide="bar-chart-3" style="width: 24px; height: 24px;"></i>
                        </div>
                        <p class="text-xs text-white-60 mt-2">çµæœåˆ†æ</p>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
                <div class="info-alert mb-4">
                    <i data-lucide="info" style="width: 24px; height: 24px; color: #60a5fa;"></i>
                    <p id="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åˆæœŸåŒ–å‰</p>
                </div>
        
                <!-- åˆæœŸåŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="test-section" id="init-section">
                    <div class="section-header">
                        <h3 class="text-section-title">éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</h3>
                        <p class="section-description">HarmonicCorrectionæœ€é©åŒ–è¨­å®šã§åˆæœŸåŒ–ã—ã¾ã™</p>
                    </div>
                    
                    <button id="init-btn" class="btn btn-primary">
                        <i data-lucide="mic" style="width: 24px; height: 24px;"></i>
                        <span>éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</span>
                    </button>
                </section>

                <!-- éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="test-section hidden" id="test-start-section">
                    <div class="section-header">
                        <h3 class="text-section-title">éŸ³åŸŸãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†</h3>
                        <p class="section-description">é«˜ç²¾åº¦ãªéŸ³åŸŸæ¸¬å®šã‚’é–‹å§‹ã§ãã¾ã™</p>
                    </div>
                    
                    <div class="success-alert">
                        <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #22c55e;"></i>
                        <p>éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚éŸ³åŸŸãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ã€‚</p>
                    </div>
                    
                    <button id="test-btn" class="btn btn-success">
                        <i data-lucide="play-circle" style="width: 24px; height: 24px;"></i>
                        <span>éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹</span>
                    </button>
                </section>
        
                <!-- éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="test-section hidden" id="range-test-section">
                    <div class="section-header">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-section-title" id="test-phase">éŸ³åŸŸã‚’æ¸¬å®šã—ã¾ã™</h3>
                                <p class="section-description" id="test-instruction">éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„</p>
                            </div>
                            <div class="test-instruction" style="flex-shrink: 0;">
                                <i data-lucide="mic" id="mic-icon" class="text-gray-400" style="width: 32px; height: 32px;"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ¤œå‡ºçŠ¶æ³ -->
                    <div class="detection-meters">
                        <div class="range-test-layout-flex">
                            <div class="range-test-item">
                                <div class="voice-range-display-container">
                                    <svg class="voice-stability-svg" width="160" height="160" id="stability-ring">
                                        <circle cx="80" cy="80" r="72" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="16"/>
                                        <circle cx="80" cy="80" r="72" fill="none" stroke="#3b82f6" stroke-width="16" 
                                                stroke-dasharray="452" stroke-dashoffset="452" 
                                                transform="rotate(-90 80 80)" class="voice-progress-circle"/>
                                    </svg>
                                    <div class="voice-note-badge">
                                        <i data-lucide="arrow-down" id="range-icon" style="width: 80px; height: 80px; color: white; display: block;"></i>
                                        <p class="countdown-text" id="countdown-display" style="display: none;">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ¤œå‡ºãƒ‡ãƒ¼ã‚¿è¡¨ç¤º -->
                    <div class="meter-group">
                        <div class="meter-label">
                            <span>æ¤œå‡ºå‘¨æ³¢æ•°</span>
                            <span class="meter-value" id="frequency-display">-- Hz</span>
                        </div>
                    </div>
                    
                    <div class="meter-group">
                        <div class="meter-label">
                            <span>éŸ³é‡ãƒ¬ãƒ™ãƒ«</span>
                            <span class="meter-value" id="volume-display">éŸ³é‡: 0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill gradient-catalog-green" id="volume-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="meter-group">
                        <div class="meter-label">
                            <span>æ˜ç­åº¦</span>
                            <span class="meter-value" id="clarity-display">æ˜ç­åº¦: --%</span>
                        </div>
                    </div>
                    
                    <p class="test-status" id="test-status">å¾…æ©Ÿä¸­...</p>
                    
                    <!-- æ¸¬å®šçµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆé·ç§»ãªã—ã§è¡¨ç¤ºï¼‰ -->
                    <div class="result-card mt-4" id="inline-result" style="display: none;">
                        <h4 class="heading-sm">
                            <i data-lucide="check-circle" class="text-green-400"></i>
                            <span>æ¸¬å®šå®Œäº†</span>
                        </h4>
                        <div class="range-info-container">
                            <div class="range-info-row">
                                <span>ä½éŸ³åŸŸ</span>
                                <span class="range-info-value" id="inline-low-result">-- Hz</span>
                            </div>
                            <div class="range-info-row">
                                <span>é«˜éŸ³åŸŸ</span>
                                <span class="range-info-value" id="inline-high-result">-- Hz</span>
                            </div>
                            <div class="range-info-row">
                                <span>éŸ³åŸŸå¹…</span>
                                <span class="range-info-value" id="inline-range-width">-- ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å†ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆä¸­ãƒ»å®Œäº†å¾Œã«è¡¨ç¤ºï¼‰ -->
                    <div class="flex justify-center gap-3 mt-4">
                        <button class="btn btn-outline" id="retest-btn" style="display: none;">
                            <i data-lucide="refresh-cw" style="width: 20px; height: 20px;"></i>
                            <span>æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</span>
                        </button>
                    </div>
                </section>
            
                    <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <div class="info-alert" id="voice-feedback" style="display: none;">
                        <i data-lucide="alert-circle" style="width: 24px; height: 24px; color: #f59e0b;"></i>
                        <p id="feedback-message">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</p>
                    </div>
                </section>
            
                <!-- çµæœè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="test-section hidden" id="result-section">
                    <div class="section-header">
                        <h3 class="text-section-title">æ¸¬å®šçµæœ</h3>
                        <p class="section-description">éŸ³åŸŸãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ</p>
                    </div>
                    
                    <div class="result-card">
                        <h4 class="heading-sm">
                            <i data-lucide="music" class="text-orange-400"></i>
                            <span>ã‚ãªãŸã®éŸ³åŸŸ</span>
                        </h4>
                        <div class="range-info-container">
                            <div class="range-info-row" id="low-result-container" style="display: none;">
                                <span>ä½éŸ³åŸŸ</span>
                                <span class="range-info-value" id="low-result">-- Hz</span>
                            </div>
                            <div class="range-info-row" id="high-result-container" style="display: none;">
                                <span>é«˜éŸ³åŸŸ</span>
                                <span class="range-info-value" id="high-result">-- Hz</span>
                            </div>
                            <div class="range-info-row" id="range-summary" style="display: none;">
                                <span>éŸ³åŸŸå¹…</span>
                                <span class="range-info-value" id="range-width">-- ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–</span>
                            </div>
                        </div>
                        
                        <!-- è©³ç´°åˆ†æ -->
                        <div class="glass-card mt-4" id="range-statistics" style="display: none;">
                            <h4 class="heading-sm">
                                <i data-lucide="bar-chart-3" class="text-blue-400"></i>
                                <span>è©³ç´°åˆ†æ</span>
                            </h4>
                            <div id="range-analysis-content"></div>
                        </div>
                        
                        <!-- HarmonicCorrectionçµ±è¨ˆï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰ -->
                        <div class="glass-card mt-4" id="harmonic-statistics" style="display: none;">
                            <h4 class="heading-sm">
                                <i data-lucide="activity" class="text-yellow-400"></i>
                                <span>å€éŸ³è£œæ­£çµ±è¨ˆ</span>
                            </h4>
                            <div id="harmonic-analysis-content"></div>
                        </div>
                    </div>
                    
                    <div class="success-alert mt-4">
                        <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #22c55e;"></i>
                        <p>éŸ³åŸŸæ¸¬å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®çµæœã¯æœ¬ç•ªå®Ÿè£…ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚</p>
                    </div>
                </section>
            </div>
        </main>
        
        <!-- é–‹ç™ºè€…ç”¨ãƒ‘ãƒãƒ« -->
        <div class="glass-card mt-4">
            <div class="section-header">
                <h3 class="text-section-title">ğŸ“„ é–‹ç™ºè€…ãƒ­ã‚°</h3>
                <p class="section-description">è©³ç´°ãªå®Ÿè¡Œãƒ­ã‚°ã¨åˆ¶å¾¡æ©Ÿèƒ½</p>
            </div>
            
            <div class="log-area" id="log"></div>
            
            <div class="flex gap-3 mt-4">
                <button onclick="clearLog()" class="btn btn-outline">
                    <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                    <span>ãƒ­ã‚°ã‚¯ãƒªã‚¢</span>
                </button>
                
                <button id="stop-btn" class="btn" style="background: #ef4444; color: white;" disabled>
                    <i data-lucide="stop-circle" style="width: 16px; height: 16px;"></i>
                    <span>ãƒ†ã‚¹ãƒˆåœæ­¢</span>
                </button>
                
                <button id="reset-btn" class="btn btn-outline" disabled>
                    <i data-lucide="rotate-ccw" style="width: 16px; height: 16px;"></i>
                    <span>ãƒªã‚»ãƒƒãƒˆ</span>
                </button>
            </div>
        </div>
        
        <!-- æœ¬ç•ªå®Ÿè£…ç”¨ãƒ„ãƒ¼ãƒ« -->
        <div class="glass-card mt-4">
            <div class="section-header">
                <h3 class="text-section-title">ğŸš€ æœ¬ç•ªå®Ÿè£…ç”¨ãƒ„ãƒ¼ãƒ«</h3>
                <p class="section-description">è¨­å®šãƒ»çµæœãƒ»ã‚³ãƒ¼ãƒ‰ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½</p>
            </div>
            
            <div class="flex gap-3 flex-wrap">
                <button id="export-config-btn" class="btn" style="background: #8b5cf6; color: white;" disabled>
                    <i data-lucide="download" style="width: 16px; height: 16px;"></i>
                    <span>è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
                </button>
                <button id="export-results-btn" class="btn" style="background: #10b981; color: white;" disabled>
                    <i data-lucide="database" style="width: 16px; height: 16px;"></i>
                    <span>çµæœãƒ‡ãƒ¼ã‚¿</span>
                </button>
                <button id="generate-code-btn" class="btn" style="background: #f59e0b; color: white;" disabled>
                    <i data-lucide="code" style="width: 16px; height: 16px;"></i>
                    <span>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- å¿…è¦ãªJavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="./js/pitchpro-audio/index.umd.js"></script>
    <script src="./js/audio-detection-component.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        // çµ±ä¸€éŸ³éŸ¿æ¤œå‡ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
        let audioDetector = null;
        
        // ã€æ—§ã‚¢ãƒ‰ãƒªãƒ–å®Ÿè£…ã€‘ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã§ç½®ãæ›ãˆæ¸ˆã¿
        // let isVoiceRangeTesting = false;
        // let voiceRangeTestData = null;
        // let currentPhase = 'low'; // 'low' or 'high' - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã§å®£è¨€æ¸ˆã¿
        // let detectionActive = false;
        // let progressInterval = null; // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«
        
        // preparation.htmlé¢¨ã®UIåˆ¶å¾¡é–¢æ•°
        function showSection(section) {
            // å…¨ã¦ã®test-sectionã‚’éš ã™
            document.querySelectorAll('.test-section').forEach(s => {
                s.classList.add('hidden');
                s.style.display = 'none';
            });
            
            // æŒ‡å®šã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            if (section) {
                section.classList.remove('hidden');
                section.style.display = 'block';
            }
        }
        
        function updateStepStatus(stepNumber, status) {
            const step = document.getElementById(`step-${stepNumber}`);
            const connector = document.getElementById(`connector-${stepNumber}`);
            
            if (!step) return;
            
            // æ—¢å­˜ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            step.classList.remove('active', 'completed', 'pending');
            if (connector) connector.classList.remove('active', 'completed');
            
            // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
            step.classList.add(status);
            if (connector && (status === 'completed' || status === 'active')) {
                connector.classList.add(status);
            }
        }
        
        // DOMè¦ç´ ï¼ˆpreparation.htmlæº–æ‹ ï¼‰
        const statusEl = document.getElementById('status');
        const initBtn = document.getElementById('init-btn');
        const testBtn = document.getElementById('test-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');
        const retestBtn = document.getElementById('retest-btn');
        
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦ç´ 
        const initSection = document.getElementById('init-section');
        const testStartSection = document.getElementById('test-start-section');
        const rangeTestSection = document.getElementById('range-test-section');
        const resultSection = document.getElementById('result-section');
        
        // è¡¨ç¤ºè¦ç´ 
        const testPhaseEl = document.getElementById('test-phase');
        const testInstructionEl = document.getElementById('test-instruction');
        const frequencyDisplayEl = document.getElementById('frequency-display');
        const volumeDisplayEl = document.getElementById('volume-display');
        const clarityDisplayEl = document.getElementById('clarity-display');
        const testStatusEl = document.getElementById('test-status');
        
        // preparation.htmlæº–æ‹ ã®è¦ç´ å‚ç…§è¿½åŠ 
        const voiceNoteBadge = document.querySelector('.voice-note-badge');
        const testInstructionContainer = document.querySelector('.test-instruction');
        
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆå††å½¢ï¼‰- ã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ã§classåã§å–å¾—
        const progressCircle = document.querySelector('.voice-progress-circle');
        const rangeIcon = document.getElementById('range-icon');
        const countdownDisplay = document.getElementById('countdown-display');
        
        // çµæœè¡¨ç¤º
        const resultsDisplayEl = document.getElementById('result-section');
        const lowResultEl = document.getElementById('low-result');
        const highResultEl = document.getElementById('high-result');
        const lowResultContainer = document.getElementById('low-result-container');
        const highResultContainer = document.getElementById('high-result-container');
        
        // éŸ³é‡ãƒãƒ¼
        const volumeBarFill = document.getElementById('volume-bar-fill');
        
        // ãã®ä»–
        const logEl = document.getElementById('log');
        const voiceFeedback = document.getElementById('voice-feedback');
        const feedbackMessage = document.getElementById('feedback-message');
        
        // åˆæœŸçŠ¶æ…‹è¨­å®š
        updateStepStatus(1, 'active');
        showSection(initSection);
        
        // Lucideã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆæœŸåŒ–
        lucide.createIcons();
        
        // ============================================
        // ã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ã®éŸ³åŸŸãƒ†ã‚¹ãƒˆå‡¦ç†ï¼ˆfeature/css-variables-systemæº–æ‹ ï¼‰
        // ============================================
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentPhase = 'low'; // 'low' or 'high'
        let testResults = {
            lowestNote: null,
            lowestFrequency: null,
            highestNote: null,
            highestFrequency: null
        };
        let detectionInterval = null;
        let stableFrequencies = [];
        let stabilityStartTime = null;
        
        // å‘¨æ³¢æ•°ã‹ã‚‰æœ€ã‚‚è¿‘ã„éŸ³åã‚’å–å¾—
        function getClosestNote(frequency) {
            const noteMapping = [
                { note: 'C2', frequency: 65.4 },
                { note: 'C#2', frequency: 69.3 },
                { note: 'D2', frequency: 73.4 },
                { note: 'D#2', frequency: 77.8 },
                { note: 'E2', frequency: 82.4 },
                { note: 'F2', frequency: 87.3 },
                { note: 'F#2', frequency: 92.5 },
                { note: 'G2', frequency: 98.0 },
                { note: 'G#2', frequency: 103.8 },
                { note: 'A2', frequency: 110.0 },
                { note: 'A#2', frequency: 116.5 },
                { note: 'B2', frequency: 123.5 },
                { note: 'C3', frequency: 130.8 },
                { note: 'C#3', frequency: 138.6 },
                { note: 'D3', frequency: 146.8 },
                { note: 'D#3', frequency: 155.6 },
                { note: 'E3', frequency: 164.8 },
                { note: 'F3', frequency: 174.6 },
                { note: 'F#3', frequency: 185.0 },
                { note: 'G3', frequency: 196.0 },
                { note: 'G#3', frequency: 207.7 },
                { note: 'A3', frequency: 220.0 },
                { note: 'A#3', frequency: 233.1 },
                { note: 'B3', frequency: 246.9 },
                { note: 'C4', frequency: 261.6 },
                { note: 'C#4', frequency: 277.2 },
                { note: 'D4', frequency: 293.7 },
                { note: 'D#4', frequency: 311.1 },
                { note: 'E4', frequency: 329.6 },
                { note: 'F4', frequency: 349.2 },
                { note: 'F#4', frequency: 370.0 },
                { note: 'G4', frequency: 392.0 },
                { note: 'G#4', frequency: 415.3 },
                { note: 'A4', frequency: 440.0 },
                { note: 'A#4', frequency: 466.2 },
                { note: 'B4', frequency: 493.9 },
                { note: 'C5', frequency: 523.3 },
                { note: 'C#5', frequency: 554.4 },
                { note: 'D5', frequency: 587.3 },
                { note: 'D#5', frequency: 622.3 },
                { note: 'E5', frequency: 659.3 },
                { note: 'F5', frequency: 698.5 },
                { note: 'F#5', frequency: 740.0 },
                { note: 'G5', frequency: 784.0 },
                { note: 'G#5', frequency: 830.6 },
                { note: 'A5', frequency: 880.0 }
            ];
            
            let closestNote = noteMapping[0];
            let minDifference = Math.abs(frequency - closestNote.frequency);
            
            for (const note of noteMapping) {
                const difference = Math.abs(frequency - note.frequency);
                if (difference < minDifference) {
                    minDifference = difference;
                    closestNote = note;
                }
            }
            
            return closestNote;
        }
        
        // recordRangeResulté–¢æ•°ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        function recordRangeResult(note, frequency) {
            if (currentPhase === 'low') {
                testResults.lowestNote = note.note;
                testResults.lowestFrequency = frequency;
                
                addLog(`âœ… ä½éŸ³æ¸¬å®šå®Œäº†: ${note.note} (${frequency.toFixed(1)}Hz)`, 'success');
                
                setTimeout(() => {
                    startHighRangeTest();
                }, 4000); // 4ç§’å¾…æ©Ÿ
            } else {
                testResults.highestNote = note.note;
                testResults.highestFrequency = frequency;
                
                addLog(`âœ… é«˜éŸ³æ¸¬å®šå®Œäº†: ${note.note} (${frequency.toFixed(1)}Hz)`, 'success');
                
                setTimeout(() => {
                    finishRangeTest();
                }, 2000); // 2ç§’å¾…æ©Ÿ
            }
        }
        
        // é«˜éŸ³æ¸¬å®šé–‹å§‹ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        function startHighRangeTest() {
            currentPhase = 'high';
            stableFrequencies = [];
            stabilityStartTime = null;
            
            // UIæ›´æ–°
            const testInstructionText = document.getElementById('test-instruction-text');
            if (testInstructionText) {
                testInstructionText.textContent = 'ã§ãã‚‹ã ã‘é«˜ã„å£°ã‚’å‡ºã—ã¦ï¼“ç§’é–“ã‚­ãƒ¼ãƒ—ã—ã¦ãã ã•ã„';
            }
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’arrow-upã«å¤‰æ›´ï¼ˆç™½è‰²ï¼‰
            if (rangeIcon) {
                rangeIcon.setAttribute('data-lucide', 'arrow-up');
                rangeIcon.style.color = 'white'; // ã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼šç™½è‰²
                rangeIcon.style.display = 'block';
                
                // æœ¬ç•ªç’°å¢ƒæº–æ‹ ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´
                addLog('ğŸ”„ é«˜éŸ³ãƒ†ã‚¹ãƒˆ: arrow-upã‚¢ã‚¤ã‚³ãƒ³ã«å¤‰æ›´', 'info');
                
                // preparation.htmlæº–æ‹ ã®ç¢ºå®Ÿãªæ–¹æ³•
                rangeIcon.setAttribute('data-lucide', 'arrow-up');
                rangeIcon.style.color = 'white';
                lucide.createIcons();
                
                // SVGãŒå®Ÿéš›ã«ç”Ÿæˆã•ã‚ŒãŸã‹ç¢ºèª
                setTimeout(() => {
                    const svgElement = rangeIcon.querySelector('svg');
                    addLog(`ğŸ” SVGç”Ÿæˆç¢ºèª: ${svgElement ? 'æˆåŠŸ' : 'å¤±æ•—'}`, svgElement ? 'success' : 'error');
                    console.log('Range Icon HTML after lucide.createIcons():', rangeIcon.outerHTML);
                }, 100);
            }
            
            addLog('ğŸ¯ é«˜éŸ³æ¸¬å®šé–‹å§‹', 'info');
            
            startContinuousDetection();
        }
        
        // æœ€çµ‚å®Œäº†å‡¦ç†ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        function finishRangeTest() {
            const octaveRange = calculateOctaveRange(testResults.lowestNote, testResults.highestNote);
            
            const voiceRangeData = {
                lowestNote: testResults.lowestNote,
                highestNote: testResults.highestNote,
                octaveCount: octaveRange,
                testDate: new Date().toISOString()
            };
            
            localStorage.setItem('voiceRangeData', JSON.stringify(voiceRangeData));
            
            addLog(`ğŸ‰ éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Œå…¨å®Œäº†: ${testResults.lowestNote} - ${testResults.highestNote} (${octaveRange}ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–)`, 'success');
        }
        
        // ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ç¯„å›²è¨ˆç®—ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        function calculateOctaveRange(lowest, highest) {
            const noteToMidi = (noteName) => {
                const noteMap = { 'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11 };
                const match = noteName.match(/([A-G]#?)(\d+)/);
                if (!match) return 60;
                
                const [, note, octave] = match;
                return noteMap[note] + (parseInt(octave) + 1) * 12;
            };
            
            const lowestMidi = noteToMidi(lowest);
            const highestMidi = noteToMidi(highest);
            const semitonesRange = highestMidi - lowestMidi;
            
            return (semitonesRange / 12).toFixed(1);
        }
        
        // startContinuousDetectioné–¢æ•°ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        function startContinuousDetection() {
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ç›®æ¨™å‘¨æ³¢æ•°ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯éŸ³å£°æ¤œå‡ºã‹ã‚‰å–å¾—ï¼‰
            window.simulationTargetFreq = currentPhase === 'low' ? 150 : 350;
            
            const stabilitySvg = document.getElementById('stability-ring');
            const progressCircle = stabilitySvg ? stabilitySvg.querySelector('.voice-progress-circle') : null;
            
            setTimeout(() => {
                detectionInterval = setInterval(() => {
                    // å‘¨æ³¢æ•°æ¤œå‡ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆÂ±3Hzã®ç¯„å›²ã§å¤‰å‹•ï¼‰
                    const detectedHz = window.simulationTargetFreq + (Math.random() - 0.5) * 6;
                    const closestNote = getClosestNote(detectedHz);
                    
                    // UIè¦ç´ å‚ç…§
                    const countdownDisplay = document.getElementById('countdown-display');
                    const rangeIcon = document.getElementById('range-icon');
                    const voiceNoteBadge = document.querySelector('.voice-note-badge');
                    const testInstruction = document.querySelector('.test-instruction');
                    
                    // Â±8Hzä»¥å†…ã§å®‰å®šæ€§ãƒã‚§ãƒƒã‚¯
                    if (stableFrequencies.length === 0 || Math.abs(detectedHz - stableFrequencies[stableFrequencies.length - 1]) <= 8) {
                        // å®‰å®šæ€§é–‹å§‹æ™‚åˆ»è¨˜éŒ²
                        if (!stabilityStartTime) {
                            stabilityStartTime = Date.now();
                            stableFrequencies = [detectedHz];
                        } else {
                            stableFrequencies.push(detectedHz);
                        }
                        
                        const stabilityDuration = Date.now() - stabilityStartTime;
                        const elapsedTime = Math.floor(stabilityDuration / 1000);
                        
                        // ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
                        if (countdownDisplay && rangeIcon) {
                            rangeIcon.style.display = 'none';
                            countdownDisplay.style.display = 'block';
                            countdownDisplay.textContent = Math.min(elapsedTime + 1, 3);
                        }
                        
                        // measuringçŠ¶æ…‹ã®è¿½åŠ 
                        if (voiceNoteBadge) {
                            voiceNoteBadge.classList.add('measuring');
                        }
                        if (testInstruction) {
                            testInstruction.classList.add('measuring');
                        }
                        
                        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚µãƒ¼ã‚¯ãƒ«æ›´æ–°
                        if (progressCircle) {
                            const progress = Math.min(100, (stabilityDuration / 3000) * 100);
                            const offset = 452 - (452 * progress / 100);
                            progressCircle.style.strokeDashoffset = offset;
                        }
                        
                        // 3ç§’é”æˆå¾Œã®å‡¦ç†
                        if (stabilityDuration >= 3000) {
                            clearInterval(detectionInterval);
                            
                            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’checkã«å¤‰æ›´ï¼ˆç™½è‰²çµ±ä¸€ï¼‰
                            if (rangeIcon && countdownDisplay) {
                                countdownDisplay.style.display = 'none';
                                rangeIcon.setAttribute('data-lucide', 'check');
                                rangeIcon.style.color = 'white'; // ç™½è‰²çµ±ä¸€
                                rangeIcon.style.display = 'block';
                                lucide.createIcons();
                                addLog('âœ… æ¸¬å®šå®Œäº†: checkã‚¢ã‚¤ã‚³ãƒ³ã«å¤‰æ›´', 'success');
                            }
                            
                            // confirmedã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                            if (voiceNoteBadge) {
                                voiceNoteBadge.classList.remove('measuring');
                                voiceNoteBadge.classList.add('confirmed');
                                setTimeout(() => {
                                    voiceNoteBadge.classList.remove('confirmed');
                                }, 600);
                            }
                            
                            if (testInstruction) {
                                testInstruction.classList.remove('measuring');
                            }
                            
                            // SVGã«completedã‚¯ãƒ©ã‚¹è¿½åŠ 
                            if (stabilitySvg) {
                                stabilitySvg.classList.add('completed');
                            }
                            
                            // å¹³å‡å‘¨æ³¢æ•°è¨ˆç®—
                            const averageFreq = stableFrequencies.slice(-30)
                                .reduce((sum, freq) => sum + freq, 0) / 
                                Math.min(30, stableFrequencies.length);
                            const finalNote = getClosestNote(averageFreq);
                            
                            setTimeout(() => {
                                recordRangeResult(finalNote, averageFreq);
                            }, 1000);
                        }
                    } else {
                        // å®‰å®šæ€§ãŒå¤±ã‚ã‚ŒãŸå ´åˆã®ãƒªã‚»ãƒƒãƒˆ
                        stabilityStartTime = null;
                        stableFrequencies = [];
                        
                        if (countdownDisplay && rangeIcon) {
                            countdownDisplay.style.display = 'none';
                            rangeIcon.style.display = 'block';
                        }
                        
                        if (progressCircle) {
                            progressCircle.style.strokeDashoffset = 452; // ãƒªã‚»ãƒƒãƒˆ
                        }
                    }
                }, 100); // 100msã”ã¨ã«æ›´æ–°
            }, 1000); // 1ç§’å¾Œã«é–‹å§‹
        }
        
        // ============================================
        // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
        // æœ¬ç•ªå®Ÿè£…ç”¨ï¼špreparation.htmlç­‰ã§å†åˆ©ç”¨å¯èƒ½
        // ============================================
        
        /**
         * ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã®çŠ¶æ…‹å®šç¾©
         * @constant {Object}
         */
        const MIC_STATES = {
            IDLE: 'idle',           // åˆæœŸçŠ¶æ…‹ãƒ»åœæ­¢çŠ¶æ…‹ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰
            WAITING: 'waiting',     // éŸ³å£°æ¤œå‡ºå¾…æ©Ÿä¸­ï¼ˆç·‘ï¼‰
            RECORDING: 'recording'  // é›†éŸ³ä¸­ãƒ»æ¸¬å®šä¸­ï¼ˆèµ¤ï¼‰
        };
        
        /**
         * ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²å®šç¾©
         * @constant {Object}
         */
        const MIC_COLORS = {
            [MIC_STATES.IDLE]: {
                class: 'text-gray-400',
                color: '#9ca3af'
            },
            [MIC_STATES.WAITING]: {
                class: 'text-green-400',
                color: '#4ade80'
            },
            [MIC_STATES.RECORDING]: {
                class: 'text-red-400',
                color: '#f87171'
            }
        };
        
        /**
         * ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
         * @param {string} state - MIC_STATESã®å€¤
         * @param {string} [elementId='mic-icon'] - ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³è¦ç´ ã®ID
         * @returns {boolean} æ›´æ–°æˆåŠŸã®å¯å¦
         */
        function updateMicIconState(state, elementId = 'mic-icon') {
            const micContainer = document.getElementById(elementId);
            if (!micContainer) {
                console.warn(`Mic icon element not found: ${elementId}`);
                return false;
            }
            
            // LucideãŒç”Ÿæˆã—ãŸSVGè¦ç´ ã‚’æ¢ã™ï¼ˆLucideã‚¢ã‚¤ã‚³ãƒ³ã¯dataå±æ€§ã‹ã‚‰SVGã‚’ç”Ÿæˆï¼‰
            const svgIcon = micContainer.querySelector('svg') || micContainer;
            
            // çŠ¶æ…‹ã«å¯¾å¿œã™ã‚‹è‰²è¨­å®šã‚’å–å¾—
            const colorConfig = MIC_COLORS[state] || MIC_COLORS[MIC_STATES.IDLE];
            
            if (svgIcon) {
                // SVGè¦ç´ ã®è‰²ã‚’ç›´æ¥å¤‰æ›´ï¼ˆLucideã‚¢ã‚¤ã‚³ãƒ³ã®è‰²å¤‰æ›´ã«å¿…è¦ï¼‰
                svgIcon.style.color = colorConfig.color;
                
                // ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ ã®ã‚¯ãƒ©ã‚¹ã‚‚æ›´æ–°ï¼ˆå°†æ¥çš„ãªäº’æ›æ€§ã®ãŸã‚ï¼‰
                Object.values(MIC_COLORS).forEach(config => {
                    micContainer.classList.remove(config.class);
                });
                micContainer.classList.add(colorConfig.class);
                
                return true;
            }
            
            return false;
        }
        
        /**
         * äº’æ›æ€§ã®ãŸã‚ã®æ—§é–¢æ•°ï¼ˆæ®µéšçš„ã«å»ƒæ­¢äºˆå®šï¼‰
         * @deprecated updateMicIconState()ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
         */
        function updateMicIconColor(colorClass) {
            // æ—§å½¢å¼ã®ã‚¯ãƒ©ã‚¹åã‹ã‚‰æ–°å½¢å¼ã®çŠ¶æ…‹ã«å¤‰æ›
            const stateMap = {
                'text-gray-400': MIC_STATES.IDLE,
                'text-green-400': MIC_STATES.WAITING,
                'text-red-400': MIC_STATES.RECORDING
            };
            
            const state = stateMap[colorClass] || MIC_STATES.IDLE;
            updateMicIconState(state);
        }
        
        // å‘¨æ³¢æ•°ã‹ã‚‰éŸ³ç¨‹ã¸ã®å¤‰æ›é–¢æ•°
        function frequencyToNote(frequency) {
            const A4 = 440;
            const C0 = A4 * Math.pow(2, -4.75);
            const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            
            if (frequency < 20 || frequency > 20000) {
                return '---';
            }
            
            const halfStepsFromC0 = 12 * Math.log2(frequency / C0);
            const octave = Math.floor(halfStepsFromC0 / 12);
            const noteIndex = Math.round(halfStepsFromC0 % 12);
            
            return `${noteNames[noteIndex]}${octave}`;
        }
        
        // ãƒ­ã‚°æ©Ÿèƒ½
        function addLog(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const levelColors = {
                info: '#3b82f6',
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b'
            };
            
            const logEntry = `[${timestamp}] ${message}\n`;
            logEl.innerHTML += `<span style="color: ${levelColors[level] || '#ffffff'}">${logEntry}</span>`;
            logEl.scrollTop = logEl.scrollHeight;
            
            console.log(`[${level.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            logEl.innerHTML = '';
        }
        
        function updateStatus(message) {
            statusEl.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${message}`;
            addLog(`Status: ${message}`);
        }
        
        // éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨ï¼‰
        initBtn.addEventListener('click', async () => {
            try {
                updateStatus('åˆæœŸåŒ–ä¸­...');
                addLog('ğŸ¤ çµ±ä¸€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åˆæœŸåŒ–é–‹å§‹', 'info');
                
                // AudioDetectionComponentåˆæœŸåŒ–ï¼ˆéŸ³åŸŸãƒ†ã‚¹ãƒˆå°‚ç”¨æœ€é©åŒ–è¨­å®šï¼‰
                audioDetector = new AudioDetectionComponent({
                    // éŸ³åŸŸãƒ†ã‚¹ãƒˆæ™‚ã¯UIæ›´æ–°ã‚’æ‰‹å‹•ã§è¡Œã†
                    // HarmonicCorrectionã®éŸ³åŸŸãƒ†ã‚¹ãƒˆæœ€é©åŒ–è¨­å®š
                    harmonicCorrectionConfig: {
                        historyWindowMs: 15000,           // 15ç§’å±¥æ­´ä¿æŒï¼ˆ3ç§’æ¸¬å®šÃ—2å›+ä½™è£•ï¼‰
                        stabilityWeight: 0.95,            // å®‰å®šæ€§æœ€é‡è¦–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0.7â†’0.95ï¼‰
                        volumeWeight: 0.05,               // éŸ³é‡ã®å½±éŸ¿ã‚’æœ€å°åŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0.3â†’0.05ï¼‰
                        minConfidenceThreshold: 0.2,      // ä¿¡é ¼åº¦é–¾å€¤ã‚’å¤§å¹…ç·©å’Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0.6â†’0.2ï¼‰
                        harmonicToleranceCents: 50,       // å€éŸ³è¨±å®¹èª¤å·®æ‹¡å¤§ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30â†’50ã‚»ãƒ³ãƒˆï¼‰
                        maxHarmonicNumber: 6              // æœ€å¤§6å€éŸ³ã¾ã§æ¤œè¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ8â†’6ã§è»½é‡åŒ–ï¼‰
                    },
                    // PitchDetectoréŸ³åŸŸãƒ†ã‚¹ãƒˆæœ€é©åŒ–
                    clarityThreshold: 0.15,              // æ˜ç­åº¦é–¾å€¤ç·©å’Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0.6â†’0.15ï¼‰
                    minVolumeAbsolute: 0.0005,           // éŸ³é‡é–¾å€¤ã‚’ä¸‹ã’ã¦å¾®ç´°ãªéŸ³ã‚‚æ‹¾ã†
                    fftSize: 8192,                       // FFTã‚µã‚¤ã‚ºæ‹¡å¤§ã§ä½éŸ³ç²¾åº¦å‘ä¸Šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ4096â†’8192ï¼‰
                    smoothing: 0.05                      // ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°æœ€å°åŒ–ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§é‡è¦–
                });
                
                await audioDetector.initialize();
                
                const status = audioDetector.getStatus();
                addLog(`âœ… ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º: ${status.deviceType}, éŸ³é‡ãƒãƒ¼æ„Ÿåº¦: ${status.volumeBarScale}x`, 'success');
                addLog('ğŸ”§ éŸ³åŸŸãƒ†ã‚¹ãƒˆç”¨HarmonicCorrectionè¨­å®š: å±¥æ­´ä¿æŒ10ç§’, å®‰å®šæ€§é‡è¦–ãƒ¢ãƒ¼ãƒ‰', 'info');
                
                updateStatus('åˆæœŸåŒ–å®Œäº† - ãƒ†ã‚¹ãƒˆæº–å‚™ãŒæ•´ã„ã¾ã—ãŸ');
                
                // UIé·ç§»ï¼šåˆæœŸåŒ–å®Œäº† â†’ ãƒ†ã‚¹ãƒˆé–‹å§‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                updateStepStatus(1, 'completed');
                updateStepStatus(2, 'active');
                showSection(testStartSection);
                
                addLog('ğŸ‰ çµ±ä¸€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæœŸåŒ–å®Œäº† - éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹å¯èƒ½', 'success');
                
            } catch (error) {
                addLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateStatus('åˆæœŸåŒ–å¤±æ•—');
            }
        });
        
        // éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
        testBtn.addEventListener('click', () => {
            // ã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ã®éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹
            currentPhase = 'low';
            stableFrequencies = [];
            stabilityStartTime = null;
            
            // UIé·ç§»
            updateStepStatus(2, 'completed');
            showSection(rangeTestSection);
            
            // ãƒ†ã‚¹ãƒˆæŒ‡ç¤ºæ›´æ–°
            const testInstructionText = document.getElementById('test-instruction-text');
            if (testInstructionText) {
                testInstructionText.textContent = 'ã§ãã‚‹ã ã‘ä½ã„å£°ã‚’å‡ºã—ã¦ï¼“ç§’é–“ã‚­ãƒ¼ãƒ—ã—ã¦ãã ã•ã„';
            }
            
            addLog('ğŸ¯ ã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹ - ä½éŸ³æ¸¬å®š', 'info');
            
            // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®startContinuousDetectioné–¢æ•°ã‚’å‘¼ã³å‡ºã—
            startContinuousDetection();
        });
        
        // ãƒ†ã‚¹ãƒˆåœæ­¢
        stopBtn.addEventListener('click', () => {
            stopVoiceRangeTest();
        });
        
        // ãƒªã‚»ãƒƒãƒˆ
        resetBtn.addEventListener('click', () => {
            resetTest();
        });
        
        // å†ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆä¸­ãƒ»å®Œäº†å¾Œç”¨ï¼‰
        if (retestBtn) {
            retestBtn.addEventListener('click', () => {
                addLog('ğŸ”„ å†ãƒ†ã‚¹ãƒˆé–‹å§‹ - éŸ³åŸŸãƒ†ã‚¹ãƒˆã‚’æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™', 'info');
                
                // ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆã‚’åœæ­¢
                if (isVoiceRangeTesting) {
                    stopVoiceRangeTest();
                }
                
                // ãƒªã‚»ãƒƒãƒˆå‡¦ç†
                resetTest();
                
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆé–‹å§‹
                setTimeout(() => {
                    addLog('ğŸ¯ å†ãƒ†ã‚¹ãƒˆè‡ªå‹•é–‹å§‹', 'info');
                    startVoiceRangeTest();
                }, 500);
            });
        }
        
        // æœ¬ç•ªå®Ÿè£…ç”¨æ©Ÿèƒ½
        const exportConfigBtn = document.getElementById('export-config-btn');
        const exportResultsBtn = document.getElementById('export-results-btn');
        const generateCodeBtn = document.getElementById('generate-code-btn');
        
        exportConfigBtn.addEventListener('click', () => exportOptimalConfig());
        exportResultsBtn.addEventListener('click', () => exportTestResults());
        generateCodeBtn.addEventListener('click', () => generateProductionCode());
        
        // 3ç§’å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼é–‹å§‹ï¼ˆpreparation.htmlæº–æ‹ ï¼‰
        function startProgressBar(onComplete) {
            // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            if (progressInterval) {
                addLog('âš ï¸ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼é‡è¤‡é–‹å§‹ã‚’æ¤œå‡º - æ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢', 'warning');
                clearInterval(progressInterval);
            }
            
            const startTime = Date.now();
            const duration = 3000; // 3ç§’
            const circumference = 2 * Math.PI * 72; // å††å‘¨é•·ï¼ˆåŠå¾„72pxï¼‰
            
            addLog(`â±ï¸ å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼é–‹å§‹ - ${duration}msé–“å®Ÿè¡Œ`, 'info');
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºã‚’é–‹å§‹
            if (countdownDisplay && rangeIcon) {
                rangeIcon.style.display = 'none';
                countdownDisplay.style.display = 'block';
                countdownDisplay.textContent = '3';
            }
            
            progressInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(100, (elapsed / duration) * 100);
                
                // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
                if (progressCircle) {
                    const dashoffset = circumference - (progress / 100) * circumference;
                    progressCircle.style.strokeDashoffset = dashoffset;
                }
                
                // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ›´æ–°ï¼ˆ0ã‚‚è¡¨ç¤ºï¼‰
                const remainingSeconds = Math.max(0, Math.ceil(3 - elapsed / 1000));
                if (countdownDisplay) {
                    countdownDisplay.textContent = remainingSeconds;
                }
                
                // 1ç§’ã”ã¨ã«ãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                if (elapsed % 1000 < 50) {
                    addLog(`ğŸ“Š ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹: ${progress.toFixed(1)}% (${(elapsed/1000).toFixed(1)}ç§’çµŒé)`, 'info');
                }
                
                // 3ç§’çµŒéã—ãŸã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚¯ãƒªã‚¢ï¼ˆ50msä½™è£•ã‚’æŒãŸã›ã‚‹ï¼‰
                if (elapsed >= duration + 50) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å®Œäº†çŠ¶æ…‹
                    if (progressCircle) {
                        progressCircle.style.strokeDashoffset = '0';
                    }
                    if (countdownDisplay) {
                        countdownDisplay.textContent = '0';
                    }
                    
                    addLog('âœ… å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å®Œäº† - 100%åˆ°é”', 'success');
                    
                    // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: preparation.htmlæº–æ‹ 
                    setTimeout(() => {
                        // ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã«ç›´æ¥å¤‰æ›´ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ï¼‰
                        if (countdownDisplay) {
                            countdownDisplay.style.display = 'none';
                        }
                        if (rangeIcon) {
                            // ã€ã‚¢ãƒ‰ãƒªãƒ–å®Ÿè£…ã€‘ä¸€æ™‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã«ç½®ãæ›ãˆäºˆå®š
                            // rangeIcon.setAttribute('data-lucide', 'check');
                            // rangeIcon.style.color = '#22c55e'; // ç·‘è‰²
                            // lucide.createIcons();
                        }
                        
                        // æ¸¬å®šå®Œäº†å‡¦ç†
                        setTimeout(() => {
                            if (onComplete && typeof onComplete === 'function') {
                                onComplete();
                            }
                        }, 500);
                    }, 300); // 0.3ç§’é–“0ã‚’è¡¨ç¤º
                }
            }, 50); // 50msã”ã¨ã«æ›´æ–°ï¼ˆæ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        }
        
        
        // éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function startVoiceRangeTest() {
            addLog('ğŸ¯ éŸ³åŸŸãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            updateStatus('éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ - ä½éŸ³åŸŸã‚’æ¸¬å®šã—ã¾ã™');
            
            // UIé·ç§»ï¼šãƒ†ã‚¹ãƒˆé–‹å§‹ â†’ éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            updateStepStatus(2, 'completed');
            showSection(rangeTestSection);
            
            isVoiceRangeTesting = true;
            detectionActive = true;
            currentPhase = 'low';
            
            // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
            voiceRangeTestData = {
                phase: currentPhase,
                measurementStartTime: null,
                detectedFrequencies: [],
                measurementStarted: false, // æ¸¬å®šé–‹å§‹ãƒ•ãƒ©ã‚°è¿½åŠ 
                results: {
                    lowestNote: null,
                    highestNote: null
                }
            };
            
            // UIæ›´æ–°ï¼ˆä»•æ§˜æ›¸æº–æ‹ ï¼‰
            testPhaseEl.textContent = 'ä½éŸ³ãƒ†ã‚¹ãƒˆ';
            testInstructionEl.textContent = 'ã§ãã‚‹ã ã‘ä½ã„å£°ã‚’å‡ºã—ã¦ï¼“ç§’é–“ã‚­ãƒ¼ãƒ—ã—ã¦ãã ã•ã„';
            testStatusEl.textContent = 'ä½éŸ³åŸŸã‚’æ¸¬å®šã—ã¦ã„ã¾ã™...';
            if (volumeBarFill) volumeBarFill.style.width = '0%';
            
            // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç·‘è‰²ã«ï¼ˆå¾…æ©ŸçŠ¶æ…‹ï¼‰
            updateMicIconColor('text-green-400');
            
            // preparation.htmlæº–æ‹ ã®measuringã‚¯ãƒ©ã‚¹é©ç”¨
            if (rangeIcon) {
                rangeIcon.classList.add('measuring');
            }
            if (voiceNoteBadge) {
                voiceNoteBadge.classList.add('measuring');
            }
            if (testInstructionContainer) {
                testInstructionContainer.classList.add('measuring');
            }
            addLog('ğŸ”„ measuringçŠ¶æ…‹é–‹å§‹ - range-icon, voice-note-badge, test-instruction', 'info');
            
            // HarmonicCorrectionã®å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆåŒã˜éŸ³ç¨‹ç¶™ç¶šæ¸¬å®šã®ãŸã‚ï¼‰
            try {
                if (audioDetector.pitchDetector && audioDetector.pitchDetector.harmonicCorrection) {
                    audioDetector.pitchDetector.harmonicCorrection.resetHistory();
                    addLog('ğŸ”§ HarmonicCorrectionå±¥æ­´ãƒªã‚»ãƒƒãƒˆ - åŒã˜éŸ³ç¨‹ç¶™ç¶šæ¸¬å®šãƒ¢ãƒ¼ãƒ‰', 'info');
                }
            } catch (error) {
                addLog('âš ï¸ HarmonicCorrectionè¨­å®šå¤‰æ›´ã«å¤±æ•—ï¼ˆéŸ³åŸŸãƒ†ã‚¹ãƒˆã¯ç¶™ç¶šï¼‰', 'warning');
            }
            
            // éŸ³åŸŸãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
            audioDetector.setCallbacks({
                onPitchUpdate: handleVoiceRangeUpdate
            });
            
            // æ¤œå‡ºé–‹å§‹
            const startResult = audioDetector.startDetection();
            addLog(`ğŸ¤ æ¤œå‡ºé–‹å§‹çµæœ: ${startResult}`, startResult ? 'success' : 'error');
            
            testBtn.disabled = true;
            stopBtn.disabled = false;
            
            // å†ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            if (retestBtn) {
                retestBtn.style.display = 'inline-flex';
            }
            
            addLog('ğŸ¤ éŸ³å£°æ¤œå‡ºå¾…æ©Ÿä¸­ - ã§ãã‚‹ã ã‘ä½ã„å£°ã‚’å‡ºã—ã¦ãã ã•ã„', 'info');
        }
        
        // éŸ³åŸŸãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
        function handleVoiceRangeUpdate(result) {
            if (!isVoiceRangeTesting || !voiceRangeTestData || !detectionActive) {
                return;
            }
            
            // UIæ›´æ–°ï¼ˆçµ±ä¸€å‡¦ç†ï¼‰
            if (result) {
                // æ¤œå‡ºæ¡ä»¶ã®å®šç¾©ï¼ˆæ¸¬å®šé–‹å§‹ã¨è¡¨ç¤ºã§ç•°ãªã‚‹åŸºæº–ï¼‰
                const minFreq = 80; // äººé–“ã®ç™ºå£°ä¸‹é™ï¼ˆè¡¨ç¤ºç”¨ï¼‰
                const maxFreq = 1000; // å®Ÿç”¨çš„ãªé«˜éŸ³ä¸Šé™ï¼ˆè¡¨ç¤ºç”¨ï¼‰
                const minVolume = 0.001;
                const minClarity = 0.2;
                
                // æ¸¬å®šé–‹å§‹ç”¨æ¡ä»¶ï¼ˆã‚ˆã‚Šç·©ã„æ¡ä»¶ï¼‰
                const measurementMinFreq = currentPhase === 'low' ? 30 : 50; // ä½éŸ³ãƒ†ã‚¹ãƒˆæ™‚ã¯30Hzã€é«˜éŸ³ãƒ†ã‚¹ãƒˆæ™‚ã¯50Hz
                const isMeasurementTriggerable = result.frequency >= measurementMinFreq && result.volume > minVolume && result.clarity > minClarity;
                
                // è¡¨ç¤ºç”¨æ¡ä»¶ï¼ˆç¾å®Ÿçš„ç¯„å›²å†…ï¼‰
                const isValidForDisplay = result.frequency >= minFreq && result.frequency <= maxFreq && result.volume > minVolume && result.clarity > minClarity;
                frequencyDisplayEl.textContent = isValidForDisplay ? 
                    `${result.frequency.toFixed(1)} Hz` : '-- Hz';
                
                // éŸ³é‡ãƒãƒ¼æ›´æ–°ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼‰
                const status = audioDetector.getStatus();
                const rawVolume = result.volume || 0;
                const adjustedVolume = rawVolume * status.volumeBarScale * status.sensitivityMultiplier;
                const volumePercent = Math.min(100, Math.max(0, adjustedVolume));
                
                // éŸ³é‡ãƒ¬ãƒ™ãƒ«ãƒãƒ¼ã®æ›´æ–°ï¼ˆæ­£ã—ã„è¦ç´ ã‚’å‚ç…§ï¼‰
                if (volumeBarFill) {
                    volumeBarFill.style.width = `${volumePercent}%`;
                }
                
                // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼ˆéŸ³é‡ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹æ™‚ã®ã¿ã€10%ã®ç¢ºç‡ã§å‡ºåŠ›ï¼‰
                if (rawVolume > 0.001 && Math.random() < 0.1) {
                    addLog(`ğŸšï¸ éŸ³é‡ãƒ‡ãƒãƒƒã‚°: ç”ŸéŸ³é‡=${(rawVolume * 100).toFixed(3)}%, ã‚¹ã‚±ãƒ¼ãƒ«=${status.volumeBarScale}, æ„Ÿåº¦=${status.sensitivityMultiplier}, èª¿æ•´å¾Œ=${volumePercent.toFixed(1)}%`, 'info');
                }
                
                volumeDisplayEl.textContent = `éŸ³é‡: ${volumePercent.toFixed(1)}% (ç”Ÿ: ${(rawVolume * 100).toFixed(2)}%)`;
                clarityDisplayEl.textContent = `æ˜ç­åº¦: ${(result.clarity * 100).toFixed(1)}%`;
                
                // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ›´æ–°
                const feedbackEl = document.getElementById('feedback-message');
                if (feedbackEl) {
                    let feedbackMessage = '';
                    
                    if (result.frequency > 0) { // å‘¨æ³¢æ•°ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿
                        if (result.frequency < minFreq) {
                            feedbackMessage = 'å£°ãŒä½ã™ãã¾ã™ï¼ˆ80Hzæœªæº€ï¼‰';
                            feedbackEl.style.color = '#f59e0b'; // è­¦å‘Šè‰²ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
                        } else if (result.frequency > maxFreq) {
                            feedbackMessage = 'å£°ãŒé«˜ã™ãã¾ã™ï¼ˆ1000Hzè¶…éï¼‰';
                            feedbackEl.style.color = '#f59e0b'; // è­¦å‘Šè‰²ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
                        } else if (result.volume <= minVolume) {
                            feedbackMessage = 'å£°ãŒå°ã•ã™ãã¾ã™';
                            feedbackEl.style.color = '#6b7280'; // ã‚°ãƒ¬ãƒ¼
                        } else if (result.clarity <= minClarity) {
                            feedbackMessage = 'éŸ³ç¨‹ãŒä¸æ˜ç­ã§ã™';
                            feedbackEl.style.color = '#6b7280'; // ã‚°ãƒ¬ãƒ¼
                        } else {
                            feedbackMessage = 'è‰¯å¥½ãªéŸ³å£°ã§ã™';
                            feedbackEl.style.color = '#10b981'; // æˆåŠŸè‰²ï¼ˆç·‘ï¼‰
                        }
                    } else {
                        feedbackMessage = 'éŸ³å£°ã‚’æ¤œå‡ºä¸­...';
                        feedbackEl.style.color = '#6b7280'; // ã‚°ãƒ¬ãƒ¼
                    }
                    
                    feedbackEl.textContent = feedbackMessage;
                }
                
                // æ¤œå‡ºæ¡ä»¶ã®ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºï¼ˆ5%ã®ç¢ºç‡ï¼‰
                if (Math.random() < 0.05 && !voiceRangeTestData.measurementStarted) {
                    const measurementValid = isMeasurementTriggerable ? 'âœ…æ¸¬å®šå¯' : 'âŒæ¸¬å®šä¸å¯';
                    const displayValid = isValidForDisplay ? 'âœ…è¡¨ç¤ºå¯' : 'âŒè¡¨ç¤ºä¸å¯';
                    addLog(`ğŸ” æ¤œå‡ºçŠ¶æ…‹: ${measurementValid} ${displayValid} å‘¨æ³¢æ•°${result.frequency.toFixed(1)}Hz(æ¸¬å®š>=${measurementMinFreq}Hz, è¡¨ç¤º${minFreq}-${maxFreq}Hz), éŸ³é‡${(rawVolume * 100).toFixed(3)}%(>=${(minVolume * 100).toFixed(1)}), æ˜ç­åº¦${(result.clarity * 100).toFixed(1)}%(>=${(minClarity * 100).toFixed(0)})`, 'info');
                }
                
                // æ¸¬å®šé–‹å§‹æ¡ä»¶ï¼ˆã‚ˆã‚Šç·©ã„æ¡ä»¶ã§æ¸¬å®šé–‹å§‹ï¼‰
                if (!voiceRangeTestData.measurementStarted && isMeasurementTriggerable) {
                    
                    voiceRangeTestData.measurementStarted = true;
                    voiceRangeTestData.measurementStartTime = Date.now();
                    
                    const phaseText = currentPhase === 'low' ? 'ä½éŸ³' : 'é«˜éŸ³';
                    addLog(`â±ï¸ ${phaseText}æ¤œå‡ºï¼3ç§’æ¸¬å®šé–‹å§‹ (${result.frequency.toFixed(1)}Hz)`, 'success');
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                    testStatusEl.textContent = `${phaseText}æ¸¬å®šä¸­... (${result.frequency.toFixed(1)}Hz)`;
                    
                    // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’èµ¤è‰²ã«ï¼ˆé›†éŸ³ä¸­ï¼‰
                    updateMicIconColor('text-red-400');
                    
                    // 3ç§’ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼é–‹å§‹ï¼ˆå®Œäº†æ™‚ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œï¼‰
                    startProgressBar(() => {
                        if (isVoiceRangeTesting && voiceRangeTestData && currentPhase === voiceRangeTestData.phase) {
                            completePhaseMeasurement();
                        }
                    });
                }
                
                // æ¸¬å®šé–‹å§‹å¾Œã®ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²
                if (voiceRangeTestData.measurementStarted) {
                    // ãƒ­ã‚°é »åº¦ã‚’ä¸‹ã’ã‚‹ï¼ˆ20å›ã«1å›ï¼‰
                    if (Math.random() < 0.05) {
                        addLog(`ğŸµ éŸ³åŸŸãƒ†ã‚¹ãƒˆå‡¦ç†: ${result.frequency.toFixed(1)}Hz, èª¿æ•´éŸ³é‡${volumePercent.toFixed(1)}%`, 'info');
                    }
                    
                    // çµŒéæ™‚é–“è¨ˆç®—
                    const elapsed = Date.now() - voiceRangeTestData.measurementStartTime;
                    
                    // ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²æ¡ä»¶ï¼ˆæ¸¬å®šé–‹å§‹æ¡ä»¶ã¨åŒã˜ï¼‰
                    if (isMeasurementTriggerable) {
                        voiceRangeTestData.detectedFrequencies.push({
                            frequency: result.frequency,
                            time: elapsed,
                            volume: result.volume,
                            clarity: result.clarity
                        });
                    }
                }
            }
        }
        
        // éŸ³ç¨‹å®‰å®šæ€§ãƒã‚§ãƒƒã‚¯é–¢æ•°
        function checkFrequencyStability(frequencies) {
            if (frequencies.length < 10) return false;
            
            const freqValues = frequencies.map(f => f.frequency);
            const mean = freqValues.reduce((a, b) => a + b) / freqValues.length;
            
            // æ¨™æº–åå·®è¨ˆç®—
            const variance = freqValues.reduce((acc, freq) => acc + Math.pow(freq - mean, 2), 0) / freqValues.length;
            const stdDev = Math.sqrt(variance);
            
            // å¹³å‡å‘¨æ³¢æ•°ã®10%ä»¥å†…ã®å¤‰å‹•ãªã‚‰å®‰å®šã¨ã¿ãªã™
            const tolerance = mean * 0.1;
            const isStable = stdDev < tolerance;
            
            addLog(`ğŸ“Š å®‰å®šæ€§åˆ†æ: å¹³å‡${mean.toFixed(1)}Hz, æ¨™æº–åå·®${stdDev.toFixed(1)}, è¨±å®¹ç¯„å›²${tolerance.toFixed(1)}`, 'info');
            
            return isStable;
        }
        
        // éŸ³åŸŸãƒ‡ãƒ¼ã‚¿è©³ç´°åˆ†æé–¢æ•°ï¼ˆæœ¬ç•ªå®Ÿè£…ç”¨ï¼‰
        function analyzeVoiceRangeData(detectedFrequencies, phase) {
            const frequencies = detectedFrequencies.map(d => d.frequency);
            const volumes = detectedFrequencies.map(d => d.volume);
            const clarities = detectedFrequencies.map(d => d.clarity);
            
            // åŸºæœ¬çµ±è¨ˆ
            const sampleCount = frequencies.length;
            const mean = frequencies.reduce((a, b) => a + b) / sampleCount;
            const variance = frequencies.reduce((acc, freq) => acc + Math.pow(freq - mean, 2), 0) / sampleCount;
            const standardDeviation = Math.sqrt(variance);
            
            // å®‰å®šæ€§ã‚¹ã‚³ã‚¢ï¼ˆ0-1ï¼‰
            const coefficientOfVariation = standardDeviation / mean;
            const stability = Math.max(0, 1 - coefficientOfVariation);
            
            // å¤–ã‚Œå€¤é™¤å»ï¼ˆå¹³å‡Â±2æ¨™æº–åå·®ä»¥å†…ï¼‰
            const filteredFreqs = frequencies.filter(freq => 
                Math.abs(freq - mean) <= 2 * standardDeviation
            );
            
            // æœ€çµ‚å‘¨æ³¢æ•°ï¼ˆå¤–ã‚Œå€¤é™¤å»å¾Œã®å¹³å‡ï¼‰
            const finalFrequency = filteredFreqs.length > 0 ? 
                filteredFreqs.reduce((a, b) => a + b) / filteredFreqs.length : mean;
            
            // éŸ³é‡ãƒ»æ˜ç­åº¦çµ±è¨ˆ
            const avgVolume = volumes.reduce((a, b) => a + b) / volumes.length;
            const avgClarity = clarities.reduce((a, b) => a + b) / clarities.length;
            
            // æ™‚ç³»åˆ—å®‰å®šæ€§ï¼ˆå‰åŠãƒ»å¾ŒåŠæ¯”è¼ƒï¼‰
            const halfPoint = Math.floor(frequencies.length / 2);
            const firstHalf = frequencies.slice(0, halfPoint);
            const secondHalf = frequencies.slice(halfPoint);
            const firstHalfMean = firstHalf.reduce((a, b) => a + b) / firstHalf.length;
            const secondHalfMean = secondHalf.reduce((a, b) => a + b) / secondHalf.length;
            const timeStability = Math.abs(secondHalfMean - firstHalfMean);
            
            return {
                phase,
                sampleCount,
                finalFrequency,
                mean,
                standardDeviation,
                stability,
                avgVolume,
                avgClarity,
                coefficientOfVariation,
                timeStability,
                outlierCount: sampleCount - filteredFreqs.length,
                frequencyRange: {
                    min: Math.min(...frequencies),
                    max: Math.max(...frequencies)
                }
            };
        }
        
        // ç·åˆåˆ†æçµæœè¡¨ç¤ºé–¢æ•°
        function displayComprehensiveAnalysis() {
            const results = voiceRangeTestData.results;
            if (!results.lowAnalysis || !results.highAnalysis) return;
            
            // éŸ³åŸŸçµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
            const rangeStatsEl = document.getElementById('range-statistics');
            const rangeContentEl = document.getElementById('range-analysis-content');
            
            if (rangeStatsEl && rangeContentEl) {
                const lowNote = frequencyToNote(results.lowestNote);
                const highNote = frequencyToNote(results.highestNote);
                const semitoneRange = Math.round(12 * Math.log2(results.highestNote / results.lowestNote));
                const octaveRange = (semitoneRange / 12).toFixed(1);
                
                rangeContentEl.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                        <div>
                            <strong>ä½éŸ³åŸŸ:</strong> ${lowNote}<br>
                            <small>å¹³å‡: ${results.lowestNote.toFixed(1)}Hz</small>
                        </div>
                        <div>
                            <strong>é«˜éŸ³åŸŸ:</strong> ${highNote}<br>
                            <small>å¹³å‡: ${results.highestNote.toFixed(1)}Hz</small>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(59, 130, 246, 0.1); border-radius: 4px;">
                        <strong>éŸ³åŸŸå¹…:</strong> ${semitoneRange}åŠéŸ³ (${octaveRange}ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–)
                    </div>
                `;
                
                rangeStatsEl.style.display = 'block';
            }
            
            // HarmonicCorrectionçµ±è¨ˆã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            const harmonicStatsEl = document.getElementById('harmonic-statistics');
            const harmonicContentEl = document.getElementById('harmonic-analysis-content');
            
            if (harmonicStatsEl && harmonicContentEl) {
                try {
                    const harmonicStats = audioDetector.pitchDetector?.harmonicCorrection?.getAnalysisStats();
                    if (harmonicStats) {
                        harmonicContentEl.innerHTML = `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>å±¥æ­´é•·: ${harmonicStats.historyLength}</div>
                                <div>å¹³å‡ä¿¡é ¼åº¦: ${(harmonicStats.averageConfidence * 100).toFixed(1)}%</div>
                                <div>å®‰å®šæ€§: ${(harmonicStats.stabilityScore * 100).toFixed(1)}%</div>
                                <div>å‘¨æ³¢æ•°ç¯„å›²: ${harmonicStats.frequencyRange ? 
                                    `${harmonicStats.frequencyRange.min.toFixed(1)}-${harmonicStats.frequencyRange.max.toFixed(1)}Hz` : 
                                    'N/A'}</div>
                            </div>
                        `;
                        harmonicStatsEl.style.display = 'block';
                    }
                } catch (error) {
                    harmonicContentEl.innerHTML = '<div style="color: #f59e0b;">HarmonicCorrectionçµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼</div>';
                    harmonicStatsEl.style.display = 'block';
                }
            }
        }
        
        // ãƒ•ã‚§ãƒ¼ã‚ºæ¸¬å®šå®Œäº†
        function completePhaseMeasurement() {
            addLog(`â° ${currentPhase}éŸ³3ç§’æ¸¬å®šå®Œäº†`, 'info');
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            if (progressInterval) {
                addLog('ğŸ›‘ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¯ãƒªã‚¢: completePhaseMeasurement()', 'warning');
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            // å®‰å®šæ€§ãƒã‚§ãƒƒã‚¯: ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ã¨éŸ³ç¨‹ã®å®‰å®šæ€§
            const minSamples = 15; // æœ€ä½15ã‚µãƒ³ãƒ—ãƒ«å¿…è¦
            const isStable = checkFrequencyStability(voiceRangeTestData.detectedFrequencies);
            
            if (voiceRangeTestData.detectedFrequencies.length < minSamples || !isStable) {
                addLog(`âš ï¸ ${currentPhase}éŸ³æ¸¬å®šå¤±æ•— - ã‚µãƒ³ãƒ—ãƒ«æ•°:${voiceRangeTestData.detectedFrequencies.length}, å®‰å®šæ€§:${isStable}`, 'warning');
                addLog('ğŸ”„ å†æ¸¬å®šã‚’é–‹å§‹ã—ã¾ã™', 'info');
                
                // å†æ¸¬å®šã®ãŸã‚ã«ãƒªã‚»ãƒƒãƒˆ
                voiceRangeTestData.measurementStartTime = null;
                voiceRangeTestData.detectedFrequencies = [];
                voiceRangeTestData.measurementStarted = false; // æ¸¬å®šé–‹å§‹ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
                if (volumeBarFill) volumeBarFill.style.width = '0%'; // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
                
                // ä»•æ§˜æ›¸æº–æ‹ ã®å†æ¸¬å®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const phaseText = currentPhase === 'low' ? 'ä½ã„' : 'é«˜ã„';
                testInstructionEl.textContent = `ã€å†æ¸¬å®šã€‘ã§ãã‚‹ã ã‘${phaseText}å£°ã‚’å‡ºã—ã¦ï¼“ç§’é–“ã‚­ãƒ¼ãƒ—ã—ã¦ãã ã•ã„`;
                testStatusEl.textContent = `å†æ¸¬å®šå¾…æ©Ÿä¸­... - ${phaseText}å£°ã‚’å‡ºã—ã¦ãã ã•ã„`;
                
                // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç·‘è‰²ã«æˆ»ã™ï¼ˆå¾…æ©ŸçŠ¶æ…‹ï¼‰
                updateMicIconColor('text-green-400');
                
                addLog('ğŸ”„ éŸ³å£°æ¤œå‡ºå¾…æ©Ÿä¸­ - ã‚‚ã†ä¸€åº¦å£°ã‚’å‡ºã—ã¦ãã ã•ã„', 'info');
                
                return;
            }
            
            // è©³ç´°åˆ†æã‚’å®Ÿè¡Œ
            const analysisResult = analyzeVoiceRangeData(voiceRangeTestData.detectedFrequencies, currentPhase);
            
            if (currentPhase === 'low') {
                voiceRangeTestData.results.lowestNote = analysisResult.finalFrequency;
                voiceRangeTestData.results.lowAnalysis = analysisResult; // åˆ†æçµæœã‚’ä¿å­˜
                const note = frequencyToNote(analysisResult.finalFrequency);
                addLog(`âœ… ä½éŸ³ç¢ºå®š: ${note} (${analysisResult.finalFrequency.toFixed(1)}Hz)`, 'success');
                
                // preparation.htmlæº–æ‹ ã®measuringçŠ¶æ…‹è§£é™¤ + confirmedçŠ¶æ…‹è¿½åŠ 
                if (rangeIcon) {
                    rangeIcon.classList.remove('measuring');
                    // ã€ã‚¢ãƒ‰ãƒªãƒ–å®Ÿè£…ã€‘ä¸€æ™‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã«ç½®ãæ›ãˆäºˆå®š
                    // rangeIcon.setAttribute('data-lucide', 'arrow-up');
                    // rangeIcon.style.color = '#ef4444'; // èµ¤è‰²ï¼ˆé«˜éŸ³ç”¨ï¼‰
                    // lucide.createIcons(); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†æç”»
                }
                if (voiceNoteBadge) {
                    voiceNoteBadge.classList.remove('measuring');
                    voiceNoteBadge.classList.add('confirmed');
                    // confirmedçŠ¶æ…‹ã‚’0.6ç§’å¾Œã«å‰Šé™¤ï¼ˆpreparation.htmlã¨åŒã˜ï¼‰
                    setTimeout(() => {
                        if (voiceNoteBadge) voiceNoteBadge.classList.remove('confirmed');
                    }, 600);
                }
                if (testInstructionContainer) {
                    testInstructionContainer.classList.remove('measuring');
                }
                addLog('ğŸ›‘ ä½éŸ³æ¸¬å®šå®Œäº† - measuringè§£é™¤, confirmedè¿½åŠ , ã‚¢ã‚¤ã‚³ãƒ³ã‚’arrow-upã«å¤‰æ›´', 'info');
                
                // ä½éŸ³çµæœã¨è©³ç´°åˆ†æã‚’è¡¨ç¤º
                if (resultsDisplayEl) {
                    resultsDisplayEl.style.display = 'block';
                    resultsDisplayEl.classList.remove('hidden');
                }
                lowResultContainer.style.display = 'block';
                lowResultEl.textContent = `${note} (${analysisResult.finalFrequency.toFixed(1)} Hz)`;
                
                // è©³ç´°æƒ…å ±è¡¨ç¤º
                const lowDetailsEl = document.getElementById('low-result-details');
                if (lowDetailsEl) {
                    lowDetailsEl.innerHTML = `
                        ã‚µãƒ³ãƒ—ãƒ«æ•°: ${analysisResult.sampleCount} | 
                        å®‰å®šæ€§: ${(analysisResult.stability * 100).toFixed(1)}% | 
                        æ¨™æº–åå·®: ${analysisResult.standardDeviation.toFixed(1)}Hz
                    `;
                }
                
                // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã«ï¼ˆæº–å‚™ä¸­ï¼‰
                updateMicIconColor('text-gray-400');
                
                // é«˜éŸ³æ¸¬å®šã«ç§»è¡Œï¼ˆ1ç§’å¾…æ©Ÿ - ä»•æ§˜æ›¸æº–æ‹ ï¼‰
                testInstructionEl.textContent = 'æ¬¡ã®æ¸¬å®šã‚’æº–å‚™ã—ã¦ã„ã¾ã™...';
                testStatusEl.textContent = 'é«˜éŸ³æ¸¬å®šæº–å‚™ä¸­...';
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
                if (progressInterval) {
                    addLog('ğŸ›‘ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¯ãƒªã‚¢: ä½éŸ³â†’é«˜éŸ³ç§»è¡Œ', 'warning');
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                if (volumeBarFill) volumeBarFill.style.width = '0%';
                
                setTimeout(() => {
                    currentPhase = 'high';
                    voiceRangeTestData.phase = 'high';
                    voiceRangeTestData.measurementStartTime = null;
                    voiceRangeTestData.detectedFrequencies = [];
                    voiceRangeTestData.measurementStarted = false; // æ¸¬å®šé–‹å§‹ãƒ•ãƒ©ã‚°ãƒªã‚»ãƒƒãƒˆ
                    
                    // HarmonicCorrectionã®å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆé«˜éŸ³ãƒ†ã‚¹ãƒˆç”¨ï¼‰
                    try {
                        if (audioDetector.pitchDetector && audioDetector.pitchDetector.harmonicCorrection) {
                            audioDetector.pitchDetector.harmonicCorrection.resetHistory();
                            addLog('ğŸ”§ HarmonicCorrectionå±¥æ­´ãƒªã‚»ãƒƒãƒˆ - é«˜éŸ³ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                        }
                    } catch (error) {
                        addLog('âš ï¸ HarmonicCorrectioné«˜éŸ³ãƒ†ã‚¹ãƒˆè¨­å®šå¤‰æ›´ã«å¤±æ•—', 'warning');
                    }
                    
                    testPhaseEl.textContent = 'é«˜éŸ³ãƒ†ã‚¹ãƒˆ';
                    testInstructionEl.textContent = 'ã§ãã‚‹ã ã‘é«˜ã„å£°ã‚’å‡ºã—ã¦ï¼“ç§’é–“ã‚­ãƒ¼ãƒ—ã—ã¦ãã ã•ã„';
                    testStatusEl.textContent = 'é«˜éŸ³åŸŸã‚’æ¸¬å®šã—ã¦ã„ã¾ã™...';
                    if (volumeBarFill) volumeBarFill.style.width = '0%';
                    
                    // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ»ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆé«˜éŸ³ãƒ†ã‚¹ãƒˆç”¨ï¼‰
                    if (progressCircle) {
                        progressCircle.style.strokeDashoffset = '452'; // ãƒªã‚»ãƒƒãƒˆ
                    }
                    if (countdownDisplay) {
                        countdownDisplay.style.display = 'none';
                        countdownDisplay.style.opacity = '1'; // ä¸é€æ˜åº¦ãƒªã‚»ãƒƒãƒˆ
                    }
                    if (rangeIcon) {
                        rangeIcon.style.display = 'block';
                        // é«˜éŸ³ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚¤ã‚³ãƒ³ã«å¤‰æ›´ï¼ˆarrow-upã€ç™½è‰²çµ±ä¸€ï¼‰
                        rangeIcon.setAttribute('data-lucide', 'arrow-up');
                        rangeIcon.style.color = 'white'; // ç™½è‰²çµ±ä¸€ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«æº–æ‹ ï¼‰
                        rangeIcon.style.transform = 'scale(1.0)'; // ã‚µã‚¤ã‚ºãƒªã‚»ãƒƒãƒˆ
                        rangeIcon.style.opacity = '1'; // ä¸é€æ˜åº¦ãƒªã‚»ãƒƒãƒˆ
                        rangeIcon.style.transition = 'none'; // ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–
                        
                        // æœ¬ç•ªç’°å¢ƒæº–æ‹ ã®ã‚·ãƒ³ãƒ—ãƒ«ãªå†æç”»
                        lucide.createIcons();
                        addLog('ğŸ”„ é«˜éŸ³ãƒ†ã‚¹ãƒˆ: arrow-upã‚¢ã‚¤ã‚³ãƒ³ã«å¤‰æ›´å®Œäº†', 'info');
                    }
                    
                    // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç·‘è‰²ã«ï¼ˆå¾…æ©ŸçŠ¶æ…‹ï¼‰
                    updateMicIconColor('text-green-400');
                    
                    // preparation.htmlæº–æ‹ ã®measuringçŠ¶æ…‹é–‹å§‹ï¼ˆé«˜éŸ³æ¸¬å®šï¼‰
                    if (rangeIcon) {
                        rangeIcon.classList.add('measuring');
                    }
                    if (voiceNoteBadge) {
                        voiceNoteBadge.classList.add('measuring');
                    }
                    if (testInstructionContainer) {
                        testInstructionContainer.classList.add('measuring');
                    }
                    addLog('ğŸ”„ é«˜éŸ³æ¸¬å®šç”¨measuringçŠ¶æ…‹é–‹å§‹ - range-icon, voice-note-badge, test-instruction', 'info');
                    
                    addLog('ğŸ¤ éŸ³å£°æ¤œå‡ºå¾…æ©Ÿä¸­ - ã§ãã‚‹ã ã‘é«˜ã„å£°ã‚’å‡ºã—ã¦ãã ã•ã„', 'info');
                }, 1000);
                
            } else {
                voiceRangeTestData.results.highestNote = analysisResult.finalFrequency;
                voiceRangeTestData.results.highAnalysis = analysisResult; // åˆ†æçµæœã‚’ä¿å­˜
                const note = frequencyToNote(analysisResult.finalFrequency);
                addLog(`âœ… é«˜éŸ³ç¢ºå®š: ${note} (${analysisResult.finalFrequency.toFixed(1)}Hz)`, 'success');
                
                // preparation.htmlæº–æ‹ ã®measuringçŠ¶æ…‹è§£é™¤ + confirmedçŠ¶æ…‹è¿½åŠ ï¼ˆé«˜éŸ³å®Œäº†ï¼‰
                if (rangeIcon) {
                    rangeIcon.classList.remove('measuring');
                    // ã€ã‚¢ãƒ‰ãƒªãƒ–å®Ÿè£…ã€‘ä¸€æ™‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã«ç½®ãæ›ãˆäºˆå®š
                    // rangeIcon.setAttribute('data-lucide', 'check');
                    // rangeIcon.style.color = '#22c55e'; // ç·‘è‰²ï¼ˆå®Œäº†ç”¨ï¼‰
                    // lucide.createIcons(); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†æç”»
                }
                if (voiceNoteBadge) {
                    voiceNoteBadge.classList.remove('measuring');
                    voiceNoteBadge.classList.add('confirmed');
                    // confirmedçŠ¶æ…‹ã‚’0.6ç§’å¾Œã«å‰Šé™¤ï¼ˆpreparation.htmlã¨åŒã˜ï¼‰
                    setTimeout(() => {
                        if (voiceNoteBadge) voiceNoteBadge.classList.remove('confirmed');
                    }, 600);
                }
                if (testInstructionContainer) {
                    testInstructionContainer.classList.remove('measuring');
                }
                addLog('ğŸ›‘ é«˜éŸ³æ¸¬å®šå®Œäº† - measuringè§£é™¤, confirmedè¿½åŠ , ã‚¢ã‚¤ã‚³ãƒ³ã‚’checkã«å¤‰æ›´', 'info');
                
                // é«˜éŸ³çµæœã¨è©³ç´°åˆ†æã‚’è¡¨ç¤º
                highResultContainer.style.display = 'block';
                highResultEl.textContent = `${note} (${analysisResult.finalFrequency.toFixed(1)} Hz)`;
                
                // è©³ç´°æƒ…å ±è¡¨ç¤º
                const highDetailsEl = document.getElementById('high-result-details');
                if (highDetailsEl) {
                    highDetailsEl.innerHTML = `
                        ã‚µãƒ³ãƒ—ãƒ«æ•°: ${analysisResult.sampleCount} | 
                        å®‰å®šæ€§: ${(analysisResult.stability * 100).toFixed(1)}% | 
                        æ¨™æº–åå·®: ${analysisResult.standardDeviation.toFixed(1)}Hz
                    `;
                }
                
                // ç·åˆåˆ†æçµæœã‚’è¡¨ç¤º
                displayComprehensiveAnalysis();
                
                // ãƒ†ã‚¹ãƒˆå®Œäº†
                finishVoiceRangeTest();
            }
        }
        
        // ãƒ†ã‚¹ãƒˆå®Œäº†
        function finishVoiceRangeTest() {
            addLog('ğŸ‰ éŸ³åŸŸãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            
            const results = voiceRangeTestData.results;
            
            testPhaseEl.textContent = 'æ¸¬å®šå®Œäº†';
            testInstructionEl.textContent = 'éŸ³åŸŸæ¸¬å®šãŒå®Œäº†ã—ã¾ã—ãŸï¼';
            testStatusEl.textContent = 'éŸ³åŸŸæ¸¬å®šå®Œäº†ï¼';
            // éŸ³é‡ãƒãƒ¼ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã®ã¾ã¾ç¶­æŒï¼ˆ100%ã«å›ºå®šã—ãªã„ï¼‰
            
            // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’å®Œå…¨ã«åŸ‹ã‚ã‚‹
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = '0'; // 100%å®Œäº†
            }
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å®Œäº†çŠ¶æ…‹ã«å¤‰æ›´ï¼ˆãƒã‚§ãƒƒã‚¯ã€ç·‘è‰²ï¼‰
            if (countdownDisplay) {
                countdownDisplay.style.display = 'none';
            }
            if (rangeIcon) {
                rangeIcon.style.display = 'block';
                // ã€ã‚¢ãƒ‰ãƒªãƒ–å®Ÿè£…ã€‘ä¸€æ™‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ - ã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ã«ç½®ãæ›ãˆäºˆå®š
                // rangeIcon.setAttribute('data-lucide', 'check');
                // rangeIcon.style.color = '#22c55e'; // ç·‘è‰²
                // lucide.createIcons();
            }
            
            // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã«ï¼ˆåœæ­¢çŠ¶æ…‹ï¼‰
            updateMicIconColor('text-gray-400');
            
            // æœ€çµ‚çµæœè¡¨ç¤º
            const lowNote = frequencyToNote(results.lowestNote);
            const highNote = frequencyToNote(results.highestNote);
            
            // éŸ³åŸŸå¹…ã‚’è¨ˆç®—ï¼ˆã‚»ãƒŸãƒˆãƒ¼ãƒ³â†’ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰
            const rangeSemitones = Math.round(12 * Math.log2(results.highestNote / results.lowestNote));
            const rangeOctaves = (rangeSemitones / 12).toFixed(1);
            
            // éŸ³åŸŸã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
            const rangeSummaryEl = document.getElementById('range-summary');
            const rangeWidthEl = document.getElementById('range-width');
            if (rangeSummaryEl && rangeWidthEl) {
                rangeSummaryEl.style.display = 'block';
                rangeWidthEl.textContent = `${rangeOctaves}ã‚ªã‚¯ã‚¿ãƒ¼ãƒ– (${rangeSemitones}åŠéŸ³)`;
            }
            
            addLog(`ğŸ“‹ æœ€çµ‚çµæœ - ä½éŸ³:${lowNote} (${results.lowestNote.toFixed(1)}Hz), é«˜éŸ³:${highNote} (${results.highestNote.toFixed(1)}Hz), éŸ³åŸŸ:${rangeOctaves}ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–`, 'success');
            
            stopVoiceRangeTest();
            resetBtn.disabled = false;
            
            // è‡ªå‹•é·ç§»ã‚’ç„¡åŠ¹åŒ– - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµæœã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ‰‹å‹•ã§é€²ã‚€
            // showSection(resultSection);
            updateStepStatus(3, 'completed');
            
            // çµæœã‚’ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«è¡¨ç¤ºï¼ˆé·ç§»ãªã—ï¼‰
            const inlineResultEl = document.getElementById('inline-result');
            const inlineLowResultEl = document.getElementById('inline-low-result');
            const inlineHighResultEl = document.getElementById('inline-high-result');
            const inlineRangeWidthEl = document.getElementById('inline-range-width');
            
            if (inlineResultEl) {
                inlineResultEl.style.display = 'block';
                
                if (inlineLowResultEl) {
                    inlineLowResultEl.textContent = `${lowNote} (${results.lowestNote.toFixed(1)} Hz)`;
                }
                if (inlineHighResultEl) {
                    inlineHighResultEl.textContent = `${highNote} (${results.highestNote.toFixed(1)} Hz)`;
                }
                if (inlineRangeWidthEl) {
                    inlineRangeWidthEl.textContent = `${rangeOctaves}ã‚ªã‚¯ã‚¿ãƒ¼ãƒ– (${rangeSemitones}åŠéŸ³)`;
                }
                
                // Lucideã‚¢ã‚¤ã‚³ãƒ³ã‚’å†æç”»
                lucide.createIcons();
            }
            
            addLog('ğŸ“Š æ¸¬å®šçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å¿…è¦ã«å¿œã˜ã¦å†ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã§å†æ¸¬å®šã§ãã¾ã™ã€‚', 'success');
            
            // æœ¬ç•ªå®Ÿè£…ç”¨ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            enableExportButtons();
        }
        
        // ãƒ†ã‚¹ãƒˆåœæ­¢
        function stopVoiceRangeTest() {
            isVoiceRangeTesting = false;
            detectionActive = false;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            if (progressInterval) {
                addLog('ğŸ›‘ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¯ãƒªã‚¢: stopVoiceRangeTest()', 'warning');
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            if (audioDetector) {
                audioDetector.stopDetection();
            }
            
            testBtn.disabled = false;
            stopBtn.disabled = true;
            
            // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã«ï¼ˆåœæ­¢çŠ¶æ…‹ï¼‰
            updateMicIconColor('text-gray-400');
            
            // preparation.htmlæº–æ‹ ã®å…¨çŠ¶æ…‹ã‚¯ãƒ©ã‚¹å‰Šé™¤
            if (rangeIcon) {
                rangeIcon.classList.remove('measuring');
            }
            if (voiceNoteBadge) {
                voiceNoteBadge.classList.remove('measuring', 'confirmed');
            }
            if (testInstructionContainer) {
                testInstructionContainer.classList.remove('measuring');
            }
            addLog('ğŸ›‘ ãƒ†ã‚¹ãƒˆåœæ­¢ - å…¨measuringçŠ¶æ…‹è§£é™¤', 'info');
            
            updateStatus('ãƒ†ã‚¹ãƒˆåœæ­¢');
            addLog('ğŸ›‘ éŸ³åŸŸãƒ†ã‚¹ãƒˆåœæ­¢', 'info');
        }
        
        // ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetTest() {
            addLog('ğŸ”„ ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ', 'info');
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            if (progressInterval) {
                addLog('ğŸ›‘ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¯ãƒªã‚¢: resetTest()', 'warning');
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            // ãƒ†ã‚¹ãƒˆçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            isVoiceRangeTesting = false;
            detectionActive = false;
            currentPhase = 'low';
            voiceRangeTestData = null;
            
            // preparation.htmlæº–æ‹ ã®å…¨çŠ¶æ…‹ã‚¯ãƒ©ã‚¹å‰Šé™¤ï¼ˆãƒªã‚»ãƒƒãƒˆæ™‚ï¼‰
            if (rangeIcon) {
                rangeIcon.classList.remove('measuring');
                // åˆæœŸçŠ¶æ…‹ï¼ˆä½éŸ³æ¸¬å®šç”¨ï¼‰ã«æˆ»ã™
                rangeIcon.setAttribute('data-lucide', 'arrow-down');
                rangeIcon.style.color = 'white';
                lucide.createIcons(); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†æç”»
            }
            if (voiceNoteBadge) {
                voiceNoteBadge.classList.remove('measuring', 'confirmed');
            }
            if (testInstructionContainer) {
                testInstructionContainer.classList.remove('measuring');
            }
            addLog('ğŸ›‘ ãƒªã‚»ãƒƒãƒˆæ™‚ - å…¨measuringçŠ¶æ…‹è§£é™¤, ã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆæœŸçŠ¶æ…‹ã«å¾©å…ƒ', 'info');
            
            // UIè¦ç´ ãƒªã‚»ãƒƒãƒˆï¼ˆä»•æ§˜æ›¸æº–æ‹ ï¼‰
            testPhaseEl.textContent = 'éŸ³åŸŸã‚’æ¸¬å®šã—ã¾ã™';
            testInstructionEl.textContent = 'éŸ³åŸŸãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„';
            testStatusEl.textContent = 'ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...';
            if (volumeBarFill) volumeBarFill.style.width = '0%';
            frequencyDisplayEl.textContent = '-- Hz';
            volumeDisplayEl.textContent = 'éŸ³é‡: 0%';
            clarityDisplayEl.textContent = 'æ˜ç­åº¦: --%';
            
            // çµæœè¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            if (resultsDisplayEl) resultsDisplayEl.style.display = 'none';
            lowResultContainer.style.display = 'none';
            highResultContainer.style.display = 'none';
            const rangeSummaryEl = document.getElementById('range-summary');
            if (rangeSummaryEl) rangeSummaryEl.style.display = 'none';
            
            // SVGãƒ»ã‚¢ã‚¤ã‚³ãƒ³çŠ¶æ…‹ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
            const stabilitySvg = document.getElementById('stability-ring');
            if (stabilitySvg) {
                stabilitySvg.style.transform = 'scale(1.0)';
                stabilitySvg.style.opacity = '1';
                stabilitySvg.style.transition = 'none';
                stabilitySvg.style.transformOrigin = 'center';
            }
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = '452';
                progressCircle.style.stroke = '#3b82f6';
                progressCircle.style.strokeWidth = '16';
                progressCircle.style.opacity = '1';
                progressCircle.style.transition = 'none';
            }
            
            // ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã«ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
            updateMicIconColor('text-gray-400');
            
            // å†ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            if (retestBtn) {
                retestBtn.style.display = 'none';
            }
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³çµæœè¡¨ç¤ºã‚’éè¡¨ç¤º
            const inlineResultEl = document.getElementById('inline-result');
            if (inlineResultEl) {
                inlineResultEl.style.display = 'none';
            }
            
            // çµæœè¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            resultsDisplayEl.style.display = 'none';
            lowResultContainer.style.display = 'none';
            highResultContainer.style.display = 'none';
            lowResultEl.textContent = '-- Hz';
            highResultEl.textContent = '-- Hz';
            
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            testBtn.disabled = false;
            stopBtn.disabled = true;
            resetBtn.disabled = true;
            
            updateStatus('ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆå®Œäº† - å†é–‹å¯èƒ½');
        }
        
        // æœ¬ç•ªå®Ÿè£…ç”¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ç”Ÿæˆæ©Ÿèƒ½
        function exportOptimalConfig() {
            const config = {
                audioDetectionComponent: {
                    harmonicCorrectionConfig: {
                        historyWindowMs: 15000,
                        stabilityWeight: 0.95,
                        volumeWeight: 0.05,
                        minConfidenceThreshold: 0.2,
                        harmonicToleranceCents: 50,
                        maxHarmonicNumber: 6
                    },
                    clarityThreshold: 0.15,
                    minVolumeAbsolute: 0.0005,
                    fftSize: 8192,
                    smoothing: 0.05
                },
                voiceRangeTest: {
                    measurementMinFreq: { low: 30, high: 50 },
                    displayFreqRange: { min: 80, max: 1000 },
                    stabilityDuration: 3000,
                    minSamples: 15,
                    stabilityTolerance: 0.1
                }
            };
            
            const dataStr = JSON.stringify(config, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'voice-range-test-config.json';
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('ğŸ“¥ æœ€é©åŒ–è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }
        
        function exportTestResults() {
            if (!voiceRangeTestData?.results) {
                addLog('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹çµæœãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const exportData = {
                timestamp: new Date().toISOString(),
                deviceType: audioDetector?.getStatus()?.deviceType || 'unknown',
                results: voiceRangeTestData.results,
                testSettings: {
                    historyWindowMs: 15000,
                    stabilityWeight: 0.95,
                    minConfidenceThreshold: 0.2
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `voice-range-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }
        
        function generateProductionCode() {
            if (!voiceRangeTestData?.results) {
                addLog('âŒ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const productionCode = `
// éŸ³åŸŸãƒ†ã‚¹ãƒˆ - æœ¬ç•ªå®Ÿè£…ç”¨ã‚³ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
// ç”Ÿæˆæ—¥æ™‚: ${new Date().toISOString()}

class VoiceRangeTest {
    constructor(options = {}) {
        this.options = {
            // HarmonicCorrectionæœ€é©åŒ–è¨­å®š
            harmonicCorrectionConfig: {
                historyWindowMs: 15000,
                stabilityWeight: 0.95,
                volumeWeight: 0.05,
                minConfidenceThreshold: 0.2,
                harmonicToleranceCents: 50,
                maxHarmonicNumber: 6
            },
            
            // éŸ³å£°æ¤œå‡ºæœ€é©åŒ–è¨­å®š  
            clarityThreshold: 0.15,
            minVolumeAbsolute: 0.0005,
            fftSize: 8192,
            smoothing: 0.05,
            
            // éŸ³åŸŸãƒ†ã‚¹ãƒˆå›ºæœ‰è¨­å®š
            measurementDuration: 3000,
            minSamples: 15,
            stabilityTolerance: 0.1,
            frequencyRange: { min: 80, max: 1000 },
            measurementTrigger: { low: 30, high: 50 },
            
            ...options
        };
        
        this.audioDetector = null;
        this.currentPhase = 'low';
        this.testData = null;
    }
    
    async initialize() {
        this.audioDetector = new AudioDetectionComponent(this.options);
        await this.audioDetector.initialize();
        
        // HarmonicCorrectionå±¥æ­´ãƒªã‚»ãƒƒãƒˆ
        if (this.audioDetector.pitchDetector?.harmonicCorrection) {
            this.audioDetector.pitchDetector.harmonicCorrection.resetHistory();
        }
        
        return true;
    }
    
    // è©³ç´°åˆ†ææ©Ÿèƒ½
    analyzeVoiceData(detectedFrequencies) {
        const frequencies = detectedFrequencies.map(d => d.frequency);
        const mean = frequencies.reduce((a, b) => a + b) / frequencies.length;
        const variance = frequencies.reduce((acc, freq) => 
            acc + Math.pow(freq - mean, 2), 0) / frequencies.length;
        const standardDeviation = Math.sqrt(variance);
        const stability = Math.max(0, 1 - (standardDeviation / mean));
        
        return {
            finalFrequency: mean,
            standardDeviation,
            stability,
            sampleCount: frequencies.length
        };
    }
}

// ä½¿ç”¨ä¾‹:
// const voiceRangeTest = new VoiceRangeTest();
// await voiceRangeTest.initialize();
            `;
            
            const blob = new Blob([productionCode], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'VoiceRangeTest-production.js';
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('ğŸ”§ æœ¬ç•ªå®Ÿè£…ç”¨ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ', 'success');
        }
        
        // ãƒ†ã‚¹ãƒˆå®Œäº†æ™‚ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
        function enableExportButtons() {
            exportConfigBtn.disabled = false;
            exportResultsBtn.disabled = false; 
            generateCodeBtn.disabled = false;
        }
        
        // åˆæœŸåŒ–
        addLog('ğŸš€ éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
        updateStatus('éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ãŒå¿…è¦ã§ã™');
        
        // Lucideã‚¢ã‚¤ã‚³ãƒ³åˆæœŸåŒ–
        lucide.createIcons();
    </script>
</body>
</html>