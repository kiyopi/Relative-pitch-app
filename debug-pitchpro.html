<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchPro ãƒ‡ãƒãƒƒã‚° - AudioDetectionComponentç¢ºèª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .debug-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #60a5fa;
        }
        .success { border-left-color: #22c55e; }
        .error { border-left-color: #ef4444; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” PitchPro AudioDetectionComponent ãƒ‡ãƒãƒƒã‚°</h1>

    <div class="debug-section" id="library-status">
        <h3>ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿çŠ¶æ³</h3>
        <div id="library-check">ç¢ºèªä¸­...</div>
    </div>

    <div class="debug-section" id="component-status">
        <h3>ğŸµ AudioDetectionComponent ç¢ºèª</h3>
        <div id="component-check">ç¢ºèªä¸­...</div>
    </div>

    <div class="debug-section" id="test-section">
        <h3>ğŸ§ª å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆ</h3>
        <button id="test-btn">AudioDetectionComponentåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
        <div id="test-result"></div>
    </div>

    <div class="debug-section">
        <h3>ğŸ“‹ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
        <pre id="debug-log"></pre>
    </div>

    <!-- PitchPro Library -->
    <script src="js/pitchpro-audio/pitchpro-v1.3.1.umd.js"></script>

    <script>
        // ãƒ­ã‚°é–¢æ•°
        function log(message) {
            console.log(message);
            const logElement = document.getElementById('debug-log');
            logElement.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        // 1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿çŠ¶æ³ç¢ºèª
        function checkLibraryStatus() {
            const statusDiv = document.getElementById('library-check');
            const section = document.getElementById('library-status');

            log('ğŸ” ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿çŠ¶æ³ç¢ºèªé–‹å§‹');

            if (typeof window.PitchPro !== 'undefined') {
                statusDiv.innerHTML = `
                    <p>âœ… <strong>PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:</strong> èª­ã¿è¾¼ã¿æˆåŠŸ</p>
                    <p><strong>åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:</strong></p>
                    <ul>
                        ${Object.keys(window.PitchPro).map(key =>
                            `<li>${key}: ${typeof window.PitchPro[key]}</li>`
                        ).join('')}
                    </ul>
                `;
                section.className = 'debug-section success';
                log('âœ… PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ç¢ºèªå®Œäº†');
                return true;
            } else {
                statusDiv.innerHTML = `
                    <p>âŒ <strong>PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:</strong> èª­ã¿è¾¼ã¿å¤±æ•—</p>
                    <p>window.PitchPro ãŒ undefined ã§ã™</p>
                `;
                section.className = 'debug-section error';
                log('âŒ PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return false;
            }
        }

        // 2. AudioDetectionComponentç¢ºèª
        function checkComponentStatus() {
            const statusDiv = document.getElementById('component-check');
            const section = document.getElementById('component-status');

            log('ğŸ” AudioDetectionComponentç¢ºèªé–‹å§‹');

            if (typeof window.PitchPro === 'undefined') {
                statusDiv.innerHTML = '<p>âŒ PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                section.className = 'debug-section error';
                return false;
            }

            if (typeof window.PitchPro.AudioDetectionComponent !== 'undefined') {
                statusDiv.innerHTML = `
                    <p>âœ… <strong>AudioDetectionComponent:</strong> åˆ©ç”¨å¯èƒ½</p>
                    <p><strong>ã‚¿ã‚¤ãƒ—:</strong> ${typeof window.PitchPro.AudioDetectionComponent}</p>
                    <p><strong>ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼:</strong> ${window.PitchPro.AudioDetectionComponent.toString().substring(0, 100)}...</p>
                `;
                section.className = 'debug-section success';
                log('âœ… AudioDetectionComponentç¢ºèªå®Œäº†');
                return true;
            } else {
                statusDiv.innerHTML = `
                    <p>âŒ <strong>AudioDetectionComponent:</strong> è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                    <p>PitchProå†…ã®åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ${Object.keys(window.PitchPro).join(', ')}</p>
                `;
                section.className = 'debug-section error';
                log('âŒ AudioDetectionComponent ãŒ PitchPro å†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return false;
            }
        }

        // 3. å®Ÿéš›ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        async function testAudioDetectionComponent() {
            const resultDiv = document.getElementById('test-result');
            const testBtn = document.getElementById('test-btn');

            testBtn.disabled = true;
            testBtn.textContent = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            resultDiv.innerHTML = '<p>ğŸ”„ AudioDetectionComponentåˆæœŸåŒ–ä¸­...</p>';

            log('ğŸ§ª AudioDetectionComponentåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹');

            try {
                // AudioDetectionComponentä½œæˆ
                const audioDetector = new window.PitchPro.AudioDetectionComponent({
                    volumeBarSelector: '#volume-progress',
                    volumeTextSelector: '#volume-value',
                    frequencySelector: '#frequency-value',
                    clarityThreshold: 0.4,
                    minVolumeAbsolute: 0.003,
                    debug: true
                });

                log('âœ… AudioDetectionComponent ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');

                // åˆæœŸåŒ–å®Ÿè¡Œ
                await audioDetector.initialize();

                resultDiv.innerHTML = `
                    <p>âœ… <strong>åˆæœŸåŒ–æˆåŠŸï¼</strong></p>
                    <p>ãƒã‚¤ã‚¯è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚ŒãŸã¯ãšã§ã™ã€‚</p>
                    <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${audioDetector.getStatus().state}</p>
                `;

                log('âœ… AudioDetectionComponentåˆæœŸåŒ–å®Œäº†');
                log(`ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${JSON.stringify(audioDetector.getStatus(), null, 2)}`);

            } catch (error) {
                resultDiv.innerHTML = `
                    <p>âŒ <strong>åˆæœŸåŒ–å¤±æ•—</strong></p>
                    <p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>
                    <p><strong>è©³ç´°:</strong> ${error.stack}</p>
                `;

                log(`âŒ AudioDetectionComponentåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`ğŸ“œ ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`);
            }

            testBtn.disabled = false;
            testBtn.textContent = 'AudioDetectionComponentåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®åˆæœŸãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');

            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªï¼ˆèª­ã¿è¾¼ã¿å®Œäº†ã‚’ç¢ºå®Ÿã«ã™ã‚‹ï¼‰
            setTimeout(() => {
                checkLibraryStatus();
                checkComponentStatus();
            }, 500);

            // ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('test-btn').addEventListener('click', testAudioDetectionComponent);
        });
    </script>

    <!-- ãƒ€ãƒŸãƒ¼è¦ç´ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ -->
    <div style="display: none;">
        <div id="volume-progress"></div>
        <div id="volume-value"></div>
        <div id="frequency-value"></div>
    </div>
</body>
</html>