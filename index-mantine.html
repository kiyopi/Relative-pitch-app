<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>相対音感トレーニング - Mantine版</title>
  
  <!-- Mantine v7.6.0 Core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@mantine/core@7.6.0/styles.css" rel="stylesheet" />
  
  <!-- Tabler Icons -->
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons@1.35.0/icons-sprite.svg" rel="stylesheet" />
  
  <style>
    /* 音楽教育カスタマイゼーション */
    :root {
      /* Mantineカラーオーバーライド */
      --mantine-color-blue-6: #007bff;        /* 進行バー色 */
      --mantine-color-pink-6: #ff69b4;        /* ドレミアクティブ色 */
      --mantine-color-green-6: #10b981;       /* 成功・正解色 */
      --mantine-color-yellow-6: #f59e0b;      /* 注意・練習中色 */
      --mantine-color-red-6: #ef4444;         /* エラー・要改善色 */
      
      /* 音階専用カラーパレット */
      --note-do: #ef4444;        /* ド - 赤 */
      --note-re: #f97316;        /* レ - オレンジ */
      --note-mi: #eab308;        /* ミ - 黄色 */
      --note-fa: #22c55e;        /* ファ - 緑 */
      --note-so: #06b6d4;        /* ソ - シアン */
      --note-la: #3b82f6;        /* ラ - 青 */
      --note-si: #8b5cf6;        /* シ - 紫 */
      --note-do-high: #ec4899;   /* 高ド - ピンク */
      
      /* グラデーションテーマ */
      --gradient-learning: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --gradient-focus: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      
      /* スペーシング */
      --training-spacing: 16px;
      --session-spacing: 24px;
      --result-spacing: 32px;
    }

    /* カスタムコンポーネント */
    .training-card {
      background: var(--mantine-color-white);
      border: 1px solid var(--mantine-color-gray-3);
      border-radius: var(--mantine-radius-md);
      transition: all 0.2s ease;
    }

    .training-card:hover {
      box-shadow: var(--mantine-shadow-md);
      transform: translateY(-2px);
    }

    /* 統合進行ガイドシステム - カスタムコンポーネント */
    .integrated-guide-system {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--mantine-shadow-lg);
      border: 3px solid var(--mantine-color-blue-6);
      margin: var(--session-spacing) 0;
    }

    .guide-title {
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--mantine-color-dark-8);
      text-align: center;
      font-size: 18px;
    }

    .guide-description {
      text-align: center;
      color: var(--mantine-color-gray-6);
      font-size: 14px;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    /* 準備進行バー */
    .preparation-progress {
      margin-bottom: 25px;
    }

    .progress-bar-container {
      height: 20px;
      background: var(--mantine-color-gray-2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: var(--mantine-color-blue-6);
      transition: width 0.1s linear;
      border-radius: 10px;
      position: relative;
    }

    .progress-fill.completed {
      background: var(--mantine-color-blue-6);
      animation: completion-glow 0.6s ease;
    }

    @keyframes completion-glow {
      0% { box-shadow: 0 0 0 rgba(0, 123, 255, 0.5); }
      50% { box-shadow: 0 0 20px rgba(0, 123, 255, 0.8); }
      100% { box-shadow: 0 0 0 rgba(0, 123, 255, 0.5); }
    }

    /* ドレミガイド */
    .doremi-guide {
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      padding: 25px;
      background: #f8f9ff;
      border-radius: 15px;
      border: 4px solid var(--mantine-color-blue-6);
      transition: all 0.3s ease;
    }

    .doremi-guide.focus-mode {
      background: #ffe0f0;
      border-color: var(--mantine-color-pink-6);
    }

    .note-circle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      background: var(--mantine-color-gray-2);
      color: var(--mantine-color-blue-6);
      border: 3px solid var(--mantine-color-gray-3);
      transition: all 0.4s ease;
      position: relative;
      cursor: pointer;
    }

    .note-circle.current {
      background: var(--mantine-color-pink-6);
      color: white;
      transform: scale(1.4);
      border-color: #ff1493;
      box-shadow: 0 0 25px rgba(255, 105, 180, 0.6);
      animation: note-glow 0.8s infinite alternate;
      z-index: 10;
      position: relative;
      font-size: 28px;
    }

    /* 二重波紋エフェクト */
    .note-circle.current::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(255, 105, 180, 0.2);
      border: 2px solid rgba(255, 105, 180, 0.4);
      animation: ripple 1.2s infinite;
      z-index: -1;
    }

    .note-circle.current::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(255, 105, 180, 0.1);
      border: 1px solid rgba(255, 105, 180, 0.3);
      animation: ripple-second 1.2s infinite;
      animation-delay: 0.2s;
      z-index: -2;
    }

    @keyframes ripple {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.6;
      }
      100% {
        transform: translate(-50%, -50%) scale(3);
        opacity: 0;
      }
    }

    @keyframes ripple-second {
      0% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 0.4;
      }
      100% {
        transform: translate(-50%, -50%) scale(3.5);
        opacity: 0;
      }
    }

    @keyframes note-glow {
      from {
        box-shadow: 0 0 25px rgba(255, 105, 180, 0.6);
      }
      to {
        box-shadow: 0 0 35px rgba(255, 105, 180, 0.9);
      }
    }

    /* Mantineボタンカスタマイズ */
    .mantine-Button-root {
      border-radius: var(--mantine-radius-md);
      font-weight: 600;
      transition: all 0.15s ease;
    }

    .primary-button {
      background: var(--mantine-color-blue-6);
      color: white;
    }

    .primary-button:hover {
      background: var(--mantine-color-blue-7);
      transform: translateY(-1px);
    }

    /* レスポンシブ対応 */
    @media (max-width: 768px) {
      .note-circle {
        width: 60px;
        height: 60px;
        font-size: 18px;
      }

      .note-circle.current {
        font-size: 24px;
      }

      .doremi-guide {
        gap: 8px;
        padding: 20px;
      }
    }

    @media (max-width: 375px) {
      .note-circle {
        width: 50px;
        height: 50px;
        font-size: 16px;
      }

      .note-circle.current {
        font-size: 20px;
      }

      .doremi-guide {
        gap: 6px;
        padding: 15px;
      }
    }

    /* タッチ操作最適化 */
    .note-circle {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Mantine Container -->
    <div style="max-width: 800px; margin: 0 auto; padding: var(--training-spacing);">
      
      <!-- Header Section -->
      <div style="text-align: center; padding: 40px 0; margin-bottom: 30px;">
        <h1 style="font-size: 28px; font-weight: 700; color: var(--mantine-color-dark-8); margin-bottom: 8px;">
          🎵 相対音感トレーニング
        </h1>
        <p style="color: var(--mantine-color-gray-6);">Mantine v7.6.0 + 音楽教育カスタマイゼーション</p>
      </div>

      <!-- メインカード -->
      <div class="training-card" style="padding: var(--session-spacing);">
        
        <!-- 基音再生セクション -->
        <div style="margin-bottom: var(--session-spacing);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="font-size: 18px; font-weight: 600; color: var(--mantine-color-dark-7);">
              🎼 基音再生
            </h3>
            <div style="font-size: 14px; color: var(--mantine-color-gray-6);">
              基音: <strong>C4 (261.63Hz)</strong>
            </div>
          </div>
          
          <button id="play-button" class="primary-button" style="width: 100%; padding: 12px 24px; border: none; border-radius: var(--mantine-radius-md); font-size: 16px; cursor: pointer;">
            ▶️ 基音を再生してセッション開始
          </button>
        </div>

        <!-- 統合進行ガイドシステム -->
        <div class="integrated-guide-system">
          <div class="guide-title">🎵 発声ガイド</div>
          <div class="guide-description">ガイドに合わせてドレミファソラシドを発声しましょう</div>
          
          <!-- 進行バー -->
          <div class="preparation-progress">
            <div class="progress-bar-container">
              <div class="progress-fill" id="preparation-fill" style="width: 0%;"></div>
            </div>
          </div>

          <!-- ドレミガイド -->
          <div class="doremi-guide" id="doremi-guide">
            <div class="note-circle" data-note="do">ド</div>
            <div class="note-circle" data-note="re">レ</div>
            <div class="note-circle" data-note="mi">ミ</div>
            <div class="note-circle" data-note="fa">ファ</div>
            <div class="note-circle" data-note="so">ソ</div>
            <div class="note-circle" data-note="la">ラ</div>
            <div class="note-circle" data-note="si">シ</div>
            <div class="note-circle" data-note="do2">ド</div>
          </div>
        </div>

        <!-- 音量確認バー -->
        <div style="margin-top: var(--session-spacing);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="font-weight: 600; color: var(--mantine-color-dark-7);">🎤 音量確認</span>
            <span id="volume-value" style="color: var(--mantine-color-blue-6); font-weight: 600;">0%</span>
          </div>
          
          <div style="height: 20px; background: var(--mantine-color-gray-2); border-radius: 10px; overflow: hidden;">
            <div id="volume-bar" style="height: 100%; background: var(--gradient-learning); width: 0%; transition: width 0.1s linear; border-radius: 10px;"></div>
          </div>
        </div>

        <!-- リセットボタン -->
        <div style="margin-top: var(--session-spacing); text-align: center;">
          <button id="reset-button" style="background: var(--mantine-color-gray-4); color: var(--mantine-color-dark-7); border: none; border-radius: var(--mantine-radius-md); padding: 8px 16px; cursor: pointer; transition: all 0.2s ease;">
            🔄 リセット
          </button>
        </div>

      </div>

      <!-- セッション評価カード -->
      <div class="training-card" style="padding: var(--session-spacing); margin-top: var(--session-spacing);">
        <h3 style="font-size: 18px; font-weight: 600; color: var(--mantine-color-dark-7); margin-bottom: 15px;">
          📊 セッション評価
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div style="text-align: center; padding: 15px; background: var(--mantine-color-gray-1); border-radius: var(--mantine-radius-md);">
            <div style="font-size: 24px; font-weight: 700; color: var(--mantine-color-blue-6);">85</div>
            <div style="color: var(--mantine-color-gray-6);">総合スコア</div>
          </div>
          
          <div style="text-align: center; padding: 15px; background: var(--mantine-color-gray-1); border-radius: var(--mantine-radius-md);">
            <div style="font-size: 24px; font-weight: 700; color: var(--mantine-color-green-6);">B級</div>
            <div style="color: var(--mantine-color-gray-6);">評価ランク</div>
          </div>
          
          <div style="text-align: center; padding: 15px; background: var(--mantine-color-gray-1); border-radius: var(--mantine-radius-md);">
            <div style="font-size: 24px; font-weight: 700; color: var(--mantine-color-yellow-6);">76.25</div>
            <div style="color: var(--mantine-color-gray-6);">実際平均</div>
          </div>
        </div>
      </div>

      <!-- Mantineシステム情報 -->
      <div style="margin-top: var(--result-spacing); padding: var(--training-spacing); background: var(--mantine-color-blue-0); border-radius: var(--mantine-radius-md); border-left: 4px solid var(--mantine-color-blue-6);">
        <h4 style="font-weight: 600; color: var(--mantine-color-blue-8); margin-bottom: 8px;">
          ✅ Mantineシステム導入完了
        </h4>
        <ul style="color: var(--mantine-color-blue-7); font-size: 14px; margin-left: 16px;">
          <li>Mantine v7.6.0 Core CSS</li>
          <li>音楽教育カスタマイゼーション適用</li>
          <li>統合進行ガイドシステム（カスタムコンポーネント）</li>
          <li>レスポンシブ・タッチ最適化</li>
        </ul>
      </div>

    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // アプリケーション状態管理
    let isPlaying = false;
    let currentNoteIndex = 0;
    const notes = document.querySelectorAll('.note-circle');
    
    // DOM要素
    const playButton = document.getElementById('play-button');
    const resetButton = document.getElementById('reset-button');
    const preparationFill = document.getElementById('preparation-fill');
    const doremiGuide = document.getElementById('doremi-guide');
    const volumeBar = document.getElementById('volume-bar');
    const volumeValue = document.getElementById('volume-value');

    // 基音再生ボタンイベント
    playButton.addEventListener('click', startSession);
    resetButton.addEventListener('click', resetSession);

    // セッション開始
    function startSession() {
      if (isPlaying) return;
      
      isPlaying = true;
      playButton.disabled = true;
      playButton.textContent = '🎵 基音再生中...';
      playButton.style.background = 'var(--mantine-color-gray-5)';
      
      // 準備バー開始（2.5秒）
      startPreparationProgress();
    }

    // 準備進行バー
    function startPreparationProgress() {
      preparationFill.style.transition = 'width 0.1s linear';
      
      let progress = 0;
      const duration = 2500; // 2.5秒
      const interval = 50; // 50ms間隔
      const increment = (100 / (duration / interval));

      const progressInterval = setInterval(() => {
        progress += increment;
        preparationFill.style.width = Math.min(progress, 100) + '%';

        if (progress >= 100) {
          clearInterval(progressInterval);
          // 完了エフェクト
          preparationFill.classList.add('completed');
          // ドレミガイド開始
          setTimeout(startDoremiGuide, 100);
        }
      }, interval);
    }

    // ドレミガイド開始
    function startDoremiGuide() {
      // フォーカスモード適用
      doremiGuide.classList.add('focus-mode');
      
      // 最初の「ド」をアクティブに
      notes[0].classList.add('current');
      currentNoteIndex = 0;
      
      // 0.6秒後に2番目から開始
      setTimeout(() => {
        startDoremiSequence();
      }, 662.5);
    }

    // ドレミシーケンス実行
    function startDoremiSequence() {
      let noteIndex = 1; // レから開始
      const noteInterval = 662.5; // 各音階662.5ms

      const sequenceInterval = setInterval(() => {
        // 前の音をリセット
        if (noteIndex === 1) {
          notes[0].classList.remove('current'); // ド
        } else {
          notes[noteIndex - 1].classList.remove('current');
        }

        // 現在の音をアクティブに
        if (noteIndex < notes.length) {
          notes[noteIndex].classList.add('current');
          noteIndex++;
        } else {
          clearInterval(sequenceInterval);
          // 最後の音をリセット
          setTimeout(() => {
            notes[notes.length - 1].classList.remove('current');
            completeSession();
          }, 500);
        }
      }, noteInterval);
    }

    // セッション完了
    function completeSession() {
      doremiGuide.classList.remove('focus-mode');
      
      // ボタン復元
      playButton.disabled = false;
      playButton.textContent = '▶️ 基音を再生してセッション開始';
      playButton.style.background = 'var(--mantine-color-blue-6)';
      
      isPlaying = false;
    }

    // リセット処理
    function resetSession() {
      if (isPlaying) {
        isPlaying = false;
        
        // 進行バーリセット（アニメーション無効化）
        preparationFill.style.transition = 'none';
        preparationFill.style.width = '0%';
        preparationFill.classList.remove('completed');
        
        // トランジション復元
        setTimeout(() => {
          preparationFill.style.transition = 'width 0.1s linear';
        }, 50);
        
        // ドレミガイドリセット
        notes.forEach(note => {
          note.classList.remove('current');
        });
        doremiGuide.classList.remove('focus-mode');
        
        // ボタン復元
        playButton.disabled = false;
        playButton.textContent = '▶️ 基音を再生してセッション開始';
        playButton.style.background = 'var(--mantine-color-blue-6)';
      }
    }

    // 音量バーデモ（静的表示）
    volumeBar.style.width = '65%';
    volumeValue.textContent = '65%';

    // 初期化完了ログ
    console.log('🎵 Mantine v7.6.0 + 音楽教育カスタマイゼーション システム初期化完了');
  </script>
</body>
</html>