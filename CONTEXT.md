# Project: 8va相対音感トレーニングアプリ - CONTEXT for Serena

## 🎯 プロジェクトの目的とコア価値

- **目的**: 科学的根拠に基づき、Webブラウザで動作する効果的な相対音感トレーニングアプリを開発する。
- **コア価値**: 歌唱力向上に加え、「脳内ピアノ理論」に基づきコミュニケーション能力の向上も支援する。
- **対象ユーザー**: 音楽学習者、カラオケ愛好家、そして人間関係を円滑にしたい一般ユーザー。

---

## 🚨 最重要設計原則：相対音感の根幹

**トレーニング中の基音の音程名（C3, D4等）や周波数の表示は、いかなる場合も絶対に禁止する。**

- **理由**: 音程名や周波数を表示すると、ユーザーは絶対音感に依存してしまい、相対音感を鍛えるというアプリの根幹目的が損なわれるため。
- **例外**: マイク調整が目的の「マイクテストページ」と、学習フィードバックが目的の「評価表示ページ」のみ、音名や周波数、セント誤差の表示を許可する。

---

## ⚙️ 主要な機能

1.  **マイクテスト ＆ 音域テスト（必須機能）**:
    - トレーニング前にマイク許可、音量調整、そしてユーザーの快適な声域（最高音・最低音）を測定する。
    - 測定された音域に基づき、各モードで使用する基音を自動で最適化する。

2.  **3つのトレーニングモード**:
    - **ランダム基音モード（初級）**: 8セッション。ユーザーの音域内の8音からランダムな基音で練習。
    - **連続チャレンジモード（中級）**: 12セッション。半音含む12音からランダムな基音で連続練習。
    - **12音階モード（上級）**: 12〜24セッション。全半音を順次使用し、S級（プロレベル）判定を目指す。

3.  **ハイブリッド評価システム**:
    - 各音階の精度をセント単位で評価。
    - セッションスコアと総合評価（S〜E級）で進捗を可視化する。

---

## 🚧 現在の状況 (2025-08-12時点)

- **作業ブランチ**: `feature/preparation-test-system`
- **現在の主要タスク**: 音域テスト機能 v4.0 の本格実装。
- **コアライブラリ**: `pitchpro-audio-processing` (`PitchPro`) を音声処理エンジンとして全面的に採用。

---

## 🛠️ AI利用時の最重要ルール

- **インライン記述禁止**: HTMLの`style`属性や、JavaScriptでのインLINE CSS記述は原則禁止。ユーティリティクラス（`base.css`）を最大限活用する。
- **音量バー制御**: UIの音量バー操作は、必ず`/js/volume-bar-controller.js`を使用する。
- **音量値の取得**: PitchProからの音量値は、必ず`pitchDetector.setCallbacks`内の`result.volume`コールバックから取得する。他のプロパティ（`rawVolume`等）は参照しない。
- **UIコンポーネントの再利用**: 新しいUIを作成する前に、必ず`ui-catalog-essentials.html`で既存のコンポーネントを確認する。