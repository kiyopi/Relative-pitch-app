# 相対音感トレーニングアプリ - 要件定義書

**バージョン**: 1.1.0  
**作成日**: 2025-08-07  
**更新日**: 2025-01-10  
**用途**: システム要件・機能要件の定義

**v1.1.0 更新内容**:
- ハイブリッド評価システムの詳細仕様追加
- Lucideアイコン仕様の追加
- S-E級判定基準の明確化

---

## 🎯 1. プロジェクト概要

### 1.1 背景・目的
- **背景**: 相対音感は音楽学習において重要な能力であり、系統的なトレーニングが求められている
- **目的**: 科学的根拠に基づいた効果的な相対音感トレーニングシステムの提供
- **ビジョン**: 誰もが楽しく継続的に相対音感を向上できるWebアプリケーション

### 1.2 対象ユーザー
- **主要ターゲット**: 音楽学習者（初級〜中級）
- **副次ターゲット**: カラオケ愛好家、合唱団メンバー、音楽教育関係者
- **拡張ターゲット**: コミュニケーション能力向上を目指す一般ユーザー

### 1.3 期待される効果
- **音楽的効果**: 歌唱力向上、音程精度改善、楽曲理解深化
- **副次的効果**: コミュニケーション能力向上、人間関係改善（脳内ピアノ理論）
- **教育的効果**: 体系的な音感学習、進捗の可視化、モチベーション維持

---

## 📋 2. 機能要件

### 2.1 コア機能

#### 2.1.1 マイクテスト機能
- **目的**: トレーニング前の音声環境準備
- **機能詳細**:
  - マイク使用許可の取得
  - リアルタイム周波数表示（Hz）
  - 音量レベルメーター表示
  - 音域テスト（低音・高音の段階的チェック）
  - デバイス別感度調整（PC: 1.0x、iPhone: 3.0x、iPad: 7.0x）

#### 2.1.2 トレーニングモード（3種類）

**A. ランダム基音モード（初級）**
- セッション数: 1回
- 基音選択: C3オクターブ8音からランダム
- ガイド速度: 約5.30秒（高速）
- 判定基準: ±50セント
- 基音聴き返し: 削除（絶対音感依存防止のため）

**B. 連続チャレンジモード（中級）**
- セッション数: 8回連続
- 基音選択: クロマチック12音からランダム
- 自動進行: セッション間2秒待機
- 判定基準: ±50セント
- 総合評価: 8セッション完了後のS-E級評価

**C. 12音階モード（上級）**
- セッション数: 12-24回
- 基音選択: 全12半音を順次使用
- 練習方向: 上昇・下降・上昇下降
- 判定基準: ±30セント
- プロレベル判定: S級取得で認定

#### 2.1.3 音程検出・評価機能
- **検出精度**: ±5セント（Pitchy v4使用）
- **リアルタイム判定**: 60FPS更新
- **評価段階**: 6段階（Perfect〜Failed）
- **視覚フィードバック**: 進行状況表示、正解/不正解表示

### 2.2 データ管理機能

#### 2.2.1 進捗管理
- **localStorage保存**: セッション履歴、基音使用状況、総合評価
- **健康確認システム**: データ整合性の自動チェック・修復
- **バックアップ機能**: 完了サイクルの自動保存
- **新サイクル開始**: 8セッション完了後の自動リセット

#### 2.2.2 評価システム（ハイブリッド方式）

##### 個別音階評価
- **4段階評価**: 
  - Excellent（±15セント以内、100点）
  - Good（±25セント以内、80点）
  - Pass（±40セント以内、60点）
  - Need Practice（±41セント以上、30点）

##### 総合評価（S-E級）
- **ハイブリッド計算方式**:
  ```
  最終スコア = (平均スコア × 0.7) + (精度ボーナス × 0.3) × 安定性係数
  ```
- **S-E級判定基準**:
  - S級: 95-100点 & Excellence割合80%以上
  - A級: 85-94点 & Excellence割合60%以上
  - B級: 75-84点 または Excellence割合40%以上
  - C級: 65-74点 または Excellence割合20%以上
  - D級: 50-64点
  - E級: 0-49点

##### 統計情報
- **精度指標**: Excellence割合、平均セント誤差、標準偏差
- **セッション情報**: 総プレイ時間、音階別成功率、安定性係数
- **外れ値検出**: 技術的誤差の統計的処理

##### Lucideアイコン仕様
- **評価レベル別**: award(Excellent), thumbs-up(Good), check(Pass), frown(Practice)
- **ランク別**: trophy(S), award(A), star(B), check-circle(C), target(D), book-open(E)
- **UI要素**: mic, volume-2, bar-chart-3, trending-up, music-note

### 2.3 共有機能

#### 2.3.1 SNS共有
- **対応プラットフォーム**: Twitter/X、Facebook、LINE、Instagram Stories
- **共有内容**: スコア、精度、達成バッジ、プレイ時間
- **画像生成**: 1080x1080px結果画像
- **カスタムメッセージ**: 100文字以内のユーザーコメント
- **直接アクセスURL生成**: チャレンジ共有用のダイレクトリンク
- **QRコード生成**: モバイルアクセス用QRコード

#### 2.3.2 共有分析
- **イベントトラッキング**: Google Analytics連携
- **共有履歴**: 最新50件のローカル保存
- **統計表示**: 共有数、人気プラットフォーム、平均スコア

### 2.4 ダイレクトアクセス機能

#### 2.4.1 URL直接アクセス
- **対応URL**: `/training/random`、`/training/continuous`、`/training/chromatic`
- **ブックマーク対応**: リピートユーザーの利便性向上
- **パラメータ付きURL**: 基音、難易度、セッション数の指定可能

#### 2.4.2 マイク許可管理
- **許可状態チェック**: navigator.permissions APIまたはlocalStorage
- **自動リダイレクト**: 未許可時はマイクテストページへ誘導
- **リダイレクト後の復帰**: テスト完了後、元のページへ自動遷移
- **キャッシュ機能**: 許可状態を30分間キャッシュ

---

## 🔧 3. 非機能要件

### 3.1 パフォーマンス要件
- **音程検出遅延**: 100ms以内
- **フレームレート**: 60FPS維持
- **ページ読み込み**: 3秒以内
- **メモリ使用量**: 最大500MB

### 3.2 信頼性要件
- **可用性**: 99%以上
- **データ永続性**: localStorage障害時の自動復旧
- **エラー処理**: グレースフルデグラデーション
- **フォールバック**: Pitchy不可時のFFT検出

### 3.3 使用性要件
- **レスポンシブ対応**: モバイル・タブレット・PC
- **直感的UI**: 3クリック以内で主要機能アクセス
- **視覚的フィードバック**: リアルタイム更新
- **多言語対応**: 将来的な国際化準備

### 3.4 セキュリティ要件
- **プライバシー保護**: 音声データの非保存
- **HTTPS通信**: GitHub Pages標準
- **XSS対策**: 入力値のサニタイゼーション
- **CORS対応**: 外部リソースの適切な管理

---

## 🎨 4. UI/UX要件

### 4.1 デザイン原則
- **相対音感原則**: トレーニング中の音名・周波数非表示(初級のランダム基音モードの1セッションは後の評価は除く)
- **視覚的階層**: 重要情報の強調表示
- **一貫性**: 統一されたカラースキーム・アイコン
- **アクセシビリティ**: WCAG 2.1 AA準拠目標

### 4.2 画面構成
- **ホームページ**: モード選択カード表示
- **マイクテストページ**: 準備状態の視覚化
- **トレーニングページ**: 統合進行ガイドシステム
- **結果表示**: 詳細評価・共有オプション

### 4.3 レスポンシブ設計
- **モバイル**: 縦積みレイアウト
- **タブレット**: 適応型グリッド
- **デスクトップ**: 横並びレイアウト
- **ブレークポイント**: 768px、1024px

---

## 🚀 5. 技術要件

### 5.1 音声処理技術
- **音程検出**: Pitchy v4 (McLeod Pitch Method)
- **ノイズ除去**: 3段階フィルタリング（ハイパス・ローパス・ノッチ）
- **倍音補正**: 動的オクターブ補正システム
- **安定化**: 5フレーム履歴による中央値フィルタ

### 5.2 開発技術スタック
- **フレームワーク**: 未定（SvelteKit or 他の選択肢）
- **音声処理**: Web Audio API
- **スタイリング**: Tailwind CSS（予定）
- **デプロイ**: GitHub Pages

### 5.3 外部ライブラリ
- **音程検出**: Pitchy v4
- **音源再生**: Tone.js
- **画像生成**: html2canvas
- **SNS共有**: react-share（フレームワーク依存）

---

## 📊 6. 制約事項

### 6.1 技術的制約
- **ブラウザ制限**: Web Audio API対応ブラウザ必須
- **マイク必須**: 音声入力デバイスが必要
- **オンライン必須**: 初回読み込み時（PWA化は将来検討）

### 6.2 運用制約
- **容量制限**: localStorage約5-10MB
- **同時接続**: クライアントサイドのため制限なし
- **更新頻度**: 継続的改善を前提

### 6.3 法的制約
- **プライバシー**: 音声データの非保存原則
- **著作権**: Salamander Grand Piano使用許諾
- **利用規約**: 教育・個人利用前提

---

## 🔄 7. 将来拡張計画

### 7.1 機能拡張
- **カスタム音階練習**: ユーザー定義の音程練習
- **AI個別指導**: 弱点分析と練習提案
- **グループ練習**: オンライン合同セッション
- **ゲーミフィケーション**: 実績システム・ランキング

### 7.2 技術拡張
- **PWA化**: オフライン対応
- **ネイティブアプリ**: iOS/Android版
- **機械学習統合**: 個人適応型難易度調整
- **WebRTC**: リアルタイム対戦機能

### 7.3 コンテンツ拡張
- **楽曲モード**: 実際の楽曲での練習
- **和音練習**: 複数音の同時認識
- **リズムトレーニング**: 音程＋リズム統合練習
- **音楽理論講座**: インタラクティブ学習

---

## ✅ 8. 受入基準

### 8.1 機能テスト
- [ ] 全3モードの正常動作確認
- [ ] 音程検出精度±5セント達成
- [ ] localStorage永続化動作確認
- [ ] SNS共有機能の全プラットフォーム確認

### 8.2 非機能テスト
- [ ] 60FPS性能達成（Chrome DevTools）
- [ ] モバイル・タブレット表示確認
- [ ] 音声遅延100ms以内確認
- [ ] エラー時のフォールバック動作確認

### 8.3 ユーザビリティテスト
- [ ] 初回利用者の3分以内開始達成
- [ ] 主要機能への3クリック以内アクセス
- [ ] 視覚的フィードバックの明確性確認
- [ ] エラーメッセージの分かりやすさ確認

---

**作成日**: 2025-08-07  
**対象**: 相対音感トレーニングアプリ全体要件  
**重要**: この要件定義書は開発の基準となる文書です