<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>8va相対音感トレーニング - 総合評価</title>
    
    <!-- スタイルシート -->
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/results.css"><!-- 結果表示専用スタイル（開発効率優先・将来分離予定） -->
    
    <!-- フォント -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- アイコンライブラリ -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <div class="min-h-screen p-6">
        <div class="container">
            <!-- ヘッダーセクション -->
            <div class="text-center mb-8">
                <div class="flex justify-center mb-6">
                    <div class="page-header-icon gradient-catalog-purple">
                        <i data-lucide="file-chart-column-increasing" class="icon-2xl text-white" data-stroke-width="2"></i>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-white mb-4">総合評価</h1>
                <p class="text-green-200 text-xl mb-6">8セッション (64音) の総合評価</p>
                <p class="text-blue-200">ランダム基音モードの結果</p>
            </div>

            <!-- メインコンテンツエリア -->
            <main class="main-content">
                
                <!-- 総合評価セクション -->
                <section class="rank-section glass-card mb-6">
                    <div class="rank-mode">
                        <h3 class="mode-title" id="main-mode-title">ランダム基音モード</h3>
                    </div>
                    <div class="rank-content-row">
                        <!-- グレードアイコン -->
                        <div class="rank-icon">
                            <div class="rank-circle rank-md rank-circle-b">
                                <i data-lucide="circle-star" class="icon-4xl text-white"></i>
                            </div>
                        </div>
                        
                        <!-- 統計情報 -->
                        <div class="rank-stats-row">
                            <div class="rank-stat-item">
                                <div class="stat-value-rank grade-value" id="dynamic-grade">B</div>
                                <div class="stat-label-rank">総合グレード</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank stat-value-avg-error avg-error">±18.2¢</div>
                                <div class="stat-label-rank">平均誤差（セント）</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank max-error">+25.8¢</div>
                                <div class="stat-label-rank">最大誤差（セント）</div>
                            </div>
                            <div class="rank-stat-item">
                                <div class="stat-value-rank stat-value-session-count session-count">8</div>
                                <div class="stat-label-rank">セッション数</div>
                            </div>
                        </div>
                        
                        <!-- ランク取得メッセージ -->
                        <div class="rank-achievement-message text-center">
                            <p id="share-message" class="text-body text-white-90">
                                B級ランク取得！グッドプレイヤー！
                            </p>
                        </div>
                    </div>
                </section>

                <!-- シェアセクション -->
                <section class="share-card glass-card mb-6">
                    <h3 class="heading-md">
                        <i data-lucide="share-2" class="text-blue-400"></i>
                        <span>みんなに成果をシェアしよう！</span>
                    </h3>
                    <div class="share-buttons">
                        <a href="#" class="share-btn twitter" onclick="shareToTwitter(event)" title="Xでシェア">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                            </svg>
                        </a>
                        <a href="#" class="share-btn line" onclick="shareToLine(event)" title="LINEで送る">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.348 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path>
                            </svg>
                        </a>
                        <a href="#" class="share-btn facebook" onclick="shareToFacebook(event)" title="Facebookでシェア">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                            </svg>
                        </a>
                        <button class="share-btn copy" onclick="copyShareText(event)" title="リンクをコピー">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                </section>

                <!-- セッショングリッド -->
                <section class="glass-card mb-6">
                    <h2 class="heading-md">
                        <i data-lucide="grid-3x3"></i>
                        <span>セッション一覧</span>
                    </h2>
                    <div id="session-grid-container">
                        <!-- 8セッショングリッド（サンプル） -->
                        <div class="sessions-grid-8">
                            <div class="session-box session-excellent">
                                <div class="session-number">1</div>
                                <div class="session-icon">
                                    <i data-lucide="trophy" class="text-yellow-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-good">
                                <div class="session-number">2</div>
                                <div class="session-icon">
                                    <i data-lucide="star" class="text-green-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-pass">
                                <div class="session-number">3</div>
                                <div class="session-icon">
                                    <i data-lucide="thumbs-up" class="text-blue-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-practice">
                                <div class="session-number">4</div>
                                <div class="session-icon">
                                    <i data-lucide="triangle-alert" class="text-red-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-excellent">
                                <div class="session-number">5</div>
                                <div class="session-icon">
                                    <i data-lucide="trophy" class="text-yellow-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-good">
                                <div class="session-number">6</div>
                                <div class="session-icon">
                                    <i data-lucide="star" class="text-green-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-pass">
                                <div class="session-number">7</div>
                                <div class="session-icon">
                                    <i data-lucide="thumbs-up" class="text-blue-300"></i>
                                </div>
                            </div>
                            <div class="session-box session-excellent">
                                <div class="session-number">8</div>
                                <div class="session-icon">
                                    <i data-lucide="trophy" class="text-yellow-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 誤差推移グラフ -->
                <section class="glass-card mb-6">
                    <h2 class="heading-md">
                        <i data-lucide="trending-up"></i>
                        <span>誤差推移</span>
                    </h2>
                    <div class="chart-container">
                        <canvas id="error-trend-chart"></canvas>
                    </div>
                </section>

                <!-- 詳細分析セクション -->
                <section class="glass-card mb-6">
                    <!-- ナビゲーションヘッダー -->
                    <div class="section-header mb-4">
                        <div class="flex items-center justify-between w-full">
                            <button class="glass-card-sm">
                                <i data-lucide="chevron-left" class="text-white icon-md"></i>
                            </button>
                            <div class="text-center flex-1 px-2">
                                <h3 class="text-sub-title">詳細分析 - セッション<span>1</span></h3>
                            </div>
                            <button class="glass-card-sm">
                                <i data-lucide="chevron-right" class="text-white icon-md"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="detail-analysis-container">
                        <!-- 評価分布バー -->
                        <div class="glass-card mb-4">
                            <h4 class="heading-md">
                                <i data-lucide="bar-chart-3" class="text-blue-300"></i>
                                <span>評価分布</span>
                            </h4>
                            
                            <!-- 評価分布バー -->
                            <div class="flex flex-col gap-3">
                                <!-- Excellent -->
                                <div class="flex items-center gap-3">
                                    <i data-lucide="trophy" class="text-yellow-300 icon-sm"></i>
                                    <div class="progress-bar flex">
                                        <div class="progress-fill-custom color-eval-gold" style="width: 37.5%;"></div>
                                    </div>
                                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">3</span>
                                </div>
                                
                                <!-- Good -->
                                <div class="flex items-center gap-3">
                                    <i data-lucide="star" class="text-green-300 icon-sm"></i>
                                    <div class="progress-bar flex">
                                        <div class="progress-fill-custom color-eval-good" style="width: 25%;"></div>
                                    </div>
                                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">2</span>
                                </div>
                                
                                <!-- Pass -->
                                <div class="flex items-center gap-3">
                                    <i data-lucide="thumbs-up" class="text-blue-300 icon-sm"></i>
                                    <div class="progress-bar flex">
                                        <div class="progress-fill-custom color-eval-pass" style="width: 37.5%;"></div>
                                    </div>
                                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">3</span>
                                </div>
                                
                                <!-- Practice -->
                                <div class="flex items-center gap-3">
                                    <i data-lucide="triangle-alert" class="text-red-300 icon-sm"></i>
                                    <div class="progress-bar flex">
                                        <div class="progress-fill-custom color-eval-practice" style="width: 0%;"></div>
                                    </div>
                                    <span class="text-sm text-white-60" style="min-width: 20px; text-align: right;">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 追加の分析情報（未定） -->
                        <!-- JavaScriptで動的生成 -->
                    </div>
                </section>

                <!-- 次のステップ -->
                <section class="glass-card mb-6">
                    <h2 class="heading-md">
                        <i data-lucide="compass"></i>
                        <span>次のステップ</span>
                    </h2>
                    <div class="next-steps-grid">
                        <!-- UIカタログ準拠のコンポーネント -->
                    </div>
                </section>

                <!-- 無料版 vs プレミアム版比較 -->
                <section class="glass-card mb-8">
                    <h2 class="heading-md">
                        <i data-lucide="scale"></i>
                        <span>無料版 vs プレミアム版</span>
                    </h2>
                    
                    <!-- 機能比較テーブル -->
                    <div class="comparison-table">
                        <!-- ヘッダー -->
                        <div class="comparison-header-row">
                            <div class="comparison-cell comparison-feature-header">
                                <h4>機能</h4>
                            </div>
                            <div class="comparison-cell comparison-plan-header">
                                <div class="plan-header">
                                    <i data-lucide="user" class="icon-sm"></i>
                                    <h4>無料版</h4>
                                </div>
                            </div>
                            <div class="comparison-cell comparison-plan-header">
                                <div class="plan-header">
                                    <i data-lucide="crown" class="icon-sm"></i>
                                    <h4>プレミアム版</h4>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ランダムモード -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>ランダム基音モード</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- 連続チャレンジモード（未定） -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>連続チャレンジモード（※未定）</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- 詳細分析レポート -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>詳細分析レポート</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <span class="text-gray-400 text-sm">基本表示</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <span class="text-white text-sm">AI分析付き</span>
                            </div>
                        </div>
                        
                        <!-- 12音階マスターモード -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>12音階マスターモード</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- 弱点特定・改善提案 -->
                        <div class="comparison-row">
                            <div class="comparison-cell comparison-feature">
                                <span>弱点特定・改善提案</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                        
                        <!-- データエクスポート -->
                        <div class="comparison-row comparison-row-last">
                            <div class="comparison-cell comparison-feature">
                                <span>データエクスポート</span>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="minus" class="icon-sm text-gray-500"></i>
                            </div>
                            <div class="comparison-cell comparison-value">
                                <i data-lucide="circle-check-big" class="icon-sm text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- プレミアム版CTA -->
                    <div class="premium-cta">
                        <button class="btn btn-premium">
                            <i data-lucide="star" class="icon-xs"></i>
                            7日間無料でお試し
                        </button>
                        <p class="premium-cta-note">月額480円 • いつでもキャンセル可能</p>
                    </div>
                </section>

                <!-- アクションボタン -->
                <section class="action-buttons mb-6">
                    <a href="training.html" class="btn btn-primary btn-large">
                        <i data-lucide="play" class="icon-xs"></i>
                        新しいトレーニング開始
                    </a>
                    <a href="index.html" class="btn btn-outline btn-large">
                        <i data-lucide="home" class="icon-xs"></i>
                        ホームに戻る
                    </a>
                </section>
            </main>

            <!-- フッター -->
            <footer class="footer-base">
                <div class="footer-content">
                    <h3 class="heading-lg justify-center">
                        <i data-lucide="award" class="text-yellow-400"></i>
                        8セッション完了！お疲れ様でした
                    </h3>
                    <p class="footer-description">素晴らしい進歩です。継続的な練習で更なる向上を目指しましょう。</p>
                </div>
                
                <div class="footer-grid">
                    <div class="footer-stat-item">
                        <i data-lucide="target" class="footer-stat-icon text-green-400"></i>
                        <p class="footer-stat-label">総合グレード</p>
                        <p class="footer-stat-value">B級</p>
                    </div>
                    <div class="footer-stat-item">
                        <i data-lucide="activity" class="footer-stat-icon text-orange-400"></i>
                        <p class="footer-stat-label">平均誤差</p>
                        <p class="footer-stat-value">±18.7¢</p>
                    </div>
                    <div class="footer-stat-item">
                        <i data-lucide="calendar" class="footer-stat-icon text-blue-400"></i>
                        <p class="footer-stat-label">完了セッション</p>
                        <p class="footer-stat-value">8セッション (64音)</p>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p class="footer-copyright">© 2024 8va相対音感トレーニングアプリ</p>
                    <p class="footer-tagline">あなたの音楽レベル向上をサポートします</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
        // モジュールインポート（将来的に外部ファイル化）
        
        // Lucideアイコン初期化
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        });
        
        // ページ初期化
        class ResultsOverviewPage {
            constructor() {
                this.sessionData = [];
                this.currentSessionIndex = 0;
            }
            
            async init() {
                // TODO: データ取得
                // TODO: コンポーネント初期化
                // TODO: イベントリスナー設定
                console.log('Results Overview Page initialized');
            }
        }
        
        // ページ読み込み時に初期化
        const page = new ResultsOverviewPage();
        page.init();
        
        // シェア機能
        function getShareText() {
            const grade = document.querySelector('#dynamic-grade')?.textContent || 'B';
            const error = document.querySelector('.avg-error')?.textContent || '±18.2¢';
            const sessions = document.querySelector('.session-count')?.textContent || '8';
            
            return `🎵 8va相対音感トレーニングで【${grade}級】獲得！\n平均誤差: ${error}\n${sessions}セッション完走！`;
        }
        
        window.shareToTwitter = function(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }
        
        window.shareToLine = function(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText() + '\n' + window.location.href);
            window.open(`https://social-plugins.line.me/lineit/share?text=${text}`, '_blank');
        }
        
        window.shareToFacebook = function(event) {
            event.preventDefault();
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        window.copyShareText = function(event) {
            event.preventDefault();
            const text = getShareText() + '\n' + window.location.href;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.currentTarget;
                btn.classList.add('copied');
                setTimeout(() => btn.classList.remove('copied'), 2000);
            });
        }
    </script>
</body>
</html>