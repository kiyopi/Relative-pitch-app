<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¼ã‚¿é€£å‹•ãƒ†ã‚¹ãƒˆ - çµæœè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body {
            font-family: Inter, system-ui, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            margin: 5px;
            cursor: pointer;
        }
        .btn:hover { background: #45a049; }
        .status { 
            padding: 8px; 
            background: rgba(0,255,0,0.2); 
            border-radius: 4px; 
            margin: 5px 0; 
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ãƒ‡ãƒ¼ã‚¿é€£å‹•ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</h3>
        <button class="btn" onclick="createTestSessionData()">ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
        <button class="btn" onclick="createTestOverallData()">ç·åˆè©•ä¾¡ãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
        <button class="btn" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
        <div id="data-status" class="status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ”— ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ</h3>
        <button class="btn" onclick="testSessionPage()">ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ãƒšãƒ¼ã‚¸</button>
        <button class="btn" onclick="testOverallPage()">ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸</button>
        <div id="test-results" class="status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ç¢ºèª</h3>
        <button class="btn" onclick="showDataSummary()">ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼è¡¨ç¤º</button>
        <pre id="data-summary" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;"></pre>
    </div>

    <!-- JavaScript -->
    <script src="../../../js/data-manager.js"></script>
    <script>
        /**
         * ãƒ†ã‚¹ãƒˆç”¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ä½œæˆ
         */
        function createTestSessionData() {
            try {
                console.log('ğŸ”§ DataManagerãƒã‚§ãƒƒã‚¯:', typeof DataManager);
                console.log('ğŸ“‹ DataManagerãƒ¡ã‚½ãƒƒãƒ‰:', Object.getOwnPropertyNames(DataManager).filter(name => typeof DataManager[name] === 'function'));
                
                const testSessionData = {
                    sessionId: 'test-session-' + Date.now(),
                    mode: 'random',
                    sessionNumber: 1,
                    baseNote: { note: 'C4', frequency: 261.63 },
                    detectionResults: [
                        { targetInterval: 'do', targetFrequency: 261.63, detectedFrequency: 260.1, evaluation: { centError: -8.2, rank: 'excellent' }},
                        { targetInterval: 're', targetFrequency: 293.66, detectedFrequency: 298.5, evaluation: { centError: +15.3, rank: 'good' }},
                        { targetInterval: 'mi', targetFrequency: 329.63, detectedFrequency: 335.2, evaluation: { centError: +25.1, rank: 'pass' }},
                        { targetInterval: 'fa', targetFrequency: 349.23, detectedFrequency: 347.8, evaluation: { centError: -3.1, rank: 'excellent' }},
                        { targetInterval: 'so', targetFrequency: 392.00, detectedFrequency: 395.4, evaluation: { centError: +12.5, rank: 'good' }},
                        { targetInterval: 'la', targetFrequency: 440.00, detectedFrequency: 450.2, evaluation: { centError: +38.7, rank: 'practice' }},
                        { targetInterval: 'ti', targetFrequency: 493.88, detectedFrequency: 487.9, evaluation: { centError: -20.1, rank: 'pass' }},
                        { targetInterval: 'do', targetFrequency: 523.25, detectedFrequency: 527.3, evaluation: { centError: +13.2, rank: 'good' }}
                    ],
                    sessionSummary: {
                        totalScore: 78.5,
                        averageCentError: 18.2,
                        successRate: 0.75,
                        excellentCount: 2,
                        goodCount: 3,
                        passCount: 2,
                        practiceCount: 1
                    },
                    startTime: new Date().toISOString(),
                    endTime: new Date(Date.now() + 180000).toISOString()
                };
                
                console.log('ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿:', testSessionData);
                
                if (typeof DataManager !== 'undefined') {
                    console.log('ğŸ” saveSessionResultãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª:', typeof DataManager.saveSessionResult);
                    
                    if (DataManager.saveSessionResult) {
                        const result = DataManager.saveSessionResult(testSessionData);
                        console.log('ğŸ’¾ ä¿å­˜çµæœ:', result);
                        updateStatus('data-status', 'âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ');
                    } else {
                        console.error('âŒ DataManager.saveSessionResult ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        console.log('ğŸ“‹ åˆ©ç”¨å¯èƒ½ãƒ¡ã‚½ãƒƒãƒ‰:', Object.getOwnPropertyNames(DataManager).filter(name => name.includes('Session') || name.includes('save')));
                        updateStatus('data-status', 'âŒ saveSessionResultãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                    }
                } else {
                    console.error('âŒ DataManagerè‡ªä½“ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                    updateStatus('data-status', 'âŒ DataManagerãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('data-status', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        /**
         * ãƒ†ã‚¹ãƒˆç”¨ç·åˆè©•ä¾¡ãƒ‡ãƒ¼ã‚¿ä½œæˆ
         */
        function createTestOverallData() {
            const testOverallData = {
                mode: 'random',
                sessionData: ['test-session-1', 'test-session-2', 'test-session-3', 'test-session-4', 'test-session-5', 'test-session-6', 'test-session-7', 'test-session-8'],
                finalEvaluation: {
                    dynamicGrade: 'B',
                    finalScore: 82.3,
                    excellenceRatio: 0.65,
                    excellentCount: 20,
                    goodCount: 25,
                    passCount: 15,
                    practiceCount: 4
                },
                statistics: {
                    noteStatistics: {
                        'ãƒ‰': { successRate: 0.85, averageError: 12.5 },
                        'ãƒ¬': { successRate: 0.80, averageError: 18.3 },
                        'ãƒŸ': { successRate: 0.75, averageError: 22.1 },
                        'ãƒ•ã‚¡': { successRate: 0.90, averageError: 8.7 },
                        'ã‚½': { successRate: 0.78, averageError: 19.4 },
                        'ãƒ©': { successRate: 0.68, averageError: 28.9 },
                        'ã‚·': { successRate: 0.82, averageError: 16.2 },
                        'ãƒ‰(é«˜)': { successRate: 0.88, averageError: 11.3 }
                    }
                },
                completedAt: new Date().toISOString()
            };
            
            DataManager.saveOverallEvaluation(testOverallData);
            updateStatus('data-status', 'âœ… ç·åˆè©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ');
        }

        /**
         * å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
         */
        function clearAllData() {
            localStorage.clear();
            updateStatus('data-status', 'ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
         */
        function testSessionPage() {
            window.open('../pages/result-session.html', '_blank');
            updateStatus('test-results', 'ğŸ“„ ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã—ãŸ');
        }

        /**
         * ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
         */
        function testOverallPage() {
            window.open('../pages/results-overview.html?mode=random', '_blank');
            updateStatus('test-results', 'ğŸ“„ ç·åˆè©•ä¾¡ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã—ãŸ');
        }

        /**
         * ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼è¡¨ç¤º
         */
        function showDataSummary() {
            const latestSession = DataManager.getLatestSession();
            const latestEvaluation = DataManager.getLatestEvaluation('random');
            const sessionHistory = DataManager.getSessionHistory();
            
            const summary = {
                'ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´æ•°': sessionHistory.length,
                'æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³': latestSession ? `${latestSession.sessionNumber} (ã‚¹ã‚³ã‚¢: ${Math.round(latestSession.sessionSummary?.totalScore || 0)})` : 'ç„¡ã—',
                'æœ€æ–°ç·åˆè©•ä¾¡': latestEvaluation ? `${latestEvaluation.finalEvaluation?.dynamicGrade}ç´š (ã‚¹ã‚³ã‚¢: ${Math.round(latestEvaluation.finalEvaluation?.finalScore || 0)})` : 'ç„¡ã—',
                'LocalStorageã‚­ãƒ¼': Object.keys(localStorage).filter(key => !key.startsWith('_'))
            };
            
            document.getElementById('data-summary').textContent = JSON.stringify(summary, null, 2);
        }

        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
         */
        function updateStatus(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                setTimeout(() => element.textContent = '', 5000);
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // DataManagerèª­ã¿è¾¼ã¿ç¢ºèª
            if (typeof DataManager === 'undefined') {
                updateStatus('data-status', 'âŒ DataManagerãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                console.error('DataManagerèª­ã¿è¾¼ã¿å¤±æ•—');
            } else {
                updateStatus('data-status', 'ğŸš€ ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº† - DataManagerèª­ã¿è¾¼ã¿æ¸ˆã¿');
                console.log('âœ… DataManagerèª­ã¿è¾¼ã¿æˆåŠŸ:', DataManager);
            }
        });
    </script>
</body>
</html>