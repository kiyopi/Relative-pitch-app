<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - ç·åˆè©•ä¾¡</title>
    <link rel="stylesheet" href="styles/system.css?v=4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        /* èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ - iOSå¯¾å¿œç‰ˆ */
        body {
            position: relative;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            -webkit-overflow-scrolling: touch;
            background: #0f172a; /* ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
        }
        
        /* ç–‘ä¼¼è¦ç´ ã§èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            -webkit-animation: gradientShift 15s ease infinite;
            z-index: -1;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            will-change: background-position;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @-webkit-keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .page-header-icon {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* SNSã‚·ã‚§ã‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .share-section {
            margin: 2rem 0;
            animation: fadeInUp 0.8s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .share-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .share-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 11s infinite;
        }
        
        @keyframes shimmer {
            0% { 
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                opacity: 1;
            }
            9.1% { 
                transform: translateX(100%) translateY(100%) rotate(45deg);
                opacity: 1;
            }
            9.2% { 
                transform: translateX(100%) translateY(100%) rotate(45deg);
                opacity: 0;
            }
            99.9% { 
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                opacity: 0;
            }
            100% { 
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                opacity: 1;
            }
        }
        
        .share-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .share-card p {
            color: white;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }
        
        /* rank-sectionã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ–°æ¨ªä¸€åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */
        .rank-section {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 32px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .rank-mode {
            margin-bottom: 24px;
        }
        
        .rank-section .mode-title {
            font-size: 1.6rem !important;
            font-weight: 700;
            color: white;
            margin: 0;
        }
        
        .rank-content-row {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 24px;
        }
        
        .rank-icon {
            flex-shrink: 0;
        }
        
        .rank-stats-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
        }
        
        .rank-stat-item {
            text-align: center;
            min-width: 80px;
        }
        
        .stat-value-rank {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
            transition: transform 0.2s ease;
            line-height: 1;
        }
        
        .stat-value-rank.grade-value {
            font-size: 2.0rem;
            color: #ffffff; /* ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯ç™½è‰² */
        }
        
        .stat-value-rank.avg-error {
            color: #fbbf24; /* å¹³å‡èª¤å·®ã‚‚ã‚°ãƒ¬ãƒ¼ãƒ‰ã¨åŒã˜é»„è‰² */
        }
        
        .stat-label-rank {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.1;
            margin: 0;
            white-space: nowrap;
        }
        
        .rank-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .rank-circle-icon {
            width: 64px;
            height: 64px;
        }
        
        @media (max-width: 768px) {
            .rank-content-row {
                gap: 20px;
            }
            
            .rank-stats-row {
                gap: 20px;
            }
            
            .rank-circle {
                width: 90px;
                height: 90px;
            }
            
            .rank-circle-icon {
                width: 54px !important;
                height: 54px !important;
            }
            
            .stat-value-rank {
                font-size: 1.5rem;
            }
            
            .stat-value-rank.grade-value {
                font-size: 2rem;
            }
        }
        
        .share-buttons {
            display: flex;
            gap: 1.2rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .share-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            position: relative;
            /* btn-secondaryã¨åŒã˜ã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯ */
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .share-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 255, 255, 0.2);
        }
        
        .share-btn svg {
            width: 24px;
            height: 24px;
            z-index: 1;
        }
        
        .share-btn.twitter:hover {
            box-shadow: 0 8px 25px rgba(29, 161, 242, 0.4), 0 0 30px rgba(29, 161, 242, 0.3);
        }
        
        .share-btn.line:hover {
            box-shadow: 0 8px 25px rgba(0, 195, 0, 0.4), 0 0 30px rgba(0, 195, 0, 0.3);
        }
        
        .share-btn.facebook:hover {
            box-shadow: 0 8px 25px rgba(24, 119, 242, 0.4), 0 0 30px rgba(24, 119, 242, 0.3);
        }
        
        .share-btn.copy:hover {
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4), 0 0 30px rgba(139, 92, 246, 0.3);
        }
        
        @media (max-width: 640px) {
            .share-btn {
                width: 48px;
                height: 48px;
            }
            
            .share-btn svg {
                width: 20px;
                height: 20px;
            }
            
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-6">
        <div class="container">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="flex justify-center mb-6">
                    <div class="page-header-icon page-header-icon-purple">
                        <i data-lucide="file-chart-column-increasing" class="icon-2xl text-white" data-stroke-width="2"></i>
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-white mb-4">ç·åˆè©•ä¾¡</h1>
                <p class="text-green-200 text-xl mb-6">12ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº† - ã‚ãªãŸã®éŸ³æ„Ÿãƒ¬ãƒ™ãƒ«ã‚’åˆ†æã—ã¾ã—ãŸ</p>
                
            </div>

            <!-- SNSã‚·ã‚§ã‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="share-section" id="share-section">
                <div class="share-card">
                    <!-- rank-section -->
                    <section class="rank-section">
                        <!-- ãƒ¢ãƒ¼ãƒ‰å -->
                        <div class="rank-mode">
                            <h3 class="mode-title" id="main-mode-title">ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰</h3>
                        </div>
                        
                        <!-- ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã¨çµ±è¨ˆæƒ…å ±ã‚’æ¨ªä¸€åˆ—ã« -->
                        <div class="rank-content-row">
                            <!-- ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ -->
                            <div class="rank-icon">
                                <div class="rank-circle" style="background: linear-gradient(135deg, #fbbf24, #d97706);">
                                    <i data-lucide="crown" class="rank-circle-icon" style="color: white;"></i>
                                </div>
                            </div>
                            
                            <!-- çµ±è¨ˆæƒ…å ± -->
                            <div class="rank-stats-row">
                                <div class="rank-stat-item">
                                    <div class="stat-value-rank grade-value" id="dynamic-grade">B</div>
                                    <div class="stat-label-rank">ç·åˆã‚°ãƒ¬ãƒ¼ãƒ‰</div>
                                </div>
                                <div class="rank-stat-item">
                                    <div class="stat-value-rank avg-error" style="color: #fbbf24;">Â±0.0Â¢</div>
                                    <div class="stat-label-rank">å¹³å‡èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</div>
                                </div>
                                <div class="rank-stat-item">
                                    <div class="stat-value-rank max-error">+0.0Â¢</div>
                                    <div class="stat-label-rank">æœ€å¤§èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</div>
                                </div>
                                <div class="rank-stat-item">
                                    <div class="stat-value-rank session-count">0</div>
                                    <div class="stat-label-rank">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</div>
                                </div>
                            </div>
                            
                            <!-- ãƒ©ãƒ³ã‚¯å–å¾—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                            <div class="rank-achievement-message" style="margin-top: 0px; margin-bottom: 0px; text-align: center;">
                                <p id="share-message" style="color: rgba(255, 255, 255, 0.9); font-size: 1.1rem; margin: 0;">
                                    Bç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ã‚°ãƒƒãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼
                                </p>
                            </div>
                        </div>
                    </section>
                    
                    <h3 style="margin-top: 0px; margin-bottom: 24px;">ã¿ã‚“ãªã«æˆæœã‚’ã‚·ã‚§ã‚¢ã—ã‚ˆã†ï¼</h3>
                    <div class="share-buttons">
                        <a href="#" class="share-btn twitter" onclick="shareToTwitter(event)" title="Xã§ã‚·ã‚§ã‚¢">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="#" class="share-btn line" onclick="shareToLine(event)" title="LINEã§é€ã‚‹">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.348 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                            </svg>
                        </a>
                        <a href="#" class="share-btn facebook" onclick="shareToFacebook(event)" title="Facebookã§ã‚·ã‚§ã‚¢">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <button class="share-btn copy" onclick="copyShareText(event)" title="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Overall Statistics (hidden - moved to rank-section) -->
            <div class="glass-card mb-8" id="overall-stats-container" style="display: none; max-width: 100vw; overflow-x: hidden;">
                <div class="grid grid-cols-4 gap-6 mb-8" id="overall-stats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="glass-card mb-8" style="max-width: 100vw; overflow-x: hidden;">
                <div class="block md:grid md:grid-cols-2 gap-4 md:gap-8">
                    <!-- Error Trend Chart -->
                    <div class="mb-8 md:mb-0">
                        <h3 class="text-xl font-bold text-white mb-4">èª¤å·®æ¨ç§»</h3>
                        <div class="relative bg-white/5 rounded-lg p-0 md:p-4" id="error-trend-container" style="height: 280px;">
                            <canvas id="error-trend-chart"></canvas>
                        </div>
                        <div class="text-xs text-white-60 text-center mt-2" id="chart-description" style="min-height: 80px; height: auto;">
                            <!-- ã‚°ãƒ©ãƒ•ã®èª¬æ˜ã¯JavaScriptã§å‹•çš„ã«è¨­å®š -->
                        </div>
                    </div>
                    
                    <!-- Accuracy Chart -->
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">è©•ä¾¡åˆ†å¸ƒ</h3>
                        <div class="bg-white/5 rounded-lg" style="height: 200px;">
                            <canvas id="accuracy-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="text-xs text-white-60 text-center mt-2">12ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©•ä¾¡å†…è¨³</div>
                    </div>
                </div>
            </div>

            <!-- è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ -->
            <div class="glass-card mb-8" style="padding: 2rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i data-lucide="microscope" style="width: 28px; height: 28px; color: #fbbf24;"></i>
                        <h2 style="color: white; font-size: 1.75rem; font-weight: 700; margin: 0;">è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h2>
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.4); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
                        <p style="color: #e2e8f0; font-size: 1rem; margin: 0; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                            ã‚ãªãŸã®ç›¸å¯¾éŸ³æ„Ÿã‚’ç§‘å­¦çš„ã«åˆ†æã—ã€å…·ä½“çš„ãªæ”¹å–„æ–¹æ³•ã‚’ã”ææ¡ˆã—ã¾ã™
                        </p>
                    </div>
                </div>
                
                <!-- ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
                <div id="mode-feedback" class="glass-card" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
                    <div class="feedback-header" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="feedback-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="target" style="width: 20px; height: 20px; color: white;"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; color: white; font-size: 1.125rem; font-weight: 600;" id="mode-title">ãƒ¢ãƒ¼ãƒ‰æƒ…å ±</h4>
                            <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;" id="mode-focus"></p>
                        </div>
                    </div>
                    
                    <div class="feedback-content" style="margin-bottom: 1.25rem;">
                        <p style="margin: 0; color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="mode-message"></p>
                    </div>
                    
                    <div class="feedback-next-step" style="padding: 1rem; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.05)); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px;">
                        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                            <div style="width: 28px; height: 28px; background: rgba(34, 197, 94, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 0.125rem;">
                                <i data-lucide="arrow-right" style="width: 14px; height: 14px; color: #22c55e;"></i>
                            </div>
                            <div>
                                <h5 style="margin: 0 0 0.25rem; color: #22c55e; font-size: 0.875rem; font-weight: 600;">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h5>
                                <p style="margin: 0; color: #a7f3d0; font-size: 0.875rem; line-height: 1.5;" id="mode-next-step"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="detailed-analysis" class="glass-card" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
                    <div class="analysis-header" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="analysis-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="crosshair" style="width: 20px; height: 20px; color: white;"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; color: white; font-size: 1.125rem; font-weight: 600;">ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æ</h4>
                            <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;">æœ€å¤§ãƒ»æœ€å°èª¤å·®ã®å…·ä½“çš„ç‰¹å®š</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" style="margin-bottom: 1.25rem;">
                        <p style="margin: 0; color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="detailed-analysis-content">åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                
                <!-- Phase 1: ç·´ç¿’æŒ‡å°è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="practice-guidance" class="glass-card" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
                    <div class="guidance-header" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="guidance-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="lightbulb" style="width: 20px; height: 20px; color: white;"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; color: white; font-size: 1.125rem; font-weight: 600;">ç·´ç¿’æŒ‡å°</h4>
                            <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;">å…·ä½“çš„ãªæ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
                        </div>
                    </div>
                    
                    <div class="guidance-content" style="margin-bottom: 1.25rem;">
                        <!-- æœ€å„ªå…ˆèª²é¡Œ -->
                        <div id="priority-guidance" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 3px solid #ef4444;">
                            <div style="color: #f87171; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">æœ€å„ªå…ˆèª²é¡Œ</div>
                            <div style="color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="priority-text">-</div>
                        </div>
                        
                        <!-- æˆåŠŸå†ç¾æŒ‡å° -->
                        <div id="success-guidance" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border-left: 3px solid #22c55e;">
                            <div style="color: #4ade80; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">æˆåŠŸå†ç¾</div>
                            <div style="color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="success-text">-</div>
                        </div>
                        
                        <!-- åŸºæœ¬ç·´ç¿’ -->
                        <div id="basic-guidance" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <div style="color: #60a5fa; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">åŸºæœ¬ç·´ç¿’</div>
                            <div style="color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="basic-text">-</div>
                        </div>
                        
                        <!-- Excellenceå‘ä¸Šç·´ç¿’ -->
                        <div id="excellence-guidance" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(168, 85, 247, 0.1); border-radius: 8px; border-left: 3px solid #a855f7;">
                            <div style="color: #c084fc; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">ç²¾åº¦å‘ä¸Šç·´ç¿’</div>
                            <div style="color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="excellence-text">-</div>
                        </div>
                        
                        <!-- ãƒ¢ãƒ¼ãƒ‰åˆ¥ç·´ç¿’ -->
                        <div id="mode-guidance" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <div style="color: #fbbf24; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">ãƒ¢ãƒ¼ãƒ‰åˆ¥ç·´ç¿’</div>
                            <div style="color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6;" id="mode-practice-text">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 12éŸ³åˆ¥æˆç¸¾åˆ†æ -->
                <div id="tone-analysis" class="glass-card" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
                    <div class="analysis-header" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="analysis-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="bar-chart-3" style="width: 20px; height: 20px; color: white;"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; color: white; font-size: 1.125rem; font-weight: 600;">12éŸ³å¾‹åˆ†æ</h4>
                            <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;">å„åŸºéŸ³ã§ã®ç¿’ç†Ÿåº¦ã¨å¼±ç‚¹ã®ç‰¹å®š</p>
                        </div>
                    </div>
                    
                    <div class="tone-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1.25rem;" id="tone-performance-grid">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹12éŸ³ã®æˆç¸¾ -->
                    </div>
                    
                    <div class="weakness-analysis" style="padding: 1rem; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05)); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px;">
                        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                            <div style="width: 28px; height: 28px; background: rgba(239, 68, 68, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 0.125rem;">
                                <i data-lucide="alert-triangle" style="width: 14px; height: 14px; color: #f87171;"></i>
                            </div>
                            <div>
                                <h5 style="margin: 0 0 0.5rem; color: #f87171; font-size: 0.875rem; font-weight: 600;">å¼±ç‚¹åˆ†æ</h5>
                                <div id="weakness-details" style="color: #fca5a5; font-size: 0.875rem; line-height: 1.5;">
                                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹å¼±ç‚¹åˆ†æ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sessions Overview -->
            <div class="glass-card mb-8">
                <h3 class="text-2xl font-bold text-white mb-6">ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥æˆç¸¾</h3>
                <p class="text-white-70 text-sm mb-4">
                    <span class="lg:hidden">ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°åˆ†æã‚’è¡¨ç¤º</span>
                    <span class="hidden lg:inline">ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°åˆ†æã‚’è¡¨ç¤º</span>
                </p>
                <div class="grid grid-cols-12 gap-3" id="sessions-grid">
                    <!-- Sessions will be populated by JavaScript -->
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="glass-card mb-8">
                <div class="flex items-center justify-between mb-6">
                    <button id="prev-session-btn" class="glass-card-sm hover:bg-white/10 transition-colors cursor-pointer flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                            <path d="m15 18-6-6 6-6"/>
                        </svg>
                    </button>
                    <h3 class="text-xl font-bold text-white text-center flex-1 px-2">
                        <div>è©³ç´°åˆ†æ</div>
                        <div class="text-lg mt-1">ã‚»ãƒƒã‚·ãƒ§ãƒ³<span id="selected-session">1</span></div>
                    </h3>
                    <button id="next-session-btn" class="glass-card-sm hover:bg-white/10 transition-colors cursor-pointer flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                            <path d="m9 18 6-6-6-6"/>
                        </svg>
                    </button>
                </div>
                <div class="mb-4 text-center" id="session-info">
                    <!-- Session info will be populated by JavaScript -->
                </div>
                <div class="space-y-2" id="note-results">
                    <!-- Note results will be populated by JavaScript -->
                </div>
            </div>


            <!-- Action Buttons -->
            <section class="final-actions">
                <a href="records.html" class="btn btn-primary btn-large">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;">
                        <path d="M3 3h18v18H3z"/>
                        <path d="M21 9H3"/>
                        <path d="M9 21V9"/>
                    </svg>
                    <span>è¨˜éŒ²ã‚’è¦‹ã‚‹</span>
                </a>
                <a href="index.html" class="btn btn-secondary btn-large">
                    <i data-lucide="home" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                    <span>ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</span>
                </a>
                <a href="mic-test.html" class="btn btn-primary btn-large">
                    <i data-lucide="rotate-ccw" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                    <span>å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸</span>
                </a>
            </section>
            
            <!-- ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒªãƒ³ã‚¯ï¼ˆé–‹ç™ºç”¨ï¼‰ -->
            <section class="section" id="test-mode-links" style="display: none;">
                <div class="glass-card" style="padding: 2rem; text-align: center; border: 1px solid rgba(251, 191, 36, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <i data-lucide="settings" style="width: 20px; height: 20px; color: #fbbf24;"></i>
                        <h3 style="color: #fbbf24; margin: 0; font-size: 1.125rem; font-weight: 600;">é–‹ç™ºç”¨ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</h3>
                    </div>
                    <p style="color: #94a3b8; margin-bottom: 1.5rem; font-size: 0.875rem;">
                        ç•°ãªã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã§ã®å‹•çš„ã‚°ãƒ¬ãƒ¼ãƒ‰è¨ˆç®—ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <a href="?mode=8" class="btn btn-secondary" style="min-width: 140px;">
                            <i data-lucide="play-circle" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                            8ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆåˆç´šï¼‰
                        </a>
                        <a href="?mode=12" class="btn btn-secondary" style="min-width: 140px;">
                            <i data-lucide="play-circle" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                            12ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆä¸­ç´šï¼‰
                        </a>
                        <a href="?mode=24" class="btn btn-secondary" style="min-width: 140px;">
                            <i data-lucide="play-circle" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                            24ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆä¸Šç´šï¼‰
                        </a>
                        <a href="results.html" class="btn btn-primary" style="min-width: 140px;">
                            <i data-lucide="database" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                            æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆURLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
        const urlParams = new URLSearchParams(window.location.search);
        const testMode = urlParams.get('mode'); // ?mode=8, ?mode=12, ?mode=24
        
        // ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function getMockDataForMode(mode) {
            const modeNum = parseInt(mode) || 12;
            
            // 8ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ï¼ˆåˆç´šãƒ»ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ï¼‰- è‡ªç„¶éŸ³éšã®ã¿
            const mockData8Sessions = [
                { session: 1, baseNote: 'C4', accuracy: 88.5, averageCentError: 35.2 },
                { session: 2, baseNote: 'D4', accuracy: 85.3, averageCentError: 42.1 },
                { session: 3, baseNote: 'E4', accuracy: 82.1, averageCentError: 48.7 },
                { session: 4, baseNote: 'F4', accuracy: 86.2, averageCentError: 38.5 },
                { session: 5, baseNote: 'G4', accuracy: 79.9, averageCentError: 52.3 },
                { session: 6, baseNote: 'A4', accuracy: 84.7, averageCentError: 44.2 },
                { session: 7, baseNote: 'B4', accuracy: 87.4, averageCentError: 36.8 },
                { session: 8, baseNote: 'C5', accuracy: 83.6, averageCentError: 46.5 }
            ];
            
            // 12ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ï¼ˆä¸­ç´šãƒ»é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰- åŠéŸ³å«ã‚€
            const mockData12Sessions = [
                { session: 1, baseNote: 'C4', accuracy: 87.5, averageCentError: 25.1 },
                { session: 2, baseNote: 'D4', accuracy: 82.3, averageCentError: 35.4 },
                { session: 3, baseNote: 'E4', accuracy: 89.1, averageCentError: 22.7 },
                { session: 4, baseNote: 'F4', accuracy: 91.2, averageCentError: 18.8 },
                { session: 5, baseNote: 'G4', accuracy: 78.9, averageCentError: 42.2 },
                { session: 6, baseNote: 'A4', accuracy: 88.7, averageCentError: 28.9 },
                { session: 7, baseNote: 'B4', accuracy: 92.4, averageCentError: 21.3 },
                { session: 8, baseNote: 'C5', accuracy: 85.6, averageCentError: 32.7 },
                { session: 9, baseNote: 'C#4', accuracy: 84.2, averageCentError: 38.1 },
                { session: 10, baseNote: 'D#4', accuracy: 73.8, averageCentError: 55.3 },
                { session: 11, baseNote: 'F#4', accuracy: 90.3, averageCentError: 23.9 },
                { session: 12, baseNote: 'G#4', accuracy: 62.1, averageCentError: 58.7 }
            ];
            
            // 24ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ï¼ˆä¸Šç´šãƒ»12éŸ³éšï¼‰- å®Œå…¨ã‚¯ãƒ­ãƒãƒãƒƒã‚¯
            const mockData24Sessions = [
                { session: 1, baseNote: 'C4', accuracy: 92.5, averageCentError: 15.1 },
                { session: 2, baseNote: 'C#4', accuracy: 88.3, averageCentError: 22.4 },
                { session: 3, baseNote: 'D4', accuracy: 91.1, averageCentError: 16.7 },
                { session: 4, baseNote: 'D#4', accuracy: 85.2, averageCentError: 28.8 },
                { session: 5, baseNote: 'E4', accuracy: 93.9, averageCentError: 12.2 },
                { session: 6, baseNote: 'F4', accuracy: 94.7, averageCentError: 10.9 },
                { session: 7, baseNote: 'F#4', accuracy: 87.4, averageCentError: 24.3 },
                { session: 8, baseNote: 'G4', accuracy: 90.6, averageCentError: 18.7 },
                { session: 9, baseNote: 'G#4', accuracy: 82.2, averageCentError: 35.1 },
                { session: 10, baseNote: 'A4', accuracy: 91.8, averageCentError: 17.3 },
                { session: 11, baseNote: 'A#4', accuracy: 86.3, averageCentError: 26.9 },
                { session: 12, baseNote: 'B4', accuracy: 95.1, averageCentError: 9.7 },
                { session: 13, baseNote: 'C5', accuracy: 89.5, averageCentError: 20.1 },
                { session: 14, baseNote: 'C#5', accuracy: 84.3, averageCentError: 31.4 },
                { session: 15, baseNote: 'D5', accuracy: 90.1, averageCentError: 19.7 },
                { session: 16, baseNote: 'D#5', accuracy: 79.2, averageCentError: 41.8 },
                { session: 17, baseNote: 'E5', accuracy: 92.9, averageCentError: 14.2 },
                { session: 18, baseNote: 'F5', accuracy: 93.7, averageCentError: 13.9 },
                { session: 19, baseNote: 'F#5', accuracy: 85.4, averageCentError: 29.3 },
                { session: 20, baseNote: 'G5', accuracy: 88.6, averageCentError: 23.7 },
                { session: 21, baseNote: 'G#5', accuracy: 78.2, averageCentError: 43.1 },
                { session: 22, baseNote: 'A5', accuracy: 89.8, averageCentError: 21.3 },
                { session: 23, baseNote: 'A#5', accuracy: 83.3, averageCentError: 33.9 },
                { session: 24, baseNote: 'B5', accuracy: 91.1, averageCentError: 17.7 }
            ];
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
            switch(modeNum) {
                case 8:
                    console.log('ğŸ¯ Test Mode: 8 sessions (åˆç´šãƒ»ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³)');
                    return mockData8Sessions;
                case 24:
                    console.log('ğŸ¯ Test Mode: 24 sessions (ä¸Šç´šãƒ»12éŸ³éš)');
                    return mockData24Sessions;
                case 12:
                default:
                    console.log('ğŸ¯ Test Mode: 12 sessions (ä¸­ç´šãƒ»é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸)');
                    return mockData12Sessions;
            }
        }
        
        // å®Ÿãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•°ï¼ˆå°†æ¥ã®å®Ÿè£…ç”¨ï¼‰
        function getActualSessionData() {
            // localStorageã¾ãŸã¯APIã‹ã‚‰å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const savedData = localStorage.getItem('sessionResults');
            if (savedData) {
                return JSON.parse(savedData);
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯12ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒƒã‚¯
            return getMockDataForMode('12');
        }
        
        // ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®é¸æŠ
        const mockSessionsData = testMode ? 
            getMockDataForMode(testMode) : 
            getActualSessionData();
        
        // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆé–‹ç™ºç”¨ï¼‰
        if (testMode) {
            console.log(`âš ï¸ ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹: ${testMode}ã‚»ãƒƒã‚·ãƒ§ãƒ³`);
            console.log('ğŸ”— åˆ‡ã‚Šæ›¿ãˆãƒªãƒ³ã‚¯:');
            console.log('  - 8ã‚»ãƒƒã‚·ãƒ§ãƒ³: results.html?mode=8');
            console.log('  - 12ã‚»ãƒƒã‚·ãƒ§ãƒ³: results.html?mode=12');
            console.log('  - 24ã‚»ãƒƒã‚·ãƒ§ãƒ³: results.html?mode=24');
            console.log('  - æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰: results.html');
            
            // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            document.addEventListener('DOMContentLoaded', () => {
                const testIndicator = document.createElement('div');
                testIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(251, 191, 36, 0.9);
                    color: black;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: bold;
                    z-index: 10000;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                `;
                testIndicator.textContent = `TEST MODE: ${testMode} sessions`;
                document.body.appendChild(testIndicator);
            });
        }

        // Simple pseudo-random number generator with seed
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        // Generate session-specific note results with consistent seed
        function generateSessionNoteResults(sessionData) {
            const noteNames = ['ãƒ‰', 'ãƒ¬', 'ãƒŸ', 'ãƒ•ã‚¡', 'ã‚½', 'ãƒ©', 'ã‚·', 'ãƒ‰'];
            const baseFreqs = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç•ªå·ã‚’ã‚·ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã—ã¦ä¸€è²«ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            let seed = sessionData.session * 1000;
            
            return noteNames.map((noteName, index) => {
                // ã‚·ãƒ¼ãƒ‰åŸºã¥ãæ“¬ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã§ä¸€è²«ã—ãŸçµæœã‚’ä¿è¨¼
                const baseError = sessionData.averageCentError;
                const variation = (seededRandom(seed + index * 10) - 0.5) * 0.8 * baseError;
                const sign = seededRandom(seed + index * 10 + 5) > 0.5 ? 1 : -1;
                const absError = Math.max(1, Math.abs(baseError + variation));
                const centError = Math.round(absError * sign);
                
                const targetFreq = baseFreqs[index];
                const userFreq = targetFreq * Math.pow(2, centError / 1200);
                
                return {
                    noteIndex: index,
                    noteName: noteName,
                    targetFrequency: targetFreq,
                    userFrequency: userFreq,
                    centError: centError,
                    isCorrect: Math.abs(centError) <= 50
                };
            });
        }

        let selectedSessionForAnalysis = 1;
        
        // Chart.jsã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ãƒ•ãƒ©ã‚°
        let errorTrendChartAnimated = false;
        let accuracyChartAnimated = false;
        
        // ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ç®¡ç†
        let errorTrendObserver = null;
        let accuracyObserver = null;

        // Get evaluation level and color (ä»•æ§˜æ›¸æº–æ‹ )
        function getSessionEvaluationLabel(averageCentError) {
            if (averageCentError <= 15) return 'Excellent';      // Â±15ã‚»ãƒ³ãƒˆä»¥å†…
            if (averageCentError <= 25) return 'Good';           // 15ã‚»ãƒ³ãƒˆè¶…ï½25ã‚»ãƒ³ãƒˆä»¥å†…  
            if (averageCentError <= 40) return 'Pass';           // 25ã‚»ãƒ³ãƒˆè¶…ï½40ã‚»ãƒ³ãƒˆä»¥å†…
            return 'Practice';                                   // 41ã‚»ãƒ³ãƒˆä»¥ä¸Š
        }

        function getSessionEvaluationColor(label) {
            switch (label) {
                case 'Excellent': return 'gradient-warning';
                case 'Good': return 'gradient-success'; 
                case 'Pass': return 'gradient-blue';
                default: return 'gradient-error';
            }
        }

        function getGlassBackground(label, isSelected = false) {
            const opacity1 = isSelected ? 0.6 : 0.45;
            const opacity2 = isSelected ? 0.8 : 0.65;
            
            switch (label) {
                case 'Excellent': return `rgba(251, 191, 36, ${opacity1}), rgba(245, 158, 11, ${opacity2})`; // é»„è‰²ç³»
                case 'Good': return `rgba(74, 222, 128, ${opacity1}), rgba(34, 197, 94, ${opacity2})`; // ç·‘è‰²ç³»
                case 'Pass': return `rgba(59, 130, 246, ${opacity1}), rgba(29, 78, 216, ${opacity2})`; // é’è‰²ç³»
                case 'Practice': return `rgba(239, 68, 68, ${opacity1}), rgba(220, 38, 38, ${opacity2})`; // èµ¤è‰²ç³»
                default: return `rgba(255, 255, 255, ${opacity1 * 0.8}), rgba(255, 255, 255, ${opacity2 * 0.8})`;
            }
        }

        function getEvaluationIcon(label, colorClass = 'text-white', size = 24) {
            // Lucideã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨ï¼ˆç›´æ„Ÿçš„ãªã‚¢ã‚¤ã‚³ãƒ³é…ç½®ï¼‰
            switch (label) {
                case 'Excellent': return lucideIcon('trophy', colorClass, size);     // Â±15ã‚»ãƒ³ãƒˆä»¥å†… - ãƒˆãƒ­ãƒ•ã‚£ãƒ¼
                case 'Good': return lucideIcon('star', colorClass, size);            // 15ï½25ã‚»ãƒ³ãƒˆ - æ˜Ÿ  
                case 'Pass': return lucideIcon('thumbs-up', colorClass, size);       // 25ï½40ã‚»ãƒ³ãƒˆ - è¦ªæŒ‡UP
                case 'Practice': return lucideIcon('triangle-alert', colorClass, size); // 41ã‚»ãƒ³ãƒˆä»¥ä¸Š - ä¸‰è§’è­¦å‘Š
                default: return lucideIcon('alert-circle', colorClass, size);        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            }
        }

        // Initialize sessions grid
        function initializeSessionsGrid() {
            const grid = document.getElementById('sessions-grid');
            grid.innerHTML = '';

            mockSessionsData.forEach((session) => {
                const label = getSessionEvaluationLabel(session.averageCentError);
                const colorClass = getSessionEvaluationColor(label);
                
                // ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã®è‰²ã‚¯ãƒ©ã‚¹ã‚’è¨­å®š
                let iconColorClass = 'text-white';
                switch (label) {
                    case 'Excellent': iconColorClass = 'text-yellow-200'; break;
                    case 'Good': iconColorClass = 'text-green-200'; break;
                    case 'Pass': iconColorClass = 'text-blue-200'; break;
                    case 'Practice': iconColorClass = 'text-red-200'; break;
                }
                
                const icon = getEvaluationIcon(label, iconColorClass, 24); // 12ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦ã¯24px
                

                const sessionElement = document.createElement('div');
                sessionElement.className = `aspect-square rounded-lg cursor-pointer transition-all hover-scale active:scale-95 flex flex-col items-center justify-center text-center relative ${
                    selectedSessionForAnalysis === session.session ? 'scale-105' : ''
                }`;
                
                // é¸æŠæ™‚ã®æ ç·šã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤åŠ¹æœä»˜ãã§è¿½åŠ 
                if (selectedSessionForAnalysis === session.session) {
                    sessionElement.style.boxShadow = '0 0 0 2px rgba(255, 255, 255, 0.6), 0 4px 6px rgba(0, 0, 0, 0.1)';
                    sessionElement.style.position = 'relative';
                } else {
                    sessionElement.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                }
                
                // èƒŒæ™¯ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ†é›¢
                const isSelected = selectedSessionForAnalysis === session.session;
                sessionElement.style.position = 'relative';
                
                // æ–‡å­—è‰²ã‚’å„ãƒœã‚¿ãƒ³ã®è‰²ã«åˆã‚ã›ã¦è¨­å®š
                let textColor = 'text-white';
                switch (label) {
                    case 'Excellent': textColor = 'text-yellow-200'; break;
                    case 'Good': textColor = 'text-green-200'; break;
                    case 'Pass': textColor = 'text-blue-200'; break;
                    case 'Practice': textColor = 'text-red-200'; break;
                }
                
                sessionElement.innerHTML = `
                    <div class="absolute inset-0 rounded-lg" style="
                        opacity: ${isSelected ? '1' : '0.7'};
                        background: linear-gradient(135deg, ${getGlassBackground(label, isSelected)});
                        backdrop-filter: blur(8px);
                        -webkit-backdrop-filter: blur(8px);
                        -moz-backdrop-filter: blur(8px);
                        border: 1px solid rgba(255, 255, 255, ${isSelected ? '0.4' : '0.3'});
                        border-radius: 12px;
                        will-change: transform, opacity;
                        -webkit-transform: translateZ(0);
                        transform: translateZ(0);
                        -webkit-backface-visibility: hidden;
                        backface-visibility: hidden;
                        -webkit-perspective: 1000px;
                        perspective: 1000px;
                    "></div>
                    <div class="relative z-10 flex flex-col items-center justify-center h-full" style="
                        opacity: 1;
                        will-change: transform;
                        -webkit-transform: translateZ(0);
                        transform: translateZ(0);
                        -webkit-backface-visibility: hidden;
                        backface-visibility: hidden;
                        pointer-events: none;
                    ">
                        <div class="${textColor} font-bold text-sm mb-1" style="
                            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
                            filter: brightness(1.2);
                            -webkit-font-smoothing: antialiased;
                            -moz-osx-font-smoothing: grayscale;
                        ">${session.session}</div>
                        <div class="mb-1" style="
                            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.8)) brightness(1.2);
                            -webkit-backface-visibility: hidden;
                            backface-visibility: hidden;
                        ">${icon}</div>
                    </div>
                `;

                // ãƒ›ãƒãƒ¼åŠ¹æœ - èƒŒæ™¯ã®ã¿ã®é€æ˜åº¦å¤‰åŒ–
                sessionElement.addEventListener('mouseenter', () => {
                    if (selectedSessionForAnalysis !== session.session) {
                        const bgElement = sessionElement.querySelector('.absolute.inset-0');
                        if (bgElement) {
                            bgElement.style.opacity = '1';
                        }
                        sessionElement.style.transform = 'scale(1.05)';
                    }
                });
                
                sessionElement.addEventListener('mouseleave', () => {
                    if (selectedSessionForAnalysis !== session.session) {
                        const bgElement = sessionElement.querySelector('.absolute.inset-0');
                        if (bgElement) {
                            bgElement.style.opacity = '0.7';
                        }
                        sessionElement.style.transform = 'scale(1)';
                    }
                });
                
                sessionElement.addEventListener('click', () => {
                    selectedSessionForAnalysis = session.session;
                    updateSelectedSession();
                    initializeSessionsGrid(); // Refresh to update selection
                });

                grid.appendChild(sessionElement);
            });
        }

        // Update selected session details
        function updateSelectedSession() {
            const selectedSession = mockSessionsData.find(s => s.session === selectedSessionForAnalysis);
            if (!selectedSession) return;

            document.getElementById('selected-session').textContent = selectedSession.session;

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©•ä¾¡ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
            const label = getSessionEvaluationLabel(selectedSession.averageCentError);

            // Update session info - 1è¡Œä¸­å¤®å¯„ã›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
            const sessionInfo = document.getElementById('session-info');
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚¯ãƒ©ã‚¹ã‚’è¨­å®š
            let iconColorClass = 'text-white';
            switch (label) {
                case 'Excellent': iconColorClass = 'text-yellow-300'; break;
                case 'Good': iconColorClass = 'text-green-300'; break;
                case 'Pass': iconColorClass = 'text-blue-300'; break;
                case 'Practice': iconColorClass = 'text-red-300'; break;
            }
            
            // ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’å‹•çš„ã«æ±ºå®š
            const isDesktop = window.innerWidth >= 768;
            const iconSize = isDesktop ? 80 : 32; // PCç‰ˆ80pxã€ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ32px
            const largeIcon = getEvaluationIcon(label, iconColorClass, iconSize);
            
            sessionInfo.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem; align-items: end; min-height: 80px;">
                    <div style="display: flex; flex-direction: column; justify-content: flex-end; text-align: center; height: 100%;">
                        <div class="text-2xl md:text-4xl font-bold text-white">${selectedSession.baseNote}</div>
                        <p class="text-xs md:text-base text-green-200">åŸºéŸ³</p>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: flex-end; align-items: center; text-align: center; height: 100%;">
                        <div class="mb-2">${largeIcon}</div>
                        <p class="text-base md:text-lg font-bold ${iconColorClass}">${label}</p>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: flex-end; text-align: center; height: 100%;">
                        <div class="text-2xl md:text-4xl font-bold text-white">${
                            // ãƒ‡ãƒ¼ã‚¿ã®æ­£è² ã«åŸºã¥ã„ã¦è¡¨ç¤ºã‚’èª¿æ•´
                            (() => {
                                const seed = selectedSession.session * 1234;
                                const isPositive = (Math.sin(seed) > 0);
                                return isPositive ? `+${selectedSession.averageCentError}` : `-${selectedSession.averageCentError}`;
                            })()
                        }</div>
                        <p class="text-xs md:text-base text-green-200">ã‚»ãƒƒã‚·ãƒ§ãƒ³å¹³å‡èª¤å·®</p>
                    </div>
                </div>
            `;

            // Update note results
            const noteResults = document.getElementById('note-results');
            noteResults.innerHTML = '';

            const sessionNoteResults = generateSessionNoteResults(selectedSession);
            sessionNoteResults.forEach((note, index) => {
                const getEvaluationLevel = (centError) => {
                    const absError = Math.abs(centError);
                    // ç›´æ„Ÿçš„ãªã‚¢ã‚¤ã‚³ãƒ³é…ç½®ã§çµ±ä¸€è©•ä¾¡åŸºæº–ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’28pxã«æ‹¡å¤§ï¼‰
                    if (absError <= 15) return { level: 'excellent', color: 'text-yellow-300', label: 'Excellent', icon: lucideIcon('trophy', 'text-yellow-300', 28) };
                    if (absError <= 25) return { level: 'good', color: 'text-green-300', label: 'Good', icon: lucideIcon('star', 'text-green-300', 28) };
                    if (absError <= 40) return { level: 'pass', color: 'text-blue-300', label: 'Pass', icon: lucideIcon('thumbs-up', 'text-blue-300', 28) };
                    return { level: 'practice', color: 'text-red-300', label: 'Practice', icon: lucideIcon('triangle-alert', 'text-red-300', 28) };
                };

                const evaluation = getEvaluationLevel(note.centError);

                const noteElement = document.createElement('div');
                noteElement.className = 'glass-card-sm hover:bg-white/10 transition-colors';
                noteElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div>
                                <div class="text-lg font-bold text-white">${note.noteName}</div>
                            </div>
                            <div>
                                <div class="text-base text-white-60 font-medium">ç›®æ¨™ ${note.targetFrequency.toFixed(0)}Hz</div>
                                <div class="text-base text-white-60 font-medium">å®ŸéŸ³ ${note.userFrequency.toFixed(0)}Hz</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="font-bold text-2xl ${note.centError > 0 ? 'text-red-300' : 'text-blue-300'}">
                                ${note.centError > 0 ? '+' : ''}${note.centError}Â¢
                            </div>
                            <div class="flex items-center justify-center" style="min-width: 36px;">
                                ${evaluation.icon}
                            </div>
                        </div>
                    </div>
                `;

                noteResults.appendChild(noteElement);
            });
            
            // è©³ç´°åˆ†æã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            setTimeout(() => {
                initializeLucideIcons();
            }, 50);
        }


        // Initialize overall statistics
        function initializeOverallStats() {
            const overallStats = document.getElementById('overall-stats');
            
            // Calculate overall statistics
            const totalSessions = mockSessionsData.length;
            const completedSessions = totalSessions; // All sessions completed
            
            // Calculate average error across all sessions (çµ¶å¯¾å€¤ã®å¹³å‡)
            const totalError = mockSessionsData.reduce((sum, session) => sum + session.averageCentError, 0);
            const averageError = Math.round(totalError / totalSessions * 10) / 10;
            
            // Find maximum error with sign (ãƒ—ãƒ©ã‚¹ã‹ãƒã‚¤ãƒŠã‚¹ã‚’ä¿æŒ)
            const errors = mockSessionsData.map(session => {
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç•ªå·ã«åŸºã¥ã„ã¦ãƒ—ãƒ©ã‚¹/ãƒã‚¤ãƒŠã‚¹ã‚’æ±ºå®š
                const seed = session.session * 1234;
                const isPositive = (Math.sin(seed) > 0);
                return isPositive ? session.averageCentError : -session.averageCentError;
            });
            // çµ¶å¯¾å€¤ãŒæœ€å¤§ã®ã‚‚ã®ã‚’é¸æŠï¼ˆç¬¦å·ä»˜ãï¼‰
            const maxError = errors.reduce((max, curr) => 
                Math.abs(curr) > Math.abs(max) ? curr : max, 0);
            
            // Calculate overall grade based on average error
            let overallGrade;
            if (averageError <= 15) overallGrade = 'S';
            else if (averageError <= 20) overallGrade = 'A';
            else if (averageError <= 25) overallGrade = 'B';
            else if (averageError <= 35) overallGrade = 'C';
            else overallGrade = 'D';
            
            overallStats.innerHTML = `
                <div class="text-center">
                    <div class="text-4xl font-bold text-white mb-2">${overallGrade}</div>
                    <p class="text-green-200">ç·åˆã‚°ãƒ¬ãƒ¼ãƒ‰</p>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold text-white mb-2 stat-value" data-value="${averageError}">Â±0.0</div>
                    <p class="text-green-200">å¹³å‡èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</p>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold text-white mb-2 stat-value" data-value="${maxError}">${maxError >= 0 ? '+' : ''}0.0</div>
                    <p class="text-green-200">æœ€å¤§èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</p>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold text-white mb-2 stat-value" data-value="${totalSessions}">0</div>
                    <p class="text-green-200">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</p>
                </div>
            `;
        }

        // ã‚°ãƒ©ã‚¹åŠ¹æœç”¨ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼‰
        function createGlassGradient(ctx, color, chartType = 'mobile') {
            // å›ºå®šå¹…ã§ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦å®‰å®šæ€§ã‚’ç¢ºä¿
            let gradient;
            if (chartType === 'mobile') {
                // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ: æ¨ªå‘ãã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå›ºå®šå¹…200pxï¼‰
                gradient = ctx.createLinearGradient(0, 0, 200, 0);
            } else {
                // PCç‰ˆ: ç¸¦å‘ãã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå›ºå®šé«˜ã•200pxï¼‰ã§çµ±ä¸€
                gradient = ctx.createLinearGradient(0, 0, 0, 200);
            }
            
            // å…ƒã®è‰²ã‚’RGBã«å¤‰æ›ã—ã¦ã‚¢ãƒ«ãƒ•ã‚¡å€¤ã‚’èª¿æ•´
            let r, g, b;
            if (color === '#fbbf24') { r = 251; g = 191; b = 36; } // Excellent - é»„è‰²
            else if (color === '#22c55e') { r = 34; g = 197; b = 94; } // Good - ç·‘
            else if (color === '#3b82f6') { r = 59; g = 130; b = 246; } // Pass - é’
            else { r = 239; g = 68; b = 68; } // Practice - èµ¤
            
            // ã‚°ãƒ©ã‚¹åŠ¹æœ: å‡ç­‰ãªã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§å®‰å®šæ€§ã‚’ç¢ºä¿ï¼ˆçµ‚ç‚¹ã‚’æ˜ã‚‹ãèª¿æ•´ï¼‰
            gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, 0.9)`); // é–‹å§‹ç‚¹ï¼ˆæ˜ã‚‹ã„ï¼‰
            gradient.addColorStop(0.3, `rgba(${Math.min(255, r + 40)}, ${Math.min(255, g + 40)}, ${Math.min(255, b + 40)}, 0.8)`); // æ˜ã‚‹ã„éƒ¨åˆ†
            gradient.addColorStop(0.7, `rgba(${r}, ${g}, ${b}, 0.7)`); // ä¸­å¤®
            gradient.addColorStop(1, `rgba(${Math.max(0, r - 10)}, ${Math.max(0, g - 10)}, ${Math.max(0, b - 10)}, 0.75)`); // çµ‚ç‚¹ï¼ˆæ˜ã‚‹ãèª¿æ•´ï¼‰
            
            return gradient;
        }

        // Initialize error trend chart with Chart.js (PC: Line Chart, Mobile: Stacked Bar Chart)
        function initializeErrorTrendChart() {
            const ctx = document.getElementById('error-trend-chart');
            if (!ctx) {
                console.error('Error trend chart canvas not found');
                return;
            }
            
            console.log('ğŸ¯ Initializing error trend chart, animated:', errorTrendChartAnimated);
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­å®š: ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®š
            const isMobile = window.innerWidth < 768;
            const isTablet = window.innerWidth >= 768 && window.innerWidth <= 1024; // iPadå¯¾å¿œ
            
            // ã‚°ãƒ©ãƒ•ã®èª¬æ˜ã‚’å‹•çš„ã«è¨­å®š
            const descriptionElement = document.getElementById('chart-description');
            if (descriptionElement) {
                if (isMobile) {
                    // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆï¼ˆæ¨ªå‘ããƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼‰ã®èª¬æ˜
                    descriptionElement.innerHTML = `
                        <div class="font-semibold text-white-70">ã€ã‚°ãƒ©ãƒ•ã®è¦‹æ–¹ã€‘</div>
                        <div class="mt-1">ç¸¦è»¸: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç•ªå·ï¼ˆS1ï½S12ï¼‰ / æ¨ªè»¸: å¹³å‡èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</div>
                        <div>ãƒ—ãƒ©ã‚¹(+) = éŸ³ãŒé«˜ã„ / ãƒã‚¤ãƒŠã‚¹(-) = éŸ³ãŒä½ã„</div>
                        <div class="mt-1">0ã«è¿‘ã„ã»ã©æ­£ç¢ºãªéŸ³ç¨‹ã§ã™</div>
                    `;
                } else {
                    // PCç‰ˆãƒ»iPadç‰ˆï¼ˆãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆï¼‰ã®èª¬æ˜
                    descriptionElement.innerHTML = `
                        <div class="font-semibold text-white-70">ã€ã‚°ãƒ©ãƒ•ã®è¦‹æ–¹ã€‘</div>
                        <div class="mt-1">æ¨ªè»¸: ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥8éŸ³ / ç¸¦è»¸: èª¤å·®ï¼ˆã‚»ãƒ³ãƒˆï¼‰</div>
                        <div>ãƒ—ãƒ©ã‚¹(+) = éŸ³ãŒé«˜ã„ / ãƒã‚¤ãƒŠã‚¹(-) = éŸ³ãŒä½ã„</div>
                        <div class="mt-1">0ã«è¿‘ã„ã»ã©æ­£ç¢ºãªéŸ³ç¨‹ã§ã™</div>
                    `;
                }
            }
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç ´æ£„
            if (window.errorTrendChartInstance) {
                window.errorTrendChartInstance.destroy();
            }
            
            if (isMobile) {
                // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ: Stacked Bar Chartï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ä»˜ãï¼‰
                initializeMobileStackedBarChart(ctx);
            } else {
                // PCç‰ˆãƒ»iPadç‰ˆ: Line Chartï¼ˆiPadç‰ˆã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹ï¼‰
                initializePCLineChart(ctx, isTablet);
            }
        }
        
        // PCç‰ˆ: Line Chartå®Ÿè£…
        function initializePCLineChart(ctx, isTabletDevice = false) {
            // Xè»¸ãƒ©ãƒ™ãƒ«: ã‚»ãƒƒã‚·ãƒ§ãƒ³1ã®8éŸ³ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³2ã®8éŸ³...ã¨ã„ã†å½¢å¼
            const noteNames = ['ãƒ‰', 'ãƒ¬', 'ãƒŸ', 'ãƒ•ã‚¡', 'ã‚½', 'ãƒ©', 'ã‚·', 'ãƒ‰\''];
            const labels = [];
            const allData = [];
            const colors = [];
            
            // å…¨96éŸ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³é †Ã—éŸ³é †ï¼‰
            mockSessionsData.forEach((session, sessionIndex) => {
                const sessionNoteResults = generateSessionNoteResults(session);
                const evaluation = getSessionEvaluationLabel(session.averageCentError);
                
                // è©•ä¾¡ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ãè‰²
                let pointColor;
                switch (evaluation) {
                    case 'Excellent': pointColor = '#fbbf24'; break; // é»„è‰²
                    case 'Good': pointColor = '#22c55e'; break;      // ç·‘è‰²
                    case 'Pass': pointColor = '#3b82f6'; break;      // é’è‰²
                    default: pointColor = '#ef4444';                 // èµ¤è‰²
                }
                
                // å„éŸ³ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
                sessionNoteResults.forEach((note, noteIndex) => {
                    labels.push(`S${session.session}-${noteNames[noteIndex]}`);
                    allData.push(note.centError);
                    colors.push(pointColor);
                });
            });
            
            // ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã‚’è¨ˆç®—
            const maxValue = Math.max(...allData);
            const minValue = Math.min(...allData);
            const maxAbsValue = Math.max(Math.abs(maxValue), Math.abs(minValue));
            
            // 1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§å…¨96éŸ³ã‚’è¡¨ç¤º
            const dataset = {
                label: 'éŸ³ç¨‹èª¤å·®',
                data: allData,
                borderColor: 'rgba(255, 255, 255, 0.6)', // é€æ˜åº¦60%
                backgroundColor: colors,
                pointBackgroundColor: colors,
                pointBorderColor: 'rgba(255, 255, 255, 0.6)', // é€æ˜åº¦60%
                pointBorderWidth: 1,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.1,
                fill: false,
                segment: {
                    borderColor: function(ctx) {
                        // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®è‰²ã‚’æ¬¡ã®ãƒã‚¤ãƒ³ãƒˆã®è‰²ã«åˆã‚ã›ã¦é€æ˜åº¦60%é©ç”¨
                        const nextIndex = ctx.p1DataIndex;
                        const baseColor = colors[nextIndex] || '#ffffff';
                        
                        // ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’RGBAã«å¤‰æ›ã—ã¦é€æ˜åº¦60%é©ç”¨
                        if (baseColor === '#fbbf24') return 'rgba(251, 191, 36, 0.6)';
                        else if (baseColor === '#22c55e') return 'rgba(34, 197, 94, 0.6)';
                        else if (baseColor === '#3b82f6') return 'rgba(59, 130, 246, 0.6)';
                        else if (baseColor === '#ef4444') return 'rgba(239, 68, 68, 0.6)';
                        else return 'rgba(255, 255, 255, 0.6)';
                    }
                }
            };
            
            window.errorTrendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [dataset]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: errorTrendChartAnimated ? false : {
                        duration: 800,
                        onComplete: () => {
                            console.log('âœ… Error trend chart animation completed (PC Line)');
                            errorTrendChartAnimated = true;
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            callbacks: {
                                title: function(tooltipItems) {
                                    if (tooltipItems.length > 0) {
                                        const dataIndex = tooltipItems[0].dataIndex;
                                        return labels[dataIndex];
                                    }
                                    return '';
                                },
                                label: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const sessionIndex = Math.floor(dataIndex / 8);
                                    const noteIndex = dataIndex % 8;
                                    const session = mockSessionsData[sessionIndex];
                                    const evaluation = getSessionEvaluationLabel(session.averageCentError);
                                    const centValue = context.parsed.y;
                                    const centDisplay = centValue >= 0 ? `+${centValue}` : `${centValue}`;
                                    return `åŸºéŸ³${session.baseNote}: ${centDisplay}ã‚»ãƒ³ãƒˆ (${evaluation})`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                color: function(context) {
                                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³å¢ƒç•Œï¼ˆ8ã®å€æ•°ï¼‰ã§ç·šã‚’å¤ªã
                                    if (context.tick && context.tick.value % 8 === 0) {
                                        return 'rgba(255, 255, 255, 0.3)';
                                    }
                                    return 'rgba(255, 255, 255, 0.1)';
                                },
                                lineWidth: function(context) {
                                    if (context.tick && context.tick.value % 8 === 0) {
                                        return 2;
                                    }
                                    return 1;
                                }
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    size: 9
                                },
                                maxRotation: 45,
                                callback: function(value, index) {
                                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³å¢ƒç•Œã®ã¿è¡¨ç¤º
                                    if (index % 8 === 0) {
                                        const sessionNum = Math.floor(index / 8) + 1;
                                        return `ã‚»ãƒƒã‚·ãƒ§ãƒ³${sessionNum}`;
                                    }
                                    return '';
                                }
                            }
                        },
                        y: {
                            display: true,
                            position: 'left',
                            min: -maxAbsValue - 10, // å®Ÿãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§çµ¶å¯¾å€¤ + ãƒãƒ¼ã‚¸ãƒ³
                            max: maxAbsValue + 10,  // å®Ÿãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§çµ¶å¯¾å€¤ + ãƒãƒ¼ã‚¸ãƒ³
                            grid: {
                                color: (context) => {
                                    if (context.tick && context.tick.value === 0) {
                                        return 'rgba(255, 255, 255, 0.5)';
                                    }
                                    return 'rgba(255, 255, 255, 0.1)';
                                },
                                lineWidth: (context) => {
                                    if (context.tick && context.tick.value === 0) {
                                        return 2;
                                    }
                                    return 1;
                                },
                                drawOnChartArea: true,
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    if (value === 0) {
                                        return '0Â¢';
                                    } else if (value > 0) {
                                        return `+${value}Â¢`;
                                    } else {
                                        return `${value}Â¢`;
                                    }
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 8
                        }
                    }
                }
            });
        }
        
        // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ: æ¨ªå‘ããƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆå®Ÿè£…ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥ï¼‰
        function initializeMobileStackedBarChart(ctx) {
            // ã‚³ãƒ³ãƒ†ãƒŠã®å¹…ã‚’åˆ¶é™
            const container = document.getElementById('error-trend-container');
            if (container) {
                const viewportWidth = window.innerWidth;
                const maxWidth = Math.min(viewportWidth - 48, 350); // æœ€å¤§350pxã«åˆ¶é™
                container.style.width = `${maxWidth}px`;
                container.style.maxWidth = '100%';
            }
            
            const labels = [];
            const data = [];
            const backgroundColors = [];
            
            // å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
            mockSessionsData.forEach((session) => {
                labels.push(`S${session.session}`);
                data.push(session.averageCentError);
                
                // è©•ä¾¡ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ãè‰²
                const evaluation = getSessionEvaluationLabel(session.averageCentError);
                let barColor;
                switch (evaluation) {
                    case 'Excellent': barColor = '#fbbf24'; break;
                    case 'Good': barColor = '#22c55e'; break;
                    case 'Pass': barColor = '#3b82f6'; break;
                    default: barColor = '#ef4444';
                }
                backgroundColors.push(barColor);
            });
            
            
            // ã‚°ãƒ©ãƒ•ã®æœ€å¤§å€¤ã‚’è¨ˆç®—
            const maxValue = Math.max(...data);
            
            window.errorTrendChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¹³å‡èª¤å·®',
                        data: data,
                        backgroundColor: function(context) {
                            if (context.parsed !== undefined) {
                                const index = context.dataIndex;
                                const baseColor = backgroundColors[index];
                                return createGlassGradient(context.chart.ctx, baseColor, 'mobile');
                            }
                            return backgroundColors;
                        },
                        borderColor: 'rgba(255, 255, 255, 0.3)', // è–„ã„ç™½ãƒœãƒ¼ãƒ€ãƒ¼ã§ã‚°ãƒ©ã‚¹åŠ¹æœã‚’å¼·åŒ–
                        borderWidth: 1,
                        borderRadius: 8, // ãƒãƒ¼ã‚’è§’ä¸¸ã«
                        borderSkipped: false, // å…¨ã¦ã®è§’ã‚’ä¸¸ãã™ã‚‹
                        barPercentage: 0.7,  // ãƒãƒ¼ã®é«˜ã•ã‚’70%ã«
                        categoryPercentage: 0.9  // ã‚«ãƒ†ã‚´ãƒªé–“éš”ã‚’90%ã«
                    }]
                },
                options: {
                    indexAxis: 'y', // æ¨ªå‘ããƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: errorTrendChartAnimated ? false : {
                        duration: 1000,
                        onComplete: () => {
                            console.log('âœ… Error trend chart animation completed (Mobile Bar)');
                            errorTrendChartAnimated = true;
                        }
                    },
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            callbacks: {
                                title: function(tooltipItems) {
                                    if (tooltipItems.length > 0) {
                                        const index = tooltipItems[0].dataIndex;
                                        const session = mockSessionsData[index];
                                        return `ã‚»ãƒƒã‚·ãƒ§ãƒ³${session.session}`;
                                    }
                                    return '';
                                },
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const session = mockSessionsData[index];
                                    const evaluation = getSessionEvaluationLabel(session.averageCentError);
                                    return [
                                        `åŸºéŸ³: ${session.baseNote}`,
                                        `èª¤å·®: Â±${context.parsed.x}ã‚»ãƒ³ãƒˆ`,
                                        `è©•ä¾¡: ${evaluation}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: true,  // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’è¡¨ç¤º
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    size: 10
                                },
                                stepSize: 10,
                                callback: function(value) {
                                    // 10ã®å€æ•°ã®ã¿è¡¨ç¤º
                                    if (value % 10 === 0) {
                                        return value;
                                    }
                                    return '';
                                }
                            },
                            suggestedMax: maxValue + 5,
                            min: 0
                        },
                        y: {
                            grid: {
                                display: true,  // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’è¡¨ç¤º
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 10  // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’10pxã«çµ±ä¸€
                                },
                                padding: 3,
                                autoSkip: false  // ãƒ©ãƒ™ãƒ«ã‚’çœç•¥ã—ãªã„
                            }
                        }
                    }
                }
            });
        }

        // Initialize accuracy chart (evaluation distribution) with Chart.js
        function initializeAccuracyChart() {
            const ctx = document.getElementById('accuracy-chart');
            if (!ctx) {
                console.error('Accuracy chart canvas not found');
                return;
            }
            
            console.log('ğŸ“ˆ Initializing accuracy chart, animated:', accuracyChartAnimated);
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç ´æ£„
            if (window.accuracyChartInstance) {
                window.accuracyChartInstance.destroy();
            }
            
            // è©•ä¾¡ãƒ¬ãƒ™ãƒ«åˆ¥ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const evaluationCounts = {
                'Excellent': 0,
                'Good': 0,
                'Pass': 0,
                'Practice': 0
            };
            
            mockSessionsData.forEach(session => {
                const label = getSessionEvaluationLabel(session.averageCentError);
                evaluationCounts[label]++;
            });
            
            
            const labels = ['Excellent', 'Good', 'Pass', 'Practice'];
            const data = [
                evaluationCounts['Excellent'],
                evaluationCounts['Good'],
                evaluationCounts['Pass'],
                evaluationCounts['Practice']
            ];
            const backgroundColors = ['#fbbf24', '#22c55e', '#3b82f6', '#ef4444'];
            
            window.accuracyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°',
                        data: data,
                        backgroundColor: function(context) {
                            if (context.parsed !== undefined) {
                                const index = context.dataIndex;
                                const baseColor = backgroundColors[index];
                                return createGlassGradient(context.chart.ctx, baseColor, 'mobile');
                            }
                            return backgroundColors;
                        },
                        borderColor: 'rgba(255, 255, 255, 0.3)',
                        borderWidth: 1,
                        borderRadius: 8,
                        borderSkipped: false,
                        barPercentage: 0.7,
                        categoryPercentage: 0.9
                    }]
                },
                options: {
                    indexAxis: 'y', // æ¨ªå‘ããƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: accuracyChartAnimated ? false : {
                        duration: 1000,
                        onComplete: () => {
                            console.log('âœ… Accuracy chart animation completed');
                            accuracyChartAnimated = true;
                        }
                    },
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // å‡¡ä¾‹ã‚’éè¡¨ç¤ºï¼ˆãƒ©ãƒ™ãƒ«ã§ååˆ†ï¼‰
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const total = mockSessionsData.length;
                                    const value = context.parsed.x;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value}ã‚»ãƒƒã‚·ãƒ§ãƒ³ (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    size: 14
                                },
                                stepSize: 1,
                                callback: function(value) {
                                    return Math.floor(value) === value ? value : '';
                                }
                            },
                            min: 0
                        },
                        y: {
                            grid: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 14
                                },
                                padding: 3,
                                autoSkip: false
                            }
                        }
                    }
                }
            });
        }

        // å‹•çš„ã‚°ãƒ¬ãƒ¼ãƒ‰è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ 
        function detectMode(sessionData) {
            const sessionCount = sessionData.length;
            
            const modeMap = {
                8: {
                    mode: 'random',
                    name: 'ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰',
                    level: 'åˆç´š',
                    target: 'ã‚«ãƒ©ã‚ªã‚±ãƒ»åˆå”±ãƒ¬ãƒ™ãƒ«'
                },
                12: {
                    mode: 'continuous',
                    name: 'é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰', 
                    level: 'ä¸­ç´š',
                    target: 'å®Ÿç”¨çš„ç›¸å¯¾éŸ³æ„Ÿãƒ¬ãƒ™ãƒ«'
                },
                24: {
                    mode: 'chromatic',
                    name: '12éŸ³éšãƒ¢ãƒ¼ãƒ‰',
                    level: 'ä¸Šç´š', 
                    target: 'ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ¬ãƒ™ãƒ«'
                }
            };
            
            if (sessionCount <= 8) return { ...modeMap[8], actualSessions: sessionCount };
            if (sessionCount <= 12) return { ...modeMap[12], actualSessions: sessionCount };
            return { ...modeMap[24], actualSessions: sessionCount };
        }

        function detectDeviceQuality() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const sampleRate = audioContext.sampleRate;
                const userAgent = navigator.userAgent.toLowerCase();
                const isMobile = /mobile|android|iphone|ipad/.test(userAgent);
                
                let quality, factor, accuracy, message;
                
                if (sampleRate >= 48000 && !isMobile) {
                    quality = 'high';
                    factor = 1.0;
                    accuracy = 'Â±10Â¢';
                    message = 'é«˜ç²¾åº¦ã§ã®æ¸¬å®šãŒå¯èƒ½ã§ã™';
                }
                else if (sampleRate >= 44100) {
                    quality = 'medium';
                    factor = 1.15;
                    accuracy = 'Â±15Â¢';
                    message = 'ä¸€èˆ¬çš„ãªç²¾åº¦ã§æ¸¬å®šä¸­ï¼ˆç´„Â±15Â¢ã®èª¤å·®ã‚’å«ã‚€å¯èƒ½æ€§ï¼‰';
                }
                else {
                    quality = 'low';
                    factor = 1.3;
                    accuracy = 'Â±25Â¢';
                    message = 'é™å®šçš„ç²¾åº¦ã§ã®æ¸¬å®šï¼ˆç´„Â±25Â¢ã®èª¤å·®ã‚’å«ã‚€å¯èƒ½æ€§ï¼‰ã€‚ç›¸å¯¾çš„ãªæ”¹å–„å‚¾å‘ã«æ³¨ç›®ã—ã¦ãã ã•ã„';
                }
                
                return { quality, factor, accuracy, message, sampleRate };
                
            } catch (error) {
                console.warn('AudioContext detection failed:', error);
                return {
                    quality: 'medium',
                    factor: 1.15,
                    accuracy: 'Â±15Â¢',
                    message: 'æ¨™æº–ç²¾åº¦ã§æ¸¬å®šä¸­',
                    sampleRate: 'unknown'
                };
            }
        }

        function calculateBasicMetrics(sessionData) {
            let totalError = 0;
            let totalNotes = 0;
            let excellentNotes = 0;
            let errors = [];
            
            sessionData.forEach(session => {
                const noteResults = generateSessionNoteResults(session);
                
                noteResults.forEach(note => {
                    const absError = Math.abs(note.centError);
                    
                    totalError += absError;
                    totalNotes++;
                    errors.push(absError);
                    
                    if (absError <= 20) {
                        excellentNotes++;
                    }
                });
            });
            
            const avgError = totalError / totalNotes;
            const excellenceRate = excellentNotes / totalNotes;
            
            return {
                avgError: Math.round(avgError * 10) / 10,
                excellenceRate: Math.round(excellenceRate * 1000) / 1000,
                totalNotes,
                excellentNotes
            };
        }

        function applyTechnicalAdjustment(basicMetrics, deviceInfo) {
            const adjustedMetrics = {
                avgError: basicMetrics.avgError / deviceInfo.factor,
                excellenceRate: basicMetrics.excellenceRate,
                totalNotes: basicMetrics.totalNotes,
                excellentNotes: basicMetrics.excellentNotes
            };
            
            return {
                raw: basicMetrics,
                adjusted: adjustedMetrics,
                adjustmentInfo: {
                    factor: deviceInfo.factor,
                    quality: deviceInfo.quality,
                    explanation: `${deviceInfo.quality}ãƒ‡ãƒã‚¤ã‚¹ã®ãŸã‚ã€${deviceInfo.factor}å€ã®èª¿æ•´ã‚’é©ç”¨`
                }
            };
        }

        function getModeSpecificThresholds(actualSessions) {
            let sessionCount;
            if (actualSessions <= 8) sessionCount = 8;
            else if (actualSessions <= 12) sessionCount = 12;
            else sessionCount = 24;
            
            const thresholds = {
                8: {
                    S: { avgError: 30, excellence: 0.75 },
                    A: { avgError: 40, excellence: 0.65 },
                    B: { avgError: 50, excellence: 0.55 },
                    C: { avgError: 60, excellence: 0.45 },
                    D: { avgError: 70, excellence: 0.35 },
                    E: { avgError: 80, excellence: 0.25 }
                },
                
                12: {
                    S: { avgError: 25, excellence: 0.80 },
                    A: { avgError: 35, excellence: 0.70 },
                    B: { avgError: 45, excellence: 0.60 },
                    C: { avgError: 55, excellence: 0.50 },
                    D: { avgError: 65, excellence: 0.40 },
                    E: { avgError: 75, excellence: 0.30 }
                },
                
                24: {
                    S: { avgError: 20, excellence: 0.85 },
                    A: { avgError: 30, excellence: 0.75 },
                    B: { avgError: 40, excellence: 0.65 },
                    C: { avgError: 50, excellence: 0.55 },
                    D: { avgError: 60, excellence: 0.45 },
                    E: { avgError: 70, excellence: 0.35 }
                }
            };
            
            return {
                thresholds: thresholds[sessionCount],
                sessionCount,
                explanation: `${sessionCount}ã‚»ãƒƒã‚·ãƒ§ãƒ³${sessionCount === 8 ? 'ï¼ˆåˆç´šï¼‰' : sessionCount === 12 ? 'ï¼ˆä¸­ç´šï¼‰' : 'ï¼ˆä¸Šç´šï¼‰'}åŸºæº–é©ç”¨`
            };
        }

        function determineGrade(adjustedMetrics, thresholds) {
            const grades = ['S', 'A', 'B', 'C', 'D', 'E'];
            
            for (const grade of grades) {
                const threshold = thresholds[grade];
                
                if (adjustedMetrics.avgError <= threshold.avgError && 
                    adjustedMetrics.excellenceRate >= threshold.excellence) {
                    return {
                        grade,
                        achievedBy: {
                            avgError: adjustedMetrics.avgError <= threshold.avgError,
                            excellence: adjustedMetrics.excellenceRate >= threshold.excellence
                        },
                        thresholds: threshold
                    };
                }
            }
            
            return {
                grade: 'E',
                achievedBy: {
                    avgError: false,
                    excellence: false
                },
                thresholds: thresholds.E
            };
        }

        function calculateDynamicGrade(sessionData) {
            const modeInfo = detectMode(sessionData);
            const deviceInfo = detectDeviceQuality();
            const basicMetrics = calculateBasicMetrics(sessionData);
            const metricsWithAdjustment = applyTechnicalAdjustment(basicMetrics, deviceInfo);
            const thresholdInfo = getModeSpecificThresholds(modeInfo.actualSessions);
            const gradeResult = determineGrade(metricsWithAdjustment.adjusted, thresholdInfo.thresholds);
            
            return {
                grade: gradeResult.grade,
                modeInfo,
                deviceInfo,
                metrics: metricsWithAdjustment,
                thresholdInfo,
                gradeResult
            };
        }

        // å‹•çš„ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºã®æ›´æ–°
        function updateGradeDisplay() {
            const gradeResult = calculateDynamicGrade(mockSessionsData);
            
            // ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
            const gradeElement = document.querySelector('.grade-value');
            if (gradeElement) {
                gradeElement.textContent = gradeResult.grade;
                console.log(`âœ… Grade updated to: ${gradeResult.grade}`, gradeResult);
            }
            
            // ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            const mainTitleElement = document.getElementById('main-mode-title');
            if (mainTitleElement) {
                mainTitleElement.textContent = gradeResult.modeInfo.name;
                console.log(`âœ… Main title updated to: ${gradeResult.modeInfo.name}`);
            }
            
            // ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
            showModeFeedback(gradeResult.modeInfo, gradeResult);
            
            // 12éŸ³åˆ¥åˆ†æè¡¨ç¤º
            showToneAnalysis(gradeResult);
        }
        
        // ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®è¡¨ç¤ºï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰
        function showModeFeedback(modeInfo, gradeResult) {
            const feedbackEl = document.getElementById('mode-feedback');
            if (!feedbackEl) return;
            
            // åŸºæœ¬æƒ…å ±ã®ã¿è¨­å®šï¼ˆè¤‡é›‘ãªåˆ†æã¯æ®µéšçš„ã«è¿½åŠ ï¼‰
            const modeSpecificFeedback = {
                8: {
                    focus: 'åŸºæœ¬çš„ãªéŸ³ç¨‹æ„Ÿè¦šã®å®šç€åº¦',
                    nextStep: 'é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã§åŠéŸ³ã‚’å«ã‚€12éŸ³ã¸ã®æŒ‘æˆ¦'
                },
                12: {
                    focus: '12éŸ³ã™ã¹ã¦ã¸ã®å¯¾å¿œåŠ›å‘ä¸Šåº¦',
                    nextStep: '12éŸ³éšãƒ¢ãƒ¼ãƒ‰ã§ã®ä¸Šæ˜‡ãƒ»ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚¹ã‚¿ãƒ¼'
                },
                24: {
                    focus: 'ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã®å®Œç’§ãª12éŸ³å¾‹ã‚·ã‚¹ãƒ†ãƒ ç¿’å¾—åº¦',
                    nextStep: 'ãƒã‚¹ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ«é”æˆå¾Œã®å®Ÿè·µçš„éŸ³æ¥½æ´»å‹•ã¸ã®å¿œç”¨'
                }
            };
            
            // å®Ÿéš›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‹ã‚‰æœ€ã‚‚è¿‘ã„ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ¤å®š
            let targetMode = 12; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            if (modeInfo.actualSessions <= 8) targetMode = 8;
            else if (modeInfo.actualSessions <= 12) targetMode = 12;
            else targetMode = 24;
            
            const feedback = modeSpecificFeedback[targetMode];
            
            // DOMè¦ç´ ã«åŸºæœ¬æƒ…å ±ã®ã¿åæ˜ 
            const modeTitle = document.getElementById('mode-title');
            const modeFocus = document.getElementById('mode-focus');
            const modeMessage = document.getElementById('mode-message');
            const modeNextStep = document.getElementById('mode-next-step');
            
            if (modeTitle) modeTitle.textContent = `${modeInfo.name} (${modeInfo.level})`;
            if (modeFocus) modeFocus.textContent = `ğŸ“ ${feedback.focus}`;
            
            // å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹
            let avgErrorText = 'åŸºæœ¬çš„ãªéŸ³ç¨‹æ„Ÿè¦šã®åˆ†æã‚’å®Ÿè¡Œä¸­';
            if (gradeResult && gradeResult.metrics && gradeResult.metrics.raw && typeof gradeResult.metrics.raw.avgError === 'number') {
                avgErrorText = `å¹³å‡èª¤å·®Â±${Math.abs(gradeResult.metrics.raw.avgError).toFixed(1)}Â¢ã®æˆç¸¾ã§ã™ã€‚`;
            }
            if (modeMessage) modeMessage.textContent = avgErrorText;
            if (modeNextStep) modeNextStep.textContent = feedback.nextStep;
            
            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            feedbackEl.style.display = 'block';
            
            // Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æã®è¡¨ç¤º
            showDetailedAnalysis(gradeResult, modeInfo);
            
            // Phase 1: ç·´ç¿’æŒ‡å°ã®è¡¨ç¤º
            showPracticeGuidance(gradeResult, modeInfo);
        }
        
        // Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æã®è¡¨ç¤ºé–¢æ•°ï¼ˆHTMLç”Ÿæˆå›é¿ç‰ˆï¼‰
        function showDetailedAnalysis(gradeResult, modeInfo) {
            const analysisEl = document.getElementById('detailed-analysis');
            const contentEl = document.getElementById('detailed-analysis-content');
            
            if (!analysisEl || !contentEl) return;
            
            // Phase 1æ©Ÿèƒ½: è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            const analysisText = generateDetailedAnalysis(gradeResult, modeInfo);
            
            // åˆ†æçµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã§è¡¨ç¤ºï¼ˆHTMLç”Ÿæˆãªã—ï¼‰
            contentEl.textContent = analysisText;
            analysisEl.style.display = 'block';
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        // Phase 1: ç·´ç¿’æŒ‡å°ã®è¡¨ç¤ºé–¢æ•°ï¼ˆHTMLç”Ÿæˆå›é¿ç‰ˆï¼‰
        function showPracticeGuidance(gradeResult, modeInfo) {
            const guidanceEl = document.getElementById('practice-guidance');
            
            if (!guidanceEl) return;
            
            // Phase 1æ©Ÿèƒ½: ç·´ç¿’æŒ‡å°ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            const guidanceText = generatePracticeGuidance(gradeResult, modeInfo);
            
            // æŒ‡å°å†…å®¹ã‚’äº‹å‰å®šç¾©ã•ã‚ŒãŸè¦ç´ ã«åˆ†å‰²è¡¨ç¤º
            updateGuidanceElements(guidanceText, gradeResult);
            
            guidanceEl.style.display = 'block';
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        // ç·´ç¿’æŒ‡å°è¦ç´ ã®æ›´æ–°ï¼ˆHTMLç”Ÿæˆå›é¿ï¼‰
        function updateGuidanceElements(guidanceText, gradeResult) {
            // æ—¢å­˜ã®generatePracticeGuidanceé–¢æ•°ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥å–å¾—
            if (!gradeResult || !gradeResult.metrics || !gradeResult.metrics.raw) {
                return;
            }
            
            const metrics = gradeResult.metrics;
            const avgError = Math.abs(metrics.raw.avgError || 0);
            const excellenceRate = metrics.raw.excellenceRate || 0;
            
            // Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨
            const extremeErrors = findExtremeErrors(mockSessionsData);
            
            // 1. æœ€å„ªå…ˆèª²é¡Œï¼ˆæœ€å¤§èª¤å·®ã®ç‰¹å®šç·´ç¿’ï¼‰
            if (extremeErrors && extremeErrors.maxError && extremeErrors.maxError.error > 30) {
                const maxErrInfo = extremeErrors.maxError;
                const priorityEl = document.getElementById('priority-guidance');
                const priorityText = document.getElementById('priority-text');
                
                if (priorityEl && priorityText) {
                    priorityText.textContent = `${maxErrInfo.note}éŸ³ã§${Math.abs(maxErrInfo.rawError).toFixed(1)}Â¢ã®å¤§ããªèª¤å·®ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®éŸ³ç¨‹ã‚’é‡ç‚¹çš„ã«ç·´ç¿’ã—ã¦ãã ã•ã„ã€‚åŸºéŸ³${maxErrInfo.sessionNote}ã‹ã‚‰${maxErrInfo.note}éŸ³ã¸ã®éŸ³ç¨‹é–¢ä¿‚ã‚’æ¥½å™¨ã§ç¢ºèªã—ãªãŒã‚‰åå¾©ç·´ç¿’ãŒåŠ¹æœçš„ã§ã™ã€‚`;
                    priorityEl.style.display = 'block';
                }
            }
            
            // 2. æˆåŠŸå†ç¾æŒ‡å°ï¼ˆæœ€å°èª¤å·®ï¼‰
            if (extremeErrors && extremeErrors.minError && extremeErrors.minError.error < 20) {
                const minErrInfo = extremeErrors.minError;
                const successEl = document.getElementById('success-guidance');
                const successText = document.getElementById('success-text');
                
                if (successEl && successText) {
                    successText.textContent = `ã‚»ãƒƒã‚·ãƒ§ãƒ³${minErrInfo.session}ã®${minErrInfo.note}éŸ³ã§é”æˆã—ãŸÂ±${minErrInfo.error.toFixed(1)}Â¢ã®é«˜ç²¾åº¦ã‚’ä»–ã®éŸ³ç¨‹ã§ã‚‚å†ç¾ã§ãã‚‹ã‚ˆã†å¿œç”¨ç·´ç¿’ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚`;
                    successEl.style.display = 'block';
                }
            }
            
            // 3. ç²¾åº¦ãƒ¬ãƒ™ãƒ«åˆ¥ã®åŸºæœ¬ç·´ç¿’æ³•
            const basicEl = document.getElementById('basic-guidance');
            const basicText = document.getElementById('basic-text');
            
            if (basicEl && basicText) {
                let basicPractice = '';
                if (avgError > 30) {
                    basicPractice = 'æ¥½å™¨ã¨ä¸€ç·’ã«æ­Œã£ã¦éŸ³ç¨‹ã‚’è€³ã§ç¢ºèªã™ã‚‹ç·´ç¿’ã‚’æ¯æ—¥10åˆ†è¡Œã„ã¾ã—ã‚‡ã†ã€‚';
                } else if (avgError > 20) {
                    basicPractice = 'ãƒ”ã‚¢ãƒãªã—ã§æ­Œã£ãŸå¾Œã«æ¥½å™¨ã§ç¢ºèªã™ã‚‹ç·´ç¿’ã§ç‹¬ç«‹æ€§ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚';
                } else {
                    basicPractice = 'æ¥½å™¨ãªã—ã§ã®éŸ³ç¨‹è¨˜æ†¶ã¨ç›¸å¯¾éŸ³æ„Ÿã«ã‚ˆã‚‹éŸ³ç¨‹é–¢ä¿‚ã®æ§‹ç¯‰ã‚’é‡ç‚¹çš„ã«è¡Œã„ã¾ã—ã‚‡ã†ã€‚';
                }
                basicText.textContent = basicPractice;
                basicEl.style.display = 'block';
            }
            
            // 4. Excellence Rateæ”¹å–„æ³•
            if (excellenceRate < 60) {
                const excellenceEl = document.getElementById('excellence-guidance');
                const excellenceText = document.getElementById('excellence-text');
                
                if (excellenceEl && excellenceText) {
                    excellenceText.textContent = `ç¾åœ¨ã®Excellence Rate ${excellenceRate.toFixed(1)}%ã‚’70%ä»¥ä¸Šã«å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€Â±15ã‚»ãƒ³ãƒˆä»¥å†…ã®ç²¾åº¦ã‚’ç›®æŒ‡ã—ãŸé›†ä¸­ç·´ç¿’ãŒå¿…è¦ã§ã™ã€‚`;
                    excellenceEl.style.display = 'block';
                }
            }
        }
        
        // 12éŸ³åˆ¥æˆç¸¾åˆ†æã®è¡¨ç¤º
        function showToneAnalysis(gradeResult) {
            const analysisEl = document.getElementById('tone-analysis');
            if (!analysisEl) return;
            
            // 12éŸ³åˆ¥æˆç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            const tonePerformance = analyzeTonePerformance(mockSessionsData);
            
            // ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã®ç”Ÿæˆ
            generateToneGrid(tonePerformance);
            
            // å¼±ç‚¹åˆ†æã®ç”Ÿæˆ
            generateWeaknessAnalysis(tonePerformance);
            
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            analysisEl.style.display = 'block';
            
            // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        // ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æ: æœ€å¤§ãƒ»æœ€å°èª¤å·®ã®ç‰¹å®š
        function findExtremeErrors(sessionData) {
            let maxErrorInfo = { error: 0, session: 0, note: '', sessionNote: '' };
            let minErrorInfo = { error: 999, session: 0, note: '', sessionNote: '' };
            
            sessionData.forEach((session, sessionIndex) => {
                const noteResults = generateSessionNoteResults(session);
                noteResults.forEach(note => {
                    const absError = Math.abs(note.centError);
                    
                    // æœ€å¤§èª¤å·®ã®æ›´æ–°
                    if (absError > maxErrorInfo.error) {
                        maxErrorInfo = {
                            error: absError,
                            rawError: note.centError,
                            session: sessionIndex + 1,
                            note: note.noteName,
                            sessionNote: session.baseNote
                        };
                    }
                    
                    // æœ€å°èª¤å·®ã®æ›´æ–°ï¼ˆ0ã§ãªã„å€¤ã®ã¿ï¼‰
                    if (absError < minErrorInfo.error && absError > 0) {
                        minErrorInfo = {
                            error: absError,
                            rawError: note.centError,
                            session: sessionIndex + 1,
                            note: note.noteName,
                            sessionNote: session.baseNote
                        };
                    }
                });
            });
            
            return { maxError: maxErrorInfo, minError: minErrorInfo };
        }
        
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
        function analyzeSessionPerformance(sessionData) {
            const sessionStats = sessionData.map((session, index) => {
                const noteResults = generateSessionNoteResults(session);
                const errors = noteResults.map(note => Math.abs(note.centError));
                const avgError = errors.reduce((sum, err) => sum + err, 0) / errors.length;
                
                return {
                    session: index + 1,
                    baseNote: session.baseNote,
                    avgError: avgError,
                    noteCount: noteResults.length
                };
            });
            
            // æœ€è‰¯ãƒ»æœ€æ‚ªã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç‰¹å®š
            const bestSession = sessionStats.reduce((min, current) => 
                current.avgError < min.avgError ? current : min
            );
            const worstSession = sessionStats.reduce((max, current) => 
                current.avgError > max.avgError ? current : max
            );
            
            return { sessionStats, bestSession, worstSession };
        }
        
        // éŸ³ç¨‹åˆ¥å¼±ç‚¹åˆ†æ
        function analyzeNoteWeaknesses(sessionData) {
            const noteStats = {};
            
            sessionData.forEach(session => {
                const noteResults = generateSessionNoteResults(session);
                noteResults.forEach(note => {
                    if (!noteStats[note.noteName]) {
                        noteStats[note.noteName] = {
                            errors: [],
                            totalError: 0,
                            count: 0
                        };
                    }
                    
                    const absError = Math.abs(note.centError);
                    noteStats[note.noteName].errors.push(absError);
                    noteStats[note.noteName].totalError += absError;
                    noteStats[note.noteName].count++;
                });
            });
            
            // å¹³å‡èª¤å·®ã‚’è¨ˆç®—ã—ã¦ã‚½ãƒ¼ãƒˆ
            const noteRankings = Object.keys(noteStats).map(noteName => ({
                note: noteName,
                avgError: noteStats[noteName].totalError / noteStats[noteName].count,
                count: noteStats[noteName].count
            })).sort((a, b) => b.avgError - a.avgError);
            
            return {
                weakest: noteRankings.slice(0, 3),  // TOP3å¼±ç‚¹
                strongest: noteRankings.slice(-3).reverse()  // TOP3å¾—æ„
            };
        }
        
        // è©³ç´°åˆ†æãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰
        function generateDetailedAnalysis(gradeResult, mode) {
            // å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹
            if (!gradeResult || !gradeResult.metrics || !gradeResult.metrics.raw) {
                return "ãƒ‡ãƒ¼ã‚¿åˆ†æä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚";
            }
            
            const metrics = gradeResult.metrics;
            const avgError = Math.abs(metrics.raw.avgError || 0);
            const excellenceRate = metrics.raw.excellenceRate || 0;
            
            // Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æã‚’æœ‰åŠ¹åŒ–
            const extremeErrors = findExtremeErrors(mockSessionsData);
            
            // Phase 2ä»¥é™ã¯æ®µéšçš„ã«è¿½åŠ äºˆå®š
            // const sessionPerf = analyzeSessionPerformance(mockSessionsData);
            // const noteWeaknesses = analyzeNoteWeaknesses(mockSessionsData);
            // const timeSeriesAnalysis = analyzeTimeSeriesPerformance(mockSessionsData);
            // const relativePitchPatterns = analyzeRelativePitchPatterns(mockSessionsData);
            
            // åŸºæœ¬çš„ãªåˆ†æã®ã¿ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰
            const analysisComponents = [];
            
            // 1. å¹³å‡èª¤å·®ã®åˆ†æ
            if (avgError <= 10) {
                analysisComponents.push("å¹³å‡èª¤å·®Â±" + avgError.toFixed(1) + "Â¢ã¯æ¥µã‚ã¦å„ªç§€ã§ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ¬ãƒ™ãƒ«ã®ç²¾åº¦ã§ã™");
            } else if (avgError <= 20) {
                analysisComponents.push("å¹³å‡èª¤å·®Â±" + avgError.toFixed(1) + "Â¢ã¯å®‰å®šã—ãŸè‰¯å¥½ãªæˆç¸¾ã§ã€éŸ³ç¨‹æ„Ÿè¦šãŒå®šç€ã—ã¦ã„ã¾ã™");
            } else if (avgError <= 30) {
                analysisComponents.push("å¹³å‡èª¤å·®Â±" + avgError.toFixed(1) + "Â¢ã¯æ¨™æº–çš„ãªæˆç¸¾ã§ã™ãŒã€ã•ã‚‰ãªã‚‹ç²¾åº¦å‘ä¸Šã®ä½™åœ°ãŒã‚ã‚Šã¾ã™");
            } else {
                analysisComponents.push("å¹³å‡èª¤å·®Â±" + avgError.toFixed(1) + "Â¢ã¯æ”¹å–„ãŒå¿…è¦ã§ã€åŸºæœ¬çš„ãªéŸ³ç¨‹æ„Ÿè¦šã®å®šç€ã«é›†ä¸­ã—ã¾ã—ã‚‡ã†");
            }
            
            // 2. ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æã«ã‚ˆã‚‹å…·ä½“çš„å•é¡Œç‰¹å®š
            if (extremeErrors && extremeErrors.maxError && extremeErrors.maxError.error > 0) {
                const maxErrInfo = extremeErrors.maxError;
                const maxErrSign = maxErrInfo.rawError > 0 ? '+' : '';
                analysisComponents.push(`æœ€å¤§èª¤å·®${maxErrSign}${maxErrInfo.rawError.toFixed(1)}Â¢ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³${maxErrInfo.session}ã®${maxErrInfo.note}éŸ³ã§ç™ºç”Ÿã—ã¦ãŠã‚Šã€ã“ã®éŸ³ç¨‹ã®é›†ä¸­ç·´ç¿’ãŒåŠ¹æœçš„ã§ã™`);
            }
            
            // 3. æœ€é«˜ç²¾åº¦ã®æˆåŠŸä½“é¨“ç‰¹å®š
            if (extremeErrors && extremeErrors.minError && extremeErrors.minError.error < 10) {
                const minErrInfo = extremeErrors.minError;
                const minErrSign = minErrInfo.rawError > 0 ? '+' : '';
                analysisComponents.push(`æœ€é«˜ç²¾åº¦${minErrSign}${minErrInfo.rawError.toFixed(1)}Â¢ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³${minErrInfo.session}ã®${minErrInfo.note}éŸ³ã§é”æˆã—ã¦ãŠã‚Šã€ã“ã®ç²¾åº¦ã®å†ç¾æ€§å‘ä¸ŠãŒéµã¨ãªã‚Šã¾ã™`);
            }
            
            // 4. Excellence Rateåˆ†æ
            if (excellenceRate >= 80) {
                analysisComponents.push("Excellence Rate " + excellenceRate.toFixed(1) + "%ã¯å„ªç§€ã§ã€Â±20Â¢ä»¥å†…ã®é«˜ç²¾åº¦ãªç™ºå£°ãŒå®‰å®šã—ã¦ã„ã¾ã™");
            } else if (excellenceRate >= 60) {
                analysisComponents.push("Excellence Rate " + excellenceRate.toFixed(1) + "%ã¯è‰¯å¥½ã§ã™ãŒã€ã‚ˆã‚Šå¤šãã®éŸ³ç¨‹ã§é«˜ç²¾åº¦ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†");
            } else {
                analysisComponents.push("Excellence Rate " + excellenceRate.toFixed(1) + "%ã¯æ”¹å–„ãŒå¿…è¦ã§ã€åŸºæœ¬çš„ãªéŸ³ç¨‹ã®å®‰å®šåŒ–ãŒé‡è¦ã§ã™");
            }
            
            // ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®ç‰¹åŒ–åˆ†æ
            if (mode === 8) {
                analysisComponents.push("ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰ã§ã¯è‡ªç„¶ãªéŸ³éšï¼ˆãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ï¼‰ã®å®šç€åº¦ãŒé‡è¦ã§ã™");
            } else if (mode === 12) {
                analysisComponents.push("é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã§ã¯åŠéŸ³ã‚’å«ã‚€12éŸ³ã¸ã®é©å¿œåŠ›ãŒè©¦ã•ã‚Œã¦ã„ã¾ã™");
            } else if (mode === 24) {
                analysisComponents.push("12éŸ³éšãƒ¢ãƒ¼ãƒ‰ã§ã¯å®Œç’§ãª12éŸ³å¾‹ã‚·ã‚¹ãƒ†ãƒ ã®ç¿’å¾—ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™");
            }
            
            return analysisComponents.join("ã€‚") + "ã€‚";
        }
        
        // ç·´ç¿’æŒ‡å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰
        function generatePracticeGuidance(gradeResult, mode) {
            // å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹
            if (!gradeResult || !gradeResult.metrics || !gradeResult.metrics.raw) {
                return "ç·´ç¿’æŒ‡å°ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ä¸­ã§ã™ã€‚";
            }
            
            const metrics = gradeResult.metrics;
            const avgError = Math.abs(metrics.raw.avgError || 0);
            const excellenceRate = metrics.raw.excellenceRate || 0;
            
            // Phase 1: ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆåˆ†æãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨
            const extremeErrors = findExtremeErrors(mockSessionsData);
            
            const guidance = [];
            
            // 1. æœ€å„ªå…ˆæ”¹å–„ãƒã‚¤ãƒ³ãƒˆï¼ˆæœ€å¤§èª¤å·®ã®ç‰¹å®šç·´ç¿’ï¼‰
            if (extremeErrors && extremeErrors.maxError && extremeErrors.maxError.error > 30) {
                const maxErrInfo = extremeErrors.maxError;
                guidance.push(`æœ€å„ªå…ˆèª²é¡Œ: ${maxErrInfo.note}éŸ³ã§${Math.abs(maxErrInfo.rawError).toFixed(1)}Â¢ã®å¤§ããªèª¤å·®ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®éŸ³ç¨‹ã‚’é‡ç‚¹çš„ã«ç·´ç¿’ã—ã¦ãã ã•ã„ã€‚åŸºéŸ³${maxErrInfo.sessionNote}ã‹ã‚‰${maxErrInfo.note}éŸ³ã¸ã®éŸ³ç¨‹é–¢ä¿‚ã‚’æ¥½å™¨ã§ç¢ºèªã—ãªãŒã‚‰åå¾©ç·´ç¿’ãŒåŠ¹æœçš„ã§ã™`);
            }
            
            // ç²¾åº¦ãƒ¬ãƒ™ãƒ«åˆ¥ã®åŸºæœ¬ç·´ç¿’æ³•
            if (avgError > 30) {
                guidance.push("åŸºæœ¬ç·´ç¿’: æ¥½å™¨ã¨ä¸€ç·’ã«æ­Œã£ã¦éŸ³ç¨‹ã‚’è€³ã§ç¢ºèªã™ã‚‹ç·´ç¿’ã‚’æ¯æ—¥10åˆ†è¡Œã„ã¾ã—ã‚‡ã†");
            } else if (avgError > 20) {
                guidance.push("ä¸­ç´šç·´ç¿’: ãƒ”ã‚¢ãƒãªã—ã§æ­Œã£ãŸå¾Œã«æ¥½å™¨ã§ç¢ºèªã™ã‚‹ç·´ç¿’ã§ç‹¬ç«‹æ€§ã‚’é«˜ã‚ã¾ã—ã‚‡ã†");
            } else {
                guidance.push("ä¸Šç´šç·´ç¿’: æ¥½å™¨ãªã—ã§ã®éŸ³ç¨‹è¨˜æ†¶ã¨ç›¸å¯¾éŸ³æ„Ÿã«ã‚ˆã‚‹éŸ³ç¨‹é–¢ä¿‚ã®æ§‹ç¯‰ã‚’é‡ç‚¹çš„ã«");
            }
            
            // Excellence Rateæ”¹å–„æ³•
            if (excellenceRate < 60) {
                guidance.push("å®‰å®šæ€§å¼·åŒ–: åŒã˜éŸ³ç¨‹ã‚’5å›é€£ç¶šã§æ­£ç¢ºã«æ­Œãˆã‚‹ç·´ç¿’ã§ç­‹è‚‰è¨˜æ†¶ã‚’å®šç€ã•ã›ã¦ãã ã•ã„");
            } else if (excellenceRate < 80) {
                guidance.push("ç²¾åº¦å‘ä¸Š: Â±10Â¢ä»¥å†…ã‚’ç›®æ¨™ã¨ã—ãŸé«˜ç²¾åº¦ç·´ç¿’ã§æ›´ãªã‚‹å‘ä¸Šã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†");
            }
            
            // 2. æˆåŠŸä½“é¨“ã®å†ç¾æŒ‡å°
            if (extremeErrors && extremeErrors.minError && extremeErrors.minError.error < 10) {
                const minErrInfo = extremeErrors.minError;
                guidance.push(`æˆåŠŸå†ç¾: ã‚»ãƒƒã‚·ãƒ§ãƒ³${minErrInfo.session}ã®${minErrInfo.note}éŸ³ã§é”æˆã—ãŸÂ±${minErrInfo.error.toFixed(1)}Â¢ã®é«˜ç²¾åº¦ã‚’ä»–ã®éŸ³ç¨‹ã§ã‚‚å†ç¾ã§ãã‚‹ã‚ˆã†ã€ãã®æ™‚ã®ç™ºå£°æ„Ÿè¦šã‚’æ„è­˜çš„ã«è¨˜æ†¶ã—ã¦å¿œç”¨ç·´ç¿’ã‚’è¡Œã„ã¾ã—ã‚‡ã†`);
            }
            
            // ãƒ¢ãƒ¼ãƒ‰ç‰¹åŒ–ç·´ç¿’æ³•
            if (mode === 8) {
                guidance.push("æ¨å¥¨ç·´ç¿’: ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã®åŸºæœ¬éŸ³éšã‚’æ¥½å™¨ã¨åˆã‚ã›ã¦æ­Œã†ç·´ç¿’ã‚’é‡ç‚¹çš„ã«");
            } else if (mode === 12) {
                guidance.push("æ¨å¥¨ç·´ç¿’: åŠéŸ³éšï¼ˆã‚¯ãƒ­ãƒãƒãƒƒã‚¯ï¼‰ç·´ç¿’ã§#â™­éŸ³ç¨‹ã¸ã®é©å¿œåŠ›ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†");
            } else if (mode === 24) {
                guidance.push("æ¨å¥¨ç·´ç¿’: 12éŸ³å¾‹ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ç¿’å¾—ã¨é•·æœŸè¨˜æ†¶ã®å®šç€ã‚’ç›®æŒ‡ã—ãŸé›†ä¸­ç·´ç¿’");
            }
            
            return guidance.join("ã€‚") + "ã€‚";
        }

        // æ™‚ç³»åˆ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
        function analyzeTimeSeriesPerformance(sessionData) {
            const sessionMetrics = sessionData.map((session, index) => {
                const noteResults = generateSessionNoteResults(session);
                const errors = noteResults.map(note => Math.abs(note.centError));
                const avgError = errors.reduce((sum, err) => sum + err, 0) / errors.length;
                const excellentCount = errors.filter(err => err <= 20).length;
                const excellenceRate = excellentCount / errors.length;
                
                return {
                    session: index + 1,
                    avgError: avgError,
                    excellenceRate: excellenceRate,
                    baseNote: session.baseNote
                };
            });
            
            // é€²æ­©å‚¾å‘ã®åˆ†æ
            const earlyAvg = sessionMetrics.slice(0, Math.ceil(sessionMetrics.length / 2))
                .reduce((sum, s) => sum + s.avgError, 0) / Math.ceil(sessionMetrics.length / 2);
            const lateAvg = sessionMetrics.slice(Math.floor(sessionMetrics.length / 2))
                .reduce((sum, s) => sum + s.avgError, 0) / Math.floor(sessionMetrics.length / 2);
            
            const improvementTrend = earlyAvg - lateAvg;  // æ­£ã®å€¤ã¯æ”¹å–„
            
            // ç–²åŠ´åŠ¹æœã®æ¤œå‡ºï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã®ç²¾åº¦ä½ä¸‹ï¼‰
            const fatiguePattern = sessionData.map((session, sessionIndex) => {
                const noteResults = generateSessionNoteResults(session);
                const firstHalf = noteResults.slice(0, Math.ceil(noteResults.length / 2));
                const secondHalf = noteResults.slice(Math.floor(noteResults.length / 2));
                
                const firstHalfAvg = firstHalf.reduce((sum, note) => sum + Math.abs(note.centError), 0) / firstHalf.length;
                const secondHalfAvg = secondHalf.reduce((sum, note) => sum + Math.abs(note.centError), 0) / secondHalf.length;
                
                return {
                    session: sessionIndex + 1,
                    fatigueEffect: secondHalfAvg - firstHalfAvg  // æ­£ã®å€¤ã¯ç–²åŠ´
                };
            });
            
            const avgFatigueEffect = fatiguePattern.reduce((sum, f) => sum + f.fatigueEffect, 0) / fatiguePattern.length;
            
            return {
                sessionMetrics,
                improvementTrend,
                avgFatigueEffect,
                earlyAvg,
                lateAvg
            };
        }
        
        // ç›¸å¯¾éŸ³æ„Ÿãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
        function analyzeRelativePitchPatterns(sessionData) {
            const intervalAnalysis = {};
            const noteToSemitone = {
                'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5,
                'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
            };
            
            sessionData.forEach(session => {
                const baseNoteName = session.baseNote.replace(/[0-9]/g, '');
                const baseSemitone = noteToSemitone[baseNoteName];
                const noteResults = generateSessionNoteResults(session);
                
                noteResults.forEach(note => {
                    const targetNoteName = note.noteName.replace(/[0-9]/g, '');
                    const targetSemitone = noteToSemitone[targetNoteName];
                    
                    // éŸ³ç¨‹é–“éš”ã‚’è¨ˆç®—ï¼ˆ0-11åŠéŸ³ï¼‰
                    let interval = (targetSemitone - baseSemitone + 12) % 12;
                    
                    if (!intervalAnalysis[interval]) {
                        intervalAnalysis[interval] = {
                            semitones: interval,
                            intervalName: getIntervalName(interval),
                            errors: [],
                            avgError: 0,
                            count: 0
                        };
                    }
                    
                    intervalAnalysis[interval].errors.push(Math.abs(note.centError));
                    intervalAnalysis[interval].count++;
                });
            });
            
            // å„éŸ³ç¨‹é–“éš”ã®å¹³å‡èª¤å·®ã‚’è¨ˆç®—
            Object.keys(intervalAnalysis).forEach(interval => {
                const data = intervalAnalysis[interval];
                data.avgError = data.errors.reduce((sum, err) => sum + err, 0) / data.errors.length;
            });
            
            // å›°é›£ãªéŸ³ç¨‹é–“éš”ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            const intervalRanking = Object.values(intervalAnalysis)
                .sort((a, b) => b.avgError - a.avgError);
            
            return {
                intervalAnalysis,
                mostDifficult: intervalRanking.slice(0, 3),
                easiest: intervalRanking.slice(-3).reverse()
            };
        }
        
        // éŸ³ç¨‹é–“éš”åã®å–å¾—
        function getIntervalName(semitones) {
            const intervalNames = {
                0: 'ãƒ¦ãƒ‹ã‚¾ãƒ³',
                1: 'çŸ­2åº¦',
                2: 'é•·2åº¦', 
                3: 'çŸ­3åº¦',
                4: 'é•·3åº¦',
                5: 'å®Œå…¨4åº¦',
                6: 'å¢—4åº¦/æ¸›5åº¦',
                7: 'å®Œå…¨5åº¦',
                8: 'çŸ­6åº¦',
                9: 'é•·6åº¦',
                10: 'çŸ­7åº¦',
                11: 'é•·7åº¦'
            };
            return intervalNames[semitones] || 'ä¸æ˜';
        }

        // 12éŸ³åˆ¥æˆç¸¾ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ
        function analyzeTonePerformance(sessionData) {
            const toneData = {};
            const toneNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            
            // åˆæœŸåŒ–
            toneNames.forEach(tone => {
                toneData[tone] = {
                    sessions: 0,
                    totalError: 0,
                    avgError: 0,
                    excellentNotes: 0,
                    totalNotes: 0,
                    excellenceRate: 0,
                    performance: 'unknown'
                };
            });
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å„åŸºéŸ³ã®æˆç¸¾ã‚’è¨ˆç®—
            sessionData.forEach(session => {
                const baseTone = session.baseNote.replace(/[0-9]/g, ''); // C4 â†’ C
                if (toneData[baseTone]) {
                    const noteResults = generateSessionNoteResults(session);
                    
                    toneData[baseTone].sessions++;
                    
                    noteResults.forEach(note => {
                        const absError = Math.abs(note.centError);
                        toneData[baseTone].totalError += absError;
                        toneData[baseTone].totalNotes++;
                        
                        if (absError <= 20) {
                            toneData[baseTone].excellentNotes++;
                        }
                    });
                }
            });
            
            // å¹³å‡å€¤ã¨è©•ä¾¡ã‚’è¨ˆç®—
            Object.keys(toneData).forEach(tone => {
                const data = toneData[tone];
                if (data.totalNotes > 0) {
                    data.avgError = data.totalError / data.totalNotes;
                    data.excellenceRate = data.excellentNotes / data.totalNotes;
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
                    if (data.avgError <= 25 && data.excellenceRate >= 0.7) {
                        data.performance = 'excellent';
                    } else if (data.avgError <= 40 && data.excellenceRate >= 0.5) {
                        data.performance = 'good';
                    } else if (data.avgError <= 60) {
                        data.performance = 'average';
                    } else {
                        data.performance = 'weak';
                    }
                } else {
                    data.performance = 'untested';
                }
            });
            
            return toneData;
        }
        
        // 12éŸ³ã‚°ãƒªãƒƒãƒ‰ã®ç”Ÿæˆ
        function generateToneGrid(toneData) {
            const gridEl = document.getElementById('tone-performance-grid');
            if (!gridEl) return;
            
            const toneNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            
            gridEl.innerHTML = '';
            
            toneNames.forEach(tone => {
                const data = toneData[tone];
                const { color, icon, label } = getTonePerformanceStyle(data.performance);
                
                const toneCard = document.createElement('div');
                toneCard.style.cssText = `
                    padding: 0.75rem;
                    background: ${color.bg};
                    border: 1px solid ${color.border};
                    border-radius: 8px;
                    text-align: center;
                `;
                
                toneCard.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <i data-lucide="${icon}" style="width: 16px; height: 16px; color: ${color.text};"></i>
                        <span style="font-weight: 600; color: white; font-size: 0.875rem;">${tone}</span>
                    </div>
                    <div style="color: ${color.text}; font-size: 0.75rem; margin-bottom: 0.25rem;">${label}</div>
                    ${data.sessions > 0 ? `
                        <div style="color: #94a3b8; font-size: 0.7rem;">
                            Â±${Math.round(data.avgError)}Â¢ | ${Math.round(data.excellenceRate * 100)}%
                        </div>
                    ` : `
                        <div style="color: #64748b; font-size: 0.7rem;">æœªãƒ†ã‚¹ãƒˆ</div>
                    `}
                `;
                
                gridEl.appendChild(toneCard);
            });
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã®å–å¾—
        function getTonePerformanceStyle(performance) {
            const styles = {
                excellent: {
                    color: { bg: 'rgba(34, 197, 94, 0.15)', border: 'rgba(34, 197, 94, 0.3)', text: '#22c55e' },
                    icon: 'check-circle',
                    label: 'å„ªç§€'
                },
                good: {
                    color: { bg: 'rgba(59, 130, 246, 0.15)', border: 'rgba(59, 130, 246, 0.3)', text: '#3b82f6' },
                    icon: 'thumbs-up',
                    label: 'è‰¯å¥½'
                },
                average: {
                    color: { bg: 'rgba(251, 191, 36, 0.15)', border: 'rgba(251, 191, 36, 0.3)', text: '#fbbf24' },
                    icon: 'minus',
                    label: 'æ¨™æº–'
                },
                weak: {
                    color: { bg: 'rgba(239, 68, 68, 0.15)', border: 'rgba(239, 68, 68, 0.3)', text: '#ef4444' },
                    icon: 'alert-circle',
                    label: 'è¦æ”¹å–„'
                },
                untested: {
                    color: { bg: 'rgba(100, 116, 139, 0.15)', border: 'rgba(100, 116, 139, 0.3)', text: '#64748b' },
                    icon: 'help-circle',
                    label: 'æœªãƒ†ã‚¹ãƒˆ'
                }
            };
            
            return styles[performance] || styles.untested;
        }
        
        // å¼±ç‚¹åˆ†æã®ç”Ÿæˆ
        function generateWeaknessAnalysis(toneData) {
            const weaknessEl = document.getElementById('weakness-details');
            if (!weaknessEl) return;
            
            // å¼±ç‚¹åŸºéŸ³ã®ç‰¹å®šï¼ˆè¦æ”¹å–„ãƒ»æœªãƒ†ã‚¹ãƒˆé™¤ãï¼‰
            const weakTones = Object.entries(toneData)
                .filter(([tone, data]) => data.performance === 'weak' && data.sessions > 0)
                .sort((a, b) => b[1].avgError - a[1].avgError)
                .slice(0, 3);
            
            // æœªãƒ†ã‚¹ãƒˆåŸºéŸ³ã®ç‰¹å®š
            const untestedTones = Object.entries(toneData)
                .filter(([tone, data]) => data.performance === 'untested')
                .map(([tone]) => tone);
            
            let analysisContent = '';
            
            if (weakTones.length > 0) {
                const toneList = weakTones.map(([tone, data]) => 
                    `<strong>${tone}åŸºéŸ³</strong>ï¼ˆå¹³å‡Â±${Math.round(data.avgError)}Â¢ï¼‰`
                ).join('ã€');
                
                analysisContent += `
                    <p style="margin: 0 0 0.75rem;">
                        <strong>ç·´ç¿’æ¨å¥¨åŸºéŸ³:</strong> ${toneList}
                    </p>
                    <p style="margin: 0 0 0.75rem;">
                        ã“ã‚Œã‚‰ã®åŸºéŸ³ã§ã®é›†ä¸­ç·´ç¿’ã‚’é€±2-3å›è¡Œã†ã“ã¨ã§ã€å…¨ä½“çš„ãªç²¾åº¦å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚
                    </p>
                `;
            }
            
            if (untestedTones.length > 0) {
                const untestedList = untestedTones.join('ã€');
                analysisContent += `
                    <p style="margin: 0;">
                        <strong>æœªãƒ†ã‚¹ãƒˆåŸºéŸ³:</strong> ${untestedList}<br>
                        12éŸ³å¾‹ã‚·ã‚¹ãƒ†ãƒ ã®å®Œæˆã®ãŸã‚ã€ã“ã‚Œã‚‰ã®åŸºéŸ³ã§ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚‚é‡è¦ã§ã™ã€‚
                    </p>
                `;
            }
            
            if (weakTones.length === 0 && untestedTones.length === 0) {
                analysisContent = `
                    <p style="margin: 0; color: #22c55e;">
                        ğŸ‰ å…¨ã¦ã®åŸºéŸ³ã§è‰¯å¥½ãªæˆç¸¾ã§ã™ï¼12éŸ³å¾‹ã‚·ã‚¹ãƒ†ãƒ ãŒé †èª¿ã«ç™ºé”ã—ã¦ã„ã¾ã™ã€‚
                    </p>
                `;
            }
            
            weaknessEl.innerHTML = analysisContent;
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
        function navigateToSession(direction) {
            const totalSessions = mockSessionsData.length;
            
            if (direction === 'prev') {
                selectedSessionForAnalysis = selectedSessionForAnalysis > 1 
                    ? selectedSessionForAnalysis - 1 
                    : totalSessions; // æœ€åˆã‹ã‚‰æœ€å¾Œã¸ãƒ«ãƒ¼ãƒ—
            } else if (direction === 'next') {
                selectedSessionForAnalysis = selectedSessionForAnalysis < totalSessions 
                    ? selectedSessionForAnalysis + 1 
                    : 1; // æœ€å¾Œã‹ã‚‰æœ€åˆã¸ãƒ«ãƒ¼ãƒ—
            }
            
            updateSelectedSession();
            initializeSessionsGrid(); // ã‚°ãƒªãƒƒãƒ‰ã®é¸æŠçŠ¶æ…‹ã‚‚æ›´æ–°
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ãƒ©ã‚°ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®é‡è¤‡ç™»éŒ²ã‚’é˜²ã
        let navigationEventListenersAdded = false;
        
        // ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºç›£è¦–
        function observeChartsSection() {
            // èª¤å·®æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç›´æ¥ç›£è¦–
            const errorTrendContainer = document.getElementById('error-trend-container');
            
            // è©•ä¾¡åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆã®è¦ªè¦ç´ ã‚’ç›´æ¥ç›£è¦–
            const accuracyChart = document.getElementById('accuracy-chart');
            const accuracyContainer = accuracyChart ? accuracyChart.parentElement : null;
            
            console.log('ğŸ“Š Charts setup:', {
                errorTrendContainer: !!errorTrendContainer,
                accuracyContainer: !!accuracyContainer,
                errorTrendAnimated: errorTrendChartAnimated,
                accuracyAnimated: accuracyChartAnimated
            });
            
            if (!errorTrendContainer && !accuracyContainer) {
                // ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å³åº§ã«ãƒãƒ£ãƒ¼ãƒˆã‚’åˆæœŸåŒ–
                console.log('âš ï¸ No chart containers found, initializing immediately');
                initializeErrorTrendChart();
                initializeAccuracyChart();
                return;
            }
            
            // æ—¢å­˜ã®ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if (errorTrendObserver) {
                errorTrendObserver.disconnect();
                errorTrendObserver = null;
            }
            if (accuracyObserver) {
                accuracyObserver.disconnect();
                accuracyObserver = null;
            }
            
            // èª¤å·®æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆç”¨ã®ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ï¼ˆã¾ã ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã§ãªã„å ´åˆã®ã¿ï¼‰
            if (errorTrendContainer && !errorTrendChartAnimated) {
                errorTrendObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !errorTrendChartAnimated) {
                            console.log('ğŸ¯ Error trend chart visible, initializing...');
                            initializeErrorTrendChart();
                            errorTrendObserver.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.2,
                    rootMargin: '0px 0px -10% 0px'
                });
                
                errorTrendObserver.observe(errorTrendContainer);
            }
            
            // è©•ä¾¡åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆç”¨ã®ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ï¼ˆã¾ã ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã§ãªã„å ´åˆã®ã¿ï¼‰
            if (accuracyContainer && !accuracyChartAnimated) {
                accuracyObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !accuracyChartAnimated) {
                            console.log('ğŸ“ˆ Accuracy chart visible, initializing...');
                            initializeAccuracyChart();
                            accuracyObserver.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.2,
                    rootMargin: '0px 0px -10% 0px'
                });
                
                accuracyObserver.observe(accuracyContainer);
            }
        }

        // Initialize page
        function initializePage() {
            initializeOverallStats();
            initializeSessionsGrid();
            updateSelectedSession();
            
            // ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºç›£è¦–ã‚’é–‹å§‹
            observeChartsSection();
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆå¾Œã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
            setTimeout(() => {
                initializeLucideIcons();
            }, 100);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯åˆå›ã®ã¿è¨­å®š
            if (!navigationEventListenersAdded) {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                const prevBtn = document.getElementById('prev-session-btn');
                const nextBtn = document.getElementById('next-session-btn');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => navigateToSession('prev'));
                }
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => navigateToSession('next'));
                }
                
                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆå·¦å³çŸ¢å°ã‚­ãƒ¼ï¼‰
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        navigateToSession('prev');
                    } else if (e.key === 'ArrowRight') {
                        navigateToSession('next');
                    }
                });
                
                navigationEventListenersAdded = true;
            }
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å†æç”»å¯¾å¿œ
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                // ãƒªã‚µã‚¤ã‚ºæ™‚ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¿æŒã—ã¦å†åˆæœŸåŒ–
                console.log('ğŸ”„ Resize detected, reinitializing charts with animation state preserved');
                
                // æ—¢ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã®å ´åˆã¯å¼·åˆ¶çš„ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹ã§å†åˆæœŸåŒ–
                if (errorTrendChartAnimated) {
                    initializeErrorTrendChart();
                }
                if (accuracyChartAnimated) {
                    initializeAccuracyChart();
                }
                
                // ã¾ã ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ãªã„å ´åˆã¯ç›£è¦–ã‚’ç¶™ç¶š
                if (!errorTrendChartAnimated || !accuracyChartAnimated) {
                    observeChartsSection();
                }
            }, 250);
        });

        // Initialize Lucide icons - simple version like final-result.html
        function initializeLucideIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
                console.log('âœ… [RESULTS] Lucide icons initialized');
            } else {
                console.error('âŒ [RESULTS] Lucide library not loaded');
            }
        }
        
        // Helper function to create Lucide icons for standard system
        function lucideIcon(iconName, colorClass = '', size = 24) {
            return `<i data-lucide="${iconName}" class="${colorClass}" style="width: ${size}px; height: ${size}px;"></i>`;
        }
        
        // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
        function animateCountUp(element, targetValue, duration = 1000, isDecimal = false) {
            const startTime = performance.now();
            const startValue = 0;
            
            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°ï¼ˆease-out-cubicï¼‰
                const easedProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = startValue + (targetValue - startValue) * easedProgress;
                
                if (isDecimal) {
                    element.textContent = currentValue.toFixed(1);
                } else {
                    element.textContent = Math.round(currentValue);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    // æœ€çµ‚å€¤ã‚’ç¢ºå®Ÿã«è¨­å®š
                    if (isDecimal) {
                        element.textContent = targetValue.toFixed(1);
                    } else {
                        element.textContent = targetValue;
                    }
                }
            }
            
            requestAnimationFrame(updateValue);
        }
        
        // çµ±è¨ˆæƒ…å ±ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animateStatistics() {
            // Overall Statisticsã®æ•°å€¤ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                const statElements = document.querySelectorAll('#overall-stats .stat-value');
                console.log('Found stat elements:', statElements.length);
                
                statElements.forEach((element, index) => {
                    const dataValue = element.getAttribute('data-value');
                    const value = parseFloat(dataValue);
                    console.log(`Element ${index}: data-value="${dataValue}", value=${value}`);
                    
                    if (!isNaN(value)) {
                        const isDecimal = dataValue.includes('.');
                        const hasPrefix = element.textContent.includes('Â±') || element.textContent.includes('+') || element.textContent.includes('-');
                        const actualValue = parseFloat(dataValue);
                        let prefix = '';
                        
                        // æœ€å¤§èª¤å·®ã®å ´åˆã¯ç¬¦å·ã‚’åˆ¤å®š
                        if (element.parentElement.textContent.includes('æœ€å¤§èª¤å·®')) {
                            prefix = actualValue >= 0 ? '+' : '';
                        } else if (element.textContent.includes('Â±')) {
                            prefix = 'Â±';
                        }
                        
                        // ä¸€æ—¦0ã«è¨­å®š
                        if (prefix) {
                            element.textContent = isDecimal ? prefix + '0.0Â¢' : prefix + '0Â¢';
                        } else {
                            element.textContent = isDecimal ? '0.0' : '0';
                        }
                        
                        setTimeout(() => {
                            animateCountUp({
                                textContent: '',
                                set textContent(val) {
                                    if (element.parentElement.textContent.includes('æœ€å¤§èª¤å·®')) {
                                        // æœ€å¤§èª¤å·®ã¯ç¬¦å·ä»˜ã
                                        const sign = actualValue >= 0 ? '+' : '-';
                                        element.textContent = sign + val + 'Â¢';
                                    } else if (prefix === 'Â±') {
                                        element.textContent = 'Â±' + val + 'Â¢';
                                    } else {
                                        element.textContent = val;
                                    }
                                }
                            }, Math.abs(value), 1200, isDecimal);
                        }, index * 150);
                    } else if (dataValue && isNaN(value)) {
                        // æ–‡å­—ï¼ˆã‚°ãƒ¬ãƒ¼ãƒ‰ãªã©ï¼‰ã®å ´åˆã¯é…å»¶è¡¨ç¤º
                        element.textContent = '';
                        setTimeout(() => {
                            element.textContent = dataValue;
                        }, index * 150 + 600);
                    }
                });
            }, 100);
            
            // ç·åˆè©•ä¾¡ç‚¹æ•°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆSç´šã®æ¨ªã®æ•°å­—ï¼‰
            const gradeScore = document.querySelector('#overall-grade');
            if (gradeScore && gradeScore.textContent.includes('ç´š')) {
                // ã‚‚ã—ç‚¹æ•°ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                const scoreMatch = gradeScore.textContent.match(/(\d+\.?\d*)/);
                if (scoreMatch) {
                    const score = parseFloat(scoreMatch[1]);
                    const gradeText = gradeScore.textContent.replace(scoreMatch[0], '');
                    gradeScore.textContent = '0' + gradeText;
                    setTimeout(() => {
                        animateCountUp({
                            textContent: '',
                            set textContent(val) {
                                gradeScore.textContent = val + gradeText;
                            }
                        }, score, 1500, true);
                    }, 300);
                }
            }
        }
        
        // Multiple initialization triggers
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ [RESULTS] DOM Content Loaded - starting icon initialization');
            initializeLucideIcons();
            
        });
        
        window.addEventListener('load', function() {
            console.log('ğŸŒ [RESULTS] Window loaded - ensuring icons are initialized');
            initializeLucideIcons();
            
            // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            setTimeout(() => {
                // å†åº¦çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                initializeOverallStats();
                
                
                setTimeout(() => {
                    updateGradeDisplay();   // å‹•çš„ã‚°ãƒ¬ãƒ¼ãƒ‰è¨ˆç®—ã‚’å®Ÿè¡Œ
                    animateStatistics();
                    updateShareMessage();  // ã‚·ã‚§ã‚¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚æ›´æ–°
                    animateRankSection();  // ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    
                    // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºï¼ˆé–‹ç™ºæ™‚ã¾ãŸã¯GitHub Pagesï¼‰
                    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    const isGitHubPages = window.location.hostname.includes('github.io');
                    
                    if (testMode || isLocalhost || isGitHubPages) {
                        const testLinks = document.getElementById('test-mode-links');
                        if (testLinks) {
                            testLinks.style.display = 'block';
                        }
                    }
                }, 100);
            }, 1200);
        });

        // SNSã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function getShareText() {
            const gradeElement = document.querySelector('#overall-stats > div:first-child .text-4xl');
            const grade = gradeElement ? gradeElement.textContent : 'B';
            const errorElement = document.querySelector('#overall-stats > div:nth-child(2) .text-4xl');
            const error = errorElement ? errorElement.textContent : 'Â±19.8';
            const sessionsElement = document.querySelector('#overall-stats > div:nth-child(4) .text-4xl');
            const sessions = sessionsElement ? sessionsElement.textContent : '12';
            
            return `ğŸµ 8vaç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã€${grade}ç´šã€‘ç²å¾—ï¼\nå¹³å‡èª¤å·®: ${error}ã‚»ãƒ³ãƒˆ\n${sessions}ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œèµ°ã—ã¾ã—ãŸï¼\n\n#ç›¸å¯¾éŸ³æ„Ÿ #éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° #8va`;
        }
        
        function updateShareMessage() {
            const gradeElement = document.querySelector('#overall-stats > div:first-child .text-4xl');
            const grade = gradeElement ? gradeElement.textContent : 'B';
            const messageElement = document.getElementById('share-message');
            
            if (messageElement) {
                let message = '';
                switch(grade) {
                    case 'S':
                        message = 'Sç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒã‚¹ã‚¿ãƒ¼ï¼';
                        break;
                    case 'A':
                        message = 'Aç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ã‚¨ã‚¯ã‚»ãƒ¬ãƒ³ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼';
                        break;
                    case 'B':
                        message = 'Bç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ã‚°ãƒƒãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼';
                        break;
                    case 'C':
                        message = 'Cç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ç·´ç¿’ã®æˆæœãŒå‡ºã¦ã„ã¾ã™ï¼';
                        break;
                    case 'D':
                        message = 'Dç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ã‚‚ã†å°‘ã—ã§ä¸Šé”ã—ã¾ã™ï¼';
                        break;
                    default:
                        message = `${grade}ç´šãƒ©ãƒ³ã‚¯å–å¾—ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼`;
                }
                messageElement.textContent = message;
            }
        }
        
        function shareToTwitter(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank', 'width=550,height=450');
        }
        
        function shareToLine(event) {
            event.preventDefault();
            const text = encodeURIComponent(getShareText() + '\n' + window.location.href);
            window.open(`https://social-plugins.line.me/lineit/share?text=${text}`, '_blank', 'width=550,height=450');
        }
        
        function shareToFacebook(event) {
            event.preventDefault();
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=550,height=450');
        }
        
        function copyShareText(event) {
            event.preventDefault();
            const text = getShareText() + '\n' + window.location.href;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸€æ™‚çš„ã«å¤‰æ›´
                    const btn = event.currentTarget;
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    `;
                    btn.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.style.background = '';
                    }, 2000);
                }).catch(err => {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                });
            } else {
                // æ—§å¼ã®ã‚³ãƒ”ãƒ¼æ–¹æ³•
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }
        
        // Rank section animation
        function animateRankSection() {
            const rankCircle = document.querySelector('.rank-circle');
            const gradeValue = document.querySelector('.grade-value');
            const sessionCount = document.querySelector('.session-count');
            const avgError = document.querySelector('.avg-error');
            const maxError = document.querySelector('.max-error');
            
            if (!rankCircle) return;
            
            // ã‚µãƒ¼ã‚¯ãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            rankCircle.style.transform = 'scale(0)';
            rankCircle.style.transition = 'transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            
            setTimeout(() => {
                rankCircle.style.transform = 'scale(1)';
            }, 300);
            
            // çµ±è¨ˆå€¤ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å€¤ã‚’å–å¾—ï¼ˆOverall Statisticsã‹ã‚‰ï¼‰
                const gradeElement = document.querySelector('#overall-stats > div:first-child .text-4xl');
                const grade = gradeElement ? gradeElement.textContent : 'B';
                
                const avgElement = document.querySelector('#overall-stats > div:nth-child(2) .stat-value');
                const avgValue = avgElement ? parseFloat(avgElement.getAttribute('data-value')) : 23.6;
                
                const maxElement = document.querySelector('#overall-stats > div:nth-child(3) .stat-value');
                const maxValue = maxElement ? parseFloat(maxElement.getAttribute('data-value')) : 48.7;
                // maxValueã«ã¯ç¬¦å·ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼ˆæ­£è² ã®å€¤ï¼‰
                
                const sessionsElement = document.querySelector('#overall-stats > div:nth-child(4) .stat-value');
                const sessionsValue = sessionsElement ? parseInt(sessionsElement.getAttribute('data-value')) : 12;
                
                // ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆæœ€åˆã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                if (gradeValue) {
                    animateGradeDisplay(gradeValue, grade);
                }
                
                // å¹³å‡èª¤å·®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚°ãƒ¬ãƒ¼ãƒ‰ã¨åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
                if (avgError) {
                    animateCountUp({
                        textContent: '',
                        set textContent(val) { avgError.textContent = 'Â±' + val + 'Â¢'; }
                    }, avgValue, 1200, true);
                }
                
                // æœ€å¤§èª¤å·®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç¬¦å·ä»˜ãï¼‰
                if (maxError) {
                    setTimeout(() => {
                        const sign = maxValue >= 0 ? '+' : '-';
                        animateCountUp({
                            textContent: '',
                            set textContent(val) { maxError.textContent = sign + val + 'Â¢'; }
                        }, Math.abs(maxValue), 1200, true);
                    }, 150);
                }
                
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                if (sessionCount) {
                    setTimeout(() => {
                        animateCountUp({
                            textContent: '',
                            set textContent(val) { sessionCount.textContent = val; }
                        }, sessionsValue, 1000, false);
                    }, 300);
                }
            }, 800);
        }
        
        // ã‚°ãƒ¬ãƒ¼ãƒ‰å°‚ç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
        function animateGradeDisplay(element, finalGrade) {
            const grades = ['E', 'D', 'C', 'B', 'A', 'S'];
            const finalIndex = grades.indexOf(finalGrade);
            
            if (finalIndex === -1) {
                element.textContent = finalGrade;
                return;
            }
            
            let currentIndex = 0;
            element.textContent = grades[currentIndex];
            
            const gradeInterval = setInterval(() => {
                currentIndex++;
                if (currentIndex <= finalIndex) {
                    element.textContent = grades[currentIndex];
                    
                    if (currentIndex === finalIndex) {
                        clearInterval(gradeInterval);
                        // æœ€çµ‚ã‚°ãƒ¬ãƒ¼ãƒ‰ã«é”ã—ãŸã‚‰å°‘ã—å¼·èª¿
                        element.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            element.style.transform = 'scale(1)';
                        }, 200);
                    }
                } else {
                    clearInterval(gradeInterval);
                }
            }, 100); // 100msã”ã¨ã«ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ä¸Šã’ã‚‹
        }
        
        // Start initialization
        initializePage();
    </script>
</body>
</html>