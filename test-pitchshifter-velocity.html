<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchShifter Velocity Test - ã‚¯ãƒªãƒƒã‚­ãƒ³ã‚°ãƒã‚¤ã‚ºèª¿æŸ»</title>

    <!-- UIã‚«ã‚¿ãƒ­ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="PitchPro-SPA/styles/base.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.0/dist/umd/lucide.js"></script>

    <style>
        /* ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            padding: 2rem;
        }

        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .test-section {
            margin-bottom: 2rem;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-group label {
            display: block;
            color: var(--text-white-90);
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .value-display {
            min-width: 70px;
            text-align: right;
            font-weight: 700;
            color: var(--text-white);
            font-size: 1.2rem;
        }

        .info-box {
            background: rgba(33, 150, 243, 0.15);
            border-left: 4px solid #2196f3;
            padding: 1rem 1.25rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-white-90);
            line-height: 1.6;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.5);
            color: var(--text-white-80);
            padding: 1rem;
            border-radius: var(--radius-lg);
            max-height: 350px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 0.5rem;
        }

        .log-entry.success { color: #10b981; }
        .log-entry.warning { color: #f59e0b; }
        .log-entry.error { color: #ef4444; }
        .log-entry.info { color: #3b82f6; }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 640px) {
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header style="text-align: center; margin-bottom: 3rem;">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ¹ PitchShifter Velocity Test</h1>
            <p class="text-white-70 text-lg">ã‚¯ãƒªãƒƒã‚­ãƒ³ã‚°ãƒã‚¤ã‚ºèª¿æŸ» - Velocityå€¤ã®æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ</p>
        </header>

        <div class="info-box">
            <i data-lucide="info" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
            <strong>ä½¿ã„æ–¹:</strong> ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§velocityå€¤ã‚’èª¿æ•´ã—ã€ã€ŒC4ã‚’å†ç”Ÿã€ãƒœã‚¿ãƒ³ã‚’é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¯ãƒªãƒƒã‚­ãƒ³ã‚°ãƒã‚¤ã‚ºã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        </div>

        <div class="test-section glass-card">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i data-lucide="sliders" class="icon-md" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                Velocityè¨­å®š
            </h2>

            <div class="control-group">
                <label for="velocitySlider">Velocityï¼ˆå©ãå¼·ã•ï¼‰</label>
                <div class="slider-container">
                    <input type="range" id="velocitySlider" min="0.1" max="1.0" step="0.05" value="0.4">
                    <span class="value-display" id="velocityValue">0.40</span>
                </div>
            </div>

            <button id="playBtn" class="btn-primary" style="width: 100%; margin-top: 1rem;">
                <i data-lucide="music" class="icon-sm" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                C4ã‚’å†ç”Ÿ - ã‚µãƒ³ãƒ—ãƒ«éŸ³æºï¼ˆPitchShifterï¼‰
            </button>

            <button id="playSynthBtn" class="btn-secondary" style="width: 100%; margin-top: 0.75rem;">
                <i data-lucide="piano" class="icon-sm" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                C4ã‚’å†ç”Ÿ - å†…è”µã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼ï¼ˆãƒã‚¤ã‚ºãªã—ï¼‰
            </button>
        </div>

        <div class="test-section glass-card">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i data-lucide="bar-chart-3" class="icon-md" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
            </h2>
            <div class="stats">
                <div class="glass-card" style="text-align: center; padding: 1.5rem;">
                    <div class="text-4xl font-bold text-white mb-2" id="clickCount">0</div>
                    <div class="text-white-70 text-sm">ã‚¯ãƒªãƒƒã‚¯å›æ•°</div>
                </div>
                <div class="glass-card" style="text-align: center; padding: 1.5rem;">
                    <div class="text-4xl font-bold text-white mb-2" id="successCount">0</div>
                    <div class="text-white-70 text-sm">å†ç”ŸæˆåŠŸ</div>
                </div>
                <div class="glass-card" style="text-align: center; padding: 1.5rem;">
                    <div class="text-4xl font-bold text-white mb-2" id="currentVelocity">0.40</div>
                    <div class="text-white-70 text-sm">ç¾åœ¨ã®Velocity</div>
                </div>
            </div>
        </div>

        <div class="test-section glass-card">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i data-lucide="file-text" class="icon-md" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                ãƒ­ã‚°
            </h2>
            <button onclick="clearLog()" class="btn-secondary" style="margin-bottom: 1rem;">
                <i data-lucide="trash-2" class="icon-sm" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;"></i>
                ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
            </button>
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <!-- Tone.js Library (Testing latest version 15.3.5) -->
    <script type="importmap">
    {
        "imports": {
            "tone": "https://cdn.jsdelivr.net/npm/tone@15.3.5/+esm"
        }
    }
    </script>

    <!-- PitchShifter Library -->
    <script type="module">
        import { PitchShifter } from './PitchPro-SPA/js/core/reference-tones.js?v=3.2.0&t=1761705186&force=reload';
        import * as Tone from 'tone';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
        window.PitchShifter = PitchShifter;
        window.Tone = Tone;

        console.log('âœ… PitchShifter class loaded:', typeof PitchShifter);
        console.log('âœ… Tone.js loaded:', typeof Tone);

        // çµ±è¨ˆå¤‰æ•°
        let clickCount = 0;
        let successCount = 0;
        let pitchShifter = null;

        // åˆæœŸåŒ–å‡¦ç†ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã§å®Ÿè¡Œ
        async function initPitchShifter() {
            try {
                console.log('ğŸ¹ [INIT] ========== PitchShifteråˆæœŸåŒ–é–‹å§‹ ==========');
                console.log('ğŸ¹ [INIT] PitchShifterã‚¯ãƒ©ã‚¹å‹:', typeof PitchShifter);
                console.log('ğŸ¹ [INIT] Toneã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹:', typeof Tone);

                // ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¯ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ãŸã‚ã€baseUrlã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
                pitchShifter = new PitchShifter({
                    baseUrl: './PitchPro-SPA/audio/piano/'
                });
                console.log('ğŸ¹ [INIT] ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå®Œäº†ï¼ˆbaseUrl: ./PitchPro-SPA/audio/piano/ï¼‰:', pitchShifter);
                console.log('ğŸ¹ [INIT] ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ nullç¢ºèª:', pitchShifter === null);
                console.log('ğŸ¹ [INIT] ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ undefinedç¢ºèª:', pitchShifter === undefined);

                console.log('ğŸ¹ [INIT] initialize()ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ä¸­...');

                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã§åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
                const initTimeout = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('åˆæœŸåŒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30ç§’ï¼‰')), 30000);
                });

                try {
                    await Promise.race([pitchShifter.initialize(), initTimeout]);
                    console.log('âœ… [INIT] initialize()ãƒ¡ã‚½ãƒƒãƒ‰å®Œäº†');
                } catch (timeoutError) {
                    console.error('âŒ [INIT] ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', timeoutError);
                    throw timeoutError;
                }

                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ã—ã¦å¤–éƒ¨ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
                console.log('ğŸ¹ [INIT] ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹å®Ÿè¡Œä¸­...');
                window.pitchShifterInstance = pitchShifter;
                window.pitchShifterReady = true;

                console.log('âœ… [INIT] ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹å®Œäº†');
                console.log('âœ… [INIT] window.pitchShifterInstance:', window.pitchShifterInstance);
                console.log('âœ… [INIT] window.pitchShifterInstanceå‹:', typeof window.pitchShifterInstance);
                console.log('âœ… [INIT] window.pitchShifterReady:', window.pitchShifterReady);
                console.log('âœ… [INIT] ========== åˆæœŸåŒ–å‡¦ç†å®Œäº† ==========');

                // UIãƒ­ã‚°ã«ã‚‚è¡¨ç¤º
                if (typeof addLog === 'function') {
                    addLog('âœ… PitchShifteråˆæœŸåŒ–å®Œäº†ï¼ˆv3.2.0: attack:0.01s + release:0.1s + Tone.js v15.3.5ï¼‰', 'success');
                }
            } catch (error) {
                console.error('âŒ [INIT] ========== PitchShifteråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ ==========');
                console.error('âŒ [INIT] ã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
                console.error('âŒ [INIT] ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:', error.stack);
                window.pitchShifterReady = false;
                window.pitchShifterError = error.message;

                if (typeof addLog === 'function') {
                    addLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
        }

        // åˆæœŸåŒ–å®Ÿè¡Œï¼ˆDOMContentLoadedå¾Œã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ï¼‰
        console.log('ğŸš€ [MODULE] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰å®Œäº† - DOMContentLoadedå¾…æ©Ÿä¸­');

        // ãƒ­ã‚°é–¢æ•°
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        window.clearLog = function() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        };

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            document.getElementById('clickCount').textContent = clickCount;
            document.getElementById('successCount').textContent = successCount;
            const velocity = document.getElementById('velocitySlider').value;
            document.getElementById('currentVelocity').textContent = parseFloat(velocity).toFixed(2);
        }

        // ä¸è¦ãªé–¢æ•°ã‚’å‰Šé™¤ï¼ˆinitPitchShifteré–¢æ•°ã‚’ç›´æ¥ä½¿ç”¨ï¼‰

        // DOMContentLoadedå¾Œã«åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚‚DOMContentLoadedå†…ã«ç§»å‹•
        // ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§DOMè¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨nullã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼‰

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–ï¼ˆé‡è¤‡å‘¼ã³å‡ºã—é˜²æ­¢ï¼‰
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ” [DOM] DOMContentLoadedç™ºç«');

            // Lucideã‚¢ã‚¤ã‚³ãƒ³åˆæœŸåŒ–
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            addLog('=== PitchShifter Velocity Test v3.1.0 (8 Samplers) ===', 'info');
            addLog('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èµ·å‹•', 'info');
            addLog('â„¹ï¸ å†ç”Ÿãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨åˆæœŸåŒ–ãŒé–‹å§‹ã•ã‚Œã¾ã™', 'info');
            updateStats();

            // åˆæœŸåŒ–ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¾Œã«å®Ÿè¡Œ
            console.log('ğŸ” [DOM] DOMContentLoadedå®Œäº† - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­');

            // Velocityã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
            const velocitySlider = document.getElementById('velocitySlider');
            const velocityValue = document.getElementById('velocityValue');

            velocitySlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                velocityValue.textContent = value.toFixed(2);
                updateStats();
                addLog(`Velocityå¤‰æ›´: ${value.toFixed(2)}`, 'info');
            });

            // å†ç”Ÿãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('playBtn').addEventListener('click', async () => {
                console.log('ğŸµ [PLAY] å†ç”Ÿãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');

                // åˆå›ã‚¯ãƒªãƒƒã‚¯æ™‚ã«åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
                if (!window.pitchShifterReady) {
                    console.log('ğŸµ [PLAY] åˆå›ã‚¯ãƒªãƒƒã‚¯ - åˆæœŸåŒ–é–‹å§‹');
                    addLog('ğŸ¹ PitchShifteråˆæœŸåŒ–ä¸­...', 'info');

                    // ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
                    document.getElementById('playBtn').disabled = true;

                    try {
                        await initPitchShifter();
                        console.log('ğŸµ [PLAY] åˆæœŸåŒ–å®Œäº†');
                        addLog('âœ… åˆæœŸåŒ–å®Œäº†ï¼ã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†ç”Ÿã—ã¦ãã ã•ã„', 'success');
                    } catch (error) {
                        console.error('ğŸµ [PLAY] åˆæœŸåŒ–å¤±æ•—:', error);
                        addLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    } finally {
                        // ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹åŒ–
                        document.getElementById('playBtn').disabled = false;
                    }
                    return;
                }

                // 2å›ç›®ä»¥é™ã¯é€šå¸¸ã®å†ç”Ÿå‡¦ç†
                clickCount++;
                updateStats();

                const velocity = parseFloat(velocitySlider.value);

                console.log('ğŸµ [PLAY] window.pitchShifterReady:', window.pitchShifterReady);
                console.log('ğŸµ [PLAY] window.pitchShifterInstance:', typeof window.pitchShifterInstance);

                try {
                    if (!window.pitchShifterInstance) {
                        console.error('ğŸµ [PLAY] ã‚¨ãƒ©ãƒ¼: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒnullã¾ãŸã¯undefined');
                        console.error('ğŸµ [PLAY] window.pitchShifterError:', window.pitchShifterError);
                        throw new Error('PitchShifterãŒã¾ã åˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }

                    console.log('ğŸµ [PLAY] playNoteå‘¼ã³å‡ºã— - velocity:', velocity);
                    addLog(`ğŸµ C4å†ç”Ÿé–‹å§‹ï¼ˆvelocity: ${velocity.toFixed(2)}ï¼‰`, 'info');

                    await window.pitchShifterInstance.playNote('C4', 2, velocity);

                    successCount++;
                    updateStats();
                    addLog(`âœ… å†ç”ŸæˆåŠŸï¼ˆ${successCount}/${clickCount}ï¼‰`, 'success');
                } catch (error) {
                    addLog(`âŒ å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    console.error('ğŸµ [PLAY] å†ç”Ÿã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
                }
            });

            // å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            document.getElementById('playBtn').disabled = false;

            // ========== ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼å†ç”Ÿãƒœã‚¿ãƒ³ ==========
            let synth = null;

            document.getElementById('playSynthBtn').addEventListener('click', async () => {
                console.log('ğŸ¹ [SYNTH] ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼å†ç”Ÿãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');

                // åˆå›ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼ã‚’åˆæœŸåŒ–
                if (!synth) {
                    console.log('ğŸ¹ [SYNTH] ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–ä¸­...');
                    addLog('ğŸ¹ ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–ä¸­...', 'info');

                    try {
                        // AudioContextã‚’èµ·å‹•
                        await Tone.start();
                        console.log('âœ… [SYNTH] AudioContext started');

                        // MonoSynthã‚’ä½œæˆï¼ˆå˜éŸ³å°‚ç”¨ãƒ»å¹²æ¸‰ãªã—ï¼‰
                        synth = new Tone.Synth({
                            oscillator: {
                                type: "triangle"  // ä¸‰è§’æ³¢ã§ãƒ”ã‚¢ãƒã«è¿‘ã„éŸ³è‰²
                            },
                            envelope: {
                                attack: 0.005,    // é€Ÿã„ã‚¢ã‚¿ãƒƒã‚¯ï¼ˆãƒ”ã‚¢ãƒã®æ‰“éµï¼‰
                                decay: 0.1,       // æ¸›è¡°
                                sustain: 0.3,     // ã‚µã‚¹ãƒ†ã‚¤ãƒ³
                                release: 1.0      // è‡ªç„¶ãªãƒªãƒªãƒ¼ã‚¹
                            }
                        }).toDestination();

                        synth.volume.value = -6; // éŸ³é‡èª¿æ•´ï¼ˆPitchShifterã¨åŒã˜ï¼‰

                        console.log('âœ… [SYNTH] ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–å®Œäº†');
                        addLog('âœ… ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–å®Œäº†ï¼', 'success');
                    } catch (error) {
                        console.error('âŒ [SYNTH] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                        addLog(`âŒ ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        return;
                    }
                }

                // çµ±è¨ˆæ›´æ–°
                clickCount++;
                updateStats();

                const velocity = parseFloat(velocitySlider.value);

                try {
                    console.log('ğŸ¹ [SYNTH] C4å†ç”Ÿé–‹å§‹ - velocity:', velocity);
                    addLog(`ğŸ¹ ã‚·ãƒ³ã‚»C4å†ç”Ÿé–‹å§‹ï¼ˆvelocity: ${velocity.toFixed(2)}ï¼‰`, 'info');

                    // ã€é‡è¦ã€‘å‰ã®éŸ³ã‚’å®Œå…¨ã«åœæ­¢ã—ã¦ã‹ã‚‰å†ç”Ÿï¼ˆMonoSynthã¯triggerReleaseã§åœæ­¢ï¼‰
                    try {
                        synth.triggerRelease();
                    } catch (e) {
                        // æœ€åˆã®å†ç”Ÿæ™‚ã¯åœæ­¢ã™ã‚‹éŸ³ãŒãªã„ã®ã§ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–
                    }
                    await new Promise(resolve => setTimeout(resolve, 30)); // 30mså¾…æ©Ÿ

                    // C4ã‚’2ç§’é–“å†ç”Ÿï¼ˆvelocityã‚‚åæ˜ ï¼‰
                    synth.triggerAttackRelease("C4", 2, undefined, velocity);

                    successCount++;
                    updateStats();
                    addLog(`âœ… ã‚·ãƒ³ã‚»å†ç”ŸæˆåŠŸï¼ˆ${successCount}/${clickCount}ï¼‰- MonoSynth`, 'success');
                } catch (error) {
                    addLog(`âŒ ã‚·ãƒ³ã‚»å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    console.error('ğŸ¹ [SYNTH] å†ç”Ÿã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
                }
            });
        });
    </script>
</body>
</html>
