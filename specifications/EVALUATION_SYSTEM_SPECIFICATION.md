# 相対音感トレーニングアプリ - 評価システム仕様書

**バージョン**: 1.1.0  
**作成日**: 2025-08-07  
**更新日**: 2025-01-10  
**用途**: 音程精度評価・採点システムの詳細仕様

**v1.1.0 更新内容**:
- ハイブリッド評価方式の採用（平均スコアと精度割合の組み合わせ）
- 安定性係数による評価の追加
- Lucideアイコン仕様の追加
- S-E級判定基準の厳密化

---

## 🎯 評価システム概要

### 基本原理
相対音感トレーニングにおける評価は、**基音に対する相対的な音程の正確さ**を測定します。
各音階（ドレミファソラシド）における周波数の誤差をセント単位で計測し、その精度に基づいて評価を行います。

### 評価の重要性
- **即時フィードバック**: リアルタイムで自分の音程精度を把握
- **成長の可視化**: 練習による上達を数値とグラフで確認
- **モチベーション維持**: 段階的な評価で達成感を提供
- **弱点の特定**: 苦手な音程を明確化し効率的な練習を促進

---

## 📊 評価基準

### 4段階評価システム

#### 🏆 優秀（Excellent）
- **判定基準**: ±15セント以内
- **説明**: 非常に正確な音程。プロレベルに近い精度
- **スコア**: 100点
- **Lucideアイコン**: `trophy` (トロフィーアイコン)
- **表示色**: ゴールド (#FFD700)
- **アニメーション**: キラキラエフェクト

#### 🎉 良好（Good）
- **判定基準**: ±25セント以内
- **説明**: 良好な精度。実用レベルの音感
- **スコア**: 80点
- **Lucideアイコン**: `star` (星アイコン)
- **表示色**: グリーン (#51cf66)
- **アニメーション**: パルスエフェクト

#### 👍 合格（Pass）
- **判定基準**: ±40セント以内
- **説明**: 合格レベル。基本的な音感は身についている
- **スコア**: 60点
- **Lucideアイコン**: `thumbs-up` (グッドアイコン)
- **表示色**: ブルー (#4c6ef5)
- **アニメーション**: 軽いバウンス

#### 😭 要練習（Need Practice）
- **判定基準**: ±41セント以上
- **説明**: 練習が必要。基礎から丁寧に
- **スコア**: 30点
- **Lucideアイコン**: `triangle-alert` (警告アイコン)
- **表示色**: グレー (#868e96)
- **アニメーション**: 振動エフェクト（励まし）

---

## 🎵 個別音階評価

### 評価プロセス

1. **音程検出**
   ```
   検出周波数 → 目標周波数との比較 → セント誤差計算
   ```

2. **セント誤差の計算式**
   ```
   誤差(セント) = 1200 × log2(検出周波数 / 目標周波数)
   ```

3. **個別採点**
   - 各音階（8音）それぞれに対して評価
   - リアルタイム視覚フィードバック提供

### 視覚的フィードバック

#### リアルタイム表示
```
ド: 🏆 +5¢  (優秀)
レ: 🎉 -20¢ (良好)
ミ: 👍 +35¢ (合格)
ファ: 😭 +45¢ (要練習)
```

#### 精度メーター
```
[========|=======] +5セント
    中心が正確な音程
```

---

## 📈 セッション総合評価（ハイブリッド方式）

### 総合スコア計算

#### ハイブリッド計算方式
```javascript
// Step 1: セッションスコア計算（1セッション8音）
セッションスコア = (個別スコアの合計) / 8音

// Step 2: 精度重視ボーナス計算
高精度ボーナス = Excellence数 × 10点
中精度ボーナス = Good数 × 5点
基礎ボーナス = Pass数 × 2点

// Step 3: 総合スコア計算（複数セッション完了時）
総合スコア = (平均スコア × 0.7) + ((精度ボーナス / 全音数) × 0.3)

// Step 4: 安定性評価
安定性係数 = 1.0 - (標準偏差 / 100)
最終スコア = 総合スコア × 安定性係数

// 計算例：8セッション（64音）の場合
平均スコア: 82.5点
Excellence: 32音、Good: 20音、Pass: 8音、Need Practice: 4音
精度ボーナス = (32×10 + 20×5 + 8×2) / 64 = 6.81
総合スコア = 82.5×0.7 + 6.81×0.3 = 59.79点
標準偏差: 15.2
安定性係数 = 1.0 - (15.2/100) = 0.848
最終スコア = 59.79 × 0.848 = 50.70点
```

### 総合評価ランク（S-E級）

| ランク | 平均誤差 | Excellence割合 | 安定性 | Lucideアイコン | 表示色 | メッセージ |
|--------|----------|--------------|--------|---------------|--------|------------|
| **S級** | ±8¢以内 | 85%以上 | ±5¢以内 | `crown` | ゴールド | プロレベル！レコーディング品質の精度です |
| **A級** | ±12¢以内 | 70%以上 | ±8¢以内 | `medal` | グレー | 素晴らしい！楽器アンサンブルに対応できます |
| **B級** | ±18¢以内 | 50%以上 | ±12¢以内 | `circle-star` | オレンジ | 実用レベル！合唱や弾き語りに最適です |
| **C級** | ±25¢以内 | 30%以上 | - | `smile` | グリーン | 基礎習得！カラオケや趣味演奏を楽しめます |
| **D級** | ±35¢以内 | - | - | `meh` | ブルー | 練習中！基礎をしっかり身につけましょう |
| **E級** | ±35¢超 | - | - | `frown` | レッド | 基礎から！一歩ずつ確実に向上していきます |

※ S級・A級・B級は平均誤差・Excellence割合・安定性の全条件を満たす必要があります
※ C級は平均誤差とExcellence割合を満たす必要があります

---

## 📊 結果表示UI

### 1. 即座表示（各音階完了時）

```
♪ ミ を歌いました
━━━━━━━━━━━━━━━
精度: 🎉 良好
誤差: -18セント
スコア: 80点
```

### 2. セッション完了時の詳細表示

#### 総合結果カード
```
┌─────────────────────────┐
│    🏆 セッション完了！     │
├─────────────────────────┤
│  最終スコア: 76.25       │
│  ランク: B級            │
│  Excellence: 45%        │
│  安定性: 良好 (σ=12.3)   │
│  時間: 3:45             │
└─────────────────────────┘
```

#### 詳細グラフ（アニメーション付き）

**棒グラフ表示**
```
100 ┤ ■
 80 ┤ ■ ■     ■   ■
 60 ┤ ■ ■ ■   ■ ■ ■ ■
 40 ┤ ■ ■ ■   ■ ■ ■ ■
 20 ┤ ■ ■ ■ ■ ■ ■ ■ ■
  0 └─────────────────
    ド レ ミ ファ ソ ラ シ ド
```

**レーダーチャート**
```
     ド(100)
      ／＼
    ／    ＼
シ(60)    レ(80)
  │        │
  │    ◆   │
ラ(80)    ミ(60)
    ＼    ／
      ＼／
    ソ(100) ファ(30)
```

### 3. 誤差分布の可視化

**ヒートマップ表示**
```
優秀 [■■■□] 3音
良好 [■■□□] 2音
合格 [■■□□] 2音
要練 [■□□□] 1音
```

**セント誤差の分布図**
```
+40 ┤      ●
+20 ┤   ●     ●
  0 ┤ ●   ●     ●
-20 ┤     ●
-40 ┤         ●
    └─────────────
     ド レ ミ ファ ソ ラ シ ド
```

---

## 🎮 アニメーション仕様

### 評価表示アニメーション

1. **スコア表示**
   - 0から目標値までカウントアップ（1秒）
   - イージング: ease-out

2. **グラフ描画**
   - 左から右へ順次表示（0.5秒/本）
   - 各棒グラフがバウンスしながら出現

3. **ランク表示**
   - スケール0→1でフェードイン
   - 評価に応じたパーティクルエフェクト

4. **改善提案**
   - スライドインで表示
   - 重要ポイントは点滅

---

## 💡 フィードバックメッセージ

### 音階別メッセージ

**優秀な場合**
- 「完璧です！」
- 「素晴らしい音程！」
- 「プロ級の精度！」

**良好な場合**
- 「いい感じ！」
- 「安定しています」
- 「その調子！」

**要練習の場合**
- 「もう少し高く」（フラット時）
- 「もう少し低く」（シャープ時）
- 「リラックスして」

### 総合メッセージ

**高得点時（85点以上）**
```
🌟 素晴らしいパフォーマンス！
この調子で練習を続けましょう。
特に「ド」「ソ」「高いド」が完璧でした！
```

**中得点時（65-84点）**
```
👏 良い音感を持っています！
「ファ」の音程をもう少し練習すると
さらに精度が上がりますよ。
```

**低得点時（65点未満）**
```
💪 練習あるのみ！
まずは「ド」「ミ」「ソ」の
基本3音から始めてみましょう。
一歩ずつ確実に！
```

---

## 📱 レスポンシブ対応

### デスクトップ表示
- グラフとテキスト情報を横並び
- 詳細な数値表示
- 大きなビジュアライゼーション

### タブレット表示（iPad縦向き）
- グラフを上部に配置
- テキスト情報を下部に整理
- タッチ操作に最適化

### モバイル表示
- コンパクトな表示
- 重要情報のみ初期表示
- 「詳細を見る」で展開

---

## 🔄 データ活用

### 練習履歴の活用
- 過去のセッションとの比較
- 成長曲線の表示
- 苦手音程の特定と集中練習提案

### 統計情報
- 平均精度の推移
- 最高記録の更新通知
- 連続練習日数の記録

---

## 🎯 改善提案システム

### 自動分析による提案

**苦手音程の特定**
```
📊 分析結果：
「ファ」の精度が低い傾向があります。
→ ファの音を重点的に練習しましょう
```

**パターン認識**
```
💡 気づき：
高い音程で誤差が大きくなる傾向があります。
→ 呼吸を深くして、リラックスして歌いましょう
```

---

## 🎨 Lucideアイコン仕様

### アイコン利用方針
評価システムの視覚的フィードバックにLucideアイコンを統一的に使用します。

### 評価レベル別アイコン定義

| 評価レベル | Lucideアイコン名 | 用途 | サイズクラス |
|-----------|----------------|------|------------|
| **Excellent** | `award` | 個別音階評価 | `icon-sm` |
| **Good** | `thumbs-up` | 個別音階評価 | `icon-sm` |
| **Pass** | `check` | 個別音階評価 | `icon-sm` |
| **Need Practice** | `frown` | 個別音階評価 | `icon-sm` |

### ランク別アイコン定義

| ランク | Lucideアイコン名 | 用途 | サイズクラス | カラー |
|--------|----------------|------|------------|--------|
| **S級** | `crown` | 総合評価表示 | `icon-xl` | gold |
| **A級** | `trophy` | 総合評価表示 | `icon-xl` | green |
| **B級** | `star` | 総合評価表示 | `icon-xl` | blue |
| **C級** | `check-circle` | 総合評価表示 | `icon-xl` | orange |
| **D級** | `target` | 総合評価表示 | `icon-xl` | yellow |
| **E級** | `book-open` | 総合評価表示 | `icon-xl` | gray |

### その他のUIアイコン

| 機能 | Lucideアイコン名 | 用途 | サイズクラス |
|------|----------------|------|------------|
| **音声入力** | `mic` | マイクテスト・録音中 | `icon-lg` |
| **音量** | `volume-2` | 音量インジケーター | `icon-md` |
| **統計** | `bar-chart-3` | グラフ表示 | `icon-md` |
| **トレンド** | `trending-up` | 成長曲線 | `icon-md` |
| **音楽** | `music-note` | 音階表示 | `icon-sm` |
| **再生** | `play` | 基音再生 | `icon-md` |
| **停止** | `stop` | 録音停止 | `icon-md` |
| **ホーム** | `home` | ナビゲーション | `icon-md` |
| **設定** | `settings` | 設定画面 | `icon-md` |

### アイコン実装コード例

```javascript
// Lucideアイコンの生成
const trophyIcon = lucideIcon('trophy', 'icon-xl text-gold');
const micIcon = lucideIcon('mic', 'icon-lg text-white');

// HTMLへの埋め込み
document.getElementById('rank-icon').innerHTML = trophyIcon;
```

---

**このハイブリッド評価システムとLucideアイコンにより、ユーザーは自分の音感レベルを正確に把握し、視覚的にも分かりやすいフィードバックで効率的な練習が可能になります。**