# 8va相対音感トレーニングアプリ - アプリケーション仕様書

**バージョン**: 1.4.0  
**作成日**: 2025-08-06  
**更新日**: 2025-08-12  
**用途**: アプリ概要・画面遷移・機能仕様（実装言語非依存）

**v1.4.0 更新内容**:
- 全モードでユーザー音域適応型基音選択を実装
- ランダム基音モードのセッション数8回に変更
- 音域テストを必須機能に変更
- セッション評価ページの追加
- Lucideアイコン仕様の更新（S級にcrownアイコン）

**v1.3.1 更新内容**:
- マイクテストページの簡素化実装（フックなし設計）
- 統合進行ガイドシステムの精密タイミング仕様更新
- ドレミガイドの視覚的エフェクト最適化

**v1.3.0 更新内容**:
- SNS共有機能の画面遷移仕様追加（10章）
- 結果表示画面への共有ボタン追加
- 総合評価画面へのS-E級表示追加

**v1.2.1 更新内容**:
- 音声コミュニケーション理論の追加（脳内ピアノ理論・人間関係向上効果）
- 対象ユーザーの拡張（コミュニケーション・人間関係改善目的）

**v1.2.0 更新内容**:
- ガイドアニメーションの高速化（全体約5.30秒）
- 基音聴き返し機能の削除（絶対音感依存防止）
- 上級モードの3種類細分化（上昇・下降・上昇下降）

---

## 🚨 最重要設計原則

### 🔒 相対音感トレーニングの根幹原則
**トレーニング中の基音音程表記は完全禁止**

#### なぜこの原則が最重要なのか
相対音感とは「基準音に対する他の音の相対的な関係を認識する能力」です。  
もし基音の音程名（C3, D4等）や周波数を表示してしまうと、ユーザーは絶対音感に依存してしまい、相対音感の向上に繋がりません。

#### 絶対禁止項目（トレーニング画面）
- ❌ 基音の音名表示（C3, D4, E♭3 等）
- ❌ 基音の周波数表示（261.63 Hz 等）
- ❌ 検出音程の音名表示（「現在: C4」等）
- ❌ 検出音程の周波数表示
- ❌ 音程差の表示（「基音より+5¢」等）
- ❌ 「正解」「不正解」のリアルタイム表示

#### 許可される表示（トレーニング画面）
- ✅ 「基音」ラベルのみ
- ✅ 相対音程（ドレミファソラシド）
- ✅ 音量レベルメーター
- ✅ 進行状況（●○○○○○○○）
- ✅ セッション番号

#### 例外：マイクテストページと評価表示
**マイクテストページは調整目的のため例外**
- ✅ 周波数表示 OK（マイク調整用）
- ✅ 音名表示 OK（発声確認用）
- ✅ 「ドを発声してください」指示 OK

**評価表示ページ（セッション評価・総合評価）は学習フィードバック目的のため例外**
- ✅ セント誤差表示 OK（±15¢等、音程精度フィードバック用）
- ✅ 音階別精度表示 OK（ド:12¢, レ:-8¢等、弱点把握用）
- ✅ 基音の音名表示 OK（「基音: C3で実施」等、記録用）

---

## 1. アプリケーション概要

### 1.1 アプリの目的
**相対音感トレーニングアプリ**は、音楽学習者が相対音感（基準音に対する音程の関係を聞き分ける能力）を効果的に鍛えるためのWebアプリケーションです。

#### 音声コミュニケーションの理論的背景
人が話した録音データをフーリエ解析し、そのデータを機械仕掛けの発音装置を備えたピアノ機器で鳴らすと、ピアノは子音まで含めて人間と同様に言葉を発することが可能になります。つまりそれは、**人は頭の中（脳内）にピアノがあるのと同じこと**を意味します。

人と人は言葉（音）で関係を結んでいます。つまり人との関係は12音律であり、**相対音感が上達すれば歌がうまくなるだけでなく、円滑な人間関係が築けるようになる**ということにつながります。

### 1.2 主な特徴
- 🎵 **基音からの相対音程トレーニング**: ランダムな基音を基準に8音階を歌う練習
- 🎤 **リアルタイム音程検出**: マイクで歌声を検出し、正確性を即座に判定
- 📊 **詳細な評価システム**: 音程の正確さを分析し、改善点を提示
- 🔄 **3つのトレーニングモード**: 初級から上級まで段階的な学習

### 1.3 対象ユーザー
- 音楽を学習している初級〜中級者
- カラオケや合唱で音程を正確に取りたい方
- 相対音感を身に付けたい音楽愛好家
- **コミュニケーション能力を向上させたい方**
- **人間関係を円滑にしたい方**

---

## 2. 画面構成と遷移フロー

### 2.1 画面遷移図
```
┌─────────────────┐
│  ホームページ   │◄─────────────────┐
│  (モード選択)   │                  │
└────────┬────────┘                  │
         │                          │
    ┌────┴────┐                     │
    ↓         ↓                     │
┌───────────────────────┐         ┌─────────────────────┐
│   マイクテストページ   │ ← - - - │ ダイレクトアクセス  │
│  (マイク許可・確認)    │         │ (未許可時リダイレクト)│
└───────────┬───────────┘         └─────────────────────┘
            │                              ↓（許可済み）
     ┌──────┼──────┐                      ↓
     ↓      ↓      ↓                      ↓
┌─────────┐┌─────────┐┌─────────┐      ↓
│ランダム │ │ 連続    │ │12音階   │ ← - - ┘
│基音     │ │チャレ   │ │モード   │
│モード   │ │ンジ     │ │         │
│(8セッション)│  │モード   │ │(上級)   │
└────┬────┘└────┬────┘└────┬────┘
     │          │          │
     ↓          ↓          ↓
┌─────────────────────────────────────┐
│       トレーニング実行画面          │
│   (統合進行ガイドシステム)          │
└───────────┬─────────────────────────┘
            │
     ┌──────┼──────┐
     ↓      ↓      ↓
┌──────────┐┌──────────┐┌──────────┐
│セッション││  総合    ││  総合    │
│評価表示  ││  評価    ││  評価    │
│(ランダム)││(連続・12音階)││  表示    │
└────┬─────┘└────┬─────┘└────┬─────┘
     │           │           │
     ↓           ↓           ↓
┌──────────┐     │      ┌──────────┐
│次セッション│     │      │  SNS     │
│(7回繰返し)│     │      │  共有    │
└────┬─────┘     │      └──────────┘
     │           │           │
     └─────┬─────┘           │
           ↓                 │
    ┌─────────────────┐      │
    │    総合評価     │      │
    │ (ランダム8回完了)│      │
    └─────────────────┘      │
           │                 │
           └─────────────────┼─────┐
                            │     │
    ┌─────────────────────────┼─────┼──┐
    ↓                       ↓     ↓  ↓
┌──────────┐           ┌──────────┐ │
│ トレーニング │           │ もう一度  │ │
│   記録     │           │ 挑戦     │ │
│ (/records) │           │         │ │
└────────────┘           └──────────┘ │
     │                       │     │
     └───────────────────────┼─────┘
                            │
                            ↓
                      ┌──────────┐
                      │ ホーム   │
                      │ に戻る   │
                      └──────────┘
```

#### ダイレクトアクセス機能
**概要**: URLを直接入力してトレーニングページにアクセスする機能

**動作フロー**:
1. ユーザーが `/training/random` 等のURLに直接アクセス
2. システムがマイク許可状態を自動チェック
3. 許可済み → 直接トレーニング開始
4. 未許可 → マイクテストページへ自動リダイレクト
5. マイクテスト完了後、元のページへ自動遷移

### 2.2 各画面の詳細

#### 2.2.1 ホームページ
**URL**: `/`

**画面要素**:
- アプリタイトル「8va相対音感トレーニング」
- 3つのモード選択カード
  - 🎲 ランダム基音モード（初級）
  - 🔄 連続チャレンジモード（中級）
  - 🎹 12音階モード（上級）
- 各モードの説明文
- 「始める」ボタン
- 直接アクセスURL表示（オプション）

**機能**:
- モード選択後、マイクテストページへ遷移
- 選択したモード情報を次画面へ引き継ぎ
- 各モードの直接アクセスURL生成・コピー機能

#### 2.2.2 マイクテストページ（簡素化準備）
**URL**: `/microphone-test`

**新仕様（v1.3.1更新）**: 簡素化されたマイクテストページ
フックなしのスムーズなトレーニング開始を実現。

**画面要素**:
- 「トレーニング前の準備」タイトル
- マイク許可ボタン
- リアルタイム周波数表示エリア
- 音量レベルメーター（視覚的フィードバック）
- 音量調整ガイド（適切な音量範囲の表示）
- **音域テスト指示エリア**:
  - 「低音テスト: C3から下げて歌ってください」
  - 「高音テスト: C5まで上げて歌ってください」
  - テスト状況のプログレス表示
- **音域結果表示**:
  - 検出された音域範囲（例：B2 - D5）
  - オクターブ数（例：2.3オクターブ）
  - 推奨基音リスト（例：C3, D3, E3）
- トレーニング開始ボタン（準備完了後に有効化）

**準備機能の詳細**:
1. **発声練習**
   - ドの音を安定して出せるか確認
   - 声の安定性をチェック

2. **音域テスト**（重要機能）
   - **低音テスト**: 
     - C3（130Hz）から開始して下降
     - 快適に出せる最低音を記録
   - **高音テスト**: 
     - C5（523Hz）まで上昇
     - 快適に出せる最高音を記録
   - **快適音域の判定**:
     - 最低音〜最高音の範囲を計算
     - オクターブ数を表示（例：2オクターブ）
   - **推奨基音の提案**:
     - 快適音域の中央値付近を推奨
     - トレーニングモードに応じた最適基音を提案

3. **マイク感度調整**
   - 周囲の雑音レベル確認
   - 最適な音量レベルの設定
   - ノイズフィルターの調整

4. **音量調整**
   - 声が小さすぎず、大きすぎない適切なレベルに調整
   - 視覚的なフィードバックで最適範囲を提示

**なぜこの準備が必要か**:
- **トレーニングの精度向上**: 事前に声の特性を把握することで、より正確な判定が可能
- **音域に合わせた基音選択**: ユーザーが無理なく歌える範囲で基音を提供
- **快適な練習環境の確立**: 適切な音量設定により、長時間の練習でも疲れにくい

**画面遷移の流れ**:
```
【通常フロー】
1. マイク許可ボタンクリック
   ↓
2. ブラウザのマイク許可ダイアログ
   ↓
3. 許可後、リアルタイム表示開始
   ↓
4. 音量調整ガイダンスに従って調整
   ↓
5. 音域テストの実施
   a. 低音から高音まで段階的にテスト
   b. 快適音域の自動判定
   c. 推奨基音の表示
   ↓
6. 準備完了でボタン有効化
   ↓
7. トレーニング開始ボタンクリック
   ↓
8. 選択したモードのページへ遷移

【ダイレクトアクセス時のリダイレクトフロー】
1. トレーニングページURLに直接アクセス
   ↓
2. マイク未許可を検出
   ↓
3. マイクテストページへ自動リダイレクト
   ↓
4. 「○○モードへのアクセスにはマイクテストが必要です」表示
   ↓
5. 通常フローの手順1-6を実行
   ↓
6. テスト完了後、元のトレーニングページへ自動遷移
```

---

## 3. トレーニングモード仕様

### 3.1 ランダム基音モード（初級）
**URL**: `/training/random`

#### モードの目的と特徴
- **対象**: 相対音感トレーニング初心者
- **目的**: カラオケなどで音程を合わせて歌えるようになる
- **学習効果**: 歌唱力向上、コミュニケーション能力の向上

#### なぜランダム基音なのか
相対音感を鍛えるためには、**基音の規則性から音を推測できないようにする**必要があります。
もしユーザーが何の音が出るか予測できてしまうと、それは絶対音感のトレーニングになってしまいます。

#### モバイル版UIレイアウト（縦積み配置）
```
┌─────────────────────────────────┐
│         セッション 1/8          │
├─────────────────────────────────┤
│           🎵 基音               │ ← 1. 基音エリア
│       [🔊 基音スタート]         │
├─────────────────────────────────┤
│ 基音再生(2.0秒) │休憩│🎯開始     │ ← 2. 統合進行バー
│ ████████▒▒▒▒▒▒▒█▒█            │    区間別タイミング表示
│ ↑現在位置      ↑ ↑             │    🎯がガイド開始ポイント
│               0.5秒 ガイド開始   │
├─────────────────────────────────┤
│    ┌─────────────────────┐      │ ← 3. ドレミガイド
│    │ ○○○○○○○○           │      │    進行バーと連携
│    │ ドレミファソラシド     │      │
│    └─────────────────────┘      │
├─────────────────────────────────┤
│           音量確認              │
│    ▒▒▒▒████▒▒▒▒ 60%           │ ← 音量のみ表示
│    「適切な音量です」            │    周波数・音名は非表示
└─────────────────────────────────┘
```

#### PC版UIレイアウト（横並び配置）
```
┌─────────────────────────────────────────────────┐
│ セッション 1/8 | 連続チャレンジモード | [ホーム] │
├─────────────────────────────────────────────────┤
│                                                 │
│ ┌─基音エリア─┐    ┌─統合ガイドエリア────────┐ │
│ │           │    │                          │ │
│ │  🎵 基音  │    │基音再生(2.0秒)│休憩│🎯開始│ │ ← 進行バー
│ │           │    │████████▒▒▒▒▒▒█▒█        │ │
│ │ [🔊スタート]│    │↑現在位置    ↑ ↑        │ │
│ │           │    │           0.5秒 開始     │ │
│ │           │    │                          │ │
│ │           │    │ ○○○○○○○○              │ │ ← ドレミガイド
│ │           │    │ ドレミファソラシド        │ │    進行バーと一体化
│ │           │    │                          │ │
│ └───────────┘    └──────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                   音量確認                      │
│             ▒▒▒▒████▒▒▒▒ 60%                 │
└─────────────────────────────────────────────────┘
```

#### 進行バーの動作仕様

**基本動作**
- **進行時間**: 2.5秒（基音再生2.0秒 + 休憩0.5秒）
- **進行方式**: 0%→100%への線形進行
- **更新間隔**: 50ms間隔でスムーズ更新

**視覚仕様**
- **通常色**: `#007bff`（青色）
- **背景色**: `#e9ecef`（ライトグレー）
- **リセット**: `transition: none`で瞬間リセット

**動作フロー**
1. ボタン押下 → 進行開始（0%）
2. 2.5秒かけて100%まで進行
3. 完了と同時にドレミガイドスタート
4. ガイド終了後、瞬間リセットで0%に復帰

**重要な設計思想**:
- ✅ **時間経過の予測可能性**: 🎯マーカーで開始時点が常に見える
- ✅ **統合UI**: 進行バーとドレミガイドが一体的に連携
- ✅ **相対音感原則**: 基音の音名・周波数は一切表示しない
- ✅ **タッチ操作**: 進行バー上のタッチで時間ジャンプ可能

#### トレーニングフロー
1. **基音再生**
   - システムがC3オクターブの8音からランダムに基音を選択
   - 「基音を聞く」ボタンで2.5秒間再生
   - **重要**: 選択された基音の音名は一切表示しない

2. **ガイドアニメーション**
   - 8つの円が横に並び、現在歌うべき音階を表示
   - ドから順番に自動的に進行
   - **全体で約5.30秒**（ドレミファソラシドで高速アニメーション）
   - **基音聴き返し**: 削除（絶対音感依存防止のため）

3. **連続歌唱**
   - ユーザーは基音を「ド」として連続的に歌う
   - 基音からの相対音程: ド→レ→ミ→ファ→ソ→ラ→シ→ド

4. **リアルタイム判定**
   - 各音階の正解/不正解を自動判定
   - 正解: ±50セント以内
   - 判定結果を●○で表示

5. **結果表示**
   - 平均音程精度（例: ±20セント）
   - 合格音数（例: 6/8音）
   - 各音階の精度表示（セント単位）
   - 4段階評価（Excellent/Good/Pass/Need Work）
   - SNS共有ボタン（Twitter/Facebook/LINE/Instagram）
   - 次のモード選択の参考指標

#### 初級者向けの特徴
- **集中時間**: 1セッションのみで短時間
- **基音の数**: C3オクターブの8音（半音なし）
- **ペース**: 高速ガイドアニメーション（全体約5.30秒）
- **難易度**: 最も基本的な音階のみ

#### 基音聴き返し機能の廃止
- **削除理由**: セッション評価表示により音程が判明し、その状態での聴き返しは絶対音感に依存する危険性
- **全モード共通**: 基音聴き返し機能は完全に削除
- **代替**: 新しいランダム基音で練習継続を推奨

#### 操作ボタン
- 「基音を聞く」: 基音の再生（セッション開始時のみ）
- 「もう一度」: 新しいランダム基音でセッション開始（終了後のみ表示）
- 「新しい基音で開始」: 別の基音で新規セッション

### 3.2 連続チャレンジモード（中級）
**URL**: `/training/continuous`

#### モードの目的と特徴
- **対象**: 初級モードで基礎を習得した中級者
- **目的**: 自分の音域で半音も含めた音を聞き分けられるようになる
- **学習効果**: 瞬間的だけでなく一定時間内でも音を合わせ続ける能力の向上

#### なぜ8セッション連続なのか
**オクターブを一つの基準**とし、その音域で連続して練習することで、基音に対する反応速度と精度の向上を図ります。休憩なしで連続することで、集中力を維持しながら相対音感を鍛えます。

#### 画面構成の違い
- セッション表示が「1/8」〜「8/8」に変化
- 「連続チャレンジ開始」ボタンでスタート
- セッション間は自動進行（休憩なし）
- 基音の聴き直しは各セッション開始時のみ

#### 8セッション連続フロー
```
セッション1: 基音(音名非表示) → 8音階歌唱 → 自動採点 → 2秒待機
    ↓
セッション2: 基音(音名非表示) → 8音階歌唱 → 自動採点 → 2秒待機
    ↓
   ...（クロマチック12音から選択）
    ↓
セッション8: 基音(音名非表示) → 8音階歌唱 → 自動採点 → 総合評価
```

**重要**: 連続モードでは1セッションごとの評価表示を行わず、8セッション完了後の総合評価のみを表示します

#### 中級者向けの特徴
- **集中時間**: 8セッション連続（約10分間）
- **基音の数**: クロマチックの12音（半音を含む）
- **ペース**: 自動進行で一定のリズムを保つ
- **難易度**: 半音を含む全音階に対応

#### ランダムモードとの違い
- **連続性**: 8セッション休憩なしで実施
- **基音の種類**: 半音を含む12音から選択
- **ペース管理**: システムが自動的に進行
- **集中力**: より長時間の集中力が必要

#### 総合評価画面
- 8セッションの統計情報
  - 平均音程精度（例: ±28セント）
  - 合格音数（例: 6/8音）
  - 各セッションの成績一覧（セント表示）
  - 音階別の精度表示（弱点の可視化）
  - 改善提案（苦手な音程の指摘）
- S-E級総合評価表示
- 「SNSで共有」ボタン（→共有画面へ遷移）
- 「もう一度8セッション」ボタン
- 「上級モードに挑戦」ボタン（スコアが良い場合）
- 「ホームに戻る」ボタン

### 3.3 12音階モード（上級）※未実装
**URL**: `/training/chromatic`

#### モードの目的と特徴
- **対象**: 中級モードを習得した上級者
- **目的**: ユーザーの音域内ですべての音に対して完璧な相対音感を持てるようになる
- **学習効果**: クロマチック（半音階）の相対的な音感の差を正確に判断して発声できる能力

#### なぜ半音階すべてを使うのか
音楽の世界では12の半音がすべての基礎となります。これらすべてに対して相対音感を持つことで、どんな調性の楽曲でも正確に歌えるようになります。

#### 音域調整機能（12音階モード専用）
**なぜ必要か**: 12音すべてを使用するため、最低音から最高音まで約2オクターブの範囲が必要となり、個人の音域やコンディションによっては調整が必要です。

**調整画面UI（セッション開始前）**:
- **音域プレビュー**: 最低音・最高音でのドレミファソラシド試聴
- **調整ボタン**: 「音域を上げる」「音域を下げる」
- **視覚的インジケーター**: 5段階のドット表示（とても低い・低い・標準・高い・とても高い）
- **重要**: 基音の音名は一切表示しない（相対音感原則の遵守）

**動作仕様**:
- 調整範囲: 標準位置から±2段階（半音単位で±2音）
- セッション開始後は調整不可（中断防止）
- 声が出ない場合も継続推奨（音域外は自動的に不正解扱い）
- 完了後に次回用の音域調整提案を表示

#### 上級モードの3種類
ユーザーのスキルレベルと練習目的に応じて選択可能です。

**1. 上昇モード**
- ド→レ→ミ→ファ→ソ→ラ→シ→ドの順番
- 音程の上昇方向に特化した練習

**2. 下降モード**
- ド→シ→ラ→ソ→ファ→ミ→レ→ドの順番
- 音程の下降方向に特化した練習

**3. 上昇下降モード**
- 上昇と下降の両方を組み合わせた総合練習
- 音程の変化をより深く理解し、相対音感を効率的に学習

#### 各モードのセッション構成

**1. 上昇モード（12セッション）**
```
セッション1: 基音(音名非表示) → 8音階上昇 → 自動採点
セッション2: 基音(音名非表示) → 8音階上昇 → 自動採点
...（クロマチック12音で順次実施）
セッション12: 基音(音名非表示) → 8音階上昇 → 総合評価
```

**2. 下降モード（12セッション）**
```
セッション1: 基音(音名非表示) → 8音階下降 → 自動採点
...（クロマチック12音で順次実施）
セッション12: 基音(音名非表示) → 8音階下降 → 総合評価
```

**3. 上昇下降モード（24セッション）**
```
上昇フェーズ（12セッション）:
セッション1-12: 各基音で上昇練習

下降フェーズ（12セッション）:
セッション13-24: 各基音で下降練習 → 総合評価
```

#### 上級者向けの特徴
- **モード種類**: 上昇（12セッション）・下降（12セッション）・上昇下降（24セッション）
- **集中時間**: 12-24セッション連続（約15-30分間）
- **基音の数**: クロマチックの12音すべて
- **練習方向**: 上昇・下降・上昇下降から選択
- **判定基準**: より厳密（±30セント以内）
- **プロレベル**: 音楽のプロを目指す人向け
- **基音聴き返し**: 全廃止（絶対音感依存防止）

#### 総合評価画面
- 24セッションの詳細統計
  - 上りフェーズの平均精度（±XXセント）
  - 下りフェーズの平均精度（±XXセント）
  - 各基音での合格音数
  - 音程別の精度分析（セント表示）
- プロレベル判定（S級取得で「プロレベル認定」）
- 弱点の詳細分析と練習提案

---

## 4. 共通UI要素

### 4.1 ヘッダー
- アプリロゴ・タイトル
- 現在のページ名
- ホームへ戻るリンク

### 4.2 統合UIコンポーネント設計

#### 基音エリア（モバイル・PC共通）
- 基音ラベル（🎵「基音」表示のみ）
- スタートボタン（状態に応じて表示変化）
  - 待機時: [🔊 基音スタート]
  - 再生中: [🔊 再生中...]
  - 完了後: [🔊 基音を再度聞く]
- **禁止**: 音名・周波数の表示

#### 統合進行ガイド（進行バー + ドレミガイド）
- **進行バー仕様**:
  - 3区間分割: 基音再生(2秒) | 休憩(0.5秒) | 開始
  - 🎯マーカー: ガイド開始ポイントを明示
  - タッチ操作: バー上タッチで時間ジャンプ
  - エフェクト: 🎯到達時に🌟✨エフェクト

- **ドレミガイド仕様**:
  - 8音階表示: ドレミファソラシド
  - 状態表示: ○(待機) → 🎯(現在) → ●(完了)
  - 進行バーと同期: 🎯到達と同時にガイド開始

#### レスポンシブ対応
- **モバイル（縦積み）**: 基音エリア → 統合ガイド → 音量確認
- **PC（横並び）**: 基音エリア | 統合ガイド

### 4.3 音量確認セクション（相対音感原則適用）
- 音量レベルメーター（視覚的バー）
- 音量状態メッセージ（「適切です」「もう少し大きく」等）
- **禁止**: 周波数・音名・音程差の表示
- **マイクテストページは例外**: 調整目的で周波数・音名表示可能

### 4.4 進行状況表示
- 8音階の進行状況（●○○○○○○○）
- 現在の音階指示
- アニメーション効果

### 4.5 結果表示セクション
- 正解数/総数
- 精度グラフ
- 評価ランク（S〜C）
- 詳細分析（オプション）
- SNS共有ボタン（詳細は10章参照）

---

## 5. 音楽理論基礎

### 5.1 相対音感とは
基準となる音（基音）に対して、他の音の高さの関係を認識する能力。
絶対音感と異なり、基準音があれば正確な音程を取ることができる。

### 5.2 相対音程の関係（開発者向け内部仕様）
```
相対音感における音程関係:
ド (基音) - 0セント
レ (基音+2半音) - +200セント
ミ (基音+4半音) - +400セント
ファ(基音+5半音) - +500セント
ソ (基音+7半音) - +700セント
ラ (基音+9半音) - +900セント
シ (基音+11半音) - +1100セント
ド (基音+12半音) - +1200セント

※どの基音が選ばれても相対関係は同じ
※ユーザーには基音の音名・周波数は一切表示しない
```

### 5.3 音程の精度（セント）と評価表示
#### セント単位の定義
- 1オクターブ = 1200セント
- 半音 = 100セント
- ±10セント以内: プロレベルの精度
- ±25セント以内: 良好な精度
- ±50セント以内: 合格ライン

#### 評価表示の統一仕様
**重要**: 相対音感トレーニングでは音程精度（セント）を主要指標とする

**表示内容**:
- **平均音程精度**: `±XXセント`（例: ±28セント）
- **合格音数**: `X/8音`（例: 6/8音）
- **Excellent数**: `X音`（±10セント以内の音数）

**廃止する表示**:
- ~~スコア（点数表示）~~: 音程精度と混同するため廃止
- ~~精度パーセント表示~~: セント表示で統一

**理由**:
- セントは音程精度の国際標準単位
- 明確な判定基準（±10、±30、±50セント）
- 相対音感の本質である「音程の正確さ」を直接表現

---

## 6. データ保存仕様

### 6.1 セッション進捗
- 現在のセッション番号（連続モード）
- 使用済み基音リスト
- 各セッションの結果

### 6.2 統計情報
- 総練習回数
- 平均正解率
- 音階別の成功率
- 最高記録

### 6.3 設定情報
- 音量設定
- 表示設定
- ユーザープリファレンス

---

## 7. エラー処理とメッセージ

### 7.1 マイク関連
- **許可拒否**: 「マイクの使用が拒否されました。ブラウザの設定から許可してください。」
- **マイク未接続**: 「マイクが検出されません。接続を確認してください。」
- **マイク使用中**: 「他のアプリがマイクを使用中です。」

### 7.2 音程検出関連
- **音量不足**: 「もう少し大きな声で歌ってください。」
- **雑音過多**: 「周囲の雑音が多いようです。静かな環境でお試しください。」
- **検出不能**: 「音程を検出できません。マイクの位置を調整してください。」

### 7.3 システム関連
- **非対応ブラウザ**: 「お使いのブラウザは音声機能に対応していません。」
- **ネットワークエラー**: 「接続エラーが発生しました。」

---

## 8. 技術実装仕様

### 8.1 統合進行ガイドの実装

#### CSS設計指針
```css
/* モバイル縦積みレイアウト */
@media (max-width: 768px) {
  .layout-container {
    flex-direction: column;
  }
  .base-note-section { order: 1; }
  .integrated-guide { order: 2; }
  .volume-section { order: 3; }
}

/* PC横並びレイアウト */
@media (min-width: 769px) {
  .layout-container {
    display: flex;
    gap: 30px;
  }
  .base-note-section { flex: 0 0 200px; }
  .integrated-guide { flex: 1; min-width: 400px; }
}
```

#### JavaScript連携仕様
```javascript
// 基音ボタン押下時の統合制御
function startBaseNote() {
  // 1. ボタン状態変更
  baseButton.setState('playing');
  
  // 2. 統合ガイドの反応
  integratedGuide.startProgressBar();
  integratedGuide.showWaitingAnimation();
  
  // 3. 🎯ポイント到達時の自動連携
  progressBar.onReachStartPoint(() => {
    integratedGuide.triggerStartEffect();
    integratedGuide.startDoremiGuide();
  });
}
```

### 8.2 進行バーの視覚設計

#### 色分け仕様
- 基音再生エリア: 青系 #2196F3
- 休憩エリア: 黄系 #FFC107
- 開始エリア: 緑系 #4CAF50
- 🎯マーカー: オレンジ #FF6B35 + 光エフェクト

#### アニメーション仕様
- 進行中: 左から右へスムーズな塗りつぶし
- 🎯到達: 🌟✨エフェクトで0.8秒間
- ドレミガイド連携: 🎯エフェクトと同時にハイライト開始

### 8.3 相対音感原則の技術的実装

#### 禁止データの非表示実装
```javascript
// ❌ 絶対禁止のコード例
const baseNote = 'C3';
const frequency = 261.63;
display(`基音: ${baseNote} (${frequency} Hz)`); // 絶対禁止

// ✅ 正しい実装例
const baseNoteFreq = getRandomBaseFrequency(); // 内部処理のみ
display('🎵 基音'); // 表示は「基音」のみ

// ✅ 相対音程のみ表示
const currentStep = 0; // ド=0, レ=1, ミ=2...
const scaleNames = ['ド', 'レ', 'ミ', 'ファ', 'ソ', 'ラ', 'シ', 'ド'];
display(`現在: ${scaleNames[currentStep]} を歌ってください`);
```

---

## 9. 将来の拡張予定

### 8.1 機能拡張
- 練習履歴の長期保存
- カスタム音階練習
- グループ練習機能
- AI による個別アドバイス

### 8.2 プラットフォーム拡張
- モバイルアプリ版
- オフライン対応
- 多言語対応

### 8.3 コンテンツ拡張
- 楽曲での練習モード
- 和音聴音トレーニング
- リズムトレーニング

---

## 10. SNS共有機能仕様

### 10.1 共有画面への遷移
**トリガー**: セッション完了後の結果表示画面から「共有」ボタンタップ

### 10.2 共有画面UI
```
┌─────────────────────────────────┐
│        結果をシェアしよう！🎉      │
├─────────────────────────────────┤
│  ┌───────────────────────────┐  │
│  │   [結果画像プレビュー]      │  │ ← 自動生成された画像
│  │    平均精度: ±20セント      │  │
│  │    合格音数: 6/8音         │  │
│  │    モード: ランダム基音     │  │
│  └───────────────────────────┘  │
│                                 │
│  カスタムメッセージ（任意）:      │
│  ┌───────────────────────────┐  │
│  │                           │  │ ← 100文字以内
│  └───────────────────────────┘  │
│                                 │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐│
│  │Twitter││Facebook││LINE││Insta││ ← SNSボタン
│  └─────┘ └─────┘ └─────┘ └─────┘│
│                                 │
│  [トレーニングに戻る] [ホームへ]  │
└─────────────────────────────────┘
```

### 10.3 共有フロー
1. **結果画像生成**: 1080x1080pxの画像を自動生成
2. **プレビュー表示**: 生成画像をユーザーに確認表示
3. **メッセージ入力**: オプションでカスタムメッセージ追加
4. **SNS選択**: 共有先プラットフォームを選択
5. **共有実行**: 各SNSアプリ/Webページへ遷移

### 10.4 共有内容
- **画像**: 平均精度（セント）、合格音数、達成バッジを含む結果画像
- **テキスト**: 定型文＋カスタムメッセージ
- **ハッシュタグ**: #相対音感 #音楽トレーニング #PitchTraining
- **URL**: アプリトップページへのリンク

### 10.5 共有後の動作
- **成功時**: 「共有ありがとうございます！」メッセージ表示
- **キャンセル時**: 共有画面に留まる
- **エラー時**: エラーメッセージ表示

---

## 11. 実装用モード別差分表と機能リスト

### 11.1 モード別差分表

| 機能/要素 | ランダム基音（初級） | 連続チャレンジ（中級） | 12音階（上級） |
|----------|---------------------|----------------------|---------------|
| **URL** | `/training?mode=random` | `/training?mode=continuous` | `/training?mode=12tone` |
| **セッション数** | 8回 | 8回（連続） | 12回/24回 |
| **基音選択** | C3オクターブ8音ランダム | クロマチック12音ランダム | クロマチック12音順次 |
| **進行バー表示** | セッション X / 8 | セッション X / 8 | セッション X / 12(24) |
| **セッション間** | 個別評価 → 次へ | 自動進行（評価なし） | 自動進行（評価なし） |
| **評価タイミング** | 各セッション + 総合 | 総合のみ | 総合のみ |
| **音域調整** | なし | なし | あり（開始前のみ） |
| **ドレミ進行** | 上昇のみ | 上昇のみ | 上昇/下降/両方 |
| **判定基準** | ±50セント | ±50セント | ±30セント |

### 11.2 共通機能リスト（全モード共通）

```javascript
// すべてのモードで共通の機能
const commonFeatures = {
  // UI要素
  header: true,                    // ページヘッダー
  baseNoteSection: true,           // 基音再生セクション
  progressBar: true,               // 進行バー（セッション表示のみ異なる）
  doremiGuide: true,              // ドレミガイド
  microphoneIndicator: true,      // マイク認識インジケーター
  
  // 機能
  microphonePermission: true,     // マイク許可
  pitchDetection: true,           // 音程検出
  realTimeVisualFeedback: true,  // リアルタイム視覚フィードバック
  sessionProgress: true,          // セッション進行管理
  
  // 制約
  hideBaseNoteName: true,         // 基音の音名非表示（相対音感原則）
  noFrequencyDisplay: true,       // 周波数非表示
  noAbsolutePitchInfo: true      // 絶対音程情報非表示
};
```

### 11.3 モード別固有機能リスト

```javascript
// モード別の固有機能
const modeSpecificFeatures = {
  random: {
    individualSessionResults: true,  // 個別セッション評価
    sessionTransition: 'manual',     // 手動で次セッションへ
    baseNotePool: 8,                // 基音候補数
    evaluationScreen: 'individual'   // 個別評価画面
  },
  
  continuous: {
    individualSessionResults: false, // 個別評価なし
    sessionTransition: 'auto',      // 自動進行
    baseNotePool: 12,               // 基音候補数（半音含む）
    evaluationScreen: 'summary'     // 総合評価のみ
  },
  
  '12tone': {
    individualSessionResults: false, // 個別評価なし
    sessionTransition: 'auto',      // 自動進行
    baseNotePool: 12,               // 基音候補数（全音階）
    evaluationScreen: 'summary',    // 総合評価のみ
    rangeAdjustment: true,          // 音域調整機能
    directionOptions: ['up', 'down', 'both'], // 進行方向選択
    stricterAccuracy: true          // より厳密な判定（±30セント）
  }
};
```

### 11.4 実装時のモード判定ロジック

```javascript
// URLパラメータからモード判定
const urlParams = new URLSearchParams(window.location.search);
const mode = urlParams.get('mode') || 'random';
const sessionNumber = parseInt(urlParams.get('session')) || 1;

// モード設定の取得
const modeConfig = {
  random: {
    maxSessions: 8,
    title: 'ランダム基音モード',
    hasIndividualResults: true,
    baseNoteSelection: 'random_c3_octave'
  },
  continuous: {
    maxSessions: 8,
    title: '連続チャレンジモード',
    hasIndividualResults: false,
    baseNoteSelection: 'random_chromatic'
  },
  '12tone': {
    maxSessions: 12, // または24（サブモードによる）
    title: '12音階モード',
    hasIndividualResults: false,
    baseNoteSelection: 'sequential_chromatic',
    hasRangeAdjustment: true
  }
};

// 現在のモード設定を取得
const currentMode = modeConfig[mode];

// UIの動的更新
document.querySelector('.page-title').textContent = currentMode.title;
document.querySelector('.progress-label').textContent = 
  `セッション ${sessionNumber} / ${currentMode.maxSessions}`;
```

### 11.5 音域調整機能の実装（12音階モードのみ）

```javascript
// 12音階モード専用の音域調整
if (mode === '12tone' && !sessionStarted) {
  // 音域調整UIを表示
  showRangeAdjustmentUI();
  
  // 内部管理（音名は表示しない）
  let rangeShift = 0; // -2 〜 +2
  
  // 調整ボタンのイベント
  document.getElementById('lower-range').addEventListener('click', () => {
    if (rangeShift > -2) {
      rangeShift--;
      updateRangeIndicator(rangeShift);
    }
  });
  
  document.getElementById('raise-range').addEventListener('click', () => {
    if (rangeShift < 2) {
      rangeShift++;
      updateRangeIndicator(rangeShift);
    }
  });
  
  // 視覚的表示のみ（音名は隠す）
  function updateRangeIndicator(shift) {
    const labels = ['とても低い', '低い', '標準', '高い', 'とても高い'];
    const dots = document.querySelectorAll('.range-dot');
    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === shift + 2);
    });
    document.querySelector('.range-label').textContent = labels[shift + 2];
  }
}
```

---

**この仕様書は、相対音感トレーニングアプリの画面構成と基本動作を定義したものです。**
**実装言語やフレームワークに依存せず、アプリケーションの振る舞いを明確に示しています。**