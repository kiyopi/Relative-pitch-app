<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchPro v1.1.9 è£½å“ãƒ¬ãƒ™ãƒ«çµ±åˆç®¡ç†ãƒ†ã‚¹ãƒˆ</title>
    
    <!-- æœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆä½¿ç”¨ -->
    <link rel="stylesheet" href="../../Bolt/v2/styles/base.css">
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="min-h-screen p-6">
        <div class="container max-w-4xl mx-auto">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">ğŸ‰ PitchPro v1.1.9 è£½å“ãƒ¬ãƒ™ãƒ«åˆ°é”</h1>
                <p class="text-yellow-200 text-lg">çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãƒ»4ãƒœã‚¿ãƒ³UIãƒ»å®Œå…¨ãªMicrophoneControllerå¯¾å¿œ</p>
            </header>

            <!-- v1.1.9è£½å“ãƒ¬ãƒ™ãƒ«åˆ°é”æ©Ÿèƒ½ -->
            <div class="glass-card mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="award" class="text-gold-300 icon-md"></i>
                    <h3 class="heading-md text-gold-300">v1.1.9 è£½å“ãƒ¬ãƒ™ãƒ«åˆ°é”æ©Ÿèƒ½</h3>
                </div>
                <ul class="text-white-70 space-y-2">
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span><strong>çµ±åˆstart()ãƒ¡ã‚½ãƒƒãƒ‰</strong> - ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤+æ¤œå‡ºé–‹å§‹ã®ä¸€æ‹¬å®Ÿè¡Œ</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span><strong>4ãƒœã‚¿ãƒ³UI</strong> - 7â†’4ãƒœã‚¿ãƒ³ï¼ˆ42%å‰Šæ¸›ï¼‰ã®ç›´æ„Ÿçš„æ“ä½œ</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span><strong>å¯¾ç§°çš„æ“ä½œè¨­è¨ˆ</strong> - reset()â‡„start()ã®å®Œå…¨å¯¾å¿œ</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span><strong>MicrophoneControllerçµ±åˆç®¡ç†</strong> - AudioDetectionComponentè‡ªå‹•ç™»éŒ²</span>
                    </li>
                </ul>
            </div>
            
            <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ -->
            <div class="glass-card mb-6">
                <h3 class="heading-md mb-4">
                    <i data-lucide="activity" class="text-blue-300"></i>
                    <span>ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</span>
                </h3>
                <div id="system-status" class="status-card mb-4">åˆæœŸåŒ–å‰...</div>
                
                <div class="flex gap-3 flex-wrap">
                    <button id="init-btn" class="btn btn-primary">
                        <i data-lucide="mic" class="icon-sm"></i>
                        <span>åˆæœŸåŒ–</span>
                    </button>
                    <button id="start-btn" class="btn btn-success" disabled>
                        <i data-lucide="play" class="icon-sm"></i>
                        <span>æ¤œå‡ºé–‹å§‹</span>
                    </button>
                    <button id="stop-btn" class="btn btn-outline" disabled>
                        <i data-lucide="stop-circle" class="icon-sm"></i>
                        <span>æ¤œå‡ºåœæ­¢</span>
                    </button>
                </div>
            </div>
            
            <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="glass-card mb-6">
                <h3 class="heading-md mb-4">
                    <i data-lucide="repeat" class="text-green-300"></i>
                    <span>ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆï¼ˆv1.1.8å¯¾å¿œï¼‰</span>
                </h3>
                <div class="info-card mb-4">
                    <h4 class="text-white font-medium mb-2">ğŸ”§ PitchDetector + MicrophoneController çµ±åˆç®¡ç†</h4>
                    <p class="text-white-70">v1.1.8ã§ã¯åˆ†é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ±åˆç®¡ç†ã—ã¦ã€UIè¦ç´ ã‚’å®Œå…¨åˆ†é›¢ã—ã¾ã™ã€‚</p>
                </div>
                
                <div class="flex gap-3 flex-wrap">
                    <button id="mic-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="mic" class="icon-sm"></i>
                        <span>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ</span>
                    </button>
                    <button id="range-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="music" class="icon-sm"></i>
                        <span>éŸ³åŸŸãƒ†ã‚¹ãƒˆ</span>
                    </button>
                    <button id="practice-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="headphones" class="icon-sm"></i>
                        <span>ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                    </button>
                </div>
            </div>
            
            <!-- ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="mic-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="mic" class="text-blue-300"></i>
                    <span>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">ãƒã‚¤ã‚¯éŸ³é‡</span>
                        <span id="mic-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-blue" id="mic-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <div class="frequency-display text-2xl font-bold text-blue-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg inline-block" id="mic-frequency">0 Hz</div>
                </div>
            </div>
            
            <!-- éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="range-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="music" class="text-green-300"></i>
                    <span>éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">æ¸¬å®šéŸ³é‡</span>
                        <span id="range-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-green" id="range-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <div class="frequency-display text-2xl font-bold text-green-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg inline-block" id="range-frequency">0 Hz</div>
                </div>
            </div>
            
            <!-- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="practice-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="headphones" class="text-orange-300"></i>
                    <span>ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">ç·´ç¿’éŸ³é‡</span>
                        <span id="practice-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-orange" id="practice-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="flex items-center justify-center gap-4 mt-4">
                    <div class="frequency-display text-2xl font-bold text-orange-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg" id="practice-frequency">0 Hz</div>
                    <div class="note-display text-xl font-bold text-yellow-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg" id="practice-note">-</div>
                </div>
            </div>
            
            <!-- ãƒ­ã‚°å‡ºåŠ› -->
            <div class="glass-card">
                <h3 class="heading-md mb-4">
                    <i data-lucide="file-text" class="text-white-70"></i>
                    <span>ãƒ­ã‚°å‡ºåŠ›</span>
                </h3>
                <div id="log-output" class="bg-black bg-opacity-50 p-4 rounded-lg h-64 overflow-y-auto font-mono text-sm"></div>
            </div>
        </div>
    </div>

    <!-- PitchPro v1.1.9 æœ€æ–°ç‰ˆUMDãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="../../js/pitchpro-audio/pitchpro-v1.1.9-latest.umd.js"></script>
    <script>
        // UMDç‰ˆã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof PitchPro !== 'undefined') {
            console.log('ğŸ‰ PitchPro v1.1.9 è£½å“ãƒ¬ãƒ™ãƒ«åˆ°é”ç‰ˆ UMD loaded successfully');
            console.log('Version:', PitchPro.VERSION);
            console.log('Build Date:', PitchPro.BUILD_DATE);
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¹:', Object.keys(PitchPro));
            console.log('ğŸ† v1.1.9è£½å“ãƒ¬ãƒ™ãƒ«çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œç‰ˆ');
            
            console.log('ğŸ” v1.1.9çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½:');
            console.log('  - çµ±åˆstart()ãƒ¡ã‚½ãƒƒãƒ‰: ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤+æ¤œå‡ºé–‹å§‹ä¸€æ‹¬');
            console.log('  - 4ãƒœã‚¿ãƒ³UI: 7â†’4ãƒœã‚¿ãƒ³ï¼ˆ42%å‰Šæ¸›ï¼‰ã®ç›´æ„Ÿçš„æ“ä½œ');
            console.log('  - å¯¾ç§°çš„æ“ä½œ: reset()â‡„start()å®Œå…¨å¯¾å¿œ');
            console.log('  - MicrophoneControllerçµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ');
            
            // åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª
            console.log('ğŸ” åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:');
            console.log('  - PitchDetector:', !!PitchPro.PitchDetector);
            console.log('  - MicrophoneController:', !!PitchPro.MicrophoneController);
            console.log('  - AudioManager:', !!PitchPro.AudioManager);
            console.log('  - AudioDetectionComponent:', !!PitchPro.AudioDetectionComponent);
            
            // PitchProèª­ã¿è¾¼ã¿å®Œäº†ã‚’é€šçŸ¥
            window.pitchProLoaded = true;
            window.dispatchEvent(new CustomEvent('pitchpro-loaded', { detail: PitchPro }));
        } else {
            console.error('âŒ PitchPro UMD failed to load');
        }
    </script>
    
    <!-- TODO: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ– /js/pitchpro-v118-controller.js -->
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®£è¨€
        let microphoneController = null;
        let pitchDetector = null;
        let currentMode = 'mic';
        let logLines = [];
        let isDetecting = false;
        
        // DOMè¦ç´ å–å¾—
        const logContainer = document.getElementById('log-output');
        
        // PitchPro v1.1.8ã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof PitchPro !== 'undefined') {
            console.log('âœ… PitchPro v1.1.8ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿æˆåŠŸ');
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¹:', Object.keys(PitchPro));
            console.log('ğŸ¯ v1.1.8æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œä¸­');
            
            // ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            
            // LucideåˆæœŸåŒ–
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // ãƒ­ã‚°å‡ºåŠ›ã‚·ã‚¹ãƒ†ãƒ 
            function log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                logLines.push(`[${timestamp}] ${message}`);
                if (logLines.length > 100) logLines.shift();
                
                const logEntry = document.createElement('div');
                logEntry.className = `text-${type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue'}-300 mb-1`;
                logEntry.textContent = `[${timestamp}] ${message}`;
                logContainer.innerHTML = logLines.map(line => {
                    const logType = line.includes('âŒ') ? 'red' : line.includes('âœ…') ? 'green' : 'blue';
                    return `<div class="text-${logType}-300 mb-1">${line}</div>`;
                }).join('');
                logContainer.scrollTop = logContainer.scrollHeight;
                
                console.log(`%c${message}`, `color: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'}`);
            }
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            function updateStatus(message, type = 'info') {
                const statusDiv = document.getElementById('system-status');
                statusDiv.className = `status-card text-${type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue'}-300`;
                statusDiv.textContent = message;
            }
            
            // UIåˆ‡ã‚Šæ›¿ãˆï¼ˆæœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«æº–æ‹ ï¼‰
            function updateModeUI(mode) {
                // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('[id$="-mode-section"]').forEach(section => {
                    section.classList.remove('border-green-300');
                    section.style.borderColor = '';
                });
                
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
                document.querySelectorAll('[id$="-mode-btn"]').forEach(btn => {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-outline');
                });
                
                // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                const activeSection = document.getElementById(`${mode}-mode-section`);
                const activeButton = document.getElementById(`${mode}-mode-btn`);
                
                if (activeSection) {
                    activeSection.classList.add('border-green-300');
                    activeSection.style.borderColor = '#22c55e';
                }
                if (activeButton) {
                    activeButton.classList.remove('btn-outline');
                    activeButton.classList.add('btn-primary');
                }
                
                currentMode = mode;
                log(`ğŸ”„ ${mode}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆv1.1.8æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰`, 'info');
            }
            
            // UIè¦ç´ ã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
            function resetAllUIElements() {
                // ã™ã¹ã¦ã®éŸ³é‡ãƒãƒ¼ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
                ['mic', 'range', 'practice'].forEach(mode => {
                    const volumeBar = document.getElementById(`${mode}-volume-bar`);
                    const volumeText = document.getElementById(`${mode}-volume-text`);
                    const frequencyDisplay = document.getElementById(`${mode}-frequency`);
                    
                    if (volumeBar) {
                        // ğŸ”§ CSSè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
                        volumeBar.style.width = '0%';
                        // minWidthã¨maxWidthã‚’å‰Šé™¤ï¼ˆåˆæœŸå€¤ã«æˆ»ã™ï¼‰
                        volumeBar.style.minWidth = '';
                        volumeBar.style.maxWidth = '';
                        volumeBar.style.flexShrink = '';
                    }
                    if (volumeText) volumeText.textContent = '0.0%';
                    if (frequencyDisplay) {
                        frequencyDisplay.textContent = '0 Hz';
                    }
                });
                
                // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã®éŸ³ç¨‹è¡¨ç¤ºã‚‚ãƒªã‚»ãƒƒãƒˆ
                const practiceNote = document.getElementById('practice-note');
                if (practiceNote) practiceNote.textContent = '-';
                
                log('ğŸ§¹ å…¨UIè¦ç´ ãƒªã‚»ãƒƒãƒˆå®Œäº†ï¼ˆCSSå¼·åˆ¶è¨­å®šã‚¯ãƒªã‚¢å«ã‚€ï¼‰', 'info');
            }
            
            // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ç”¨UIè¦ç´ ã®å–å¾—
            function getCurrentModeElements() {
                const prefix = currentMode === 'practice' ? 'practice' : 
                              currentMode === 'range' ? 'range' : 'mic';
                
                return {
                    volumeBar: document.getElementById(`${prefix}-volume-bar`),
                    volumeText: document.getElementById(`${prefix}-volume-text`),
                    frequencyDisplay: document.getElementById(`${prefix}-frequency`),
                    noteDisplay: prefix === 'practice' ? document.getElementById('practice-note') : null
                };
            }
            
            // UIæ›´æ–°é–¢æ•°
            function updateUI(result) {
                const elements = getCurrentModeElements();
                
                // ğŸ” è©³ç´°ãƒ‡ãƒãƒƒã‚°: éŸ³é‡ã®åŒæœŸå•é¡Œèª¿æŸ»
                if (Math.random() < 0.1) { // 10%ã®ç¢ºç‡ã§ãƒ­ã‚°
                    console.group(`ğŸ” UIæ›´æ–°ãƒ‡ãƒãƒƒã‚° [${currentMode}ãƒ¢ãƒ¼ãƒ‰]`);
                    console.log('ğŸ“Š resultå…¨ä½“:', result);
                    console.log('ğŸ”Š result.volumeå€¤:', result.volume);
                    console.log('ğŸ“ˆ typeof result.volume:', typeof result.volume);
                    console.log('ğŸ¯ ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:', currentMode);
                    console.log('ğŸ“ å–å¾—ã—ãŸè¦ç´ :', {
                        volumeBar: elements.volumeBar?.id,
                        volumeText: elements.volumeText?.id,
                        frequencyDisplay: elements.frequencyDisplay?.id
                    });
                }
                
                if (elements.volumeBar) {
                    // PitchProã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨
                    const volumePercent = result.volume || 0;
                    elements.volumeBar.style.width = `${volumePercent}%`;
                    
                    if (Math.random() < 0.1) {
                        console.log(`ğŸ’‰ volumeBarè¨­å®š: width="${volumePercent}%"`);
                        console.log(`ğŸ“ å®Ÿéš›ã®DOM width:`, elements.volumeBar.style.width);
                    }
                }
                if (elements.volumeText) {
                    // PitchProã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ãã®ã¾ã¾è¡¨ç¤º
                    const volumeTextValue = (result.volume || 0).toFixed(1);
                    elements.volumeText.textContent = `${volumeTextValue}%`;
                    
                    if (Math.random() < 0.1) {
                        console.log(`ğŸ“ volumeTextè¨­å®š: "${volumeTextValue}%"`);
                        console.log(`ğŸ“„ å®Ÿéš›ã®DOM text:`, elements.volumeText.textContent);
                    }
                }
                if (elements.frequencyDisplay) {
                    // å‘¨æ³¢æ•°è¡¨ç¤ºï¼ˆpitchã¾ãŸã¯frequencyãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰
                    const frequency = result.pitch || result.frequency || 0;
                    elements.frequencyDisplay.textContent = `${frequency.toFixed(1)} Hz`;
                }
                if (elements.noteDisplay && result.note) {
                    elements.noteDisplay.textContent = result.note;
                }
                
                if (Math.random() < 0.1) {
                    console.groupEnd();
                }
            }
            
            // åˆæœŸåŒ–
            document.getElementById('init-btn').addEventListener('click', async () => {
                try {
                    updateStatus('åˆæœŸåŒ–ä¸­...', 'info');
                    log('ğŸ¤ v1.1.8 æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆæœŸåŒ–é–‹å§‹', 'info');
                    
                    // MicrophoneControllerã‚’åˆæœŸåŒ–
                    microphoneController = new PitchPro.MicrophoneController();
                    await microphoneController.initialize();
                    log('âœ… MicrophoneControlleråˆæœŸåŒ–å®Œäº†', 'success');
                    
                    // PitchDetectorã‚’åˆæœŸåŒ–ï¼ˆå®Œå…¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨ï¼‰
                    const audioManager = microphoneController.audioManager;
                    pitchDetector = new PitchPro.PitchDetector(audioManager);
                    // âš ï¸ é‡è¦: ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãªã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ã¿ä½¿ç”¨
                    
                    await pitchDetector.initialize();
                    log('âœ… PitchDetectoråˆæœŸåŒ–å®Œäº†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼‰', 'success');
                    
                    // ğŸ¯ é‡è¦: PitchDetectorã‚’MicrophoneControllerã«ç™»éŒ²
                    microphoneController.registerDetector(pitchDetector);
                    log('âœ… PitchDetector â†’ MicrophoneController ç™»éŒ²å®Œäº†', 'success');
                    log('ğŸ”— v1.1.9çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', 'success');
                    
                    // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                    pitchDetector.setCallbacks({
                        onPitchUpdate: (result) => {
                            updateUI(result);
                            
                            // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã®éŸ³ç¨‹è¡¨ç¤ºæ›´æ–°ã‚’ç›£è¦–
                            if (currentMode === 'practice' && result.frequency > 0) {
                                const practiceNote = document.querySelector('#practice-note');
                                if (practiceNote && Math.random() < 0.05) { // 5%ã®ç¢ºç‡ã§ãƒ­ã‚°
                                    log(`ğŸ¼ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰éŸ³ç¨‹æ›´æ–°: ${result.frequency?.toFixed(1)}Hz â†’ DOM: "${practiceNote.textContent}"`, 'info');
                                }
                            }
                            
                            // ğŸ” result object debug - å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è©³ç´°ãƒ­ã‚°ï¼ˆ2%ã®ç¢ºç‡ï¼‰
                            if (Math.random() < 0.02) {
                                console.group('ğŸ” PitchPro Result Object Analysis');
                                console.log('ğŸ“Š Full result object:', result);
                                console.log('ğŸ“‹ Available properties:', Object.keys(result));
                                console.log('ğŸµ result.frequency:', result.frequency);
                                console.log('ğŸ”Š result.volume:', result.volume);
                                console.log('ğŸ“ˆ result.stableVolume:', result.stableVolume);
                                console.log('ğŸ’¾ result.volumePercent:', result.volumePercent);
                                console.log('ğŸ¯ result.rawVolume:', result.rawVolume);
                                console.log('ğŸ“Š result.normalizedVolume:', result.normalizedVolume);
                                console.groupEnd();
                                
                                log(`ğŸµ ${result.frequency?.toFixed(1) || 0}Hz, éŸ³é‡åˆ†æ: volume=${result.volume?.toFixed(1) || 0}%, stableVolume=${result.stableVolume?.toFixed(1) || 0}%, volumePercent=${result.volumePercent?.toFixed(1) || 0}%`, 'info');
                            }
                        },
                        onError: (error) => {
                            log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                            updateStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        },
                        onStateChange: (state) => {
                            log(`ğŸ”„ çŠ¶æ…‹å¤‰åŒ–: ${state}`, 'info');
                        }
                    });
                    
                    updateStatus('åˆæœŸåŒ–å®Œäº†', 'success');
                    log('âœ… v1.1.8æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆæœŸåŒ–å®Œäº†', 'success');
                    log('â„¹ï¸ PitchDetector + MicrophoneControllerçµ±åˆç®¡ç†', 'success');
                    
                    // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
                    document.getElementById('init-btn').disabled = true;
                    document.getElementById('start-btn').disabled = false;
                    document.getElementById('mic-mode-btn').disabled = false;
                    document.getElementById('range-mode-btn').disabled = false;
                    document.getElementById('practice-mode-btn').disabled = false;
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚¤ã‚¯ãƒ¢ãƒ¼ãƒ‰
                    updateModeUI('mic');
                    
                } catch (error) {
                    log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    updateStatus(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
            
            // çµ±åˆæ¤œå‡ºé–‹å§‹ãƒœã‚¿ãƒ³ï¼ˆv1.1.9æ–°æ©Ÿèƒ½ï¼‰
            document.getElementById('start-btn').addEventListener('click', async () => {
                if (!microphoneController) return;
                
                try {
                    log('ğŸš€ çµ±åˆstart()å®Ÿè¡Œï¼ˆv1.1.9è£½å“ãƒ¬ãƒ™ãƒ«æ©Ÿèƒ½ï¼‰', 'info');
                    log('  - ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ + æ¤œå‡ºé–‹å§‹ã®ä¸€æ‹¬å®Ÿè¡Œ', 'info');
                    
                    // v1.1.9ã®çµ±åˆstart()ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ç”¨
                    const started = microphoneController.start();
                    
                    if (started) {
                        isDetecting = true;
                        updateStatus('ğŸ¤ éŸ³å£°æ¤œå‡ºä¸­...', 'success');
                        document.getElementById('start-btn').disabled = true;
                        document.getElementById('stop-btn').disabled = false;
                        log('âœ… çµ±åˆstart()å®Œäº† - ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤+æ¤œå‡ºé–‹å§‹', 'success');
                    } else {
                        log('âŒ çµ±åˆstart()ã«å¤±æ•—', 'error');
                    }
                } catch (error) {
                    log(`âŒ çµ±åˆstart()ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
            
            // çµ±åˆæ¤œå‡ºåœæ­¢ãƒœã‚¿ãƒ³ï¼ˆv1.1.9çµ±åˆç®¡ç†ï¼‰
            document.getElementById('stop-btn').addEventListener('click', () => {
                if (!microphoneController) return;
                
                try {
                    log('ğŸ›‘ çµ±åˆreset()å®Ÿè¡Œï¼ˆv1.1.9è£½å“ãƒ¬ãƒ™ãƒ«æ©Ÿèƒ½ï¼‰', 'info');
                    log('  - ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢ + UIãƒªã‚»ãƒƒãƒˆã®ä¸€æ‹¬å®Ÿè¡Œ', 'info');
                    
                    microphoneController.reset();
                    isDetecting = false;
                    
                    updateStatus('éŸ³å£°æ¤œå‡ºåœæ­¢', 'info');
                    document.getElementById('start-btn').disabled = false;
                    document.getElementById('stop-btn').disabled = true;
                    log('âœ… çµ±åˆreset()å®Œäº† - ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢+UIãƒªã‚»ãƒƒãƒˆ', 'success');
                    
                } catch (error) {
                    log(`âŒ çµ±åˆreset()ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
            
            // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆé–¢æ•°ï¼ˆv1.1.9çµ±åˆç®¡ç†å¯¾å¿œï¼‰
            async function switchMode(mode) {
                log(`ğŸ”˜ ${mode}ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ`, 'info');
                
                if (!microphoneController) {
                    log('âŒ MicrophoneControllerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    return;
                }
                
                try {
                    log(`ğŸ”„ ${mode}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆä¸­ï¼ˆv1.1.9çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰...`, 'info');
                    
                    // æ¤œå‡ºä¸­ã‹ã©ã†ã‹ã‚’è¨˜éŒ²
                    const wasDetecting = isDetecting;
                    
                    // v1.1.9çµ±åˆreset()ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢
                    log('ğŸ›‘ çµ±åˆreset()å®Ÿè¡Œä¸­...', 'info');
                    microphoneController.reset();
                    isDetecting = false;
                    log('âœ… çµ±åˆreset()å®Œäº† - ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢+UIãƒªã‚»ãƒƒãƒˆ', 'success');
                    
                    // ãƒ¢ãƒ¼ãƒ‰UIæ›´æ–°
                    updateModeUI(mode);
                    
                    // å¿…è¦ã«å¿œã˜ã¦çµ±åˆstart()ã§å¾©å¸°
                    if (wasDetecting) {
                        setTimeout(() => {
                            log('ğŸš€ çµ±åˆstart()ã§å®Œå…¨å¾©å¸°ä¸­...', 'info');
                            const restarted = microphoneController.start();
                            if (restarted) {
                                isDetecting = true;
                                log('âœ… çµ±åˆstart()å®Œäº† - å®Œå…¨å¾©å¸°', 'success');
                            } else {
                                log('âŒ çµ±åˆstart()å¾©å¸°ã«å¤±æ•—', 'error');
                            }
                        }, 200);
                    }
                    
                    log(`âœ… ${mode}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆv1.1.9çµ±åˆç®¡ç†ï¼‰`, 'success');
                    log(`ğŸ¯ çµ±åˆreset()â†’start()ã«ã‚ˆã‚‹å®Œå…¨ãªãƒ¢ãƒ¼ãƒ‰åˆ†é›¢`, 'info');
                    
                } catch (error) {
                    log(`âŒ ${mode}ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
            
            // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
            document.getElementById('mic-mode-btn').addEventListener('click', () => {
                switchMode('mic');
            });
            
            // éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
            document.getElementById('range-mode-btn').addEventListener('click', () => {
                switchMode('range');
            });
            
            // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰
            document.getElementById('practice-mode-btn').addEventListener('click', () => {
                switchMode('practice');
            });
            
            // åˆæœŸãƒ­ã‚°
            log('âœ… PitchPro v1.1.8æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†', 'success');
            log('ğŸ¯ PitchDetector + MicrophoneControlleråˆ†é›¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œ', 'success');
            log('æ‰‹é †: 1) åˆæœŸåŒ– â†’ 2) æ¤œå‡ºé–‹å§‹ â†’ 3) ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ', 'info');
            updateStatus('æº–å‚™å®Œäº† - åˆæœŸåŒ–ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯', 'success');
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚¤ã‚¯ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
            updateModeUI('mic');
            
        } else {
            console.error('âŒ PitchPro v1.1.8ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            alert('PitchPro v1.1.8ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        }
    </script>
</body>
</html>