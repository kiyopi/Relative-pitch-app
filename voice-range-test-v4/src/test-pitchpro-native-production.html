<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchPro Nativeæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆæœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«ï¼‰</title>
    
    <!-- æœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆä½¿ç”¨ -->
    <link rel="stylesheet" href="../../Bolt/v2/styles/base.css">
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="min-h-screen p-6">
        <div class="container max-w-4xl mx-auto">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">âœ… PitchPro Nativeæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
                <p class="text-yellow-200 text-lg">æœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆä½¿ç”¨ãƒ»UIã‚«ã‚¿ãƒ­ã‚°æº–æ‹ ãƒ»ã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ãªã—</p>
            </header>

            <!-- é‡è¦ãªæ”¹å–„ç‚¹ -->
            <div class="glass-card mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="check-circle" class="text-green-300 icon-md"></i>
                    <h3 class="heading-md text-green-300">PitchPro Nativeæ©Ÿèƒ½æ´»ç”¨ï¼ˆã‚«ã‚¹ã‚¿ãƒ é–¢æ•°æ’é™¤å®Œäº†ï¼‰</h3>
                </div>
                <ul class="text-white-70 space-y-2">
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span>updateSelectors()ã«ã‚ˆã‚‹UIè¦ç´ ã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="check" class="text-green-300 icon-sm"></i>
                        <span>PitchProãŒç®¡ç†ã™ã‚‹å†…éƒ¨çŠ¶æ…‹ã§ã®éŸ³é‡ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="x" class="text-red-300 icon-sm"></i>
                        <span>resetAllVolumeDisplays()ç­‰ã®ã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ã¯å‰Šé™¤</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="x" class="text-red-300 icon-sm"></i>
                        <span>startDetectionWithReset()ç­‰ã®ç‹¬è‡ªãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã¯å‰Šé™¤</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <i data-lucide="x" class="text-red-300 icon-sm"></i>
                        <span>ä¸è¦ãªæ‰‹å‹•DOMæ“ä½œã¯æ’é™¤</span>
                    </li>
                </ul>
            </div>
            
            <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ -->
            <div class="glass-card mb-6">
                <h3 class="heading-md mb-4">
                    <i data-lucide="activity" class="text-blue-300"></i>
                    <span>ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</span>
                </h3>
                <div id="system-status" class="status-card mb-4">åˆæœŸåŒ–å‰...</div>
                
                <div class="flex gap-3 flex-wrap">
                    <button id="init-btn" class="btn btn-primary">
                        <i data-lucide="mic" class="icon-sm"></i>
                        <span>åˆæœŸåŒ–</span>
                    </button>
                    <button id="start-btn" class="btn btn-success" disabled>
                        <i data-lucide="play" class="icon-sm"></i>
                        <span>æ¤œå‡ºé–‹å§‹</span>
                    </button>
                    <button id="stop-btn" class="btn btn-outline" disabled>
                        <i data-lucide="stop-circle" class="icon-sm"></i>
                        <span>æ¤œå‡ºåœæ­¢</span>
                    </button>
                </div>
            </div>
            
            <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="glass-card mb-6">
                <h3 class="heading-md mb-4">
                    <i data-lucide="repeat" class="text-green-300"></i>
                    <span>ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆï¼ˆPitchPro Nativeï¼‰</span>
                </h3>
                <div class="info-card mb-4">
                    <h4 class="text-white font-medium mb-2">ğŸ“Š updateSelectors()ã«ã‚ˆã‚‹é«˜é€Ÿåˆ‡ã‚Šæ›¿ãˆ</h4>
                    <p class="text-white-70">PitchProã®updateSelectors()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€UIè¦ç´ ã‚’ç¬æ™‚ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚å†…éƒ¨çŠ¶æ…‹ã‚‚è‡ªå‹•ç®¡ç†ã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <div class="flex gap-3 flex-wrap">
                    <button id="mic-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="mic" class="icon-sm"></i>
                        <span>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ</span>
                    </button>
                    <button id="range-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="music" class="icon-sm"></i>
                        <span>éŸ³åŸŸãƒ†ã‚¹ãƒˆ</span>
                    </button>
                    <button id="practice-mode-btn" class="btn btn-outline" disabled>
                        <i data-lucide="headphones" class="icon-sm"></i>
                        <span>ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                    </button>
                </div>
            </div>
            
            <!-- ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="mic-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="mic" class="text-blue-300"></i>
                    <span>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">ãƒã‚¤ã‚¯éŸ³é‡</span>
                        <span id="mic-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-blue" id="mic-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <div class="frequency-display text-2xl font-bold text-blue-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg inline-block" id="mic-frequency-display">0 Hz</div>
                </div>
            </div>
            
            <!-- éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="range-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="music" class="text-green-300"></i>
                    <span>éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">æ¸¬å®šéŸ³é‡</span>
                        <span id="range-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-green" id="range-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <div class="frequency-display text-2xl font-bold text-green-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg inline-block" id="range-frequency-display">0 Hz</div>
                </div>
            </div>
            
            <!-- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰UI -->
            <div class="glass-card mb-6" id="practice-mode-section">
                <h3 class="heading-md mb-4">
                    <i data-lucide="headphones" class="text-orange-300"></i>
                    <span>ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                </h3>
                <div class="volume-meter">
                    <div class="flex items-center justify-between mb-2 w-full">
                        <span class="text-white-70">ç·´ç¿’éŸ³é‡</span>
                        <span id="practice-volume-text" class="text-white font-medium">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gradient-catalog-orange" id="practice-volume-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="flex items-center justify-center gap-4 mt-4">
                    <div class="frequency-display text-2xl font-bold text-orange-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg" id="practice-frequency">0 Hz</div>
                    <div class="note-display text-xl font-bold text-yellow-300 bg-black bg-opacity-30 px-4 py-2 rounded-lg" id="practice-note">-</div>
                </div>
            </div>
            
            <!-- ãƒ­ã‚°å‡ºåŠ› -->
            <div class="glass-card">
                <h3 class="heading-md mb-4">
                    <i data-lucide="file-text" class="text-white-70"></i>
                    <span>ãƒ­ã‚°å‡ºåŠ›</span>
                </h3>
                <div id="log-output" class="bg-black bg-opacity-50 p-4 rounded-lg h-64 overflow-y-auto font-mono text-sm"></div>
            </div>
        </div>
    </div>

    <!-- PitchPro v1.2.1 UMDãƒ©ã‚¤ãƒ–ãƒ©ãƒª (æœ€æ–°ç‰ˆãƒ†ã‚¹ãƒˆ) -->
    <!-- PitchPro v1.2.1 - æ–°æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ -->
    <script src="js/pitchpro-v1.2.1.umd.js"></script>
    <script>
        // UMDç‰ˆã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof PitchPro !== 'undefined') {
            console.log('ğŸ‰ PitchPro v1.2.1 UMD loaded successfully - æœ€æ–°ç‰ˆçµ±åˆãƒ†ã‚¹ãƒˆ');
            console.log('Version:', PitchPro.VERSION || 'v1.2.1');
            console.log('Build Date:', PitchPro.BUILD_DATE || 'Latest');
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¹:', Object.keys(PitchPro));
            console.log('ğŸš€ v1.2.1 æœ€æ–°æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½ä¸­!');
            
            // updateSelectorsãƒ¡ã‚½ãƒƒãƒ‰ã®ç¢ºèª
            if (PitchPro.AudioDetectionComponent) {
                const tempInstance = new PitchPro.AudioDetectionComponent({
                    volumeBarSelector: '#test',
                    volumeTextSelector: '#test',
                    frequencySelector: '#test'
                });
                console.log('ğŸ”§ updateSelectors method:', typeof tempInstance.updateSelectors);
                tempInstance.destroy();
            }
            
            // PitchProèª­ã¿è¾¼ã¿å®Œäº†ã‚’é€šçŸ¥
            window.pitchProLoaded = true;
            window.dispatchEvent(new CustomEvent('pitchpro-loaded', { detail: PitchPro }));
        } else {
            console.error('âŒ PitchPro UMD failed to load');
        }
    </script>
    
    <!-- TODO: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ– /js/pitchpro-native-test.js -->
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®£è¨€ï¼ˆæœ€å„ªå…ˆ - PitchProãƒã‚§ãƒƒã‚¯å‰ï¼‰
        let audioDetector = null;
        let currentMode = 'mic';
        let logLines = [];
        let practiceNoteObserver = null;
        let suppressNoteUpdates = false;
        
        // DOMè¦ç´ å–å¾—ï¼ˆPitchProãƒã‚§ãƒƒã‚¯å‰ï¼‰
        const logContainer = document.getElementById('log-output');
        
        // PitchPro UMDç‰ˆã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof PitchPro !== 'undefined') {
            console.log('âœ… PitchPro v1.1.6ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿æˆåŠŸ');
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¹:', Object.keys(PitchPro));
            console.log('ğŸ¯ v1.1.6ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œä¸­ï¼ˆUMDç‰ˆï¼‰');
            
            // ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            
            // PitchPro v1.1.6ã®å®Ÿéš›ã®AudioDetectionComponentã‚’ä½¿ç”¨
            // æ¨¡æ“¬å®Ÿè£…ã¯å‰Šé™¤æ¸ˆã¿ - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã¿ä¿æŒï¼ˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ç”¨ï¼‰
            const AudioDetectionComponent = PitchPro?.AudioDetectionComponent || class FallbackAudioDetector {
            constructor(config) {
                this.config = config;
                this.volumeBarSelector = config.volumeBarSelector;
                this.volumeTextSelector = config.volumeTextSelector;
                this.frequencySelector = config.frequencySelector;
                this.noteSelector = config.noteSelector;
                this.callbacks = {};
                this.isInitialized = false;
                this.isDetecting = false;
                
                // UIè¦ç´ ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                this.volumeBar = null;
                this.volumeText = null;
                this.frequencyElement = null;
                this.noteElement = null;
                
                log('âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: PitchProãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
            
            async initialize() {
                this.cacheElements();
                this.isInitialized = true;
                log('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆæœŸåŒ–å®Œäº†', 'info');
            }
            
            cacheElements() {
                this.volumeBar = document.querySelector(this.volumeBarSelector);
                this.volumeText = document.querySelector(this.volumeTextSelector);
                this.frequencyElement = document.querySelector(this.frequencySelector);
                if (this.noteSelector) {
                    this.noteElement = document.querySelector(this.noteSelector);
                }
            }
            
            updateSelectors(newSelectors) {
                log('ğŸ”„ updateSelectors()å®Ÿè¡Œä¸­...', 'info');
                
                // è‡ªå‹•UIãƒªã‚»ãƒƒãƒˆï¼ˆv1.1.5æ–°æ©Ÿèƒ½ã®æ¨¡æ“¬ï¼‰
                this.resetCurrentUI();
                
                // ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æ›´æ–°
                Object.assign(this.config, newSelectors);
                this.volumeBarSelector = newSelectors.volumeBarSelector || this.volumeBarSelector;
                this.volumeTextSelector = newSelectors.volumeTextSelector || this.volumeTextSelector;
                this.frequencySelector = newSelectors.frequencySelector || this.frequencySelector;
                this.noteSelector = newSelectors.noteSelector || this.noteSelector;
                
                // æ–°ã—ã„è¦ç´ ã‚’å†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                this.cacheElements();
                
                // æ–°ã—ã„UIè¦ç´ ã‚‚ãƒªã‚»ãƒƒãƒˆ
                this.resetCurrentUI();
                
                log('âœ… updateSelectors()å®Œäº† - è‡ªå‹•UIãƒªã‚»ãƒƒãƒˆé©ç”¨æ¸ˆã¿', 'success');
            }
            
            resetCurrentUI() {
                // ç¾åœ¨ã®UIè¦ç´ ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆv1.1.5ã®è‡ªå‹•ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼‰
                if (this.volumeBar) {
                    this.volumeBar.style.width = '0%';
                }
                if (this.volumeText) {
                    this.volumeText.textContent = '0.0%';
                }
                if (this.frequencyElement) {
                    this.frequencyElement.textContent = '0 Hz';
                }
                if (this.noteElement) {
                    this.noteElement.textContent = '-';
                }
                
                // æ–°ã—ã„è¦ç´ ã‚‚ãƒªã‚»ãƒƒãƒˆ
                const newVolumeBar = document.querySelector(this.volumeBarSelector);
                const newVolumeText = document.querySelector(this.volumeTextSelector);
                const newFrequencyElement = document.querySelector(this.frequencySelector);
                const newNoteElement = this.noteSelector ? document.querySelector(this.noteSelector) : null;
                
                if (newVolumeBar) newVolumeBar.style.width = '0%';
                if (newVolumeText) newVolumeText.textContent = '0.0%';
                if (newFrequencyElement) newFrequencyElement.textContent = '0 Hz';
                if (newNoteElement) newNoteElement.textContent = '-';
            }
            
            setCallbacks(callbacks) {
                this.callbacks = callbacks;
                
                // æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆ
                setTimeout(() => {
                    if (this.isDetecting && this.callbacks.onPitchUpdate) {
                        const mockResult = {
                            frequency: Math.random() * 200 + 100,
                            volume: Math.random() * 30 + 10,
                            note: 'A',
                            clarity: 0.8
                        };
                        this.updateUI(mockResult);
                        this.callbacks.onPitchUpdate(mockResult);
                    }
                }, 1000);
            }
            
            updateUI(result) {
                if (this.volumeBar) {
                    this.volumeBar.style.width = `${Math.min(100, result.volume)}%`;
                }
                if (this.volumeText) {
                    this.volumeText.textContent = `${result.volume.toFixed(1)}%`;
                }
                if (this.frequencyElement) {
                    this.frequencyElement.textContent = `${result.frequency.toFixed(1)} Hz`;
                }
                if (this.noteElement && result.note) {
                    this.noteElement.textContent = result.note;
                }
            }
            
            async startDetection() {
                this.isDetecting = true;
                log('â–¶ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡ºé–‹å§‹', 'info');
                return true;
            }
            
            stopDetection() {
                this.isDetecting = false;
                log('â¹ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡ºåœæ­¢', 'info');
            }
            
            destroy() {
                this.stopDetection();
                this.resetCurrentUI();
                log('ğŸ—‘ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç ´æ£„å®Œäº†', 'info');
            }
        }
        
        // LucideåˆæœŸåŒ–
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
        
        // ãƒ­ã‚°å‡ºåŠ›ã‚·ã‚¹ãƒ†ãƒ 
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logLines.push(`[${timestamp}] ${message}`);
            if (logLines.length > 100) logLines.shift();
            
            const logEntry = document.createElement('div');
            logEntry.className = `text-${type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue'}-300 mb-1`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.innerHTML = logLines.map(line => {
                const logType = line.includes('âŒ') ? 'red' : line.includes('âœ…') ? 'green' : 'blue';
                return `<div class="text-${logType}-300 mb-1">${line}</div>`;
            }).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`%c${message}`, `color: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'}`);
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('system-status');
            statusDiv.className = `status-card text-${type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue'}-300`;
            statusDiv.textContent = message;
        }
        
        // UIåˆ‡ã‚Šæ›¿ãˆï¼ˆæœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«æº–æ‹ ï¼‰
        function updateModeUI(mode) {
            // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('[id$="-mode-section"]').forEach(section => {
                section.classList.remove('border-green-300');
                section.style.borderColor = '';
            });
            
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('[id$="-mode-btn"]').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            });
            
            // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            const activeSection = document.getElementById(`${mode}-mode-section`);
            const activeButton = document.getElementById(`${mode}-mode-btn`);
            
            if (activeSection) {
                activeSection.classList.add('border-green-300');
                activeSection.style.borderColor = '#22c55e';
            }
            if (activeButton) {
                activeButton.classList.remove('btn-outline');
                activeButton.classList.add('btn-primary');
            }
            
            currentMode = mode;
            log(`ğŸ”„ ${mode}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆPitchProç®¡ç†ï¼‰`, 'info');
        }
        
        // åˆæœŸåŒ–
        document.getElementById('init-btn').addEventListener('click', async () => {
            try {
                updateStatus('åˆæœŸåŒ–ä¸­...', 'info');
                log('ğŸ¤ AudioDetectionComponentåˆæœŸåŒ–é–‹å§‹', 'info');
                
                // PitchPro v1.1.8 AudioDetectionComponentã‚’ä½¿ç”¨
                if (!PitchPro.AudioDetectionComponent) {
                    log('âŒ AudioDetectionComponentãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    log('åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¹: ' + Object.keys(PitchPro).join(', '), 'error');
                    throw new Error('AudioDetectionComponent not found in PitchPro v1.1.8');
                }
                
                audioDetector = new PitchPro.AudioDetectionComponent({
                    // åˆæœŸè¨­å®š: ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
                    volumeBarSelector: '#mic-volume-bar',
                    volumeTextSelector: '#mic-volume-text',
                    frequencySelector: '#mic-frequency-display',
                    
                    // PitchProæ¨å¥¨è¨­å®š
                    clarityThreshold: 0.4,
                    minVolumeAbsolute: 0.003,
                    deviceOptimization: true,
                    debug: true
                });
                
                
                // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                audioDetector.setCallbacks({
                    onPitchUpdate: (result) => {
                        // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã®éŸ³ç¨‹è¡¨ç¤ºæ›´æ–°ã‚’ç›£è¦–
                        if (currentMode === 'practice' && result.frequency > 0) {
                            const practiceNote = document.querySelector('#practice-note');
                            if (practiceNote && Math.random() < 0.05) { // 5%ã®ç¢ºç‡ã§ãƒ­ã‚°
                                log(`ğŸ¼ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰éŸ³ç¨‹æ›´æ–°: ${result.frequency?.toFixed(1)}Hz â†’ DOM: "${practiceNote.textContent}"`, 'info');
                            }
                        }
                        
                        // ä½é »åº¦ãƒ­ã‚°å‡ºåŠ›ï¼ˆã‚¹ãƒ‘ãƒ é˜²æ­¢ï¼‰
                        if (Math.random() < 0.02) { // 2%ã®ç¢ºç‡
                            log(`ğŸµ ${result.frequency?.toFixed(1) || 0}Hz, éŸ³é‡: ${result.volume?.toFixed(1) || 0}%`, 'info');
                        }
                    },
                    onError: (error) => {
                        log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        updateStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    },
                    onStateChange: (state) => {
                        log(`ğŸ”„ çŠ¶æ…‹å¤‰åŒ–: ${state}`, 'info');
                    }
                });
                
                await audioDetector.initialize();
                
                updateStatus('åˆæœŸåŒ–å®Œäº†', 'success');
                log('âœ… AudioDetectionComponentåˆæœŸåŒ–å®Œäº†', 'success');
                log('â„¹ï¸ PitchPro Nativeæ©Ÿèƒ½ã®ã¿ã‚’ä½¿ç”¨ï¼ˆã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ãªã—ï¼‰', 'success');
                
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
                document.getElementById('init-btn').disabled = true;
                document.getElementById('start-btn').disabled = false;
                document.getElementById('mic-mode-btn').disabled = false;
                document.getElementById('range-mode-btn').disabled = false;
                document.getElementById('practice-mode-btn').disabled = false;
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚¤ã‚¯ãƒ¢ãƒ¼ãƒ‰
                updateModeUI('mic');
                
            } catch (error) {
                log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateStatus(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // æ¤œå‡ºé–‹å§‹ãƒœã‚¿ãƒ³ï¼ˆPitchPro Nativeï¼‰
        document.getElementById('start-btn').addEventListener('click', async () => {
            if (!audioDetector) return;
            
            try {
                log('â–¶ï¸ æ¤œå‡ºé–‹å§‹ï¼ˆPitchPro Nativeï¼‰', 'info');
                
                const started = await audioDetector.startDetection();
                
                if (started) {
                    updateStatus('ğŸ¤ éŸ³å£°æ¤œå‡ºä¸­...', 'success');
                    document.getElementById('start-btn').disabled = true;
                    document.getElementById('stop-btn').disabled = false;
                    log('âœ… éŸ³å£°æ¤œå‡ºé–‹å§‹å®Œäº†', 'success');
                } else {
                    log('âŒ æ¤œå‡ºé–‹å§‹ã«å¤±æ•—', 'error');
                }
            } catch (error) {
                log(`âŒ æ¤œå‡ºé–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // æ¤œå‡ºåœæ­¢ãƒœã‚¿ãƒ³ï¼ˆPitchPro Nativeï¼‰
        document.getElementById('stop-btn').addEventListener('click', () => {
            if (!audioDetector) return;
            
            try {
                log('â¹ æ¤œå‡ºåœæ­¢ï¼ˆPitchPro Nativeï¼‰', 'info');
                
                audioDetector.stopDetection();
                
                updateStatus('éŸ³å£°æ¤œå‡ºåœæ­¢', 'info');
                document.getElementById('start-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
                log('âœ… éŸ³å£°æ¤œå‡ºåœæ­¢å®Œäº†', 'info');
                
            } catch (error) {
                log(`âŒ æ¤œå‡ºåœæ­¢ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆPitchPro updateSelectorsä½¿ç”¨ï¼‰
        document.getElementById('mic-mode-btn').addEventListener('click', async () => {
            log('ğŸ”˜ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'info');
            
            if (!audioDetector) {
                log('âŒ audioDetectorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            
            try {
                log('ğŸ”„ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆä¸­ï¼ˆv1.1.8 updateSelectorsä½¿ç”¨ï¼‰...', 'info');
                
                // ä¸€æ™‚çš„ã«éŸ³å£°æ¤œå‡ºã‚’åœæ­¢
                const wasDetecting = audioDetector && audioDetector.currentState === 'detecting';
                if (wasDetecting) {
                    audioDetector.stopDetection();
                    log('â¸ï¸ UIåˆ‡ã‚Šæ›¿ãˆã®ãŸã‚éŸ³å£°æ¤œå‡ºã‚’ä¸€æ™‚åœæ­¢', 'info');
                }
                
                // PitchPro v1.1.8 æ”¹å–„ç‰ˆupdateSelectorsä½¿ç”¨
                if (typeof audioDetector.updateSelectors === 'function') {
                    await audioDetector.updateSelectors({
                        volumeBarSelector: '#mic-volume-bar',
                        volumeTextSelector: '#mic-volume-text',
                        frequencySelector: '#mic-frequency-display'
                    });
                    log('âœ… v1.1.6 updateSelectorså®Ÿè¡Œå®Œäº†', 'success');
                } else {
                    log('âš ï¸ updateSelectors method not available', 'error');
                    throw new Error('updateSelectors method not found on audioDetector');
                }
                
                // ãƒªã‚»ãƒƒãƒˆå®Œäº†å¾Œã«æ¤œå‡ºã‚’å†é–‹
                setTimeout(() => {
                    if (wasDetecting) {
                        audioDetector.startDetection();
                        log('â–¶ï¸ éŸ³å£°æ¤œå‡ºã‚’å†é–‹', 'info');
                    }
                }, 50);
                
                updateModeUI('mic');
                log('âœ… ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆPitchPro Nativeï¼‰', 'success');
                log('ğŸ¯ updateSelectorså®Ÿè¡Œ: #mic-volume-bar, #mic-volume-text, #mic-frequency-display', 'info');
                
            } catch (error) {
                log(`âŒ ãƒã‚¤ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆPitchPro updateSelectorsä½¿ç”¨ï¼‰
        document.getElementById('range-mode-btn').addEventListener('click', async () => {
            log('ğŸ”˜ éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'info');
            
            if (!audioDetector) {
                log('âŒ audioDetectorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            
            try {
                log('ğŸ”„ éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆä¸­ï¼ˆv1.1.8 updateSelectorsä½¿ç”¨ï¼‰...', 'info');
                
                // ä¸€æ™‚çš„ã«éŸ³å£°æ¤œå‡ºã‚’åœæ­¢
                const wasDetecting = audioDetector && audioDetector.currentState === 'detecting';
                if (wasDetecting) {
                    audioDetector.stopDetection();
                    log('â¸ï¸ UIåˆ‡ã‚Šæ›¿ãˆã®ãŸã‚éŸ³å£°æ¤œå‡ºã‚’ä¸€æ™‚åœæ­¢', 'info');
                }
                
                // PitchPro v1.1.8 æ”¹å–„ç‰ˆupdateSelectorsä½¿ç”¨
                if (typeof audioDetector.updateSelectors === 'function') {
                    await audioDetector.updateSelectors({
                        volumeBarSelector: '#range-volume-bar',
                        volumeTextSelector: '#range-volume-text',
                        frequencySelector: '#range-frequency-display'
                    });
                    log('âœ… v1.1.6 updateSelectorså®Ÿè¡Œå®Œäº†', 'success');
                } else {
                    log('âš ï¸ updateSelectors method not available', 'error');
                    throw new Error('updateSelectors method not found on audioDetector');
                }
                
                // ãƒªã‚»ãƒƒãƒˆå®Œäº†å¾Œã«æ¤œå‡ºã‚’å†é–‹
                setTimeout(() => {
                    if (wasDetecting) {
                        audioDetector.startDetection();
                        log('â–¶ï¸ éŸ³å£°æ¤œå‡ºã‚’å†é–‹', 'info');
                    }
                }, 50);
                
                updateModeUI('range');
                log('âœ… éŸ³åŸŸãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆPitchPro Nativeï¼‰', 'success');
                log('ğŸ¯ updateSelectorså®Ÿè¡Œ: #range-volume-bar, #range-volume-text, #range-frequency-display', 'info');
                
            } catch (error) {
                log(`âŒ éŸ³åŸŸãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼ˆPitchPro updateSelectorsä½¿ç”¨ï¼‰
        document.getElementById('practice-mode-btn').addEventListener('click', async () => {
            log('ğŸ”˜ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'info');
            
            if (!audioDetector) {
                log('âŒ audioDetectorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                log('ğŸ”„ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆä¸­ï¼ˆv1.1.8 updateSelectorsä½¿ç”¨ï¼‰...', 'info');
                
                // ä¸€æ™‚çš„ã«éŸ³å£°æ¤œå‡ºã‚’åœæ­¢
                const wasDetecting = audioDetector && audioDetector.currentState === 'detecting';
                if (wasDetecting) {
                    audioDetector.stopDetection();
                    log('â¸ï¸ UIåˆ‡ã‚Šæ›¿ãˆã®ãŸã‚éŸ³å£°æ¤œå‡ºã‚’ä¸€æ™‚åœæ­¢', 'info');
                }
                
                // PitchPro v1.1.8 æ”¹å–„ç‰ˆupdateSelectorsä½¿ç”¨
                if (typeof audioDetector.updateSelectors === 'function') {
                    await audioDetector.updateSelectors({
                        volumeBarSelector: '#practice-volume-bar',
                        volumeTextSelector: '#practice-volume-text',
                        frequencySelector: '#practice-frequency',
                        noteSelector: '#practice-note'
                    });
                    log('âœ… v1.1.6 updateSelectorså®Ÿè¡Œå®Œäº†', 'success');
                    log('ğŸ¯ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨éŸ³ç¨‹è¡¨ç¤ºã‚‚å«ã‚ã¦å®Œå…¨åˆ†é›¢', 'success');
                } else {
                    log('âš ï¸ updateSelectors method not available', 'error');
                    throw new Error('updateSelectors method not found on audioDetector');
                }
                
                // ãƒªã‚»ãƒƒãƒˆå®Œäº†å¾Œã«æ¤œå‡ºã‚’å†é–‹
                setTimeout(() => {
                    if (wasDetecting) {
                        audioDetector.startDetection();
                        log('â–¶ï¸ éŸ³å£°æ¤œå‡ºã‚’å†é–‹', 'info');
                    }
                }, 50);
                
                updateModeUI('practice');
                log('âœ… ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆPitchPro Nativeï¼‰', 'success');
                log('ğŸ¯ updateSelectorså®Ÿè¡Œ: #practice-volume-bar, #practice-volume-text, #practice-frequency, #practice-note', 'info');
                
            } catch (error) {
                log(`âŒ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // åˆæœŸãƒ­ã‚°
        log('âœ… PitchPro Nativeæ©Ÿèƒ½ã®ã¿å®Ÿè£…ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†', 'success');
        log('ğŸ¯ æœ¬ç•ªã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆä½¿ç”¨ãƒ»UIã‚«ã‚¿ãƒ­ã‚°æº–æ‹ ãƒ»ã‚«ã‚¹ã‚¿ãƒ é–¢æ•°æ’é™¤', 'success');
        log('æ‰‹é †: 1) åˆæœŸåŒ– â†’ 2) æ¤œå‡ºé–‹å§‹ â†’ 3) ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ', 'info');
        updateStatus('æº–å‚™å®Œäº† - åˆæœŸåŒ–ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯', 'success');
        
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚¤ã‚¯ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
            updateModeUI('mic');
            
        } else {
            console.error('âŒ PitchPro v1.1.6ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            alert('PitchPro v1.1.6ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        }
    </script>
</body>
</html>