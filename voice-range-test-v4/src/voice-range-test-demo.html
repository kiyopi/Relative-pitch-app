<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音域テストコントローラー デモ - ワンメソッド呼び出し</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../Bolt/v2/styles/base.css">
    <link rel="stylesheet" href="../../Bolt/v2/styles/results.css">
    <link rel="stylesheet" href="../../Bolt/v2/styles/training.css">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="page-header">
            <div class="page-header-content">
                <div class="page-header-icon-wrapper">
                    <div class="page-header-icon gradient-catalog-purple">
                        <i data-lucide="package" class="text-white" data-stroke-width="2" class="icon-xl"></i>
                    </div>
                </div>
                <div class="page-header-text">
                    <h1 class="page-title">VoiceRangeTestController デモ</h1>
                    <p class="page-subtitle text-purple-200">PitchPro v1.2.1統合版 - ワンメソッド呼び出しで完全な音域テスト</p>
                </div>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="narrow-main">
            <!-- PitchProバージョン情報 -->
            <div class="glass-card mb-6" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(147, 51, 234, 0.15));">
                <h3 class="heading-md">
                    <i data-lucide="info" class="text-purple-300"></i>
                    <span>PitchPro v1.2.1 統合情報</span>
                </h3>
                <div style="padding: 10px 0;">
                    <p class="text-sm text-white-70">🎵 音声処理エンジン: <strong>PitchPro v1.2.1</strong></p>
                    <p class="text-sm text-white-70">📦 AudioDetectionComponent: <strong id="adc-status">確認中...</strong></p>
                    <p class="text-sm text-white-70">🔧 デバイス最適化: <strong id="device-opt">自動検出</strong></p>
                </div>
            </div>

            <!-- マイク許可セクション -->
            <div class="glass-card mb-6">
                <h3 class="heading-md">
                    <i data-lucide="mic" class="text-green-300"></i>
                    <span>マイクロフォン許可</span>
                </h3>

                <div style="text-align: center; padding: 20px 0;">
                    <p class="text-sm text-white-70 mb-4">音域テストを開始するには、マイクの使用許可が必要です</p>

                    <button class="btn btn-primary" id="request-mic-permission">
                        <i data-lucide="mic" class="icon-md"></i>
                        <span>マイク許可を要求</span>
                    </button>

                    <div id="mic-permission-status" style="margin-top: 15px;">
                        <p class="text-sm" id="mic-status-text">マイク許可待機中...</p>
                    </div>
                </div>
            </div>
            
            <!-- 音域テスト実行エリア -->
            <div class="glass-card">
                <div class="section-header">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-section-title">音域テスト実行</h3>
                            <p class="section-description">パッケージ化された統合音域テストシステム</p>
                        </div>
                        <!-- マイクステータスアイコン -->
                        <div class="mic-status-container standby" id="mic-status-container">
                            <i data-lucide="mic" id="mic-status-icon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- メインステータス -->
                <div class="text-center mb-6">
                    <h4 class="text-sub-title main-status-display" id="main-status-text">マイク許可後、音域テストを開始してください</h4>
                </div>
                
                <!-- 音域テストバッジ -->
                <div class="range-test-layout-flex">
                    <div class="range-test-item">
                        <div class="voice-range-display-container">
                            <svg class="voice-stability-svg" width="160" height="160" id="stability-ring">
                                <circle cx="80" cy="80" r="72" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="16"/>
                                <circle cx="80" cy="80" r="72" fill="none" stroke="#3b82f6" stroke-width="16" 
                                        stroke-dasharray="452" stroke-dashoffset="452" 
                                        transform="rotate(-90 80 80)" class="voice-progress-circle"/>
                            </svg>
                            <div class="voice-note-badge">
                                <div id="range-icon" class="icon-4xl text-white" style="display: block;">
                                    <img src="./icons/arrow-down.png" alt="初期アイコン" style="width: 80px; height: 80px; display: block;">
                                </div>
                                <p class="countdown-text" id="countdown-display" style="display: none;">3</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- サブ情報 -->
                <div class="text-center mt-4">
                    <p class="text-sm text-white-70 sub-info-display" id="sub-info-text">待機中...</p>
                </div>

                <!-- 検出状況表示 -->
                <div class="detection-meters" style="margin-top: 24px;">
                    <!-- 音量レベル -->
                    <div class="meter-group" id="range-volume-container">
                        <div class="meter-label">
                            <span>音量レベル</span>
                            <span class="volume-text meter-value" id="range-test-volume-text">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill gradient-catalog-green" 
                                 id="range-test-volume-bar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- 検出周波数 -->
                    <div class="meter-group">
                        <div class="meter-label">
                            <span>検出周波数</span>
                            <span class="meter-value" id="range-test-frequency-value">0 Hz</span>
                        </div>
                    </div>
                </div>
                
                <!-- コントロールボタン -->
                <div class="text-center mt-6">
                    <button class="btn btn-primary" id="begin-range-test-btn" disabled>
                        <i data-lucide="play" class="icon-sm"></i>
                        <span>音域テスト開始</span>
                    </button>

                    <button class="btn btn-outline ml-3" id="stop-range-test-btn" style="display: none;">
                        <i data-lucide="square" class="icon-sm"></i>
                        <span>テスト停止</span>
                    </button>

                    <button class="btn btn-danger ml-3" id="stop-detection-btn" style="display: none;">
                        <i data-lucide="mic-off" class="icon-sm"></i>
                        <span>検出停止</span>
                    </button>

                    <button class="btn btn-secondary ml-3" id="retry-measurement-btn" style="display: none;">
                        <i data-lucide="refresh-cw" class="icon-sm"></i>
                        <span>再測定</span>
                    </button>
                </div>
            </div>
            
            <!-- 結果表示エリア -->
            <div class="glass-card mt-6" id="results-section" style="display: none;">
                <h3 class="heading-md">
                    <i data-lucide="bar-chart-3" class="text-green-300"></i>
                    <span>音域テスト結果</span>
                </h3>

                <!-- 基本結果 -->
                <div class="result-info-container">
                    <div class="result-info-row">
                        <span>🎵 音域範囲</span>
                        <span class="result-info-value" id="result-range">-</span>
                    </div>
                    <div class="result-info-row">
                        <span>🎹 オクターブ数</span>
                        <span class="result-info-value" id="result-octaves">-</span>
                    </div>
                    <div class="result-info-row">
                        <span>🔽 最低音</span>
                        <span class="result-info-value" id="result-low-freq">-</span>
                    </div>
                    <div class="result-info-row">
                        <span>🔼 最高音</span>
                        <span class="result-info-value" id="result-high-freq">-</span>
                    </div>
                </div>

                <!-- 詳細統計 -->
                <div style="margin-top: 20px;">
                    <h4 class="heading-sm">
                        <i data-lucide="activity" class="text-blue-300"></i>
                        <span>測定統計</span>
                    </h4>
                    <div class="result-info-container" id="result-details">
                        <!-- JavaScript で動的に追加される -->
                    </div>
                </div>

                <!-- アクションボタン -->
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="startVoiceRangeTest()">
                        <i data-lucide="refresh-cw" class="icon-sm"></i>
                        <span>再測定</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- 🎵 PitchPro v1.2.1 音声処理エンジン -->
    <script src="js/pitchpro-v1.2.1.umd.js"></script>
    <script>
        // PitchPro v1.2.1 読み込み確認
        console.log('%c📌 PitchPro v1.2.1 Loading...', 'color: #8b5cf6; font-weight: bold; font-size: 14px;');
    </script>

    <!-- 音域テストデモメインスクリプト（PitchPro v1.2.1統合版） -->
    <script type="module" src="js/voice-range-test-demo.js"></script>
</body>
</html>